import{_ as s,o as a,c as n,a as l}from"./app.1e6146c3.js";const B=JSON.parse('{"title":"ipvsadm \u53C2\u6570","description":"","frontmatter":{},"headers":[{"level":2,"title":"ipvsadm\u7B80\u4ECB","slug":"ipvsadm\u7B80\u4ECB"},{"level":2,"title":"ipvsadm\u76F8\u5173\u6587\u4EF6","slug":"ipvsadm\u76F8\u5173\u6587\u4EF6"},{"level":2,"title":"\u8BED\u6CD5","slug":"\u8BED\u6CD5"},{"level":3,"title":"\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1","slug":"\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1"},{"level":3,"title":"\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1\u4E0A\u7684RealServer","slug":"\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1\u4E0A\u7684realserver"},{"level":2,"title":"\u793A\u4F8B","slug":"\u793A\u4F8B"}],"relativePath":"LinuxBasics/LoadBalancer/LVS/ipvsadm \u53C2\u6570.md","lastUpdated":1657272051000}'),p={name:"LinuxBasics/LoadBalancer/LVS/ipvsadm \u53C2\u6570.md"},e=l(`<h1 id="ipvsadm-\u53C2\u6570" tabindex="-1">ipvsadm \u53C2\u6570 <a class="header-anchor" href="#ipvsadm-\u53C2\u6570" aria-hidden="true">#</a></h1><h2 id="ipvsadm\u7B80\u4ECB" tabindex="-1">ipvsadm\u7B80\u4ECB <a class="header-anchor" href="#ipvsadm\u7B80\u4ECB" aria-hidden="true">#</a></h2><p>ipvsadm\u662Flinux\u4E0B\u7684LVS\u865A\u62DF\u670D\u52A1\u5668\u7684\u7BA1\u7406\u5DE5\u5177\uFF0CLVS\u5DE5\u4F5C\u4E8E\u5185\u6838\u7A7A\u95F4\uFF0C\u800Cipvsadm\u5219\u63D0\u4F9B\u4E86\u7528\u6237\u7A7A\u95F4\u7684\u63A5\u53E3\u3002</p><h2 id="ipvsadm\u76F8\u5173\u6587\u4EF6" tabindex="-1">ipvsadm\u76F8\u5173\u6587\u4EF6 <a class="header-anchor" href="#ipvsadm\u76F8\u5173\u6587\u4EF6" aria-hidden="true">#</a></h2><div class="language-"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#dbd7ca;">\u670D\u52A1\u540D:         ipvsadm.service</span></span>
<span class="line"><span style="color:#dbd7ca;">\u4E3B\u7A0B\u5E8F\uFF1A        /usr/sbin/ipvsadm</span></span>
<span class="line"><span style="color:#dbd7ca;">\u89C4\u5219\u4FDD\u5B58\u5DE5\u5177\uFF1A  /usr/sbin/ipvsadm-save</span></span>
<span class="line"><span style="color:#dbd7ca;">\u89C4\u5219\u91CD\u8F7D\u5DE5\u5177\uFF1A  /usr/sbin/ipvsadm-restore</span></span>
<span class="line"><span style="color:#dbd7ca;">\u914D\u7F6E\u6587\u4EF6\uFF1A      /etc/sysconfig/ipvsadm-config</span></span>
<span class="line"><span style="color:#dbd7ca;"></span></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393a34;">\u670D\u52A1\u540D:         ipvsadm.service</span></span>
<span class="line"><span style="color:#393a34;">\u4E3B\u7A0B\u5E8F\uFF1A        /usr/sbin/ipvsadm</span></span>
<span class="line"><span style="color:#393a34;">\u89C4\u5219\u4FDD\u5B58\u5DE5\u5177\uFF1A  /usr/sbin/ipvsadm-save</span></span>
<span class="line"><span style="color:#393a34;">\u89C4\u5219\u91CD\u8F7D\u5DE5\u5177\uFF1A  /usr/sbin/ipvsadm-restore</span></span>
<span class="line"><span style="color:#393a34;">\u914D\u7F6E\u6587\u4EF6\uFF1A      /etc/sysconfig/ipvsadm-config</span></span>
<span class="line"><span style="color:#393a34;"></span></span></code></pre></div><h2 id="\u8BED\u6CD5" tabindex="-1">\u8BED\u6CD5 <a class="header-anchor" href="#\u8BED\u6CD5" aria-hidden="true">#</a></h2><h3 id="\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1" tabindex="-1">\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1 <a class="header-anchor" href="#\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1" aria-hidden="true">#</a></h3><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">ipvsadm -A</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">E -t</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">u</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">f service-address:port </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">-s scheduler</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">-p </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">timeout</span><span style="color:#858585;">]]</span></span>
<span class="line"><span style="color:#DBD7CA;">-A  \u521B\u5EFA\u4E00\u4E2ALVS\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#DBD7CA;">-E  \u4FEE\u6539\u4E00\u4E2ALVS\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#DBD7CA;">-C  \u6E05\u7A7ALVS\u89C4\u5219</span></span>
<span class="line"><span style="color:#DBD7CA;">-R  \u91CD\u8F7DLVS\u89C4\u5219\uFF0C\u91CD\u8F7D\u89C4\u5219\u65F6\u9700\u8981\u5229\u7528\u91CD\u5B9A\u5411</span><span style="color:#CB7676;">&lt;</span></span>
<span class="line"><span style="color:#CB7676;">-S</span><span style="color:#DBD7CA;">  \u4FDD\u5B58</span></span>
<span class="line"><span style="color:#DBD7CA;">-Z  \u6E05\u7A7A\u8BA1\u6570\u5668</span></span>
<span class="line"><span style="color:#CB7676;">-L</span><span style="color:#DBD7CA;">  \u67E5\u770BLVS\u89C4\u5219</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">-n</span><span style="color:#DBD7CA;">\uFF1A        \u4EE5\u6570\u5B57\u5F62\u5F0F\u8F93\u51FA\u5730\u5740\u548C\u7AEF\u53E3\u53F7</span></span>
<span class="line"><span style="color:#DBD7CA;">    --exact\uFF1A   \u6269\u5C55\u4FE1\u606F\uFF0C\u7CBE\u786E\u503C</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">-c</span><span style="color:#DBD7CA;">\uFF1A        \u5F53\u524DIPVS\u8FDE\u63A5\u8F93\u51FA</span></span>
<span class="line"><span style="color:#DBD7CA;">    --stats\uFF1A   \u7EDF\u8BA1\u4FE1\u606F</span></span>
<span class="line"><span style="color:#DBD7CA;">    --rate \uFF1A   \u8F93\u51FA\u901F\u7387\u4FE1\u606F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">ipvsadm -D </span><span style="color:#CB7676;">-t|</span><span style="color:#DBD7CA;">u</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">f service-address</span></span>
<span class="line"><span style="color:#DBD7CA;">-D  \u5220\u9664</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">service-address\uFF1A</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">-t|</span><span style="color:#DBD7CA;">u</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">f\uFF1A\u521B\u5EFALVS\u96C6\u7FA4\u670D\u52A1\u4E3Atcp/udp/firewall mark\u670D\u52A1</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">-t</span><span style="color:#DBD7CA;">\uFF1ATCP\u534F\u8BAE\u7684\u7AEF\u53E3\uFF0CVIP:TCP\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">-u</span><span style="color:#DBD7CA;">\uFF1AUDP\u534F\u8BAE\u7684\u7AEF\u53E3\uFF0CVIP:UDP\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">-f</span><span style="color:#DBD7CA;">\uFF1Afirewall MARK\uFF0C\u6807\u8BB0\uFF0C\u4E00\u4E2A\u6570\u5B57</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">-s scheduler</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">\uFF1A\u6307\u5B9A\u96C6\u7FA4\u7684\u8C03\u5EA6\u7B97\u6CD5\uFF0C\u9ED8\u8BA4\u4E3Awlc</span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">\u52A0\u6743\u6700\u5C11\u94FE\u8DEF</span><span style="color:#858585;">)</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">ipvsadm -A</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">E -t</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">u</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">f service-address:port </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">-s scheduler</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">-p </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">timeout</span><span style="color:#8E8F8B;">]]</span></span>
<span class="line"><span style="color:#393A34;">-A  \u521B\u5EFA\u4E00\u4E2ALVS\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#393A34;">-E  \u4FEE\u6539\u4E00\u4E2ALVS\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#393A34;">-C  \u6E05\u7A7ALVS\u89C4\u5219</span></span>
<span class="line"><span style="color:#393A34;">-R  \u91CD\u8F7DLVS\u89C4\u5219\uFF0C\u91CD\u8F7D\u89C4\u5219\u65F6\u9700\u8981\u5229\u7528\u91CD\u5B9A\u5411</span><span style="color:#AB5959;">&lt;</span></span>
<span class="line"><span style="color:#AB5959;">-S</span><span style="color:#393A34;">  \u4FDD\u5B58</span></span>
<span class="line"><span style="color:#393A34;">-Z  \u6E05\u7A7A\u8BA1\u6570\u5668</span></span>
<span class="line"><span style="color:#AB5959;">-L</span><span style="color:#393A34;">  \u67E5\u770BLVS\u89C4\u5219</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">-n</span><span style="color:#393A34;">\uFF1A        \u4EE5\u6570\u5B57\u5F62\u5F0F\u8F93\u51FA\u5730\u5740\u548C\u7AEF\u53E3\u53F7</span></span>
<span class="line"><span style="color:#393A34;">    --exact\uFF1A   \u6269\u5C55\u4FE1\u606F\uFF0C\u7CBE\u786E\u503C</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">-c</span><span style="color:#393A34;">\uFF1A        \u5F53\u524DIPVS\u8FDE\u63A5\u8F93\u51FA</span></span>
<span class="line"><span style="color:#393A34;">    --stats\uFF1A   \u7EDF\u8BA1\u4FE1\u606F</span></span>
<span class="line"><span style="color:#393A34;">    --rate \uFF1A   \u8F93\u51FA\u901F\u7387\u4FE1\u606F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">ipvsadm -D </span><span style="color:#AB5959;">-t|</span><span style="color:#393A34;">u</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">f service-address</span></span>
<span class="line"><span style="color:#393A34;">-D  \u5220\u9664</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">service-address\uFF1A</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">-t|</span><span style="color:#393A34;">u</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">f\uFF1A\u521B\u5EFALVS\u96C6\u7FA4\u670D\u52A1\u4E3Atcp/udp/firewall mark\u670D\u52A1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">-t</span><span style="color:#393A34;">\uFF1ATCP\u534F\u8BAE\u7684\u7AEF\u53E3\uFF0CVIP:TCP\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">-u</span><span style="color:#393A34;">\uFF1AUDP\u534F\u8BAE\u7684\u7AEF\u53E3\uFF0CVIP:UDP\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">-f</span><span style="color:#393A34;">\uFF1Afirewall MARK\uFF0C\u6807\u8BB0\uFF0C\u4E00\u4E2A\u6570\u5B57</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">-s scheduler</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">\uFF1A\u6307\u5B9A\u96C6\u7FA4\u7684\u8C03\u5EA6\u7B97\u6CD5\uFF0C\u9ED8\u8BA4\u4E3Awlc</span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">\u52A0\u6743\u6700\u5C11\u94FE\u8DEF</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1\u4E0A\u7684realserver" tabindex="-1">\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1\u4E0A\u7684RealServer <a class="header-anchor" href="#\u7BA1\u7406\u96C6\u7FA4\u670D\u52A1\u4E0A\u7684realserver" aria-hidden="true">#</a></h3><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">ipvsadm -a</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">e -t</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">u</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">f service-address -r server-address </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">-g</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">i</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">m</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">-w weight</span><span style="color:#858585;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">server-address\uFF1A</span></span>
<span class="line"><span style="color:#DBD7CA;">\u683C\u5F0F\uFF1Arip</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">:port</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> \u5982\u7701\u7565port\uFF0C\u4E0D\u4F5C\u7AEF\u53E3\u6620\u5C04</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">-a  \u6DFB\u52A0\u4E00\u4E2ARealServer\u5230\u96C6\u7FA4\u4E2D\u3002</span></span>
<span class="line"><span style="color:#DBD7CA;">-d  \u5220\u9664\u4E00\u4E2ARealServer\u670D\u52A1\u5668</span></span>
<span class="line"><span style="color:#DBD7CA;">-r  \u6307\u5B9A\u5C06\u8981\u6DFB\u52A0\u7684Realserver\u7684IP\u5730\u5740\u3002</span></span>
<span class="line"><span style="color:#DBD7CA;">-m  \u8868\u793ALVS\u96C6\u7FA4\u7684\u5DE5\u4F5C\u6A21\u5F0F\u4E3ALVS-NAT\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#DBD7CA;">-g  \u8868\u793ALVS\u96C6\u7FA4\u7684\u5DE5\u4F5C\u6A21\u5F0F\u4E3ALVS-DR\u6A21\u5F0F\uFF0C\u9ED8\u8BA4</span></span>
<span class="line"><span style="color:#DBD7CA;">-i  \u8868\u793ALVS\u96C6\u7FA4\u7684\u5DE5\u4F5C\u6A21\u5F0F\u4E3ALVS-TUN\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#DBD7CA;">-w  \u6743\u91CD</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">ipvsadm -a</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">e -t</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">u</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">f service-address -r server-address </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">-g</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">i</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">m</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">-w weight</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">server-address\uFF1A</span></span>
<span class="line"><span style="color:#393A34;">\u683C\u5F0F\uFF1Arip</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">:port</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> \u5982\u7701\u7565port\uFF0C\u4E0D\u4F5C\u7AEF\u53E3\u6620\u5C04</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">-a  \u6DFB\u52A0\u4E00\u4E2ARealServer\u5230\u96C6\u7FA4\u4E2D\u3002</span></span>
<span class="line"><span style="color:#393A34;">-d  \u5220\u9664\u4E00\u4E2ARealServer\u670D\u52A1\u5668</span></span>
<span class="line"><span style="color:#393A34;">-r  \u6307\u5B9A\u5C06\u8981\u6DFB\u52A0\u7684Realserver\u7684IP\u5730\u5740\u3002</span></span>
<span class="line"><span style="color:#393A34;">-m  \u8868\u793ALVS\u96C6\u7FA4\u7684\u5DE5\u4F5C\u6A21\u5F0F\u4E3ALVS-NAT\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#393A34;">-g  \u8868\u793ALVS\u96C6\u7FA4\u7684\u5DE5\u4F5C\u6A21\u5F0F\u4E3ALVS-DR\u6A21\u5F0F\uFF0C\u9ED8\u8BA4</span></span>
<span class="line"><span style="color:#393A34;">-i  \u8868\u793ALVS\u96C6\u7FA4\u7684\u5DE5\u4F5C\u6A21\u5F0F\u4E3ALVS-TUN\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#393A34;">-w  \u6743\u91CD</span></span>
<span class="line"></span></code></pre></div><h2 id="\u793A\u4F8B" tabindex="-1">\u793A\u4F8B <a class="header-anchor" href="#\u793A\u4F8B" aria-hidden="true">#</a></h2><ol><li>\u7BA1\u7406\u865A\u62DF\u670D\u52A1</li></ol><ul><li>\u6DFB\u52A0\u4E00\u4E2A\u865A\u62DF\u670D\u52A1192.168.1.100:80\uFF0C\u4F7F\u7528\u8F6E\u8BE2\u7B97\u6CD5</li></ul><p><code>ipvsadm -A -t 192.168.1.100:80 -s rr</code></p><ul><li>\u4FEE\u6539\u865A\u62DF\u670D\u52A1\u7684\u7B97\u6CD5\u4E3A\u52A0\u6743\u8F6E\u8BE2</li></ul><p><code>ipvsadm -E -t 192.168.1.100:80 -s wrr</code></p><ul><li>\u5220\u9664\u865A\u62DF\u670D\u52A1</li></ul><p><code>ipvsadm -D -t 192.168.1.100:80</code></p><ol start="2"><li>\u7BA1\u7406\u771F\u5B9E\u670D\u52A1</li></ol><ul><li>\u6DFB\u52A0\u4E00\u4E2A\u771F\u5B9E\u670D\u52A1\u5668192.168.1.123\uFF0C\u4F7F\u7528DR\u6A21\u5F0F\uFF0C\u6743\u91CD2</li></ul><p><code>ipvsadm -a -t 192.168.1.100:80 -r 192.168.1.123 -g -w 2</code></p><ul><li>\u4FEE\u6539\u771F\u5B9E\u670D\u52A1\u5668\u7684\u6743\u91CD</li></ul><p><code>ipvsadm -a -t 192.168.1.100:80 -r 192.168.1.123 -g -w 5</code></p><ul><li>\u5220\u9664\u771F\u5B9E\u670D\u52A1\u5668</li></ul><p><code>ipvsadm -d -t 192.168.1.100:80 -r 192.168.1.123</code></p><ol start="3"><li>\u67E5\u770B\u7EDF\u8BA1</li></ol><ul><li>\u67E5\u770B\u5F53\u524D\u914D\u7F6E\u7684\u865A\u62DF\u670D\u52A1\u548C\u5404\u4E2ARS\u7684\u6743\u91CD</li></ul><p><code>ipvsadm -Ln</code></p><ul><li>\u67E5\u770B\u5F53\u524Dipvs\u6A21\u5757\u4E2D\u8BB0\u5F55\u7684\u8FDE\u63A5\uFF08\u53EF\u7528\u4E8E\u89C2\u5BDF\u8F6C\u53D1\u60C5\u51B5\uFF09</li></ul><p><code>ipvsadm -lnc</code></p><ul><li>\u67E5\u770Bipvs\u6A21\u5757\u7684\u8F6C\u53D1\u60C5\u51B5\u7EDF\u8BA1</li></ul><p><code>ipvsadm -Ln --stats | --rate</code></p>`,32),o=[e];function c(r,t,i,y,d,A){return a(),n("div",null,o)}var v=s(p,[["render",c]]);export{B as __pageData,v as default};
