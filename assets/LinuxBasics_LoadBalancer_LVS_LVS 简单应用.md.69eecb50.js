import{_ as s,o as n,c as a,a as l}from"./app.1e6146c3.js";const C=JSON.parse('{"title":"LVS \u7B80\u5355\u5E94\u7528","description":"","frontmatter":{},"headers":[{"level":2,"title":"NAT\u6A21\u5F0F","slug":"nat\u6A21\u5F0F"},{"level":2,"title":"DR\u6A21\u5F0F","slug":"dr\u6A21\u5F0F"},{"level":2,"title":"TUN\u6A21\u5F0F","slug":"tun\u6A21\u5F0F"},{"level":2,"title":"FullNAT\u6A21\u5F0F","slug":"fullnat\u6A21\u5F0F"}],"relativePath":"LinuxBasics/LoadBalancer/LVS/LVS \u7B80\u5355\u5E94\u7528.md","lastUpdated":1657272051000}'),p={name:"LinuxBasics/LoadBalancer/LVS/LVS \u7B80\u5355\u5E94\u7528.md"},o=l(`<h1 id="lvs-\u7B80\u5355\u5E94\u7528" tabindex="-1">LVS \u7B80\u5355\u5E94\u7528 <a class="header-anchor" href="#lvs-\u7B80\u5355\u5E94\u7528" aria-hidden="true">#</a></h1><p>\u4EE5\u4E0Bmaster\u4E3B\u673A\u4E3A<code>172.16.1.134</code>\uFF0CVIP\u5730\u5740\u4E3A<code>172.16.1.111</code>\uFF0C\u540E\u7AEFRS1\u4E3A<code>172.16.1.135</code>\uFF0CRS2\u4E3A<code>172.16.1.136</code>.</p><h2 id="nat\u6A21\u5F0F" tabindex="-1">NAT\u6A21\u5F0F <a class="header-anchor" href="#nat\u6A21\u5F0F" aria-hidden="true">#</a></h2><ol><li>\u5F00\u542F\u8C03\u5EA6\u5668VS\u4E3B\u673A\u7684\u5305\u8F6C\u53D1\u529F\u80FD\uFF08CentOS7\u9ED8\u8BA4\u4E3A\u5173\u95ED\u72B6\u6001\uFF09</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;net.ipv4.ip_forward = 1&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;&gt;</span><span style="color:#DBD7CA;"> /etc/sysctl.conf </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CA;"> sysctl -p</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;net.ipv4.ip_forward = 1&quot;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;&gt;</span><span style="color:#393A34;"> /etc/sysctl.conf </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> sysctl -p</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u521B\u5EFA\u4E00\u4E2ALVS-NAT\u96C6\u7FA4</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># \u5728master\u4E3B\u673A\u4E0A</span></span>
<span class="line"><span style="color:#DBD7CA;">ipvsadm -A -t 172.16.1.134:80 -s rr</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u5728master\u4E3B\u673A\u4E0A</span></span>
<span class="line"><span style="color:#393A34;">ipvsadm -A -t 172.16.1.134:80 -s rr</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u6DFB\u52A0\u540E\u7AEFRealServer</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;"> ipvsadm -a -t 172.16.1.134:80 -m -r  172.16.1.135:80</span></span>
<span class="line"><span style="color:#DBD7CA;"> ipvsadm -a -t 172.16.1.134:80 -m -r  172.16.1.136:80</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;"> ipvsadm -a -t 172.16.1.134:80 -m -r  172.16.1.135:80</span></span>
<span class="line"><span style="color:#393A34;"> ipvsadm -a -t 172.16.1.134:80 -m -r  172.16.1.136:80</span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>\u67E5\u770B\u96C6\u7FA4\u72B6\u6001</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ipvsadm -Ln</span></span>
<span class="line"><span style="color:#DBD7CA;">IP Virtual Server version 1.2.1 </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">size=4096</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">Prot LocalAddress:Port Scheduler Flags</span></span>
<span class="line"><span style="color:#DBD7CA;">  -</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span>
<span class="line"><span style="color:#DBD7CA;">TCP  172.16.1.134:80 rr</span></span>
<span class="line"><span style="color:#DBD7CA;">  -</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> 172.16.1.135:80              Masq    1      0          0         </span></span>
<span class="line"><span style="color:#DBD7CA;">  -</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> 172.16.1.136:80              Masq    1      0          0         </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ipvsadm -Ln</span></span>
<span class="line"><span style="color:#393A34;">IP Virtual Server version 1.2.1 </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">size=4096</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">Prot LocalAddress:Port Scheduler Flags</span></span>
<span class="line"><span style="color:#393A34;">  -</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span>
<span class="line"><span style="color:#393A34;">TCP  172.16.1.134:80 rr</span></span>
<span class="line"><span style="color:#393A34;">  -</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> 172.16.1.135:80              Masq    1      0          0         </span></span>
<span class="line"><span style="color:#393A34;">  -</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> 172.16.1.136:80              Masq    1      0          0         </span></span>
<span class="line"></span></code></pre></div><ol start="5"><li>\u4FDD\u5B58ipvs\u5F53\u524D\u89C4\u5219\u5230\u6307\u5B9A\u6587\u4EF6</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;"> ipvsadm-save -n </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /etc/sysconfig/ipvsadm</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;"> ipvsadm-save -n </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /etc/sysconfig/ipvsadm</span></span>
<span class="line"></span></code></pre></div><ol start="6"><li>\u6D4B\u8BD5</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">true</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CA;"> curl 172.16.1.134 </span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> sleep 1</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">done</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">while</span><span style="color:#393A34;"> </span><span style="color:#B58451;">true</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">do</span><span style="color:#393A34;"> curl 172.16.1.134 </span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> sleep 1</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">done</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"></span></code></pre></div><ol start="7"><li>\u4FEE\u6539\u8C03\u5EA6\u7B97\u6CD5\u548C\u540E\u7AEFRS\u6743\u91CD</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;"> ipvsadm -E -t 172.16.1.134:80 -s wrr		</span><span style="color:#758575;"># \u4FEE\u6539\u8C03\u5EA6\u7B97\u6CD5\u4E3Awrr</span></span>
<span class="line"><span style="color:#DBD7CA;"> ipvsadm -e -t 172.16.1.134:80 -m -r 172.16.1.135:80 -w 2		</span><span style="color:#758575;"># RS1\u6743\u91CD\u6539\u4E3A2</span></span>
<span class="line"><span style="color:#DBD7CA;"> ipvsadm -e -t 172.16.1.134:80 -m -r 172.16.1.136:80 -w 1		</span><span style="color:#758575;"># RS2\u6743\u91CD\u6539\u4E3A1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;"> ipvsadm -E -t 172.16.1.134:80 -s wrr		</span><span style="color:#A0ADA0;"># \u4FEE\u6539\u8C03\u5EA6\u7B97\u6CD5\u4E3Awrr</span></span>
<span class="line"><span style="color:#393A34;"> ipvsadm -e -t 172.16.1.134:80 -m -r 172.16.1.135:80 -w 2		</span><span style="color:#A0ADA0;"># RS1\u6743\u91CD\u6539\u4E3A2</span></span>
<span class="line"><span style="color:#393A34;"> ipvsadm -e -t 172.16.1.134:80 -m -r 172.16.1.136:80 -w 1		</span><span style="color:#A0ADA0;"># RS2\u6743\u91CD\u6539\u4E3A1</span></span>
<span class="line"></span></code></pre></div><h2 id="dr\u6A21\u5F0F" tabindex="-1">DR\u6A21\u5F0F <a class="header-anchor" href="#dr\u6A21\u5F0F" aria-hidden="true">#</a></h2><ol><li>\u914D\u7F6ELVS-master\u4E3B\u673A\uFF0C\u811A\u672C\u5982\u4E0B</li></ol><div class="language-shell"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;">#!/bin/bash</span></span>
<span class="line"><span style="color:#DBD7CA;">vip=</span><span style="color:#C98A7D;">&#39;172.16.1.111&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">iface=</span><span style="color:#C98A7D;">&#39;ens33:1&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">mask=</span><span style="color:#C98A7D;">&#39;255.255.255.255&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">port=</span><span style="color:#C98A7D;">&#39;80&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">rs1=</span><span style="color:#C98A7D;">&#39;172.16.1.135&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">rs2=</span><span style="color:#C98A7D;">&#39;172.16.1.136&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">scheduler=</span><span style="color:#C98A7D;">&#39;rr&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">type=</span><span style="color:#C98A7D;">&#39;-g&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">case</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">1</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span></span>
<span class="line"><span style="color:#DBD7CA;">start</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">   ifconfig </span><span style="color:#858585;">$</span><span style="color:#B8A965;">iface</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">vip</span><span style="color:#DBD7CA;"> netmask </span><span style="color:#858585;">$</span><span style="color:#B8A965;">mask</span><span style="color:#DBD7CA;"> broadcast </span><span style="color:#858585;">$</span><span style="color:#B8A965;">vip</span><span style="color:#DBD7CA;"> up</span></span>
<span class="line"><span style="color:#DBD7CA;">    iptables -F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">    ipvsadm -A -t </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">vip</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">:</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">port</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;"> -s </span><span style="color:#858585;">$</span><span style="color:#B8A965;">scheduler</span></span>
<span class="line"><span style="color:#DBD7CA;">    ipvsadm -a -t </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">vip</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">:</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">port</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;"> -r </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">rs1</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">type</span></span>
<span class="line"><span style="color:#DBD7CA;">    ipvsadm -a -t </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">vip</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">:</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">port</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;"> -r </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">rs2</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">type</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;The LVS Server is Ready!&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#DBD7CA;">stop</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">    ipvsadm -C</span></span>
<span class="line"><span style="color:#DBD7CA;">    ifconfig </span><span style="color:#858585;">$</span><span style="color:#B8A965;">iface</span><span style="color:#DBD7CA;"> down</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;The LVS Server is STOPPED!&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;Usage: $(basename </span><span style="color:#858585;">$</span><span style="color:#C98A7D;">0) start|stop&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">exit</span><span style="color:#DBD7CA;"> 1</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#4D9375;">esac</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">#!/bin/bash</span></span>
<span class="line"><span style="color:#393A34;">vip=</span><span style="color:#B56959;">&#39;172.16.1.111&#39;</span></span>
<span class="line"><span style="color:#393A34;">iface=</span><span style="color:#B56959;">&#39;ens33:1&#39;</span></span>
<span class="line"><span style="color:#393A34;">mask=</span><span style="color:#B56959;">&#39;255.255.255.255&#39;</span></span>
<span class="line"><span style="color:#393A34;">port=</span><span style="color:#B56959;">&#39;80&#39;</span></span>
<span class="line"><span style="color:#393A34;">rs1=</span><span style="color:#B56959;">&#39;172.16.1.135&#39;</span></span>
<span class="line"><span style="color:#393A34;">rs2=</span><span style="color:#B56959;">&#39;172.16.1.136&#39;</span></span>
<span class="line"><span style="color:#393A34;">scheduler=</span><span style="color:#B56959;">&#39;rr&#39;</span></span>
<span class="line"><span style="color:#393A34;">type=</span><span style="color:#B56959;">&#39;-g&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1C6B48;">case</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">1</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span></span>
<span class="line"><span style="color:#393A34;">start</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">   ifconfig </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">iface</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">vip</span><span style="color:#393A34;"> netmask </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">mask</span><span style="color:#393A34;"> broadcast </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">vip</span><span style="color:#393A34;"> up</span></span>
<span class="line"><span style="color:#393A34;">    iptables -F</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    ipvsadm -A -t </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">vip</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">:</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">port</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;"> -s </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">scheduler</span></span>
<span class="line"><span style="color:#393A34;">    ipvsadm -a -t </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">vip</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">:</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">port</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;"> -r </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">rs1</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">type</span></span>
<span class="line"><span style="color:#393A34;">    ipvsadm -a -t </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">vip</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">:</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">port</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;"> -r </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">rs2</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">type</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;The LVS Server is Ready!&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#393A34;">stop</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">    ipvsadm -C</span></span>
<span class="line"><span style="color:#393A34;">    ifconfig </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">iface</span><span style="color:#393A34;"> down</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;The LVS Server is STOPPED!&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;Usage: $(basename </span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">0) start|stop&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">exit</span><span style="color:#393A34;"> 1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#1C6B48;">esac</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u914D\u7F6E\u540E\u7AEFRS\uFF0C\u811A\u672C\u5982\u4E0B</li></ol><div class="language-shell"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;">#!/bin/bash</span></span>
<span class="line"><span style="color:#DBD7CA;">vip=</span><span style="color:#C98A7D;">&#39;172.16.1.111&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">mask=</span><span style="color:#C98A7D;">&#39;255.255.255.255&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">dev=</span><span style="color:#C98A7D;">&#39;lo:1&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">case</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">1</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span></span>
<span class="line"><span style="color:#DBD7CA;">start</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> 1 </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /proc/sys/net/ipv4/conf/all/arp_ignore</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> 1 </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /proc/sys/net/ipv4/conf/lo/arp_ignore</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> 2 </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /proc/sys/net/ipv4/conf/all/arp_announce</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> 2 </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /proc/sys/net/ipv4/conf/lo/arp_announce</span></span>
<span class="line"><span style="color:#858585;">   </span><span style="color:#758575;"># ifconfig $dev $vip netmask $mask</span></span>
<span class="line"><span style="color:#DBD7CA;">    ip addr add </span><span style="color:#858585;">$</span><span style="color:#B8A965;">vip</span><span style="color:#DBD7CA;">/32 label lo:1 dev lo</span></span>
<span class="line"><span style="color:#858585;">    </span><span style="color:#758575;">#route add -host $vip dev $dev</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;The RS Server is Ready!&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#DBD7CA;">stop</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">    ifconfig </span><span style="color:#858585;">$</span><span style="color:#B8A965;">dev</span><span style="color:#DBD7CA;"> down</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> 0 </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /proc/sys/net/ipv4/conf/all/arp_ignore</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> 0 </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /proc/sys/net/ipv4/conf/lo/arp_ignore</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> 0 </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /proc/sys/net/ipv4/conf/all/arp_announce</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> 0 </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /proc/sys/net/ipv4/conf/lo/arp_announce</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;The RS Server is Canceled!&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;Usage: $(basename </span><span style="color:#858585;">$</span><span style="color:#C98A7D;">0) start|stop&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">exit</span><span style="color:#DBD7CA;"> 1</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#4D9375;">esac</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">#!/bin/bash</span></span>
<span class="line"><span style="color:#393A34;">vip=</span><span style="color:#B56959;">&#39;172.16.1.111&#39;</span></span>
<span class="line"><span style="color:#393A34;">mask=</span><span style="color:#B56959;">&#39;255.255.255.255&#39;</span></span>
<span class="line"><span style="color:#393A34;">dev=</span><span style="color:#B56959;">&#39;lo:1&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1C6B48;">case</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">1</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span></span>
<span class="line"><span style="color:#393A34;">start</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> 1 </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /proc/sys/net/ipv4/conf/all/arp_ignore</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> 1 </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /proc/sys/net/ipv4/conf/lo/arp_ignore</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> 2 </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /proc/sys/net/ipv4/conf/all/arp_announce</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> 2 </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /proc/sys/net/ipv4/conf/lo/arp_announce</span></span>
<span class="line"><span style="color:#8E8F8B;">   </span><span style="color:#A0ADA0;"># ifconfig $dev $vip netmask $mask</span></span>
<span class="line"><span style="color:#393A34;">    ip addr add </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">vip</span><span style="color:#393A34;">/32 label lo:1 dev lo</span></span>
<span class="line"><span style="color:#8E8F8B;">    </span><span style="color:#A0ADA0;">#route add -host $vip dev $dev</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;The RS Server is Ready!&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#393A34;">stop</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">    ifconfig </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">dev</span><span style="color:#393A34;"> down</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> 0 </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /proc/sys/net/ipv4/conf/all/arp_ignore</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> 0 </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /proc/sys/net/ipv4/conf/lo/arp_ignore</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> 0 </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /proc/sys/net/ipv4/conf/all/arp_announce</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> 0 </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /proc/sys/net/ipv4/conf/lo/arp_announce</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;The RS Server is Canceled!&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;Usage: $(basename </span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">0) start|stop&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">exit</span><span style="color:#393A34;"> 1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#1C6B48;">esac</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u5BA2\u6237\u673A\u6D4B\u8BD5</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">suofeiya@suofeiya-15ISK:</span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">$  </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">true</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CA;"> curl 172.16.1.111</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> sleep 1 </span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">done</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">suofeiya@suofeiya-15ISK:</span><span style="color:#AB5959;">~</span><span style="color:#393A34;">$  </span><span style="color:#1C6B48;">while</span><span style="color:#393A34;"> </span><span style="color:#B58451;">true</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">do</span><span style="color:#393A34;"> curl 172.16.1.111</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> sleep 1 </span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">done</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"></span></code></pre></div><h2 id="tun\u6A21\u5F0F" tabindex="-1">TUN\u6A21\u5F0F <a class="header-anchor" href="#tun\u6A21\u5F0F" aria-hidden="true">#</a></h2><ol><li>\u6DFB\u52A0IP\u96A7\u9053\u6A21\u5757</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> modprobe ipip</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ip a show</span></span>
<span class="line"><span style="color:#DBD7CA;">1: lo: </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">LOOPBACK,UP,LOWER_UP</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span></span>
<span class="line"><span style="color:#DBD7CA;">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></span>
<span class="line"><span style="color:#DBD7CA;">    inet 127.0.0.1/8 scope host lo</span></span>
<span class="line"><span style="color:#DBD7CA;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#DBD7CA;">    inet6 ::1/128 scope host </span></span>
<span class="line"><span style="color:#DBD7CA;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#DBD7CA;">2: ens33: </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">BROADCAST,MULTICAST,UP,LOWER_UP</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span></span>
<span class="line"><span style="color:#DBD7CA;">    link/ether 00:0c:29:00:55:c3 brd ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#DBD7CA;">    inet 172.16.1.134/24 brd 172.16.1.255 scope global noprefixroute dynamic ens33</span></span>
<span class="line"><span style="color:#DBD7CA;">       valid_lft 1131sec preferred_lft 1131sec</span></span>
<span class="line"><span style="color:#DBD7CA;">    inet6 fe80::20c:29ff:fe00:55c3/64 scope link </span></span>
<span class="line"><span style="color:#DBD7CA;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#DBD7CA;">3: tunl0@NONE: </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">NOARP</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> mtu 1480 qdisc noop state DOWN group default qlen 1000</span></span>
<span class="line"><span style="color:#DBD7CA;">    link/ipip 0.0.0.0 brd 0.0.0.0</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> modprobe ipip</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ip a show</span></span>
<span class="line"><span style="color:#393A34;">1: lo: </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">LOOPBACK,UP,LOWER_UP</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span></span>
<span class="line"><span style="color:#393A34;">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span></span>
<span class="line"><span style="color:#393A34;">    inet 127.0.0.1/8 scope host lo</span></span>
<span class="line"><span style="color:#393A34;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#393A34;">    inet6 ::1/128 scope host </span></span>
<span class="line"><span style="color:#393A34;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#393A34;">2: ens33: </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">BROADCAST,MULTICAST,UP,LOWER_UP</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span></span>
<span class="line"><span style="color:#393A34;">    link/ether 00:0c:29:00:55:c3 brd ff:ff:ff:ff:ff:ff</span></span>
<span class="line"><span style="color:#393A34;">    inet 172.16.1.134/24 brd 172.16.1.255 scope global noprefixroute dynamic ens33</span></span>
<span class="line"><span style="color:#393A34;">       valid_lft 1131sec preferred_lft 1131sec</span></span>
<span class="line"><span style="color:#393A34;">    inet6 fe80::20c:29ff:fe00:55c3/64 scope link </span></span>
<span class="line"><span style="color:#393A34;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#393A34;">3: tunl0@NONE: </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">NOARP</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> mtu 1480 qdisc noop state DOWN group default qlen 1000</span></span>
<span class="line"><span style="color:#393A34;">    link/ipip 0.0.0.0 brd 0.0.0.0</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u6DFB\u52A0VIP\u5730\u5740\u5230<code>tunl0</code>\u7F51\u5361\u4E0A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ip addr add 172.16.1.111/32 dev tunl0</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ip addr add 172.16.1.111/32 dev tunl0</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u6DFB\u52A0\u5E76\u67E5\u770B\u89C4\u5219</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ipvsadm -A -t 172.16.1.111:80 -s rr</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ipvsadm -a -t  172.16.1.111:80 -r 172.16.1.134:80 -i</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ipvsadm -a -t  172.16.1.111:80 -r 172.16.1.135:80 -i</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ipvsadm -Ln</span></span>
<span class="line"><span style="color:#DBD7CA;">IP Virtual Server version 1.2.1 </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">size=4096</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">Prot LocalAddress:Port Scheduler Flags</span></span>
<span class="line"><span style="color:#DBD7CA;">  -</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span>
<span class="line"><span style="color:#DBD7CA;">TCP  172.16.1.111:80 rr</span></span>
<span class="line"><span style="color:#DBD7CA;">  -</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> 172.16.1.134:80              Tunnel  1      0          0         </span></span>
<span class="line"><span style="color:#DBD7CA;">  -</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> 172.16.1.135:80              Tunnel  1      0          0         </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ipvsadm -A -t 172.16.1.111:80 -s rr</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ipvsadm -a -t  172.16.1.111:80 -r 172.16.1.134:80 -i</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ipvsadm -a -t  172.16.1.111:80 -r 172.16.1.135:80 -i</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ipvsadm -Ln</span></span>
<span class="line"><span style="color:#393A34;">IP Virtual Server version 1.2.1 </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">size=4096</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">Prot LocalAddress:Port Scheduler Flags</span></span>
<span class="line"><span style="color:#393A34;">  -</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span>
<span class="line"><span style="color:#393A34;">TCP  172.16.1.111:80 rr</span></span>
<span class="line"><span style="color:#393A34;">  -</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> 172.16.1.134:80              Tunnel  1      0          0         </span></span>
<span class="line"><span style="color:#393A34;">  -</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> 172.16.1.135:80              Tunnel  1      0          0         </span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>\u540E\u7AEFRS</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@node01 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> modprobe ipip</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@node01 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ip addr add 172.16.1.111/32 dev tunl0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@node02 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> modprobe ipip</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@node02 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ip addr add 172.16.1.111/32 dev tunl0</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@node01 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> modprobe ipip</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@node01 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ip addr add 172.16.1.111/32 dev tunl0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@node02 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> modprobe ipip</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@node02 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ip addr add 172.16.1.111/32 dev tunl0</span></span>
<span class="line"></span></code></pre></div><ol start="5"><li>\u6FC0\u6D3B\u5404\u8282\u70B9\u96A7\u9053\u6A21\u5F0F</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ip link </span><span style="color:#E0A569;">set</span><span style="color:#DBD7CA;"> up tunl0</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@node01 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ip link </span><span style="color:#E0A569;">set</span><span style="color:#DBD7CA;"> up tunl0</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@node02 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ip link </span><span style="color:#E0A569;">set</span><span style="color:#DBD7CA;"> up tunl0</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ip link </span><span style="color:#B58451;">set</span><span style="color:#393A34;"> up tunl0</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@node01 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ip link </span><span style="color:#B58451;">set</span><span style="color:#393A34;"> up tunl0</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@node02 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ip link </span><span style="color:#B58451;">set</span><span style="color:#393A34;"> up tunl0</span></span>
<span class="line"></span></code></pre></div><ol start="6"><li>\u5173\u95ED\u5185\u6838\u76F8\u5173\u529F\u80FD\u53CA\u5BF9\u6570\u636E\u5305\u7684\u6821\u9A8C(\u4EE5node01\u8282\u70B9\u4E3A\u4F8B\uFF0Cnode02\u8282\u70B9\u4E00\u6837)</li></ol><p>\u200B \u4E3A\u4E86\u9632\u6B62web\u670D\u52A1\u5668\u4E0D\u8BA4\u8BC6\u53D1\u6765\u7684\u62C6\u5305\u540E\u7684\u6E90ip\u628A\u6570\u636E\u5305\u7ED9\u4E22\u6389\uFF0C\u5BFC\u81F4web\u670D\u52A1\u5668\u4E22\u5305\uFF0C\u5BA2\u6237\u7AEF\u8BBF\u95EE\u4E0D\u5230\u6570\u636E\uFF0C\u56E0\u4E3A\u96A7\u9053\u6A21\u5F0F\u5B9E\u73B0\u7684\u662F\u4E0D\u540C\u7F51\u6BB5\u7684\u4E3B\u673A\u8FDB\u884C\u901A\u4FE1\uFF0C\u5982\u679C\u4FE1\u606F\u8981\u4ECE\u670D\u52A1\u7AEF\u8FD4\u56DE\u5230\u5BA2\u6237\u7AEF\u65F6\uFF0C\u7531\u4E8E\u5BA2\u6237\u7AEF\u548C\u670D\u52A1\u7AEF\u4E0D\u5728\u540C\u4E00\u4E2A\u7F51\u6BB5\uFF0C\u6570\u636E\u6839\u672C\u51FA\u4E0D\u53BB\uFF0C\u6240\u4EE5\u6211\u4EEC\u9700\u8981\u5173\u95ED\u6570\u636E\u6821\u9A8C.</p><p>\u67E5\u770B\u76F8\u5173\u5185\u6838\u53C2\u6570\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@node01 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> sysctl -a </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> grep rp_filter</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.all.arp_filter = 0</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.all.rp_filter = 1</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.default.arp_filter = 0</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.default.rp_filter = 1</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.ens33.arp_filter = 0</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.ens33.rp_filter = 1</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.lo.arp_filter = 0</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.lo.rp_filter = 0</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.tunl0.arp_filter = 0</span></span>
<span class="line"><span style="color:#DBD7CA;">net.ipv4.conf.tunl0.rp_filter = 1</span></span>
<span class="line"><span style="color:#DBD7CA;">sysctl: reading key </span><span style="color:#C98A7D;">&quot;net.ipv6.conf.all.stable_secret&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">sysctl: reading key </span><span style="color:#C98A7D;">&quot;net.ipv6.conf.default.stable_secret&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">sysctl: reading key </span><span style="color:#C98A7D;">&quot;net.ipv6.conf.ens33.stable_secret&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">sysctl: reading key </span><span style="color:#C98A7D;">&quot;net.ipv6.conf.lo.stable_secret&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">sysctl: reading key </span><span style="color:#C98A7D;">&quot;net.ipv6.conf.tunl0.stable_secret&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@node01 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> sysctl -a </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> grep rp_filter</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.all.arp_filter = 0</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.all.rp_filter = 1</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.default.arp_filter = 0</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.default.rp_filter = 1</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.ens33.arp_filter = 0</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.ens33.rp_filter = 1</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.lo.arp_filter = 0</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.lo.rp_filter = 0</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.tunl0.arp_filter = 0</span></span>
<span class="line"><span style="color:#393A34;">net.ipv4.conf.tunl0.rp_filter = 1</span></span>
<span class="line"><span style="color:#393A34;">sysctl: reading key </span><span style="color:#B56959;">&quot;net.ipv6.conf.all.stable_secret&quot;</span></span>
<span class="line"><span style="color:#393A34;">sysctl: reading key </span><span style="color:#B56959;">&quot;net.ipv6.conf.default.stable_secret&quot;</span></span>
<span class="line"><span style="color:#393A34;">sysctl: reading key </span><span style="color:#B56959;">&quot;net.ipv6.conf.ens33.stable_secret&quot;</span></span>
<span class="line"><span style="color:#393A34;">sysctl: reading key </span><span style="color:#B56959;">&quot;net.ipv6.conf.lo.stable_secret&quot;</span></span>
<span class="line"><span style="color:#393A34;">sysctl: reading key </span><span style="color:#B56959;">&quot;net.ipv6.conf.tunl0.stable_secret&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u5173\u95ED\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@node01 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> cat </span><span style="color:#CB7676;">&gt;&gt;</span><span style="color:#DBD7CA;"> /etc/sysctl.conf </span><span style="color:#CB7676;">&lt;&lt;</span><span style="color:#C98A7D;"> </span><span style="color:#4D9375;">EOF</span></span>
<span class="line"><span style="color:#C98A7D;">&gt; net.ipv4.conf.all.rp_filter=0</span></span>
<span class="line"><span style="color:#C98A7D;">&gt; net.ipv4.conf.default.rp_filter=0</span></span>
<span class="line"><span style="color:#C98A7D;">&gt; net.ipv4.conf.ens33.rp_filter=0</span></span>
<span class="line"><span style="color:#C98A7D;">&gt; net.ipv4.conf.tunl0.rp_filter=0</span></span>
<span class="line"><span style="color:#C98A7D;">&gt; EOF</span></span>
<span class="line"><span style="color:#C98A7D;"># \u4F7F\u914D\u7F6E\u751F\u6548</span></span>
<span class="line"><span style="color:#C98A7D;">[root@node01 ~]\\# sysctl -p</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@node01 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> cat </span><span style="color:#AB5959;">&gt;&gt;</span><span style="color:#393A34;"> /etc/sysctl.conf </span><span style="color:#AB5959;">&lt;&lt;</span><span style="color:#B56959;"> </span><span style="color:#1C6B48;">EOF</span></span>
<span class="line"><span style="color:#B56959;">&gt; net.ipv4.conf.all.rp_filter=0</span></span>
<span class="line"><span style="color:#B56959;">&gt; net.ipv4.conf.default.rp_filter=0</span></span>
<span class="line"><span style="color:#B56959;">&gt; net.ipv4.conf.ens33.rp_filter=0</span></span>
<span class="line"><span style="color:#B56959;">&gt; net.ipv4.conf.tunl0.rp_filter=0</span></span>
<span class="line"><span style="color:#B56959;">&gt; EOF</span></span>
<span class="line"><span style="color:#B56959;"># \u4F7F\u914D\u7F6E\u751F\u6548</span></span>
<span class="line"><span style="color:#B56959;">[root@node01 ~]\\# sysctl -p</span></span>
<span class="line"></span></code></pre></div><ol start="7"><li>\u6D4B\u8BD5</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">suofeiya@suofeiya-15ISK:</span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">$ </span><span style="color:#4D9375;">while</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">true</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">do</span><span style="color:#DBD7CA;"> curl 172.16.1.111</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> sleep 1 </span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">done</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">1&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">h</span><span style="color:#CB7676;">1&gt;</span><span style="color:#DBD7CA;">Backend RS</span><span style="color:#CB7676;">2&lt;</span><span style="color:#DBD7CA;">/h</span><span style="color:#CB7676;">1&gt;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">suofeiya@suofeiya-15ISK:</span><span style="color:#AB5959;">~</span><span style="color:#393A34;">$ </span><span style="color:#1C6B48;">while</span><span style="color:#393A34;"> </span><span style="color:#B58451;">true</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">do</span><span style="color:#393A34;"> curl 172.16.1.111</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> sleep 1 </span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">done</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">1&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">h</span><span style="color:#AB5959;">1&gt;</span><span style="color:#393A34;">Backend RS</span><span style="color:#AB5959;">2&lt;</span><span style="color:#393A34;">/h</span><span style="color:#AB5959;">1&gt;</span></span>
<span class="line"></span></code></pre></div><h2 id="fullnat\u6A21\u5F0F" tabindex="-1">FullNAT\u6A21\u5F0F <a class="header-anchor" href="#fullnat\u6A21\u5F0F" aria-hidden="true">#</a></h2>`,44),e=[o];function c(t,r,y,A,B,i){return n(),a("div",null,e)}var d=s(p,[["render",c]]);export{C as __pageData,d as default};
