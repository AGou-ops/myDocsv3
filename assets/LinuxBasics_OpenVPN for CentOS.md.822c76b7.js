import{_ as s,o as n,c as a,a as p}from"./app.1e6146c3.js";const v=JSON.parse('{"title":"OpenVPN for CentOS","description":"","frontmatter":{},"headers":[{"level":2,"title":"CentOS7 \u5B89\u88C5\u914D\u7F6E OpenVPN","slug":"centos7-\u5B89\u88C5\u914D\u7F6E-openvpn"},{"level":2,"title":"OpenVPN \u7B80\u4ECB","slug":"openvpn-\u7B80\u4ECB"},{"level":2,"title":"OpenVPN \u5B89\u88C5","slug":"openvpn-\u5B89\u88C5"},{"level":3,"title":"\u4F7F\u7528EasyRSA\u6784\u5EFA CA","slug":"\u4F7F\u7528easyrsa\u6784\u5EFA-ca"},{"level":3,"title":"\u5B89\u88C5 OpenVPN \u548C EasyRSA","slug":"\u5B89\u88C5-openvpn-\u548C-easyrsa"},{"level":3,"title":"\u521B\u5EFADiffie-Hellman\u548CHMAC\u5BC6\u94A5","slug":"\u521B\u5EFAdiffie-hellman\u548Chmac\u5BC6\u94A5"},{"level":3,"title":"\u521B\u5EFA\u670D\u52A1\u5668\u8BC1\u4E66\u548C\u79C1\u94A5","slug":"\u521B\u5EFA\u670D\u52A1\u5668\u8BC1\u4E66\u548C\u79C1\u94A5"},{"level":3,"title":"\u914D\u7F6EOpenVPN\u670D\u52A1","slug":"\u914D\u7F6Eopenvpn\u670D\u52A1"},{"level":3,"title":"\u542F\u52A8 OpenVPN \u670D\u52A1","slug":"\u542F\u52A8-openvpn-\u670D\u52A1"},{"level":2,"title":"\u914D\u7F6E\u5BA2\u6237\u7AEF\u63A5\u53E3","slug":"\u914D\u7F6E\u5BA2\u6237\u7AEF\u63A5\u53E3"},{"level":2,"title":"\u521B\u5EFA\u5BA2\u6237\u7AEF\u8BC1\u4E66\u79C1\u94A5\u548C\u914D\u7F6E","slug":"\u521B\u5EFA\u5BA2\u6237\u7AEF\u8BC1\u4E66\u79C1\u94A5\u548C\u914D\u7F6E"},{"level":2,"title":"\u4F7F\u7528 OpenVPN","slug":"\u4F7F\u7528-openvpn"},{"level":2,"title":"\u5FEB\u901F\u5B89\u88C5 OpenVPN","slug":"\u5FEB\u901F\u5B89\u88C5-openvpn"}],"relativePath":"LinuxBasics/OpenVPN for CentOS.md","lastUpdated":1657272051000}'),l={name:"LinuxBasics/OpenVPN for CentOS.md"},e=p(`<h1 id="openvpn-for-centos" tabindex="-1">OpenVPN for CentOS <a class="header-anchor" href="#openvpn-for-centos" aria-hidden="true">#</a></h1><h2 id="centos7-\u5B89\u88C5\u914D\u7F6E-openvpn" tabindex="-1">CentOS7 \u5B89\u88C5\u914D\u7F6E OpenVPN <a class="header-anchor" href="#centos7-\u5B89\u88C5\u914D\u7F6E-openvpn" aria-hidden="true">#</a></h2><h2 id="openvpn-\u7B80\u4ECB" tabindex="-1">OpenVPN \u7B80\u4ECB <a class="header-anchor" href="#openvpn-\u7B80\u4ECB" aria-hidden="true">#</a></h2><p>OpenVPN \u662F\u4E00\u4E2A\u57FA\u4E8E OpenSSL \u5E93\u7684\u5E94\u7528\u5C42 VPN \u5B9E\u73B0\u3002\u548C\u4F20\u7EDF VPN \u76F8\u6BD4\uFF0C\u5B83\u7684\u4F18\u70B9\u662F\u7B80\u5355\u6613\u7528\u3002 [1]</p><p>OpenVPN\u5141\u8BB8\u53C2\u4E0E\u5EFA\u7ACBVPN\u7684\u5355\u70B9\u4F7F\u7528\u5171\u4EAB\u91D1\u94A5\uFF0C\u7535\u5B50\u8BC1\u4E66\uFF0C\u6216\u8005\u7528\u6237\u540D/\u5BC6\u7801\u6765\u8FDB\u884C\u8EAB\u4EFD\u9A8C\u8BC1\u3002\u5B83\u5927\u91CF\u4F7F\u7528\u4E86OpenSSL\u52A0\u5BC6\u5E93\u4E2D\u7684SSLv3/TLSv1 \u534F\u8BAE\u51FD\u5F0F\u5E93\u3002OpenVPN\u80FD\u5728Solaris\u3001Linux\u3001OpenBSD\u3001FreeBSD\u3001NetBSD\u3001Mac OS X\u4E0EWindows 2000/XP/Vista\u4E0A\u8FD0\u884C\uFF0C\u5E76\u5305\u542B\u4E86\u8BB8\u591A\u5B89\u5168\u6027\u7684\u529F\u80FD\u3002\u5B83\u5E76\u4E0D\u662F\u4E00\u4E2A\u57FA\u4E8EWeb\u7684VPN\u8F6F\u4EF6\uFF0C\u4E5F\u4E0D\u4E0EIPsec\u53CA\u5176\u4ED6VPN\u8F6F\u4EF6\u5305\u517C\u5BB9\u3002</p><h2 id="openvpn-\u5B89\u88C5" tabindex="-1">OpenVPN \u5B89\u88C5 <a class="header-anchor" href="#openvpn-\u5B89\u88C5" aria-hidden="true">#</a></h2><h3 id="\u4F7F\u7528easyrsa\u6784\u5EFA-ca" tabindex="-1">\u4F7F\u7528<code>EasyRSA</code>\u6784\u5EFA CA <a class="header-anchor" href="#\u4F7F\u7528easyrsa\u6784\u5EFA-ca" aria-hidden="true">#</a></h3><ol><li>\u9996\u5148\u4ECE\u9879\u76EE<a href="https://github.com/OpenVPN/easy-rsa" target="_blank" rel="noopener noreferrer">Github\u5B58\u50A8\u5E93</a>\u4E0B\u8F7DEasyRSA\u7684\u6700\u65B0\u7248\u672C\u5E76\u89E3\u538B\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CA;"> wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.7.tgz</span></span>
<span class="line"><span style="color:#DBD7CA;">tar xzf EasyRSA-3.0.7.tgz</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.7.tgz</span></span>
<span class="line"><span style="color:#393A34;">tar xzf EasyRSA-3.0.7.tgz</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u590D\u5236\u6A21\u677F\u6587\u4EF6\uFF0C\u5E76\u8FDB\u884C\u9002\u5F53\u4FEE\u6539\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">mv EasyRSA-3.0.7 EasyRSA-CA</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> EasyRSA-CA</span></span>
<span class="line"><span style="color:#DBD7CA;">cp vars.example vars</span></span>
<span class="line"><span style="color:#758575;"># ---------- \u7F16\u8F91 vars \u6587\u4EF6\u5185\u5BB9\`95\`\u884C\u5DE6\u53F3 ----------</span></span>
<span class="line"><span style="color:#DBD7CA;">set_var EASYRSA_REQ_COUNTRY    </span><span style="color:#C98A7D;">&quot;CN&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">set_var EASYRSA_REQ_PROVINCE   </span><span style="color:#C98A7D;">&quot;Shandong&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">set_var EASYRSA_REQ_CITY       </span><span style="color:#C98A7D;">&quot;Jinan&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">set_var EASYRSA_REQ_ORG        </span><span style="color:#C98A7D;">&quot;AGou&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">set_var EASYRSA_REQ_EMAIL      </span><span style="color:#C98A7D;">&quot;AGou-ops@foxmail.com&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">set_var EASYRSA_REQ_OU         </span><span style="color:#C98A7D;">&quot;Community&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">mv EasyRSA-3.0.7 EasyRSA-CA</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">cd</span><span style="color:#393A34;"> EasyRSA-CA</span></span>
<span class="line"><span style="color:#393A34;">cp vars.example vars</span></span>
<span class="line"><span style="color:#A0ADA0;"># ---------- \u7F16\u8F91 vars \u6587\u4EF6\u5185\u5BB9\`95\`\u884C\u5DE6\u53F3 ----------</span></span>
<span class="line"><span style="color:#393A34;">set_var EASYRSA_REQ_COUNTRY    </span><span style="color:#B56959;">&quot;CN&quot;</span></span>
<span class="line"><span style="color:#393A34;">set_var EASYRSA_REQ_PROVINCE   </span><span style="color:#B56959;">&quot;Shandong&quot;</span></span>
<span class="line"><span style="color:#393A34;">set_var EASYRSA_REQ_CITY       </span><span style="color:#B56959;">&quot;Jinan&quot;</span></span>
<span class="line"><span style="color:#393A34;">set_var EASYRSA_REQ_ORG        </span><span style="color:#B56959;">&quot;AGou&quot;</span></span>
<span class="line"><span style="color:#393A34;">set_var EASYRSA_REQ_EMAIL      </span><span style="color:#B56959;">&quot;AGou-ops@foxmail.com&quot;</span></span>
<span class="line"><span style="color:#393A34;">set_var EASYRSA_REQ_OU         </span><span style="color:#B56959;">&quot;Community&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u4FEE\u6539\u5B8C\u6210\u4E4B\u540E\u4FDD\u5B58\u9000\u51FA\u3002</p><ol start="3"><li>\u521D\u59CB\u5316<code>PKI</code>\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@test EasyRSA-CA</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ./easyrsa init-pki</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">Note: using Easy-RSA configuration from: /root/EasyRSA-3.0.7/vars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">init-pki </span><span style="color:#E0A569;">complete</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> you may now create a CA or requests.</span></span>
<span class="line"><span style="color:#DBD7CA;">Your newly created PKI dir is: /root/EasyRSA-3.0.7/pki</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@test EasyRSA-CA</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ./easyrsa init-pki</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">Note: using Easy-RSA configuration from: /root/EasyRSA-3.0.7/vars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">init-pki </span><span style="color:#B58451;">complete</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> you may now create a CA or requests.</span></span>
<span class="line"><span style="color:#393A34;">Your newly created PKI dir is: /root/EasyRSA-3.0.7/pki</span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>\u63A5\u4E0B\u6765\u5EFA\u7ACB<code>CA</code>\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@test EasyRSA-CA</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ./easyrsa build-ca nopass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">Note: using Easy-RSA configuration from: /root/EasyRSA-3.0.7/vars</span></span>
<span class="line"><span style="color:#DBD7CA;">Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017</span></span>
<span class="line"><span style="color:#DBD7CA;">Generating RSA private key, 2048 bit long modulus</span></span>
<span class="line"><span style="color:#DBD7CA;">...............+++</span></span>
<span class="line"><span style="color:#DBD7CA;">............................................................................................................................+++</span></span>
<span class="line"><span style="color:#DBD7CA;">e is 65537 </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">0x10001</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">You are about to be asked to enter information that will be incorporated</span></span>
<span class="line"><span style="color:#DBD7CA;">into your certificate request.</span></span>
<span class="line"><span style="color:#DBD7CA;">What you are about to enter is what is called a Distinguished Name or a DN.</span></span>
<span class="line"><span style="color:#DBD7CA;">There are quite a few fields but you can leave some blank</span></span>
<span class="line"><span style="color:#DBD7CA;">For some fields there will be a default value,</span></span>
<span class="line"><span style="color:#DBD7CA;">If you enter </span><span style="color:#C98A7D;">&#39;.&#39;</span><span style="color:#DBD7CA;">, the field will be left blank.</span></span>
<span class="line"><span style="color:#DBD7CA;">-----</span></span>
<span class="line"><span style="color:#DBD7CA;">Common Name </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">eg: your user, host, or server name</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">Easy-RSA CA</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">CA creation </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> and you may now import and sign cert requests.</span></span>
<span class="line"><span style="color:#DBD7CA;">Your new CA certificate file </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CA;"> publishing is at:</span></span>
<span class="line"><span style="color:#DBD7CA;">/root/EasyRSA-3.0.7/pki/ca.crt</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@test EasyRSA-CA</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ./easyrsa build-ca nopass</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">Note: using Easy-RSA configuration from: /root/EasyRSA-3.0.7/vars</span></span>
<span class="line"><span style="color:#393A34;">Using SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017</span></span>
<span class="line"><span style="color:#393A34;">Generating RSA private key, 2048 bit long modulus</span></span>
<span class="line"><span style="color:#393A34;">...............+++</span></span>
<span class="line"><span style="color:#393A34;">............................................................................................................................+++</span></span>
<span class="line"><span style="color:#393A34;">e is 65537 </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">0x10001</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">You are about to be asked to enter information that will be incorporated</span></span>
<span class="line"><span style="color:#393A34;">into your certificate request.</span></span>
<span class="line"><span style="color:#393A34;">What you are about to enter is what is called a Distinguished Name or a DN.</span></span>
<span class="line"><span style="color:#393A34;">There are quite a few fields but you can leave some blank</span></span>
<span class="line"><span style="color:#393A34;">For some fields there will be a default value,</span></span>
<span class="line"><span style="color:#393A34;">If you enter </span><span style="color:#B56959;">&#39;.&#39;</span><span style="color:#393A34;">, the field will be left blank.</span></span>
<span class="line"><span style="color:#393A34;">-----</span></span>
<span class="line"><span style="color:#393A34;">Common Name </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">eg: your user, host, or server name</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">Easy-RSA CA</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">CA creation </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> and you may now import and sign cert requests.</span></span>
<span class="line"><span style="color:#393A34;">Your new CA certificate file </span><span style="color:#1C6B48;">for</span><span style="color:#393A34;"> publishing is at:</span></span>
<span class="line"><span style="color:#393A34;">/root/EasyRSA-3.0.7/pki/ca.crt</span></span>
<span class="line"></span></code></pre></div><p>\u5B8C\u6210\u540E\uFF0C\u8BE5\u811A\u672C\u5C06\u521B\u5EFA\u4E24\u4E2A\u6587\u4EF6-CA\u516C\u5171\u8BC1\u4E66<code>PKI/ca.crt</code>\u548CCA\u79C1\u94A5<code>PKI/private/ca.key</code></p><h3 id="\u5B89\u88C5-openvpn-\u548C-easyrsa" tabindex="-1">\u5B89\u88C5 OpenVPN \u548C EasyRSA <a class="header-anchor" href="#\u5B89\u88C5-openvpn-\u548C-easyrsa" aria-hidden="true">#</a></h3><ol><li>\u53EF\u4EE5\u5728 OpenVPN \u7684\u5B98\u65B9 github \u4ED3\u5E93 \u4E0B\u8F7D\u6700\u65B0\u6E90\u7801\u5305\u8FDB\u884C\u7F16\u8BD1\u5B89\u88C5\uFF0C\u5728\u8FD9\u91CC\u4E3A\u4E86\u65B9\u4FBF\uFF0C\u6211\u4F7F\u7528<code>epel</code>\u4ED3\u5E93\u8FDB\u884C\u5B89\u88C5\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">yum install epel-release -y</span></span>
<span class="line"><span style="color:#DBD7CA;">yum install openvpn -y</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">yum install epel-release -y</span></span>
<span class="line"><span style="color:#393A34;">yum install openvpn -y</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u83B7\u53D6\u6700\u65B0\u7248\u672C\u7684<code>EasyRSA</code>\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CA;"> wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.7.tgz</span></span>
<span class="line"><span style="color:#DBD7CA;">tar xzf EasyRSA-3.0.7.tgz</span></span>
<span class="line"><span style="color:#DBD7CA;">mv EasyRSA-3.0.7 EasyRSA-Sever1</span></span>
<span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> EasyRSA-Sever1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.7.tgz</span></span>
<span class="line"><span style="color:#393A34;">tar xzf EasyRSA-3.0.7.tgz</span></span>
<span class="line"><span style="color:#393A34;">mv EasyRSA-3.0.7 EasyRSA-Sever1</span></span>
<span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> EasyRSA-Sever1</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u5C3D\u7BA1\u6211\u4EEC\u5DF2\u7ECF\u5728 CA \u4E3B\u673A\u4E0A\u521D\u59CB\u5316\u4E86PKI\uFF0C\u4F46\u662F\u6211\u4EEC\u8FD8\u9700\u8981\u5728 <code>OpenVPN \u670D\u52A1\u5668</code>\u4E0A\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684 PKI \uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@test EasyRSA-Server1</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ./easyrsa init-pki</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">Note: using Easy-RSA configuration from: /root/EasyRSA-Server1/vars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">init-pki </span><span style="color:#E0A569;">complete</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> you may now create a CA or requests.</span></span>
<span class="line"><span style="color:#DBD7CA;">Your newly created PKI dir is: /root/EasyRSA-Server1/pki</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@test EasyRSA-Server1</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ./easyrsa init-pki</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">Note: using Easy-RSA configuration from: /root/EasyRSA-Server1/vars</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">init-pki </span><span style="color:#B58451;">complete</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> you may now create a CA or requests.</span></span>
<span class="line"><span style="color:#393A34;">Your newly created PKI dir is: /root/EasyRSA-Server1/pki</span></span>
<span class="line"></span></code></pre></div><h3 id="\u521B\u5EFAdiffie-hellman\u548Chmac\u5BC6\u94A5" tabindex="-1">\u521B\u5EFA<code>Diffie-Hellman</code>\u548C<code>HMAC</code>\u5BC6\u94A5 <a class="header-anchor" href="#\u521B\u5EFAdiffie-hellman\u548Chmac\u5BC6\u94A5" aria-hidden="true">#</a></h3><p>\u751F\u6210\u4E00\u4E2A<code>Diffie-Hellman</code>\u5BC6\u94A5\uFF0C\u8BE5\u5BC6\u94A5\u5C06\u5728\u5BC6\u94A5\u4EA4\u6362\u671F\u95F4\u4F7F\u7528\uFF0C\u5E76\u4F7F\u7528<code>HMAC</code>\u7B7E\u540D\u6587\u4EF6\u4E3A\u8FDE\u63A5\u6DFB\u52A0\u9644\u52A0\u7684\u5B89\u5168\u5C42\u3002</p><ol><li>\u5728<code>OpenVPN</code>\u670D\u52A1\u5668\u4E0A\uFF0C\u751F\u6210<code>Diffie-Hellman</code>\u5BC6\u94A5\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-Server1</span></span>
<span class="line"><span style="color:#DBD7CA;">./easyrsa gen-dh</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-Server1</span></span>
<span class="line"><span style="color:#393A34;">./easyrsa gen-dh</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u590D\u5236\u8BE5\u6587\u4EF6\u5230<code>/etc/openvpn</code>\u76EE\u5F55\u4E2D\u53BB\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp /root/EasyRSA-Server1/pki/dh.pem /etc/openvpn</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp /root/EasyRSA-Server1/pki/dh.pem /etc/openvpn</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u63A5\u4E0B\u6765\uFF0C\u4F7F\u7528<code>openvpn</code>\u4E8C\u8FDB\u5236\u6587\u4EF6\u751F\u6210<code>HMAC</code>\u7B7E\u540D\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">openvpn --genkey --secret ta.key</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">openvpn --genkey --secret ta.key</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u5C06\u751F\u6210\u7684<code>ta.key</code>\u590D\u5236\u5230<code>/etc/openvpn</code>\u76EE\u5F55\u4E2D\u53BB\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp ta.key /etc/openvpn</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp ta.key /etc/openvpn</span></span>
<span class="line"></span></code></pre></div><h3 id="\u521B\u5EFA\u670D\u52A1\u5668\u8BC1\u4E66\u548C\u79C1\u94A5" tabindex="-1">\u521B\u5EFA\u670D\u52A1\u5668\u8BC1\u4E66\u548C\u79C1\u94A5 <a class="header-anchor" href="#\u521B\u5EFA\u670D\u52A1\u5668\u8BC1\u4E66\u548C\u79C1\u94A5" aria-hidden="true">#</a></h3><ol><li>\u8FDB\u5165<code>OpenVPN\u670D\u52A1\u5668</code>\u4E0A\u7684EasyRSA\u76EE\u5F55\uFF0C\u5E76\u4E3A\u670D\u52A1\u5668\u548C\u8BC1\u4E66\u8BF7\u6C42\u6587\u4EF6\u751F\u6210\u4E00\u4E2A\u65B0\u7684\u79C1\u94A5\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-Server1</span></span>
<span class="line"><span style="color:#DBD7CA;">./easyrsa gen-req server1 nopass</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-Server1</span></span>
<span class="line"><span style="color:#393A34;">./easyrsa gen-req server1 nopass</span></span>
<span class="line"></span></code></pre></div><p>\u8BE5\u547D\u4EE4\u5C06\u521B\u5EFA\u4E24\u4E2A\u6587\u4EF6\uFF0C\u4E00\u4E2A\u79C1\u94A5\uFF08<code>server1.key</code>\uFF09\u548C\u4E00\u4E2A\u8BC1\u4E66\u8BF7\u6C42\u6587\u4EF6\uFF08<code>server1.req</code>\uFF09</p><ol start="2"><li>\u5C06\u751F\u6210\u7684\u79C1\u94A5\u590D\u5236\u5230<code>/etc/openvpn</code>\u76EE\u5F55\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp /root/EasyRSA-Server1/pki/private/server1.key /etc/openvpn/</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp /root/EasyRSA-Server1/pki/private/server1.key /etc/openvpn/</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u5C06\u8BC1\u4E66\u8BF7\u6C42\u53D1\u9001\u5230<code>CA</code>\u4E3B\u673A\uFF08\u8FD9\u91CC\u6211CA\u4E3B\u673A\u4E0EOpenVPN\u4E3A\u540C\u4E00\u4E3B\u673A\uFF09\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-Server1/pki/reqs/server1.req /tmp</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-Server1/pki/reqs/server1.req /tmp</span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>\u767B\u5F55<code>CA\u4E3B\u673A</code>\uFF0C\u5207\u6362\u5230 EasyRSA \u76EE\u5F55\u5E76\u5BFC\u5165\u8BC1\u4E66\u8BF7\u6C42\u6587\u4EF6\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-CA</span></span>
<span class="line"><span style="color:#DBD7CA;">./easyrsa import-req /tmp/server1.req server1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-CA</span></span>
<span class="line"><span style="color:#393A34;">./easyrsa import-req /tmp/server1.req server1</span></span>
<span class="line"></span></code></pre></div><p>\u6B64\u547D\u4EE4\u53EA\u662F\u5C06\u8BF7\u6C42\u6587\u4EF6\u590D\u5236\u5230<code>pki/reqs</code>\u76EE\u5F55\u4E2D\u3002</p><ol start="5"><li>\u5728<code>CA\u4E3B\u673A</code>\u4E0A\uFF0C\u7B7E\u7F72\u8BC1\u4E66\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">./easyrsa sign-req server server1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">./easyrsa sign-req server server1</span></span>
<span class="line"></span></code></pre></div><p>\u786E\u8BA4\u4FE1\u606F\u65E0\u8BEF\u4E4B\u540E\uFF0C\u8F93\u5165 yes \u7136\u540E\u70B9\u51FB\u56DE\u8F66\u5373\u53EF\u3002</p><ol start="6"><li>\u5728<code>CA\u4E3B\u673A</code>\u4E0A\uFF0C\u5C06\u7B7E\u540D\u7684\u8BC1\u4E66<code>server1.crt</code>\u548C<code>ca.crt</code>\u6587\u4EF6\u4F20\u53D1\u9001\u56DE<code>OpenVPN\u4E3B\u673A</code>\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-CA/pki/issued/server1.crt /etc/openvpn/</span></span>
<span class="line"><span style="color:#DBD7CA;">cp </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-CA/pki/ca.crt /etc/openvpn/</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-CA/pki/issued/server1.crt /etc/openvpn/</span></span>
<span class="line"><span style="color:#393A34;">cp </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-CA/pki/ca.crt /etc/openvpn/</span></span>
<span class="line"></span></code></pre></div><p>\u26A0\uFE0F \u8FD9\u91CC\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF1A\u6211\u7684<code>CA\u4E3B\u673A</code>\u548C<code>OpenVPN</code>\u4E3B\u673A\u662F\u540C\u4E00\u4E3B\u673A\uFF0C\u6240\u4EE5\u4E0A\u9762\u7684<code>/etc/openvpn</code>\u76EE\u5F55\u662F<code>OpenVPN\u4E3B\u673A</code>\u7684\u3002</p><p>\u6240\u6709\u6B65\u9AA4\u90FD\u5B8C\u6210\u4E4B\u540E\uFF0C\u5728<code>/etc/openvpn</code>\u76EE\u5F55\u4E0B\u5E94\u5F53\u6709\u8FD9\u4E9B\u6587\u4EF6\u5B58\u5728\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@test EasyRSA-CA</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ls /etc/openvpn/</span></span>
<span class="line"><span style="color:#DBD7CA;">ca.crt  client  dh.pem  server  server1.crt  server1.key  ta.key</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@test EasyRSA-CA</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ls /etc/openvpn/</span></span>
<span class="line"><span style="color:#393A34;">ca.crt  client  dh.pem  server  server1.crt  server1.key  ta.key</span></span>
<span class="line"></span></code></pre></div><h3 id="\u914D\u7F6Eopenvpn\u670D\u52A1" tabindex="-1">\u914D\u7F6E<code>OpenVPN</code>\u670D\u52A1 <a class="header-anchor" href="#\u914D\u7F6Eopenvpn\u670D\u52A1" aria-hidden="true">#</a></h3><ol><li>\u5C06 OpenVPN \u7684\u6A21\u677F\u914D\u7F6E\u6587\u4EF6\u590D\u5236\u5230<code>/etc/openvpn</code>\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp /usr/share/doc/openvpn-2.4.9/sample/sample-config-files/server.conf /etc/openvpn/server1.conf</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp /usr/share/doc/openvpn-2.4.9/sample/sample-config-files/server.conf /etc/openvpn/server1.conf</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u4FEE\u6539<code>server1.conf</code>\uFF0C\u627E\u5230\u8BC1\u4E66\uFF0C\u5BC6\u94A5\u548CDH\u53C2\u6570\u6307\u4EE4\u5E76\u66F4\u6539\u6587\u4EF6\u540D\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">user nobody</span></span>
<span class="line"><span style="color:#DBD7CA;">group nogroup</span></span>
<span class="line"><span style="color:#758575;"># ---------- \u5927\u7EA6\u572878\u884C\u5DE6\u53F3 ----------</span></span>
<span class="line"><span style="color:#DBD7CA;">cert server1.crt</span></span>
<span class="line"><span style="color:#DBD7CA;">key server1.key </span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">dh dh.pem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u5728\u6587\u4EF6\u672B\u5C3E\u6DFB\u52A0\u4EE5\u4E0B\u884C\u3002\u8BE5\u6307\u4EE4\u4F1A\u5C06\u6D88\u606F\u8EAB\u4EFD\u9A8C\u8BC1\u7B97\u6CD5\uFF08HMAC\uFF09\u4ECESHA1\u66F4\u6539\u4E3ASHA256</span></span>
<span class="line"><span style="color:#DBD7CA;">auth SHA256</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">user nobody</span></span>
<span class="line"><span style="color:#393A34;">group nogroup</span></span>
<span class="line"><span style="color:#A0ADA0;"># ---------- \u5927\u7EA6\u572878\u884C\u5DE6\u53F3 ----------</span></span>
<span class="line"><span style="color:#393A34;">cert server1.crt</span></span>
<span class="line"><span style="color:#393A34;">key server1.key </span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">dh dh.pem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u5728\u6587\u4EF6\u672B\u5C3E\u6DFB\u52A0\u4EE5\u4E0B\u884C\u3002\u8BE5\u6307\u4EE4\u4F1A\u5C06\u6D88\u606F\u8EAB\u4EFD\u9A8C\u8BC1\u7B97\u6CD5\uFF08HMAC\uFF09\u4ECESHA1\u66F4\u6539\u4E3ASHA256</span></span>
<span class="line"><span style="color:#393A34;">auth SHA256</span></span>
<span class="line"></span></code></pre></div><p>\u2139\uFE0F\u53EF\u9009\uFF1A \u8981\u901A\u8FC7VPN\u91CD\u5B9A\u5411\u5BA2\u6237\u7AEF\u6D41\u91CF\uFF0C\u8BF7\u627E\u5230\u5E76\u53D6\u6D88\u6CE8\u91CA<code>redirect-gateway</code>\u548C<code>dhcp-option</code>\u9009\u9879\uFF1A</p><p><code>/etc/openvpn/server1.conf</code></p><div class="language-"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#dbd7ca;">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span></span>
<span class="line"><span style="color:#dbd7ca;"></span></span>
<span class="line"><span style="color:#dbd7ca;">push &quot;dhcp-option DNS 208.67.222.222&quot;</span></span>
<span class="line"><span style="color:#dbd7ca;">push &quot;dhcp-option DNS 208.67.220.220&quot;</span></span>
<span class="line"><span style="color:#dbd7ca;"></span></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393a34;">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span></span>
<span class="line"><span style="color:#393a34;"></span></span>
<span class="line"><span style="color:#393a34;">push &quot;dhcp-option DNS 208.67.222.222&quot;</span></span>
<span class="line"><span style="color:#393a34;">push &quot;dhcp-option DNS 208.67.220.220&quot;</span></span>
<span class="line"><span style="color:#393a34;"></span></span></code></pre></div><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u4F7F\u7528OpenDNS\u89E3\u6790\u5668\u3002\u60A8\u53EF\u4EE5\u66F4\u6539\u5B83\u5E76\u4F7F\u7528CloudFlare\uFF0CGoogle\u6216\u60A8\u60F3\u8981\u7684\u4EFB\u4F55\u5176\u4ED6DNS\u89E3\u6790\u5668\u3002</p><p>\u5B8C\u6574\u914D\u7F6E\u6587\u4EF6\u53C2\u8003\uFF1A</p><div class="language-"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#dbd7ca;">port 1194</span></span>
<span class="line"><span style="color:#dbd7ca;">proto udp</span></span>
<span class="line"><span style="color:#dbd7ca;">dev tun</span></span>
<span class="line"><span style="color:#dbd7ca;">ca ca.crt</span></span>
<span class="line"><span style="color:#dbd7ca;">cert server1.crt</span></span>
<span class="line"><span style="color:#dbd7ca;">key server1.key  # This file should be kept secret</span></span>
<span class="line"><span style="color:#dbd7ca;">dh dh.pem</span></span>
<span class="line"><span style="color:#dbd7ca;">server 10.8.0.0 255.255.255.0</span></span>
<span class="line"><span style="color:#dbd7ca;">ifconfig-pool-persist ipp.txt</span></span>
<span class="line"><span style="color:#dbd7ca;">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span></span>
<span class="line"><span style="color:#dbd7ca;">push &quot;dhcp-option DNS 208.67.222.222&quot;</span></span>
<span class="line"><span style="color:#dbd7ca;">push &quot;dhcp-option DNS 208.67.220.220&quot;</span></span>
<span class="line"><span style="color:#dbd7ca;">keepalive 10 120</span></span>
<span class="line"><span style="color:#dbd7ca;">tls-auth ta.key 0 # This file is secret</span></span>
<span class="line"><span style="color:#dbd7ca;">cipher AES-256-CBC</span></span>
<span class="line"><span style="color:#dbd7ca;">user nobody</span></span>
<span class="line"><span style="color:#dbd7ca;">group nobody</span></span>
<span class="line"><span style="color:#dbd7ca;">persist-key</span></span>
<span class="line"><span style="color:#dbd7ca;">persist-tun</span></span>
<span class="line"><span style="color:#dbd7ca;">status openvpn-status.log</span></span>
<span class="line"><span style="color:#dbd7ca;">verb 3</span></span>
<span class="line"><span style="color:#dbd7ca;">explicit-exit-notify 1</span></span>
<span class="line"><span style="color:#dbd7ca;">auth SHA256</span></span>
<span class="line"><span style="color:#dbd7ca;"></span></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393a34;">port 1194</span></span>
<span class="line"><span style="color:#393a34;">proto udp</span></span>
<span class="line"><span style="color:#393a34;">dev tun</span></span>
<span class="line"><span style="color:#393a34;">ca ca.crt</span></span>
<span class="line"><span style="color:#393a34;">cert server1.crt</span></span>
<span class="line"><span style="color:#393a34;">key server1.key  # This file should be kept secret</span></span>
<span class="line"><span style="color:#393a34;">dh dh.pem</span></span>
<span class="line"><span style="color:#393a34;">server 10.8.0.0 255.255.255.0</span></span>
<span class="line"><span style="color:#393a34;">ifconfig-pool-persist ipp.txt</span></span>
<span class="line"><span style="color:#393a34;">push &quot;redirect-gateway def1 bypass-dhcp&quot;</span></span>
<span class="line"><span style="color:#393a34;">push &quot;dhcp-option DNS 208.67.222.222&quot;</span></span>
<span class="line"><span style="color:#393a34;">push &quot;dhcp-option DNS 208.67.220.220&quot;</span></span>
<span class="line"><span style="color:#393a34;">keepalive 10 120</span></span>
<span class="line"><span style="color:#393a34;">tls-auth ta.key 0 # This file is secret</span></span>
<span class="line"><span style="color:#393a34;">cipher AES-256-CBC</span></span>
<span class="line"><span style="color:#393a34;">user nobody</span></span>
<span class="line"><span style="color:#393a34;">group nobody</span></span>
<span class="line"><span style="color:#393a34;">persist-key</span></span>
<span class="line"><span style="color:#393a34;">persist-tun</span></span>
<span class="line"><span style="color:#393a34;">status openvpn-status.log</span></span>
<span class="line"><span style="color:#393a34;">verb 3</span></span>
<span class="line"><span style="color:#393a34;">explicit-exit-notify 1</span></span>
<span class="line"><span style="color:#393a34;">auth SHA256</span></span>
<span class="line"><span style="color:#393a34;"></span></span></code></pre></div><h3 id="\u542F\u52A8-openvpn-\u670D\u52A1" tabindex="-1">\u542F\u52A8 OpenVPN \u670D\u52A1 <a class="header-anchor" href="#\u542F\u52A8-openvpn-\u670D\u52A1" aria-hidden="true">#</a></h3><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">systemctl start openvpn@server1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">systemctl start openvpn@server1</span></span>
<span class="line"></span></code></pre></div><p>\u6210\u529F\u542F\u52A8\u4E4B\u540E\uFF0COpenVPN Server \u4F1A\u521B\u5EFA\u4E00\u4E2A tun \u8BBE\u5907\uFF0C\u5373<code>tun0</code>\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@test openvpn</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ip a show tun0</span></span>
<span class="line"><span style="color:#DBD7CA;">3: tun0: </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100</span></span>
<span class="line"><span style="color:#DBD7CA;">    link/none </span></span>
<span class="line"><span style="color:#DBD7CA;">    inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0</span></span>
<span class="line"><span style="color:#DBD7CA;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#DBD7CA;">    inet6 fe80::afaa:c6f7:7ae8:3a76/64 scope link flags 800 </span></span>
<span class="line"><span style="color:#DBD7CA;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@test openvpn</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ip a show tun0</span></span>
<span class="line"><span style="color:#393A34;">3: tun0: </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 100</span></span>
<span class="line"><span style="color:#393A34;">    link/none </span></span>
<span class="line"><span style="color:#393A34;">    inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0</span></span>
<span class="line"><span style="color:#393A34;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"><span style="color:#393A34;">    inet6 fe80::afaa:c6f7:7ae8:3a76/64 scope link flags 800 </span></span>
<span class="line"><span style="color:#393A34;">       valid_lft forever preferred_lft forever</span></span>
<span class="line"></span></code></pre></div><p>\u4E3A\u4E86\u6B63\u786E\u8F6C\u53D1\u7F51\u7EDC\u6570\u636E\u5305\uFF0C\u6211\u4EEC\u9700\u8981\u542F\u7528IP\u8F6C\u53D1\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;net.ipv4.ip_forward = 1&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;&gt;</span><span style="color:#DBD7CA;"> /etc/sysctl.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">sysctl -p</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;net.ipv4.ip_forward = 1&quot;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;&gt;</span><span style="color:#393A34;"> /etc/sysctl.conf</span></span>
<span class="line"><span style="color:#393A34;">sysctl -p</span></span>
<span class="line"></span></code></pre></div><h2 id="\u914D\u7F6E\u5BA2\u6237\u7AEF\u63A5\u53E3" tabindex="-1">\u914D\u7F6E\u5BA2\u6237\u7AEF\u63A5\u53E3 <a class="header-anchor" href="#\u914D\u7F6E\u5BA2\u6237\u7AEF\u63A5\u53E3" aria-hidden="true">#</a></h2><p>\u521B\u5EFA\u4E00\u4E2A\u5355\u72EC\u7684SSL\u8BC1\u4E66\uFF0C\u5E76\u4E3A\u6BCF\u4E2AVPN\u5BA2\u6237\u7AEF\u751F\u6210\u4E00\u4E2A\u4E0D\u540C\u7684\u914D\u7F6E\u6587\u4EF6\u3002</p><p>\u5BA2\u6237\u7AEF\u79C1\u94A5\u548C\u8BC1\u4E66\u8BF7\u6C42\u53EF\u4EE5\u5728\u5BA2\u6237\u7AEF\u8BA1\u7B97\u673A\u6216\u670D\u52A1\u5668\u4E0A\u751F\u6210\u3002\u4E3A\u7B80\u5355\u8D77\u89C1\uFF0C\u6211\u4EEC\u5C06\u5728\u670D\u52A1\u5668\u4E0A\u751F\u6210\u8BC1\u4E66\u8BF7\u6C42\uFF0C\u7136\u540E\u5C06\u5176\u53D1\u9001\u5230CA\u8FDB\u884C\u7B7E\u540D\u3002</p><p>\u751F\u6210\u5BA2\u6237\u7AEF\u8BC1\u4E66\u548C\u914D\u7F6E\u6587\u4EF6\u7684\u6574\u4E2A\u8FC7\u7A0B\u5982\u4E0B\uFF1A</p><ol><li><p>\u5728OpenVPN\u670D\u52A1\u5668\u4E0A\u751F\u6210\u79C1\u94A5\u548C\u8BC1\u4E66\u8BF7\u6C42\uFF1B</p></li><li><p>\u5C06\u8BF7\u6C42\u53D1\u9001\u5230\u8981\u7B7E\u540D\u7684CA\u8BA1\u7B97\u673A\uFF1B</p></li><li><p>\u5C06\u7B7E\u540D\u7684SSL\u8BC1\u4E66\u590D\u5236\u5230OpenVPN\u670D\u52A1\u5668\u5E76\u751F\u6210\u914D\u7F6E\u6587\u4EF6\uFF1B</p></li><li><p>\u5C06\u914D\u7F6E\u6587\u4EF6\u53D1\u9001\u5230VPN\u5BA2\u6237\u7AEF\u7684\u8BA1\u7B97\u673A\u3002</p></li><li><p>\u9996\u5148\uFF0C\u5728<code>OpenVPN\u4E3B\u673A</code>\u4E0A\u521B\u5EFA\u4E00\u7EC4\u76EE\u5F55\u6765\u5B58\u653E\u5BA2\u6237\u7AEF\u6587\u4EF6\uFF1A</p></li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">mkdir -p </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients/{configs,base,files}</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">mkdir -p </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients/{configs,base,files}</span></span>
<span class="line"></span></code></pre></div><ul><li><code>base</code> \u76EE\u5F55\u5C06\u5B58\u50A8\u5C06\u5728\u6240\u6709\u5BA2\u6237\u7AEF\u6587\u4EF6\u4E4B\u95F4\u5171\u4EAB\u7684\u57FA\u672C\u6587\u4EF6\u548C\u914D\u7F6E\uFF1B</li><li><code>configs</code> \u76EE\u5F55\u5C06\u5B58\u50A8\u751F\u6210\u7684\u5BA2\u6237\u7AEF\u914D\u7F6E\uFF1B</li><li><code>files</code> \u76EE\u5F55\u5C06\u5B58\u50A8\u7279\u5B9A\u4E8E\u5BA2\u6237\u7AEF\u7684\u8BC1\u4E66/\u5BC6\u94A5\u5BF9\u3002</li></ul><ol start="2"><li>\u590D\u5236<code>ca.crt</code>\u548C<code>ta.key</code>\u6587\u4EF6\u5230<code>~/openvpn-clients/base</code>\u76EE\u5F55\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-Server1/ta.key </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients/base/</span></span>
<span class="line"><span style="color:#DBD7CA;">cp /etc/openvpn/ca.crt </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients/base/</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-Server1/ta.key </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients/base/</span></span>
<span class="line"><span style="color:#393A34;">cp /etc/openvpn/ca.crt </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients/base/</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u5C06\u793A\u4F8B\u5BA2\u6237\u7AEF\u914D\u7F6E\u6587\u4EF6\u590D\u5236\u5230<code>~/openvpn-clients/base/</code>\u76EE\u5F55\u4E0B\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp /usr/share/doc/openvpn-2.4.9/sample/sample-config-files/client.conf </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients/base/</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp /usr/share/doc/openvpn-2.4.9/sample/sample-config-files/client.conf </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients/base/</span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>\u7F16\u8F91<code>client.conf</code>\u6587\u4EF6\u4EE5\u5339\u914D\u6211\u4EEC\u7684\u670D\u52A1\u5668\u914D\u7F6E\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">remote 172.16.1.131 1194</span></span>
<span class="line"><span style="color:#758575;"># \u5728\u6587\u4EF6\u7ED3\u5C3E\u6DFB\u52A0\u4EE5\u4E0B\u5185\u5BB9</span></span>
<span class="line"><span style="color:#DBD7CA;">auth SHA256</span></span>
<span class="line"><span style="color:#DBD7CA;">key-direction 1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">remote 172.16.1.131 1194</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u5728\u6587\u4EF6\u7ED3\u5C3E\u6DFB\u52A0\u4EE5\u4E0B\u5185\u5BB9</span></span>
<span class="line"><span style="color:#393A34;">auth SHA256</span></span>
<span class="line"><span style="color:#393A34;">key-direction 1</span></span>
<span class="line"></span></code></pre></div><p>\u5B8C\u6574\u914D\u7F6E\u6587\u4EF6\u53C2\u8003\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#dbd7ca;">client</span></span>
<span class="line"><span style="color:#dbd7ca;">dev tun</span></span>
<span class="line"><span style="color:#dbd7ca;">proto udp</span></span>
<span class="line"><span style="color:#dbd7ca;">remote 172.16.1.131 1194</span></span>
<span class="line"><span style="color:#dbd7ca;">resolv-retry infinite</span></span>
<span class="line"><span style="color:#dbd7ca;">nobind</span></span>
<span class="line"><span style="color:#dbd7ca;">persist-key</span></span>
<span class="line"><span style="color:#dbd7ca;">persist-tun</span></span>
<span class="line"><span style="color:#dbd7ca;">remote-cert-tls server</span></span>
<span class="line"><span style="color:#dbd7ca;">cipher AES-256-CBC</span></span>
<span class="line"><span style="color:#dbd7ca;">verb 3</span></span>
<span class="line"><span style="color:#dbd7ca;">auth SHA256</span></span>
<span class="line"><span style="color:#dbd7ca;">key-direction 1</span></span>
<span class="line"><span style="color:#dbd7ca;"></span></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393a34;">client</span></span>
<span class="line"><span style="color:#393a34;">dev tun</span></span>
<span class="line"><span style="color:#393a34;">proto udp</span></span>
<span class="line"><span style="color:#393a34;">remote 172.16.1.131 1194</span></span>
<span class="line"><span style="color:#393a34;">resolv-retry infinite</span></span>
<span class="line"><span style="color:#393a34;">nobind</span></span>
<span class="line"><span style="color:#393a34;">persist-key</span></span>
<span class="line"><span style="color:#393a34;">persist-tun</span></span>
<span class="line"><span style="color:#393a34;">remote-cert-tls server</span></span>
<span class="line"><span style="color:#393a34;">cipher AES-256-CBC</span></span>
<span class="line"><span style="color:#393a34;">verb 3</span></span>
<span class="line"><span style="color:#393a34;">auth SHA256</span></span>
<span class="line"><span style="color:#393a34;">key-direction 1</span></span>
<span class="line"><span style="color:#393a34;"></span></span></code></pre></div><ol start="5"><li>\u63A5\u4E0B\u6765\uFF0C\u521B\u5EFA\u4E00\u4E2A\u7B80\u5355\u7684bash\u811A\u672C\uFF0C\u5B83\u5C06\u57FA\u672C\u914D\u7F6E\u548C\u6587\u4EF6\u4E0E\u5BA2\u6237\u7AEF\u8BC1\u4E66\u548C\u5BC6\u94A5\u5408\u5E76\uFF0C\u5E76\u5C06\u751F\u6210\u7684\u914D\u7F6E\u5B58\u50A8\u5728<code>~/openvpn-clients/configs</code>\u76EE\u5F55\u4E2D\uFF1A</li></ol><p><code>vim ~/openvpn-clients/gen_config.sh</code></p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">FILES_DIR=</span><span style="color:#858585;">$</span><span style="color:#B8A965;">HOME</span><span style="color:#DBD7CA;">/openvpn-clients/files</span></span>
<span class="line"><span style="color:#DBD7CA;">BASE_DIR=</span><span style="color:#858585;">$</span><span style="color:#B8A965;">HOME</span><span style="color:#DBD7CA;">/openvpn-clients/base</span></span>
<span class="line"><span style="color:#DBD7CA;">CONFIGS_DIR=</span><span style="color:#858585;">$</span><span style="color:#B8A965;">HOME</span><span style="color:#DBD7CA;">/openvpn-clients/configs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">BASE_CONF=</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">BASE_DIR</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/client.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">CA_FILE=</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">BASE_DIR</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/ca.crt</span></span>
<span class="line"><span style="color:#DBD7CA;">TA_FILE=</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">BASE_DIR</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/ta.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">CLIENT_CERT=</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">FILES_DIR</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">1</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">.crt</span></span>
<span class="line"><span style="color:#DBD7CA;">CLIENT_KEY=</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">FILES_DIR</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">1</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># Test for files</span></span>
<span class="line"><span style="color:#4D9375;">for</span><span style="color:#DBD7CA;"> </span><span style="color:#B8A965;">i</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;</span><span style="color:#858585;">$</span><span style="color:#C98A7D;">BASE_CONF&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;</span><span style="color:#858585;">$</span><span style="color:#C98A7D;">CA_FILE&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;</span><span style="color:#858585;">$</span><span style="color:#C98A7D;">TA_FILE&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;</span><span style="color:#858585;">$</span><span style="color:#C98A7D;">CLIENT_CERT&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;</span><span style="color:#858585;">$</span><span style="color:#C98A7D;">CLIENT_KEY&quot;</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">do</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[[</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">!</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">-f</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">i</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">]]</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot; The file </span><span style="color:#858585;">$</span><span style="color:#C98A7D;">i does not exist&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#E0A569;">exit</span><span style="color:#DBD7CA;"> 1</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[[</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">!</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">-r</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">i</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">]]</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot; The file </span><span style="color:#858585;">$</span><span style="color:#C98A7D;">i is not readable.&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#E0A569;">exit</span><span style="color:#DBD7CA;"> 1</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">fi</span></span>
<span class="line"><span style="color:#4D9375;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># Generate client config</span></span>
<span class="line"><span style="color:#DBD7CA;">cat </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">CONFIGS_DIR</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">1</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">.ovpn </span><span style="color:#CB7676;">&lt;&lt;</span><span style="color:#4D9375;">EOF</span></span>
<span class="line"><span style="color:#C98A7D;">$(cat \${BASE_CONF})</span></span>
<span class="line"><span style="color:#C98A7D;">&lt;key&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">$(cat \${CLIENT_KEY})</span></span>
<span class="line"><span style="color:#C98A7D;">&lt;/key&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">&lt;cert&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">$(cat \${CLIENT_CERT})</span></span>
<span class="line"><span style="color:#C98A7D;">&lt;/cert&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">&lt;ca&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">$(cat \${CA_FILE})</span></span>
<span class="line"><span style="color:#C98A7D;">&lt;/ca&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">&lt;tls-auth&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">$(cat \${TA_FILE})</span></span>
<span class="line"><span style="color:#C98A7D;">&lt;/tls-auth&gt;</span></span>
<span class="line"><span style="color:#4D9375;">EOF</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">FILES_DIR=</span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">HOME</span><span style="color:#393A34;">/openvpn-clients/files</span></span>
<span class="line"><span style="color:#393A34;">BASE_DIR=</span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">HOME</span><span style="color:#393A34;">/openvpn-clients/base</span></span>
<span class="line"><span style="color:#393A34;">CONFIGS_DIR=</span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">HOME</span><span style="color:#393A34;">/openvpn-clients/configs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">BASE_CONF=</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">BASE_DIR</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/client.conf</span></span>
<span class="line"><span style="color:#393A34;">CA_FILE=</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">BASE_DIR</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/ca.crt</span></span>
<span class="line"><span style="color:#393A34;">TA_FILE=</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">BASE_DIR</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/ta.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">CLIENT_CERT=</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">FILES_DIR</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">1</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">.crt</span></span>
<span class="line"><span style="color:#393A34;">CLIENT_KEY=</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">FILES_DIR</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">1</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># Test for files</span></span>
<span class="line"><span style="color:#1C6B48;">for</span><span style="color:#393A34;"> </span><span style="color:#8C862B;">i</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;</span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">BASE_CONF&quot;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;</span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">CA_FILE&quot;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;</span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">TA_FILE&quot;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;</span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">CLIENT_CERT&quot;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;</span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">CLIENT_KEY&quot;</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">do</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[[</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-f</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">i</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">]]</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot; The file </span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">i does not exist&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B58451;">exit</span><span style="color:#393A34;"> 1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[[</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">!</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-r</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">i</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">]]</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot; The file </span><span style="color:#8E8F8B;">$</span><span style="color:#B56959;">i is not readable.&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B58451;">exit</span><span style="color:#393A34;"> 1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">fi</span></span>
<span class="line"><span style="color:#1C6B48;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># Generate client config</span></span>
<span class="line"><span style="color:#393A34;">cat </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">CONFIGS_DIR</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">1</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">.ovpn </span><span style="color:#AB5959;">&lt;&lt;</span><span style="color:#1C6B48;">EOF</span></span>
<span class="line"><span style="color:#B56959;">$(cat \${BASE_CONF})</span></span>
<span class="line"><span style="color:#B56959;">&lt;key&gt;</span></span>
<span class="line"><span style="color:#B56959;">$(cat \${CLIENT_KEY})</span></span>
<span class="line"><span style="color:#B56959;">&lt;/key&gt;</span></span>
<span class="line"><span style="color:#B56959;">&lt;cert&gt;</span></span>
<span class="line"><span style="color:#B56959;">$(cat \${CLIENT_CERT})</span></span>
<span class="line"><span style="color:#B56959;">&lt;/cert&gt;</span></span>
<span class="line"><span style="color:#B56959;">&lt;ca&gt;</span></span>
<span class="line"><span style="color:#B56959;">$(cat \${CA_FILE})</span></span>
<span class="line"><span style="color:#B56959;">&lt;/ca&gt;</span></span>
<span class="line"><span style="color:#B56959;">&lt;tls-auth&gt;</span></span>
<span class="line"><span style="color:#B56959;">$(cat \${TA_FILE})</span></span>
<span class="line"><span style="color:#B56959;">&lt;/tls-auth&gt;</span></span>
<span class="line"><span style="color:#1C6B48;">EOF</span></span>
<span class="line"></span></code></pre></div><p>\u8D4B\u4E88\u6267\u884C\u6743\u9650\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">chmod +x </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients/gen_config.sh</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">chmod +x </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients/gen_config.sh</span></span>
<span class="line"></span></code></pre></div><h2 id="\u521B\u5EFA\u5BA2\u6237\u7AEF\u8BC1\u4E66\u79C1\u94A5\u548C\u914D\u7F6E" tabindex="-1">\u521B\u5EFA\u5BA2\u6237\u7AEF\u8BC1\u4E66\u79C1\u94A5\u548C\u914D\u7F6E <a class="header-anchor" href="#\u521B\u5EFA\u5BA2\u6237\u7AEF\u8BC1\u4E66\u79C1\u94A5\u548C\u914D\u7F6E" aria-hidden="true">#</a></h2><p>\u751F\u6210\u5BA2\u6237\u7AEF\u79C1\u94A5\u548C\u8BC1\u4E66\u8BF7\u6C42\u7684\u8FC7\u7A0B\u4E0E\u751F\u6210\u670D\u52A1\u5668\u5BC6\u94A5\u548C\u8BC1\u4E66\u8BF7\u6C42\u7684\u8FC7\u7A0B\u76F8\u540C\u3002</p><ol><li>\u767B\u5F55<code>OpenVPN\u4E3B\u673A</code>\u4E3A\u5BA2\u6237\u7AEF\u751F\u6210\u4E00\u4E2A\u65B0\u7684\u79C1\u94A5\u548C\u4E00\u4E2A\u8BC1\u4E66\u8BF7\u6C42\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-Server1</span></span>
<span class="line"><span style="color:#DBD7CA;">./easyrsa gen-req client1 nopass</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-Server1</span></span>
<span class="line"><span style="color:#393A34;">./easyrsa gen-req client1 nopass</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u5C06\u79C1\u94A5<code>client1.key</code>\u590D\u5236\u5230<code>~/openvpn-clients/files</code>\u4E2D\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-Server1/pki/private/client1.key </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients/files/</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-Server1/pki/private/client1.key </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients/files/</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u5C06\u8BC1\u4E66\u8BF7\u6C42\u6587\u4EF6\u4F20\u8F93\u5230<code>CA\u4E3B\u673A</code>\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-Server1/pki/reqs/client1.req /tmp</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-Server1/pki/reqs/client1.req /tmp</span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>\u8FDB\u5165<code>CA\u4E3B\u673A</code>\uFF0C\u5BFC\u5165\u8BC1\u4E66\u8BF7\u6C42\u5E76\u8FDB\u884C\u7B7E\u7F72\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-CA</span></span>
<span class="line"><span style="color:#DBD7CA;">./easyrsa import-req /tmp/client1.req client1</span></span>
<span class="line"><span style="color:#DBD7CA;">./easyrsa sign-req client client1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-CA</span></span>
<span class="line"><span style="color:#393A34;">./easyrsa import-req /tmp/client1.req client1</span></span>
<span class="line"><span style="color:#393A34;">./easyrsa sign-req client client1</span></span>
<span class="line"></span></code></pre></div><ol start="5"><li>\u63A5\u4E0B\u6765\uFF0C\u5C06\u7B7E\u597D\u540D\u7684\u8BC1\u4E66<code>client1.crt</code>\u6587\u4EF6\u53D1\u9001\u56DE<code>OpenVPN\u4E3B\u673A</code>\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cp </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/EasyRSA-CA/pki/issued/client1.crt </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients/files</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cp </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/EasyRSA-CA/pki/issued/client1.crt </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients/files</span></span>
<span class="line"></span></code></pre></div><ol start="6"><li>\u6700\u540E\u4E00\u6B65\u662F\u4F7F\u7528<code>gen_config.sh</code>\u811A\u672C\u751F\u6210\u5BA2\u6237\u7AEF\u914D\u7F6E\uFF0C\u5207\u6362\u5230<code>~/openvpn-clients</code>\u76EE\u5F55\u5E76\u4F7F\u7528\u5BA2\u6237\u7AEF\u540D\u79F0\u4F5C\u4E3A\u53C2\u6570\u8FD0\u884C\u811A\u672C\uFF1A</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients</span></span>
<span class="line"><span style="color:#DBD7CA;">./gen_config.sh client1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients</span></span>
<span class="line"><span style="color:#393A34;">./gen_config.sh client1</span></span>
<span class="line"></span></code></pre></div><p>\u8BE5\u811A\u672C\u5C06\u5728<code>~/client-configs/configs</code>\u76EE\u5F55\u4E2D\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A<code>client1.ovpn</code>\u7684\u6587\u4EF6\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@test openvpn-clients</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ls </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/openvpn-clients/configs</span></span>
<span class="line"><span style="color:#DBD7CA;">client1.ovpn</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@test openvpn-clients</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ls </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/openvpn-clients/configs</span></span>
<span class="line"><span style="color:#393A34;">client1.ovpn</span></span>
<span class="line"></span></code></pre></div><p>\u6B64\u65F6\uFF0C\u5BA2\u6237\u7AEF\u914D\u7F6E\u5DF2\u521B\u5EFA\uFF0C\u53EF\u4EE5\u76F4\u63A5\u5C06\u914D\u7F6E\u6587\u4EF6\u4F20\u8F93\u5230\u8981\u7528\u4F5C\u5BA2\u6237\u7AEF\u7684\u8BBE\u5907\u4E0A\u3002</p><p>\u5982\u679C\u60F3\u8981\u6DFB\u52A0\u5176\u4ED6\u7684\u5BA2\u6237\u7AEF\uFF0C\u91CD\u590D\u8FD9\u4E9B\u6B65\u9AA4\u5373\u53EF\u3002</p><h2 id="\u4F7F\u7528-openvpn" tabindex="-1">\u4F7F\u7528 OpenVPN <a class="header-anchor" href="#\u4F7F\u7528-openvpn" aria-hidden="true">#</a></h2><p>\u5728<code>Debian</code>\u7CFB\u7CFB\u7EDF\u4E0B\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">sudo apt update -y </span><span style="color:#CB7676;">&amp;&amp;</span><span style="color:#DBD7CA;"> sudo apt instal openvpn</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">sudo apt update -y </span><span style="color:#AB5959;">&amp;&amp;</span><span style="color:#393A34;"> sudo apt instal openvpn</span></span>
<span class="line"></span></code></pre></div><p>\u5B89\u88C5\u5B8C\u8F6F\u4EF6\u5305\u4E4B\u540E\uFF0C\u4F7F\u7528\u4EE5\u4E0B\u547D\u4EE4\u8FDE\u63A5\u5230<code>OpenVPN</code>\u670D\u52A1\u5668\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">sudo openvpn --config client1.ovpn</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">sudo openvpn --config client1.ovpn</span></span>
<span class="line"></span></code></pre></div><h2 id="\u5FEB\u901F\u5B89\u88C5-openvpn" tabindex="-1">\u5FEB\u901F\u5B89\u88C5 OpenVPN <a class="header-anchor" href="#\u5FEB\u901F\u5B89\u88C5-openvpn" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">sudo apt update -y</span></span>
<span class="line"><span style="color:#DBD7CA;">sudo apt install -y openvpn</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">sudo apt update -y</span></span>
<span class="line"><span style="color:#393A34;">sudo apt install -y openvpn</span></span>
<span class="line"></span></code></pre></div><p>\u4ECE github \u83B7\u53D6\u4E00\u952E\u5B89\u88C5\u811A\u672C:</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">git clone https://github.com/angristan/openvpn-install.git</span></span>
<span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> openvpn-install</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">git clone https://github.com/angristan/openvpn-install.git</span></span>
<span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> openvpn-install</span></span>
<span class="line"></span></code></pre></div><p>\u8D4B\u4E88\u811A\u672C\u53EF\u6267\u884C\u6743\u9650:</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">chmod +x openvpn-install</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">chmod +x openvpn-install</span></span>
<span class="line"></span></code></pre></div><p>\u6267\u884C\u811A\u672C:</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">AUTO_INSTALL=y ./openvpn-install.sh</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">AUTO_INSTALL=y ./openvpn-install.sh</span></span>
<span class="line"></span></code></pre></div><p>\u26A0\uFE0F \u6CE8\u610F: \u5728\u5BA2\u6237\u7AEF\u4F7F\u7528 OpenVPN \u65F6, \u8981\u786E\u4FDD\u670D\u52A1\u5668\u7AEF\u7684 OpenVPN \u76D1\u542C\u7684\u7AEF\u53E3\u5904\u4E8E\u653E\u884C\u72B6\u6001.</p><p>Linux \u5BA2\u6237\u7AEF\u4F7F\u7528:</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">sudo apt install network-manager-openvpn</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">sudo apt install network-manager-openvpn</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">sudo openvpn ./client.ovpn</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">sudo openvpn ./client.ovpn</span></span>
<span class="line"></span></code></pre></div><p>Windows \u5BA2\u6237\u7AEF\u4F7F\u7528:</p><p>\u76F4\u63A5\u53BB<a href="https://openvpn.net/community-downloads/" target="_blank" rel="noopener noreferrer"> OpenVPN \u5B98\u65B9\u4E0B\u8F7D\u7AD9\u70B9</a>\u4E0B\u8F7D\u7136\u540E\u5BFC\u5165\u5BA2\u6237\u7AEF\u914D\u7F6E\u6587\u4EF6 <code>client.ovpn</code>, \u7136\u540E\u542F\u52A8\u670D\u52A1\u5373\u53EF.</p>`,127),o=[e];function c(t,r,i,y,d,A){return n(),a("div",null,o)}var B=s(l,[["render",c]]);export{v as __pageData,B as default};
