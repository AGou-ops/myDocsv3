import{_ as s,o as n,c as a,a as l}from"./app.1e6146c3.js";const d=JSON.parse('{"title":"nginx try_files","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u793A\u4F8B","slug":"\u793A\u4F8B"},{"level":2,"title":"\u6CE8\u610F\u70B9","slug":"\u6CE8\u610F\u70B9"},{"level":2,"title":"\u53C2\u8003\u94FE\u63A5","slug":"\u53C2\u8003\u94FE\u63A5"}],"relativePath":"LinuxBasics/Web Servers/Nginx/Nginx try_files.md","lastUpdated":1657272051000}'),p={name:"LinuxBasics/Web Servers/Nginx/Nginx try_files.md"},o=l(`<h1 id="nginx-try-files" tabindex="-1">nginx try_files <a class="header-anchor" href="#nginx-try-files" aria-hidden="true">#</a></h1><blockquote><p>\u8A9E\u6CD5\uFF1Atry_files file ... uri \u6216 try_files file ... = code \u9ED8\u8A8D\u503C\uFF1A\u7121 \u4F5C\u7528\u57DF\uFF1Aserver location</p><p>\u5176\u4F5C\u7528\u662F\u6309\u9806\u5E8F\u6AA2\u67E5\u6587\u4EF6\u662F\u5426\u5B58\u5728\uFF0C\u8FD4\u56DE\u7B2C\u4E00\u500B\u627E\u5230\u7684\u6587\u4EF6\u6216\u6587\u4EF6\u593E\uFF08\u7D50\u5C3E\u52A0\u659C\u7DDA\u8868\u793A\u70BA\u6587\u4EF6\u593E\uFF09\uFF0C\u5982\u679C\u6240\u6709\u7684\u6587\u4EF6\u6216\u6587\u4EF6\u593E\u90FD\u627E\u4E0D\u5230\uFF0C\u6703\u9032\u884C\u4E00\u500B\u5167\u90E8\u91CD\u5B9A\u5411\u5230\u6700\u5F8C\u4E00\u500B\u53C3\u6578\u3002</p><p>\u9700\u8981\u8A3B\u610F\u7684\u662F\uFF0C\u53EA\u6709\u6700\u5F8C\u4E00\u500B\u53C3\u6578\u53EF\u4EE5\u5F15\u8D77\u4E00\u500B\u5167\u90E8\u91CD\u5B9A\u5411\uFF0C\u4E4B\u524D\u7684\u53C3\u6578\u53EA\u8A2D\u7F6E\u5167\u90E8URI\u7684\u6307\u5411\u3002\u6700\u5F8C\u4E00\u500B\u53C3\u6578\u662F\u56DE\u9000URI\u4E14\u5FC5\u9808\u5B58\u5728\uFF0C\u5426\u5247\u6703\u51FA\u73FE\u5167\u90E8500\u932F\u8AA4\u3002\u547D\u540D\u7684location\u4E5F\u53EF\u4EE5\u4F7F\u7528\u5728\u6700\u5F8C\u4E00\u500B\u53C3\u6578\u4E2D\u3002\u8207rewrite\u6307\u4EE4\u4E0D\u540C\uFF0C\u5982\u679C\u56DE\u9000URI\u4E0D\u662F\u547D\u540D\u7684location\u90A3\u9EBD$args\u4E0D\u6703\u81EA\u52D5\u4FDD\u7559\uFF0C\u5982\u679C\u4F60\u60F3\u4FDD\u7559$args\uFF0C\u5247\u5FC5\u9808\u660E\u78BA\u8072\u660E\u3002</p></blockquote><h2 id="\u793A\u4F8B" tabindex="-1">\u793A\u4F8B <a class="header-anchor" href="#\u793A\u4F8B" aria-hidden="true">#</a></h2><ul><li>\u5F53\u6587\u4EF6\u4E0D\u5B58\u5728\u65F6\uFF0C\u8BBE\u7F6E\u4E00\u4E2A\u9ED8\u8BA4\u503C\uFF0C\u5E76\u8BBE\u7F6E\u4E00\u4E2A\u8FC7\u671F\u65F6\u95F4.</li></ul><div class="language-nginx"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#CB7676;">location</span><span style="color:#DBD7CA;"> </span><span style="color:#A1B567;">/images/ </span><span style="color:#DBD7CA;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">   </span><span style="color:#4D9375;"> try_files </span><span style="color:#858585;">$</span><span style="color:#B8A965;">uri</span><span style="color:#DBD7CA;"> /images/default.gif</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">location</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">=</span><span style="color:#DBD7CA;"> </span><span style="color:#C4704F;">/images/default.gif </span><span style="color:#DBD7CA;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">   </span><span style="color:#4D9375;"> expires </span><span style="color:#DBD7CA;">30s</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#AB5959;">location</span><span style="color:#393A34;"> </span><span style="color:#6C7834;">/images/ </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#393A34;">   </span><span style="color:#1C6B48;"> try_files </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">uri</span><span style="color:#393A34;"> /images/default.gif</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">location</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">=</span><span style="color:#393A34;"> </span><span style="color:#AB5E3F;">/images/default.gif </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#393A34;">   </span><span style="color:#1C6B48;"> expires </span><span style="color:#393A34;">30s</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>\u68C0\u6D4B\u6587\u4EF6\u662F\u5426\u5B58\u5728\uFF0C\u5982\u679C\u4E0D\u5B58\u5728\u5C31\u53BB\u5176\u4ED6\u7684location\u91CC\u9762\u53BB\u627E.</li></ul><div class="language-nginx"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#CB7676;">location</span><span style="color:#DBD7CA;"> </span><span style="color:#A1B567;">/abc </span><span style="color:#DBD7CA;">{</span></span>
<span class="line"><span style="color:#4D9375;">	try_files </span><span style="color:#DBD7CA;">/4.html /5.html @qwe</span><span style="color:#858585;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#758575;">#\u68C0\u6D4B\u6587\u4EF64.html\u548C5.html,\u5982\u679C\u5B58\u5728\u6B63\u5E38\u663E\u793A,\u4E0D\u5B58\u5728\u5C31\u53BB\u67E5\u627E@qwe\u503C</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">location</span><span style="color:#DBD7CA;"> </span><span style="color:#A1B567;">@qwe </span><span style="color:#DBD7CA;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">	</span><span style="color:#4D9375;">rewrite</span><span style="color:#DBD7CA;"> </span><span style="color:#C4704F;">^/(.*)$</span><span style="color:#DBD7CA;"> http://www.baidu.com</span><span style="color:#858585;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#758575;">#\u8DF3\u8F6C\u5230\u767E\u5EA6\u9875\u9762</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#AB5959;">location</span><span style="color:#393A34;"> </span><span style="color:#6C7834;">/abc </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#1C6B48;">	try_files </span><span style="color:#393A34;">/4.html /5.html @qwe</span><span style="color:#8E8F8B;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">#\u68C0\u6D4B\u6587\u4EF64.html\u548C5.html,\u5982\u679C\u5B58\u5728\u6B63\u5E38\u663E\u793A,\u4E0D\u5B58\u5728\u5C31\u53BB\u67E5\u627E@qwe\u503C</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">location</span><span style="color:#393A34;"> </span><span style="color:#6C7834;">@qwe </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#393A34;">	</span><span style="color:#1C6B48;">rewrite</span><span style="color:#393A34;"> </span><span style="color:#AB5E3F;">^/(.*)$</span><span style="color:#393A34;"> http://www.baidu.com</span><span style="color:#8E8F8B;">;</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;">#\u8DF3\u8F6C\u5230\u767E\u5EA6\u9875\u9762</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>\u8DF3\u8F6C\u5230\u540E\u7AEF\u8D1F\u8F7D\u5747\u8861.</li></ul><div class="language-nginx"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#CB7676;">upstream</span><span style="color:#DBD7CA;"> </span><span style="color:#A1B567;">tornado </span><span style="color:#DBD7CA;">{</span></span>
<span class="line"><span style="color:#4D9375;">server</span><span style="color:#DBD7CA;"> 127.0.0.1:8001;</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">server</span><span style="color:#DBD7CA;"> {</span></span>
<span class="line"><span style="color:#4D9375;">server_name </span><span style="color:#DBD7CA;">imike.me</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#4D9375;">return</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">301</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">scheme</span><span style="color:#DBD7CA;">://www.imike.me</span><span style="color:#858585;">$</span><span style="color:#B8A965;">request_uri</span><span style="color:#DBD7CA;">;</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">server</span><span style="color:#DBD7CA;"> {</span></span>
<span class="line"><span style="color:#4D9375;">listen </span><span style="color:#DBD7CA;">80</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#4D9375;">server_name </span><span style="color:#DBD7CA;">www.imike.me</span><span style="color:#858585;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">root </span><span style="color:#DBD7CA;">/var/www/www.imike.me/V0.3/www</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#4D9375;">index </span><span style="color:#DBD7CA;">index.html index.htm</span><span style="color:#858585;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">try_files </span><span style="color:#858585;">$</span><span style="color:#B8A965;">uri</span><span style="color:#DBD7CA;"> @tornado</span><span style="color:#858585;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CB7676;">location</span><span style="color:#DBD7CA;"> </span><span style="color:#A1B567;">@tornado </span><span style="color:#DBD7CA;">{</span></span>
<span class="line"><span style="color:#4D9375;">proxy_pass_header </span><span style="color:#DBD7CA;">Server</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#4D9375;">proxy_set_header </span><span style="color:#DBD7CA;">Host </span><span style="color:#858585;">$</span><span style="color:#B8A965;">http_host</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#4D9375;">proxy_set_header </span><span style="color:#DBD7CA;">X-Real-IP </span><span style="color:#858585;">$</span><span style="color:#B8A965;">remote_addr</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#4D9375;">proxy_set_header </span><span style="color:#DBD7CA;">X-Scheme </span><span style="color:#858585;">$</span><span style="color:#B8A965;">scheme</span><span style="color:#858585;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">proxy_pass </span><span style="color:#DBD7CA;">http://tornado</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#AB5959;">upstream</span><span style="color:#393A34;"> </span><span style="color:#6C7834;">tornado </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#1C6B48;">server</span><span style="color:#393A34;"> 127.0.0.1:8001;</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">server</span><span style="color:#393A34;"> {</span></span>
<span class="line"><span style="color:#1C6B48;">server_name </span><span style="color:#393A34;">imike.me</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#1C6B48;">return</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">301</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">scheme</span><span style="color:#393A34;">://www.imike.me</span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">request_uri</span><span style="color:#393A34;">;</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">server</span><span style="color:#393A34;"> {</span></span>
<span class="line"><span style="color:#1C6B48;">listen </span><span style="color:#393A34;">80</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#1C6B48;">server_name </span><span style="color:#393A34;">www.imike.me</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1C6B48;">root </span><span style="color:#393A34;">/var/www/www.imike.me/V0.3/www</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#1C6B48;">index </span><span style="color:#393A34;">index.html index.htm</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1C6B48;">try_files </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">uri</span><span style="color:#393A34;"> @tornado</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;">location</span><span style="color:#393A34;"> </span><span style="color:#6C7834;">@tornado </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#1C6B48;">proxy_pass_header </span><span style="color:#393A34;">Server</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#1C6B48;">proxy_set_header </span><span style="color:#393A34;">Host </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">http_host</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#1C6B48;">proxy_set_header </span><span style="color:#393A34;">X-Real-IP </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">remote_addr</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#1C6B48;">proxy_set_header </span><span style="color:#393A34;">X-Scheme </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">scheme</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1C6B48;">proxy_pass </span><span style="color:#393A34;">http://tornado</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u4EE5\u4E0A\u90E8\u5206\u793A\u4F8B\u6765\u6E90\u4E8E\u7F51\u7EDC\u3002</p></blockquote><h2 id="\u6CE8\u610F\u70B9" tabindex="-1">\u6CE8\u610F\u70B9 <a class="header-anchor" href="#\u6CE8\u610F\u70B9" aria-hidden="true">#</a></h2><ol><li>\u5F53<code>try_files</code>\u7684\u6700\u540E\u4E00\u4E2A\u53C2\u6570\u4E3A\u5185\u90E8\u91CD\u5B9A\u5411\u65F6\uFF0C\u9700\u8981\u5728\u540E\u754C\u9762\u52A0\u4E00\u4E2A<code>404</code>\u6216\u8005\u5176\u4ED6\u8DF3\u8F6C\uFF0C\u4EE5\u514D\u524D\u9762\u6587\u4EF6\u627E\u4E0D\u5230\u5BFC\u81F4\u670D\u52A1\u5668\u62A5\u51FA<code>500</code>\u9519\u8BEF.</li></ol><div class="language-nginx"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#CB7676;">location</span><span style="color:#DBD7CA;"> </span><span style="color:#A1B567;">~.*\\.(gif|jpg|jpeg|png)$ </span><span style="color:#DBD7CA;">{</span></span>
<span class="line"><span style="color:#4D9375;">	root </span><span style="color:#DBD7CA;">/web/wwwroot</span><span style="color:#858585;">;</span></span>
<span class="line"><span style="color:#4D9375;">	try_files </span><span style="color:#DBD7CA;">/static/</span><span style="color:#858585;">$</span><span style="color:#B8A965;">uri</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">uri</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">404</span><span style="color:#858585;">;</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;"># \u5982\u679C\u4E0D\u52A0\u540E\u9762\u7684404\uFF0C\u53EA\u8981\u7B2C\u4E00\u4E2A\u8DEF\u5F84\u5339\u914D\u5931\u8D25\uFF0C\u90A3\u4E48\u670D\u52A1\u5668\u5C31\u4F1A\u62A5\u51FA500</span></span>
<span class="line"><span style="color:#DBD7CA;">}</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#AB5959;">location</span><span style="color:#393A34;"> </span><span style="color:#6C7834;">~.*\\.(gif|jpg|jpeg|png)$ </span><span style="color:#393A34;">{</span></span>
<span class="line"><span style="color:#1C6B48;">	root </span><span style="color:#393A34;">/web/wwwroot</span><span style="color:#8E8F8B;">;</span></span>
<span class="line"><span style="color:#1C6B48;">	try_files </span><span style="color:#393A34;">/static/</span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">uri</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">uri</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">404</span><span style="color:#8E8F8B;">;</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;"># \u5982\u679C\u4E0D\u52A0\u540E\u9762\u7684404\uFF0C\u53EA\u8981\u7B2C\u4E00\u4E2A\u8DEF\u5F84\u5339\u914D\u5931\u8D25\uFF0C\u90A3\u4E48\u670D\u52A1\u5668\u5C31\u4F1A\u62A5\u51FA500</span></span>
<span class="line"><span style="color:#393A34;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="\u53C2\u8003\u94FE\u63A5" tabindex="-1">\u53C2\u8003\u94FE\u63A5 <a class="header-anchor" href="#\u53C2\u8003\u94FE\u63A5" aria-hidden="true">#</a></h2><ul><li><a href="https://www.796t.com/content/1519111220.html" target="_blank" rel="noopener noreferrer">https://www.796t.com/content/1519111220.html</a></li><li><a href="https://www.cnblogs.com/zhengchunyuan/p/11281568.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/zhengchunyuan/p/11281568.html</a></li><li><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files" target="_blank" rel="noopener noreferrer">http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files</a></li></ul>`,15),e=[o];function c(t,r,y,i,A,B){return n(),a("div",null,e)}var C=s(p,[["render",c]]);export{d as __pageData,C as default};
