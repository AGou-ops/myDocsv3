import{_ as s,o as a,c as n,a as e}from"./app.1e6146c3.js";const D=JSON.parse('{"title":"kubectl\u8FDC\u7A0B\u8FDE\u63A5k8s","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u65B9\u6848\u4E00\uFF1A\u901A\u8FC7\u5B89\u5168\u4E0A\u4E0B\u6587\u8BBF\u95EE\u672C\u5730\u7F51\u7EDCk8s","slug":"\u65B9\u6848\u4E00\uFF1A\u901A\u8FC7\u5B89\u5168\u4E0A\u4E0B\u6587\u8BBF\u95EE\u672C\u5730\u7F51\u7EDCk8s"},{"level":3,"title":"\u57FA\u672C\u6D41\u7A0B\u64CD\u4F5C","slug":"\u57FA\u672C\u6D41\u7A0B\u64CD\u4F5C"},{"level":3,"title":"\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848","slug":"\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848"},{"level":2,"title":"\u65B9\u6848\u4E8C\uFF1A\u4FEE\u6539\u8BC1\u4E66\u57DF","slug":"\u65B9\u6848\u4E8C\uFF1A\u4FEE\u6539\u8BC1\u4E66\u57DF"},{"level":3,"title":"\u67E5\u770B Apiserver \u8BC1\u4E66\u5305\u542B\u54EA\u4E9B\u5730\u5740","slug":"\u67E5\u770B-apiserver-\u8BC1\u4E66\u5305\u542B\u54EA\u4E9B\u5730\u5740"},{"level":3,"title":"\u6DFB\u52A0\u65B0\u7684\u57DF\u540D\u6216 IP \u5230\u8BC1\u4E66","slug":"\u6DFB\u52A0\u65B0\u7684\u57DF\u540D\u6216-ip-\u5230\u8BC1\u4E66"},{"level":2,"title":"\u8BBF\u95EE\u4E91\u7AEFk8s","slug":"\u8BBF\u95EE\u4E91\u7AEFk8s"},{"level":2,"title":"","slug":""}],"relativePath":"CloudNative/k8s/Remote access k8s.md","lastUpdated":1657272051000}'),l={name:"CloudNative/k8s/Remote access k8s.md"},p=e(`<h1 id="kubectl\u8FDC\u7A0B\u8FDE\u63A5k8s" tabindex="-1">kubectl\u8FDC\u7A0B\u8FDE\u63A5k8s <a class="header-anchor" href="#kubectl\u8FDC\u7A0B\u8FDE\u63A5k8s" aria-hidden="true">#</a></h1><h2 id="\u65B9\u6848\u4E00\uFF1A\u901A\u8FC7\u5B89\u5168\u4E0A\u4E0B\u6587\u8BBF\u95EE\u672C\u5730\u7F51\u7EDCk8s" tabindex="-1">\u65B9\u6848\u4E00\uFF1A\u901A\u8FC7\u5B89\u5168\u4E0A\u4E0B\u6587\u8BBF\u95EE\u672C\u5730\u7F51\u7EDCk8s <a class="header-anchor" href="#\u65B9\u6848\u4E00\uFF1A\u901A\u8FC7\u5B89\u5168\u4E0A\u4E0B\u6587\u8BBF\u95EE\u672C\u5730\u7F51\u7EDCk8s" aria-hidden="true">#</a></h2><h3 id="\u57FA\u672C\u6D41\u7A0B\u64CD\u4F5C" tabindex="-1">\u57FA\u672C\u6D41\u7A0B\u64CD\u4F5C <a class="header-anchor" href="#\u57FA\u672C\u6D41\u7A0B\u64CD\u4F5C" aria-hidden="true">#</a></h3><p>\u9996\u5148\u8981\u786E\u4FDDk8s\u7684<code>apiServer</code>\u53EF\u4EE5\u88AB\u5F53\u524D\u7F51\u7EDC\u8BBF\u95EE\uFF0C\u786E\u4FDD\u7F51\u6BB5\u5728\u5176\u76D1\u542C\u7684\u8303\u56F4\u4E4B\u5185\u3002\uFF08\u91CD\u8981\uFF09</p><p>\u767B\u5F55\u5230<code>master</code>\u4E3B\u673A\u4E0A\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ kubectl cluster-info</span></span>
<span class="line"><span style="color:#DBD7CA;">Kubernetes control plane is running at https://0.0.0.0:6443 </span></span>
<span class="line"><span style="color:#DBD7CA;">CoreDNS is running at https://0.0.0.0:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy </span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">To further debug and diagnose cluster problems, use </span><span style="color:#C98A7D;">&#39;kubectl cluster-info dump&#39;</span><span style="color:#DBD7CA;">.</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ kubectl cluster-info</span></span>
<span class="line"><span style="color:#393A34;">Kubernetes control plane is running at https://0.0.0.0:6443 </span></span>
<span class="line"><span style="color:#393A34;">CoreDNS is running at https://0.0.0.0:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy </span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">To further debug and diagnose cluster problems, use </span><span style="color:#B56959;">&#39;kubectl cluster-info dump&#39;</span><span style="color:#393A34;">.</span></span>
<span class="line"></span></code></pre></div><p>\u26A0\uFE0F\u6781\u4E0D\u63A8\u8350\u4F7F\u7528<code>0.0.0.0</code>\uFF0C\u8FD9\u91CC\u6211\u53EA\u662F\u56FE\u65B9\u4FBF\u8FDB\u884C\u6D4B\u8BD5\u4F7F\u7528\u3002</p><p>\u83B7\u53D6\u5F53\u524D\u96C6\u7FA4\u7684\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ cat </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/.kube/config</span></span>
<span class="line"><span style="color:#DBD7CA;">apiVersion: v1</span></span>
<span class="line"><span style="color:#DBD7CA;">clusters:</span></span>
<span class="line"><span style="color:#DBD7CA;">- cluster:</span></span>
<span class="line"><span style="color:#DBD7CA;">    certificate-authority-data: LS0tLS1CRUdJTiB\u3010\u6B64\u5904\u7701\u7565\u3002\u3002\u3002\u3011==</span></span>
<span class="line"><span style="color:#DBD7CA;">    server: https://0.0.0.0:6443</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: kind-my-cluster</span></span>
<span class="line"><span style="color:#DBD7CA;">contexts:</span></span>
<span class="line"><span style="color:#DBD7CA;">- context:</span></span>
<span class="line"><span style="color:#DBD7CA;">    cluster: kind-my-cluster</span></span>
<span class="line"><span style="color:#DBD7CA;">    user: kind-my-cluster</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: kind-my-cluster</span></span>
<span class="line"><span style="color:#DBD7CA;">current-context: kind-my-cluster</span></span>
<span class="line"><span style="color:#DBD7CA;">kind: Config</span></span>
<span class="line"><span style="color:#DBD7CA;">preferences: {}</span></span>
<span class="line"><span style="color:#DBD7CA;">users:</span></span>
<span class="line"><span style="color:#DBD7CA;">- name: kind-my-cluster</span></span>
<span class="line"><span style="color:#DBD7CA;">  user:</span></span>
<span class="line"><span style="color:#DBD7CA;">    client-certificate-data: LS0tLS1\u3010\u6B64\u5904\u7701\u7565\u3002\u3002\u3002\u3011==</span></span>
<span class="line"><span style="color:#DBD7CA;">    client-key-data: LS0t\u3010\u6B64\u5904\u7701\u7565\u3002\u3002\u3002\u3011=</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ cat </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/.kube/config</span></span>
<span class="line"><span style="color:#393A34;">apiVersion: v1</span></span>
<span class="line"><span style="color:#393A34;">clusters:</span></span>
<span class="line"><span style="color:#393A34;">- cluster:</span></span>
<span class="line"><span style="color:#393A34;">    certificate-authority-data: LS0tLS1CRUdJTiB\u3010\u6B64\u5904\u7701\u7565\u3002\u3002\u3002\u3011==</span></span>
<span class="line"><span style="color:#393A34;">    server: https://0.0.0.0:6443</span></span>
<span class="line"><span style="color:#393A34;">  name: kind-my-cluster</span></span>
<span class="line"><span style="color:#393A34;">contexts:</span></span>
<span class="line"><span style="color:#393A34;">- context:</span></span>
<span class="line"><span style="color:#393A34;">    cluster: kind-my-cluster</span></span>
<span class="line"><span style="color:#393A34;">    user: kind-my-cluster</span></span>
<span class="line"><span style="color:#393A34;">  name: kind-my-cluster</span></span>
<span class="line"><span style="color:#393A34;">current-context: kind-my-cluster</span></span>
<span class="line"><span style="color:#393A34;">kind: Config</span></span>
<span class="line"><span style="color:#393A34;">preferences: {}</span></span>
<span class="line"><span style="color:#393A34;">users:</span></span>
<span class="line"><span style="color:#393A34;">- name: kind-my-cluster</span></span>
<span class="line"><span style="color:#393A34;">  user:</span></span>
<span class="line"><span style="color:#393A34;">    client-certificate-data: LS0tLS1\u3010\u6B64\u5904\u7701\u7565\u3002\u3002\u3002\u3011==</span></span>
<span class="line"><span style="color:#393A34;">    client-key-data: LS0t\u3010\u6B64\u5904\u7701\u7565\u3002\u3002\u3002\u3011=</span></span>
<span class="line"></span></code></pre></div><p>\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684<code>certificate-authority-data\u3010\u670D\u52A1\u5668\u7AEFCA\u3011</code>\u3001<code>client-certificate-data\u3010\u5BA2\u6237\u7AEF\u8BC1\u4E66\u3011</code>\u548C<code>client-key-data\u3010\u5BA2\u6237\u7AEF\u79C1\u94A5\u3011</code>\u90FD\u662F<code>base64</code>\u7B80\u5355\u52A0\u5BC6\u8FC7\u7684\uFF0C\u6240\u4EE5\u5728\u5F15\u5165\u4E0A\u4E0B\u6587\u4E4B\u524D\u5148\u5C06\u5176\u89E3\u5BC6\u3002</p><ul><li>\u4F7F\u7528<code>base64</code>\u547D\u4EE4\u8FDB\u884C\u89E3\u5BC6\uFF1A<code>echo &lt;data&gt; | base64 -d</code></li><li>\u4F7F\u7528\u5728\u7EBF\u7F51\u7AD9\u8FDB\u884C\u89E3\u5BC6\uFF1A<a href="https://www.base64decode.org/" target="_blank" rel="noopener noreferrer">https://www.base64decode.org/</a></li></ul><p>\u5C06\u89E3\u5BC6\u4E4B\u540E\u7684\u6587\u4EF6\u4FDD\u5B58\u5728\u5F53\u524D\u4E3B\u673A\u7684<code>~/.kube/</code>\u76EE\u5F55\u4E4B\u4E0B\uFF0C\u5206\u522B\u547D\u540D\u4E3A\uFF08\u540D\u5B57\u968F\u610F\uFF0C\u8BB0\u4F4F\u5C31\u597D\uFF09\uFF1A</p><ul><li><a href="http://my-cluster.ca" target="_blank" rel="noopener noreferrer">my-cluster.ca</a></li><li>k8s.crt</li><li>k8s.key</li></ul><blockquote><p>\u5F53\u524D\u4E3B\u673A\u8FD8\u6CA1\u6709<code>kubectl</code>\uFF1F\u4E09\u6761\u547D\u4EE4\u5FEB\u901F\u5B89\u88C5\u3002</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">curl -LO </span><span style="color:#C98A7D;">&quot;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">curl -LO </span><span style="color:#B56959;">&quot;https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl&quot;</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl version --client</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl version --client</span></span>
<span class="line"></span></code></pre></div></blockquote><p>\u6253\u5F00\u7EC8\u7AEF\uFF0C\u786E\u4FDD<code>kubectl</code>\u5DF2\u6B63\u786E\u5B89\u88C5\u540E\u8FD0\u884C\u4EE5\u4E0B\u51E0\u6761\u547D\u4EE4\u6765\u6DFB\u52A0\u5B89\u5168\u4E0A\u4E0B\u6587\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># \u6DFB\u52A0\u96C6\u7FA4\u5730\u5740\uFF0C\u5E76\u8BBE\u7F6E\u96C6\u7FA4ca</span></span>
<span class="line"><span style="color:#DBD7CA;">kubectl config set-cluster my-k8s --server https://10.0.0.18:6443  --certificate-authority=/home/agou-ops/.kube/my-cluster.ca	</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u6DFB\u52A0\u7528\u6237\uFF0C\u4EE5\u53CA\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BC1\u4E66\u53CA\u79C1\u94A5</span></span>
<span class="line"><span style="color:#DBD7CA;">kubectl config set-credentials kubernetes-admin     --client-certificate=/home/agou-ops/.kube/k8s.crt     --client-key=/home/agou-ops/.kube/k8s.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u6307\u5B9A\u4E0A\u4E0B\u6587\uFF0Cset-context\u540D\u79F0\u53EF\u968F\u4FBF\u53D6</span></span>
<span class="line"><span style="color:#DBD7CA;">kubectl config set-context ubuntu --cluster=my-k8s  --namespace=default --user=kubernetes-admin </span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u6FC0\u6D3B\u4E0A\u4E0B\u6587</span></span>
<span class="line"><span style="color:#DBD7CA;">kubectl config use-context ubuntu </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u6DFB\u52A0\u96C6\u7FA4\u5730\u5740\uFF0C\u5E76\u8BBE\u7F6E\u96C6\u7FA4ca</span></span>
<span class="line"><span style="color:#393A34;">kubectl config set-cluster my-k8s --server https://10.0.0.18:6443  --certificate-authority=/home/agou-ops/.kube/my-cluster.ca	</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u6DFB\u52A0\u7528\u6237\uFF0C\u4EE5\u53CA\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BC1\u4E66\u53CA\u79C1\u94A5</span></span>
<span class="line"><span style="color:#393A34;">kubectl config set-credentials kubernetes-admin     --client-certificate=/home/agou-ops/.kube/k8s.crt     --client-key=/home/agou-ops/.kube/k8s.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u6307\u5B9A\u4E0A\u4E0B\u6587\uFF0Cset-context\u540D\u79F0\u53EF\u968F\u4FBF\u53D6</span></span>
<span class="line"><span style="color:#393A34;">kubectl config set-context ubuntu --cluster=my-k8s  --namespace=default --user=kubernetes-admin </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u6FC0\u6D3B\u4E0A\u4E0B\u6587</span></span>
<span class="line"><span style="color:#393A34;">kubectl config use-context ubuntu </span></span>
<span class="line"></span></code></pre></div><p>\u4F7F\u7528<code>kubectl config view</code>\u547D\u4EE4\u68C0\u67E5\u914D\u7F6E\u6587\u4EF6\u3002</p><p>\u6700\u540E\u4F7F\u7528<code>kubectl cluster info</code>\u8FDB\u884C\u67E5\u770B\u5373\u53EF\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> kubectl --insecure-skip-tls-verify cluster-info</span></span>
<span class="line"><span style="color:#DBD7CA;">Kubernetes control plane is running at https://10.0.0.18:6443</span></span>
<span class="line"><span style="color:#DBD7CA;">CoreDNS is running at https://10.0.0.18:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">To further debug and diagnose cluster problems, use </span><span style="color:#C98A7D;">&#39;kubectl cluster-info dump&#39;</span><span style="color:#DBD7CA;">.</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> kubectl --insecure-skip-tls-verify cluster-info</span></span>
<span class="line"><span style="color:#393A34;">Kubernetes control plane is running at https://10.0.0.18:6443</span></span>
<span class="line"><span style="color:#393A34;">CoreDNS is running at https://10.0.0.18:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">To further debug and diagnose cluster problems, use </span><span style="color:#B56959;">&#39;kubectl cluster-info dump&#39;</span><span style="color:#393A34;">.</span></span>
<span class="line"></span></code></pre></div><p>Done. \u{1F604}</p><h3 id="\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848" tabindex="-1">\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848 <a class="header-anchor" href="#\u95EE\u9898\u53CA\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a></h3><ol><li><code>Unable to connect to the server: x509: certificate is valid for 10.96.0.1, 172.18.0.4, 0.0.0.0, not 10.0.0.18</code></li></ol><blockquote><p>One option is to tell <code>kubectl</code> that you don&#39;t want the certificate to be validated. Obviously this brings up security issues but I guess you are only testing so here you go:</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl --insecure-skip-tls-verify --context=employee-context get pods</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl --insecure-skip-tls-verify --context=employee-context get pods</span></span>
<span class="line"></span></code></pre></div><p>\u6216\u8005\u5C06\u5176\u5199\u5165\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-cluster my-k8s --insecure-skip-tls-verify=true</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-cluster my-k8s --insecure-skip-tls-verify=true</span></span>
<span class="line"></span></code></pre></div><p>The better option is to fix the certificate. Easiest if you reinitialize the cluster by running <code>kubeadm reset</code> on all nodes including the master and then do</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubeadm init --apiserver-cert-extra-sans=114.215.201.87</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubeadm init --apiserver-cert-extra-sans=114.215.201.87</span></span>
<span class="line"></span></code></pre></div><p>It&#39;s also possible to fix that certificate without wiping everything, but that&#39;s a bit more tricky. Execute something like this on the master as root:</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">rm /etc/kubernetes/pki/apiserver.</span><span style="color:#CB7676;">*</span></span>
<span class="line"><span style="color:#DBD7CA;">kubeadm init phase certs all --apiserver-advertise-address=0.0.0.0 --apiserver-cert-extra-sans=10.161.233.80,114.215.201.87</span></span>
<span class="line"><span style="color:#DBD7CA;">docker rm </span><span style="color:#C98A7D;">\`docker ps -q -f &#39;name=k8s_kube-apiserver*&#39;\`</span></span>
<span class="line"><span style="color:#DBD7CA;">systemctl restart kubelet</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">rm /etc/kubernetes/pki/apiserver.</span><span style="color:#AB5959;">*</span></span>
<span class="line"><span style="color:#393A34;">kubeadm init phase certs all --apiserver-advertise-address=0.0.0.0 --apiserver-cert-extra-sans=10.161.233.80,114.215.201.87</span></span>
<span class="line"><span style="color:#393A34;">docker rm </span><span style="color:#B56959;">\`docker ps -q -f &#39;name=k8s_kube-apiserver*&#39;\`</span></span>
<span class="line"><span style="color:#393A34;">systemctl restart kubelet</span></span>
<span class="line"></span></code></pre></div><p>\u6765\u81EA\uFF1A<a href="https://stackoverflow.com/a/46360852" target="_blank" rel="noopener noreferrer">https://stackoverflow.com/a/46360852</a></p></blockquote><h2 id="\u65B9\u6848\u4E8C\uFF1A\u4FEE\u6539\u8BC1\u4E66\u57DF" tabindex="-1">\u65B9\u6848\u4E8C\uFF1A\u4FEE\u6539\u8BC1\u4E66\u57DF <a class="header-anchor" href="#\u65B9\u6848\u4E8C\uFF1A\u4FEE\u6539\u8BC1\u4E66\u57DF" aria-hidden="true">#</a></h2><h3 id="\u67E5\u770B-apiserver-\u8BC1\u4E66\u5305\u542B\u54EA\u4E9B\u5730\u5740" tabindex="-1">\u67E5\u770B Apiserver \u8BC1\u4E66\u5305\u542B\u54EA\u4E9B\u5730\u5740 <a class="header-anchor" href="#\u67E5\u770B-apiserver-\u8BC1\u4E66\u5305\u542B\u54EA\u4E9B\u5730\u5740" aria-hidden="true">#</a></h3><ol><li>\u8FDB\u5165\u8BC1\u4E66\u76EE\u5F55</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> /etc/kubernetes/pki  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B58451;">cd</span><span style="color:#393A34;"> /etc/kubernetes/pki  </span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u67E5\u770B\u8BC1\u4E66</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ openssl x509 -in apiserver.crt -noout -text</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">grep -A  2 </span><span style="color:#C98A7D;">&#39;Alternative&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">X509v3 Subject Alternative Name:  </span></span>
<span class="line"><span style="color:#DBD7CA;">                DNS:1-1-1-1, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, DNS:lb-apiserver.kubernetes.local, DNS:localhost, IP Address:1.1.1.1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ openssl x509 -in apiserver.crt -noout -text</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">grep -A  2 </span><span style="color:#B56959;">&#39;Alternative&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">X509v3 Subject Alternative Name:  </span></span>
<span class="line"><span style="color:#393A34;">                DNS:1-1-1-1, DNS:kubernetes, DNS:kubernetes.default, DNS:kubernetes.default.svc, DNS:kubernetes.default.svc.cluster.local, DNS:lb-apiserver.kubernetes.local, DNS:localhost, IP Address:1.1.1.1</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u5982\u679C\u53EA\u5141\u8BB8\u901A\u8FC7 1.1.1.1 \u8BBF\u95EE\u96C6\u7FA4\u7684 Apiserver\u3002\u5982\u679C\u9700\u8981\u4F7F\u7528\u57DF\u540D\uFF0C<code>kubernetes\u3001kubernetes.default\u3001kubernetes.default.svc</code> \u7B49\uFF0C\u5219\u9700\u8981\u914D\u7F6E hosts \u5C06\u5176\u6307\u5411 1.1.1.1 \u3002</p><h3 id="\u6DFB\u52A0\u65B0\u7684\u57DF\u540D\u6216-ip-\u5230\u8BC1\u4E66" tabindex="-1">\u6DFB\u52A0\u65B0\u7684\u57DF\u540D\u6216 IP \u5230\u8BC1\u4E66 <a class="header-anchor" href="#\u6DFB\u52A0\u65B0\u7684\u57DF\u540D\u6216-ip-\u5230\u8BC1\u4E66" aria-hidden="true">#</a></h3><ol><li>\u5907\u4EFD\u8BC1\u4E66</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ </span><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> /etc/kubernetes/pki  </span></span>
<span class="line"><span style="color:#DBD7CA;">$ mv apiserver.crt apiserver.crt.bak  </span></span>
<span class="line"><span style="color:#DBD7CA;">$ mv apiserver.key apiserver.key.bak  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ </span><span style="color:#B58451;">cd</span><span style="color:#393A34;"> /etc/kubernetes/pki  </span></span>
<span class="line"><span style="color:#393A34;">$ mv apiserver.crt apiserver.crt.bak  </span></span>
<span class="line"><span style="color:#393A34;">$ mv apiserver.key apiserver.key.bak  </span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>\u4FEE\u6539 <code>/etc/kubernetes/kubeadm-config.yaml</code></li></ol><p>\u5728 ClusterConfiguration \u7684 apiServer \u5B57\u6BB5\u4E0B\uFF0C\u627E\u5230 certSANs\u3002</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubeadm.k8s.io/v1beta2</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterConfiguration</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#A1B567;">...</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">certSANs</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default.svc</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default.svc.cluster.local</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">10.233.0.1</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubeadm.k8s.io/v1beta2</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterConfiguration</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#6C7834;">...</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">certSANs</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default.svc</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default.svc.cluster.local</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">10.233.0.1</span><span style="color:#393A34;">  </span></span>
<span class="line"></span></code></pre></div><p>\u5728 certSANs \u4E2D\u6DFB\u52A0\u8FDC\u7A0B\u8BBF\u95EE\u7684\u57DF\u540D\u6216 IP \u5730\u5740\uFF1A</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">certSANs</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">remote.doamin.com</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">1.2.3.4</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default.svc</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default.svc.cluster.local</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">10.233.0.1</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">certSANs</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">remote.doamin.com</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">1.2.3.4</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default.svc</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default.svc.cluster.local</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">10.233.0.1</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u4F60\u5728 <code>/etc/kubernetes/</code> \u76EE\u5F55\u4E2D\u6CA1\u6709\u627E\u5230 kubeadm-config.yaml \u6587\u4EF6\uFF0C\u4E0D\u8981\u7D27\u5F20\uFF0C\u4F60\u53EF\u4EE5\u4F7F\u7528\u4E0B\u9762\u7684\u65B9\u5F0F\u751F\u6210\u4E00\u4E2A\u5F53\u524D\u96C6\u7FA4\u7684\u914D\u7F6E\u6587\u4EF6\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ kubectl get cm kubeadm-config  -n kube-system -o yaml </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> /etc/kubernetes/kubeadm-config.yaml  </span></span>
<span class="line"><span style="color:#DBD7CA;">\u6216\u8005  </span></span>
<span class="line"><span style="color:#DBD7CA;">$ kubeadm config view </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee /etc/kubernetes/kubeadm-config.yaml  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ kubectl get cm kubeadm-config  -n kube-system -o yaml </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> /etc/kubernetes/kubeadm-config.yaml  </span></span>
<span class="line"><span style="color:#393A34;">\u6216\u8005  </span></span>
<span class="line"><span style="color:#393A34;">$ kubeadm config view </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee /etc/kubernetes/kubeadm-config.yaml  </span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u7136\u4F60\u7684\u96C6\u7FA4\u7684\u914D\u7F6E\u6587\u4EF6\u4E2D\u53EF\u80FD\u6CA1\u6709 <code>certSANs</code> \u914D\u7F6E\u6BB5\uFF0C\u4F60\u53EF\u4EE5\u76F4\u63A5\u52A0\u5728\u7C7B\u4F3C\u4E0B\u9762\u7684\u4F4D\u7F6E\u5904\uFF1A</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiServer</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">certSANs</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">   </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">remote.doamin.com</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">     </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">1.2.3.4</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">       </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">       </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">       </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default.svc</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">       </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes.default.svc.cluster.local</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">       </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">10.233.0.1</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">         </span><span style="color:#429988;">extraArgs</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">         </span><span style="color:#429988;">authorization-mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Node,RBAC</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">         </span><span style="color:#429988;">timeoutForControlPlane</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">4m0s</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">         </span><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubeadm.k8s.io/v1beta2</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">         </span><span style="color:#6394BF;">....</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiServer</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">certSANs</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">   </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">remote.doamin.com</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">     </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">1.2.3.4</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">       </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">       </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">       </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default.svc</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">       </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes.default.svc.cluster.local</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">       </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">10.233.0.1</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">         </span><span style="color:#2F8A89;">extraArgs</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">         </span><span style="color:#2F8A89;">authorization-mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Node,RBAC</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">         </span><span style="color:#2F8A89;">timeoutForControlPlane</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">4m0s</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">         </span><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubeadm.k8s.io/v1beta2</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">         </span><span style="color:#296AA3;">....</span><span style="color:#393A34;">  </span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>\u91CD\u65B0\u751F\u6210\u8BC1\u4E66</li></ol><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ kubeadm init phase certs apiserver --config /etc/kubernetes/kubeadm-config.yaml  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ kubeadm init phase certs apiserver --config /etc/kubernetes/kubeadm-config.yaml  </span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>\u518D\u6B21\u67E5\u770B\u8BC1\u4E66</li></ol><p>\u68C0\u67E5\u8F93\u51FA\u7684\u7ED3\u679C\u4E2D\uFF0C\u662F\u5426\u5305\u542B\u524D\u9762\u589E\u52A0\u7684\u516C\u7F51 IP\uFF0C\u5982\u6709\u5219\u8BC1\u660E\u64CD\u4F5C\u6210\u529F\u3002</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ openssl x509 -in pki/apiserver.crt -noout -text </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> grep 1.2.3.4  </span></span>
<span class="line"><span style="color:#DBD7CA;">                IP Address:192.168.0.8, IP Address: 1.2.3.4  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ openssl x509 -in pki/apiserver.crt -noout -text </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> grep 1.2.3.4  </span></span>
<span class="line"><span style="color:#393A34;">                IP Address:192.168.0.8, IP Address: 1.2.3.4  </span></span>
<span class="line"></span></code></pre></div><ol start="5"><li>\u91CD\u542F kube-apiserver</li></ol><ul><li>\u5982\u679C\u662F\u9AD8\u53EF\u7528\u96C6\u7FA4</li></ul><p>\u76F4\u63A5\u6740\u6B7B\u5F53\u524D\u8282\u70B9\u7684 kube-apiserver \u8FDB\u7A0B\uFF0C\u7B49\u5F85 kubelet \u62C9\u8D77 kube-apiserver \u5373\u53EF\u3002\u9700\u8981\u5728\u4E09\u4E2A\u8282\u70B9\u6267\u884C\u6B65\u9AA4 1 \u5230\u6B65\u9AA4 4\uFF0C\u9010\u4E00\u66F4\u65B0\u3002</p><ul><li>\u5982\u679C\u662F\u975E\u9AD8\u53EF\u7528\u96C6\u7FA4</li></ul><p>\u6740\u6B7B kube-apiserver \u53EF\u80FD\u4F1A\u5BFC\u81F4\u670D\u52A1\u6709\u4E2D\u65AD\uFF0C\u9700\u8981\u5728\u4E1A\u52A1\u4F4E\u5CF0\u7684\u65F6\u5019\u64CD\u4F5C\u3002</p><p>\u8FDB\u5165 <code>/etc/kubernetes/manifests</code> \u76EE\u5F55\u4E0B\uFF0C\u79FB\u52A8 kube-apiserver.yaml \u6587\u4EF6\u81F3\u5176\u5B83\u4F4D\u7F6E\uFF0C\u7136\u540E\u53C8\u79FB\u56DE\u6765\u5373\u53EF\u3002</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ mv /etc/kubernetes/manifests/kube-apiserver.yaml /root/  </span></span>
<span class="line"><span style="color:#DBD7CA;">$ mv /root/kube-apiserver.yaml /etc/kubernetes/manifests  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ mv /etc/kubernetes/manifests/kube-apiserver.yaml /root/  </span></span>
<span class="line"><span style="color:#393A34;">$ mv /root/kube-apiserver.yaml /etc/kubernetes/manifests  </span></span>
<span class="line"></span></code></pre></div><ol start="6"><li>\u4FEE\u6539 kubeconfig \u4E2D\u7684 server ip</li></ol><p>\u6700\u540E\uFF0C\u4F60\u53EA\u9700\u8981\u5C06 <code>kubeconfig</code> \u6587\u4EF6\u4E2D <code>server</code> \u5730\u5740\u4FEE\u6539\u4E3A <code>1.2.3.4</code>\u3002</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#429988;">clusters</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">cluster</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#6394BF;">...</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">server</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">https://1.2.3.4:6443</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#6394BF;">...</span><span style="color:#DBD7CA;">  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#2F8A89;">clusters</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">cluster</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#296AA3;">...</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">server</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">https://1.2.3.4:6443</span><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#296AA3;">...</span><span style="color:#393A34;">  </span></span>
<span class="line"></span></code></pre></div><p>\u4FDD\u5B58\u4E4B\u540E\uFF0C\u5C31\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7\u516C\u7F51 IP \u8BBF\u95EE Kubernetes \u96C6\u7FA4\u3002</p><p><code>$ kubectl get node </code></p><blockquote><p>\u8BE5\u90E8\u5206\u5185\u5BB9\u8F6C\u8F7D\u81EA\uFF1A<a href="https://kubesphereio.com/post/add-public-ip-to-kubernetes-apiserver-operation-guide/" target="_blank" rel="noopener noreferrer">https://kubesphereio.com/post/add-public-ip-to-kubernetes-apiserver-operation-guide/</a></p></blockquote><h2 id="\u8BBF\u95EE\u4E91\u7AEFk8s" tabindex="-1">\u8BBF\u95EE\u4E91\u7AEFk8s <a class="header-anchor" href="#\u8BBF\u95EE\u4E91\u7AEFk8s" aria-hidden="true">#</a></h2><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-hidden="true">#</a></h2><p>\u672A\u5B8C\u3002</p>`,63),o=[p];function c(t,r,i,y,d,u){return a(),n("div",null,o)}var k=s(l,[["render",c]]);export{D as __pageData,k as default};
