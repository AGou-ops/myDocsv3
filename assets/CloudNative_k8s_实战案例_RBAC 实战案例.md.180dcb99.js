import{_ as s,o as n,c as a,a as l}from"./app.1e6146c3.js";const B=JSON.parse('{"title":"\uFF08\u4E00\uFF09\u901A\u8FC7\u7528\u6237\u8D26\u53F7\u7684\u65B9\u5F0F\u5206\u914D\u5355\u72ECNamespace\u7684\u6743\u9650","description":"","frontmatter":{},"headers":[{"level":2,"title":"1.\u6848\u4F8B\u63CF\u8FF0","slug":"_1-\u6848\u4F8B\u63CF\u8FF0"},{"level":2,"title":"2.\u521B\u5EFA\u7528\u6237\u8D26\u53F7","slug":"_2-\u521B\u5EFA\u7528\u6237\u8D26\u53F7"},{"level":2,"title":"3.\u521B\u5EFAClusterRole\u8D44\u6E90\u8BBE\u7F6E\u6743\u9650","slug":"_3-\u521B\u5EFAclusterrole\u8D44\u6E90\u8BBE\u7F6E\u6743\u9650"},{"level":2,"title":"4.\u521B\u5EFARoleBinding\u8D44\u6E90\u5C06\u7528\u6237\u548C\u89D2\u8272\u7ED1\u5B9A","slug":"_4-\u521B\u5EFArolebinding\u8D44\u6E90\u5C06\u7528\u6237\u548C\u89D2\u8272\u7ED1\u5B9A"},{"level":2,"title":"5.\u5207\u6362knowman\u7528\u6237\u67E5\u770B\u6743\u9650","slug":"_5-\u5207\u6362knowman\u7528\u6237\u67E5\u770B\u6743\u9650"},{"level":2,"title":"1.\u6848\u4F8B\u63CF\u8FF0","slug":"_1-\u6848\u4F8B\u63CF\u8FF0-1"},{"level":2,"title":"2.\u51C6\u5907cfssl\u5DE5\u5177\u547D\u4EE4","slug":"_2-\u51C6\u5907cfssl\u5DE5\u5177\u547D\u4EE4"},{"level":2,"title":"3.\u5229\u7528k8s\u6839\u8BC1\u4E66\u7B7E\u53D1\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8BC1\u4E66","slug":"_3-\u5229\u7528k8s\u6839\u8BC1\u4E66\u7B7E\u53D1\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8BC1\u4E66"},{"level":2,"title":"4.\u751F\u6210kubeconfig\u6388\u6743\u6587\u4EF6","slug":"_4-\u751F\u6210kubeconfig\u6388\u6743\u6587\u4EF6"},{"level":2,"title":"5.\u6267\u884Ckubectl\u547D\u4EE4\u65F6\u6307\u5B9A\u6388\u6743\u6587\u4EF6","slug":"_5-\u6267\u884Ckubectl\u547D\u4EE4\u65F6\u6307\u5B9A\u6388\u6743\u6587\u4EF6"},{"level":2,"title":"6.\u914D\u7F6Erbac\u7B56\u7565\u6388\u6743kubeconfig\u76F8\u5E94\u7684\u6743\u9650","slug":"_6-\u914D\u7F6Erbac\u7B56\u7565\u6388\u6743kubeconfig\u76F8\u5E94\u7684\u6743\u9650"},{"level":2,"title":"7.\u9A8C\u8BC1kubeconfig\u6388\u6743\u6587\u4EF6\u662F\u5426\u6709\u4E86\u5BF9\u5E94\u7684\u6743\u9650","slug":"_7-\u9A8C\u8BC1kubeconfig\u6388\u6743\u6587\u4EF6\u662F\u5426\u6709\u4E86\u5BF9\u5E94\u7684\u6743\u9650"},{"level":2,"title":"1.\u521B\u5EFA\u4E00\u4E2Asa\u8D26\u53F7","slug":"_1-\u521B\u5EFA\u4E00\u4E2Asa\u8D26\u53F7"},{"level":2,"title":"2.\u7F16\u5199rbac\u8D44\u6E90\u6388\u6743yaml\u6587\u4EF6","slug":"_2-\u7F16\u5199rbac\u8D44\u6E90\u6388\u6743yaml\u6587\u4EF6"},{"level":2,"title":"3.\u7F16\u5199nginx pod\u8D44\u6E90\u5E76\u4F7F\u7528sa\u8D26\u53F7","slug":"_3-\u7F16\u5199nginx-pod\u8D44\u6E90\u5E76\u4F7F\u7528sa\u8D26\u53F7"},{"level":2,"title":"4.\u521B\u5EFA\u6240\u6709\u8D44\u6E90\u5E76\u67E5\u770B","slug":"_4-\u521B\u5EFA\u6240\u6709\u8D44\u6E90\u5E76\u67E5\u770B"}],"relativePath":"CloudNative/k8s/\u5B9E\u6218\u6848\u4F8B/RBAC \u5B9E\u6218\u6848\u4F8B.md","lastUpdated":1657272051000}'),p={name:"CloudNative/k8s/\u5B9E\u6218\u6848\u4F8B/RBAC \u5B9E\u6218\u6848\u4F8B.md"},o=l(`<h1 id="\uFF08\u4E00\uFF09\u901A\u8FC7\u7528\u6237\u8D26\u53F7\u7684\u65B9\u5F0F\u5206\u914D\u5355\u72ECnamespace\u7684\u6743\u9650" tabindex="-1">\uFF08\u4E00\uFF09\u901A\u8FC7\u7528\u6237\u8D26\u53F7\u7684\u65B9\u5F0F\u5206\u914D\u5355\u72ECNamespace\u7684\u6743\u9650 <a class="header-anchor" href="#\uFF08\u4E00\uFF09\u901A\u8FC7\u7528\u6237\u8D26\u53F7\u7684\u65B9\u5F0F\u5206\u914D\u5355\u72ECnamespace\u7684\u6743\u9650" aria-hidden="true">#</a></h1><h2 id="_1-\u6848\u4F8B\u63CF\u8FF0" tabindex="-1">1.\u6848\u4F8B\u63CF\u8FF0 <a class="header-anchor" href="#_1-\u6848\u4F8B\u63CF\u8FF0" aria-hidden="true">#</a></h2><p>\u521B\u5EFA\u4E00\u4E2A\u7528\u6237\uFF0C\u4EC5\u62E5\u6709\u5BF9know-system\u547D\u540D\u7A7A\u95F4\u4E0B\u7684pods\u3001deployments\u8D44\u6E90\u64CD\u4F5C\u6743\u9650\uFF0C\u91C7\u7528RoleBinding\u7ED1\u5B9AClusterRole\u7684\u65B9\u5F0F\u6765\u5B9E\u73B0\u3002</p><p>\u5927\u81F4\u5B9E\u73B0\u601D\u8DEF\uFF1A</p><p>1.\u751F\u6210\u7528\u6237\u7684\u8BC1\u4E66\u6587\u4EF6key</p><p>2.\u901A\u8FC7apiserver\u751F\u6210\u8BC1\u4E66\u8BF7\u6C42</p><p>3.\u901A\u8FC7k8s\u7684api\u7684ca\u8BC1\u4E66\u7B7E\u53D1\u7528\u6237\u7684\u8BC1\u4E66\u8BF7\u6C42</p><p>4.\u914D\u7F6Ek8s\u8BBE\u7F6E\u96C6\u7FA4\u3001\u521B\u5EFA\u7528\u6237\u3001\u914D\u7F6E\u4E0A\u4E0B\u6587\u4FE1\u606F</p><p>5.\u521B\u5EFAClusterRole\u3001RoleBinding\u8D44\u6E90</p><h2 id="_2-\u521B\u5EFA\u7528\u6237\u8D26\u53F7" tabindex="-1">2.\u521B\u5EFA\u7528\u6237\u8D26\u53F7 <a class="header-anchor" href="#_2-\u521B\u5EFA\u7528\u6237\u8D26\u53F7" aria-hidden="true">#</a></h2><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u521B\u5EFA\u8BC1\u4E66\u6587\u4EF6</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">cd</span><span style="color:#DBD7CA;"> /etc/kubernetes/pki/</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">umask 077</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;">openssl genrsa -out knowman.key 2048</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">Generating RSA private key, 2048 bit long modulus</span></span>
<span class="line"><span style="color:#DBD7CA;">....................................................................................+++</span></span>
<span class="line"><span style="color:#DBD7CA;">................+++</span></span>
<span class="line"><span style="color:#DBD7CA;">e is 65537 </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">0x10001</span><span style="color:#858585;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u4F7F\u7528apiserver\u7684\u8BC1\u4E66\u7B7E\u53D1\u8BC1\u4E66\u8BF7\u6C42</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2-1.\u7533\u8BF7\u7B7E\u540D\uFF0C\u8BC1\u4E66\u8BF7\u6C42\uFF0C\u7533\u8BF7\u7684\u7528\u6237\u540D\u662Fknowman\uFF0C\u7EC4\u662Fknowgroup</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> openssl req -new -key knowman.key -out knowman.csr -subj </span><span style="color:#C98A7D;">&quot;/CN=knowman/O=knowgroup&quot;</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ll knowman.</span><span style="color:#CB7676;">*</span></span>
<span class="line"><span style="color:#DBD7CA;">-rw-r--r-- 1 root root  915 4\u6708  20 13:27 knowman.csr</span></span>
<span class="line"><span style="color:#DBD7CA;">-rw------- 1 root root 1679 4\u6708  20 13:25 knowman.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2-2.\u7B7E\u53D1\u8BC1\u4E66</span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">\u4F7F\u7528apiserver\u7684ca\u8BC1\u4E66\u7B7E\u53D1\u7528\u6237\u8BC1\u4E66</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> openssl x509 -req -in knowman.csr -CA ca.crt  -CAkey ca.key  -CAcreateserial -out knowman.crt -days 3650</span></span>
<span class="line"><span style="color:#DBD7CA;">Signature ok</span></span>
<span class="line"><span style="color:#DBD7CA;">subject=/CN=knowman/O=knowgroup</span></span>
<span class="line"><span style="color:#DBD7CA;">Getting CA Private Key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">0.3 \u{1F440} \u5148\u67E5\u770B\u4E00\u4E0B\u96C6\u7FA4apiserver\u7684\u76D1\u542C\u5730\u5740\uFF0C\u786E\u4FDD\u76D1\u542C\u7684\u8BE5\u5730\u5740\u53EF\u4EE5\u8BBF\u95EE\u5230kubernetes\uFF08\u8FD9\u91CC\u6211\u505A\u4E86\u4EE3\u7406\u3002\u3002\uFF09</span></span>
<span class="line"><span style="color:#DBD7CA;">\u276F kubectl cluster-info</span></span>
<span class="line"><span style="color:#DBD7CA;">Kubernetes control plane is running at https://127.0.0.1:52520</span></span>
<span class="line"><span style="color:#DBD7CA;">CoreDNS is running at https://127.0.0.1:52520/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">To further debug and diagnose cluster problems, use </span><span style="color:#C98A7D;">&#39;kubectl cluster-info dump&#39;</span><span style="color:#DBD7CA;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u914D\u7F6E\u96C6\u7FA4\u3001\u7528\u6237\u3001\u4E0A\u4E0B\u6587\u4FE1\u606F</span></span>
<span class="line"><span style="color:#758575;">#\u914D\u7F6E\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.81.210:6443</span></span>
<span class="line"><span style="color:#DBD7CA;">Cluster </span><span style="color:#C98A7D;">&quot;kubernetes&quot;</span><span style="color:#DBD7CA;"> set.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#\u914D\u7F6E\u7528\u6237\u4FE1\u606F</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl config set-credentials knowman --embed-certs=true --client-certificate=/etc/kubernetes/pki/knowman.crt --client-key=/etc/kubernetes/pki/knowman.key </span></span>
<span class="line"><span style="color:#DBD7CA;">User </span><span style="color:#C98A7D;">&quot;knowman&quot;</span><span style="color:#DBD7CA;"> set.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#\u914D\u7F6E\u4E0A\u4E0B\u6587\u4FE1\u606F</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl config set-context knowman@kubernetes --cluster=kubernetes --user=knowman</span></span>
<span class="line"><span style="color:#DBD7CA;">Context </span><span style="color:#C98A7D;">&quot;knowman@kubernetes&quot;</span><span style="color:#DBD7CA;"> created.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">4.\u67E5\u770B\u914D\u7F6E\u7684\u96C6\u7FA4\u4FE1\u606F</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl config view</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u521B\u5EFA\u8BC1\u4E66\u6587\u4EF6</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> </span><span style="color:#B58451;">cd</span><span style="color:#393A34;"> /etc/kubernetes/pki/</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">umask 077</span><span style="color:#AB5959;">;</span><span style="color:#393A34;">openssl genrsa -out knowman.key 2048</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">Generating RSA private key, 2048 bit long modulus</span></span>
<span class="line"><span style="color:#393A34;">....................................................................................+++</span></span>
<span class="line"><span style="color:#393A34;">................+++</span></span>
<span class="line"><span style="color:#393A34;">e is 65537 </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">0x10001</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u4F7F\u7528apiserver\u7684\u8BC1\u4E66\u7B7E\u53D1\u8BC1\u4E66\u8BF7\u6C42</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2-1.\u7533\u8BF7\u7B7E\u540D\uFF0C\u8BC1\u4E66\u8BF7\u6C42\uFF0C\u7533\u8BF7\u7684\u7528\u6237\u540D\u662Fknowman\uFF0C\u7EC4\u662Fknowgroup</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> openssl req -new -key knowman.key -out knowman.csr -subj </span><span style="color:#B56959;">&quot;/CN=knowman/O=knowgroup&quot;</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ll knowman.</span><span style="color:#AB5959;">*</span></span>
<span class="line"><span style="color:#393A34;">-rw-r--r-- 1 root root  915 4\u6708  20 13:27 knowman.csr</span></span>
<span class="line"><span style="color:#393A34;">-rw------- 1 root root 1679 4\u6708  20 13:25 knowman.key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2-2.\u7B7E\u53D1\u8BC1\u4E66</span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">\u4F7F\u7528apiserver\u7684ca\u8BC1\u4E66\u7B7E\u53D1\u7528\u6237\u8BC1\u4E66</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> openssl x509 -req -in knowman.csr -CA ca.crt  -CAkey ca.key  -CAcreateserial -out knowman.crt -days 3650</span></span>
<span class="line"><span style="color:#393A34;">Signature ok</span></span>
<span class="line"><span style="color:#393A34;">subject=/CN=knowman/O=knowgroup</span></span>
<span class="line"><span style="color:#393A34;">Getting CA Private Key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">0.3 \u{1F440} \u5148\u67E5\u770B\u4E00\u4E0B\u96C6\u7FA4apiserver\u7684\u76D1\u542C\u5730\u5740\uFF0C\u786E\u4FDD\u76D1\u542C\u7684\u8BE5\u5730\u5740\u53EF\u4EE5\u8BBF\u95EE\u5230kubernetes\uFF08\u8FD9\u91CC\u6211\u505A\u4E86\u4EE3\u7406\u3002\u3002\uFF09</span></span>
<span class="line"><span style="color:#393A34;">\u276F kubectl cluster-info</span></span>
<span class="line"><span style="color:#393A34;">Kubernetes control plane is running at https://127.0.0.1:52520</span></span>
<span class="line"><span style="color:#393A34;">CoreDNS is running at https://127.0.0.1:52520/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">To further debug and diagnose cluster problems, use </span><span style="color:#B56959;">&#39;kubectl cluster-info dump&#39;</span><span style="color:#393A34;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u914D\u7F6E\u96C6\u7FA4\u3001\u7528\u6237\u3001\u4E0A\u4E0B\u6587\u4FE1\u606F</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u914D\u7F6E\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.81.210:6443</span></span>
<span class="line"><span style="color:#393A34;">Cluster </span><span style="color:#B56959;">&quot;kubernetes&quot;</span><span style="color:#393A34;"> set.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#\u914D\u7F6E\u7528\u6237\u4FE1\u606F</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl config set-credentials knowman --embed-certs=true --client-certificate=/etc/kubernetes/pki/knowman.crt --client-key=/etc/kubernetes/pki/knowman.key </span></span>
<span class="line"><span style="color:#393A34;">User </span><span style="color:#B56959;">&quot;knowman&quot;</span><span style="color:#393A34;"> set.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#\u914D\u7F6E\u4E0A\u4E0B\u6587\u4FE1\u606F</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl config set-context knowman@kubernetes --cluster=kubernetes --user=knowman</span></span>
<span class="line"><span style="color:#393A34;">Context </span><span style="color:#B56959;">&quot;knowman@kubernetes&quot;</span><span style="color:#393A34;"> created.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">4.\u67E5\u770B\u914D\u7F6E\u7684\u96C6\u7FA4\u4FE1\u606F</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl config view</span></span>
<span class="line"></span></code></pre></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616085930486.png" alt="Kubernetes\u96C6\u7FA4RBAC\u6388\u6743\u6848\u4F8B\uFF08\u4E00\uFF09\u901A\u8FC7\u7528\u6237\u8D26\u53F7\u7684\u65B9\u5F0F\u5206\u914D\u5355\u72ECNamespace\u7684\u6743\u9650\uFF08\u56DB\u5341\uFF09_\u7528\u6237\u8D26\u53F7"></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">5\uFF09\u5207\u6362\u5230knowman\u7528\u6237</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl config use-context knowman@kubernetes</span></span>
<span class="line"><span style="color:#DBD7CA;">Switched to context </span><span style="color:#C98A7D;">&quot;knowman@kubernetes&quot;</span><span style="color:#DBD7CA;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">6\uFF09\u8BD5\u7740\u67E5\u770B\u4E0Bknow-system\u547D\u540D\u7A7A\u95F4\u4E0B\u7684\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get pod -n know-system</span></span>
<span class="line"><span style="color:#DBD7CA;">Error from server </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">Forbidden</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">: pods is forbidden: User </span><span style="color:#C98A7D;">&quot;knowman&quot;</span><span style="color:#DBD7CA;"> cannot list resource </span><span style="color:#C98A7D;">&quot;pods&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span><span style="color:#DBD7CA;"> API group </span><span style="color:#C98A7D;">&quot;&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span><span style="color:#DBD7CA;"> the namespace </span><span style="color:#C98A7D;">&quot;know-system&quot;</span></span>
<span class="line"><span style="color:#758575;">#\u53EF\u4EE5\u770B\u5230\u6CA1\u6709\u6743\u9650\u8BBF\u95EE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">7\uFF09\u5207\u6362\u5230admin\u7528\u6237\u8FDB\u884C\u6388\u6743</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl config use-context kubernetes-admin@kubernetes </span></span>
<span class="line"><span style="color:#DBD7CA;">Switched to context </span><span style="color:#C98A7D;">&quot;kubernetes-admin@kubernetes&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">5\uFF09\u5207\u6362\u5230knowman\u7528\u6237</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl config use-context knowman@kubernetes</span></span>
<span class="line"><span style="color:#393A34;">Switched to context </span><span style="color:#B56959;">&quot;knowman@kubernetes&quot;</span><span style="color:#393A34;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">6\uFF09\u8BD5\u7740\u67E5\u770B\u4E0Bknow-system\u547D\u540D\u7A7A\u95F4\u4E0B\u7684\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master /etc/kubernetes/pki</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get pod -n know-system</span></span>
<span class="line"><span style="color:#393A34;">Error from server </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">Forbidden</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">: pods is forbidden: User </span><span style="color:#B56959;">&quot;knowman&quot;</span><span style="color:#393A34;"> cannot list resource </span><span style="color:#B56959;">&quot;pods&quot;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span><span style="color:#393A34;"> API group </span><span style="color:#B56959;">&quot;&quot;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span><span style="color:#393A34;"> the namespace </span><span style="color:#B56959;">&quot;know-system&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u53EF\u4EE5\u770B\u5230\u6CA1\u6709\u6743\u9650\u8BBF\u95EE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">7\uFF09\u5207\u6362\u5230admin\u7528\u6237\u8FDB\u884C\u6388\u6743</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl config use-context kubernetes-admin@kubernetes </span></span>
<span class="line"><span style="color:#393A34;">Switched to context </span><span style="color:#B56959;">&quot;kubernetes-admin@kubernetes&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="_3-\u521B\u5EFAclusterrole\u8D44\u6E90\u8BBE\u7F6E\u6743\u9650" tabindex="-1">3.\u521B\u5EFAClusterRole\u8D44\u6E90\u8BBE\u7F6E\u6743\u9650 <a class="header-anchor" href="#_3-\u521B\u5EFAclusterrole\u8D44\u6E90\u8BBE\u7F6E\u6743\u9650" aria-hidden="true">#</a></h2><p>\u521B\u5EFA\u4E00\u4E2AClusterRole\uFF0C\u9488\u5BF9\u8D44\u6E90\u505A\u4E00\u4E9B\u6388\u6743\uFF0C\u7531\u4E8EClusterRole\u662F\u96C6\u7FA4\u7EA7\u522B\u7684\u89D2\u8272\u6388\u6743\uFF0C\u53EF\u4EE5\u591A\u6B21\u590D\u7528</p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u7F16\u5199ClusterRole\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> vim knowman-clusterrole.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#DBD7CA;">kind: ClusterRole</span></span>
<span class="line"><span style="color:#DBD7CA;">metadata:</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: knowman-clusterrole</span></span>
<span class="line"><span style="color:#DBD7CA;">rules:											</span><span style="color:#758575;">#\u5B9A\u4E49\u89D2\u8272</span></span>
<span class="line"><span style="color:#DBD7CA;">- apiGroups: </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;apps&quot;</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">						</span><span style="color:#758575;">#\u5BF9\u54EA\u4E2Aapi\u7EC4\u8FDB\u884C\u6388\u6743\uFF0C&quot;&quot;\u6838\u5FC3\u8D44\u6E90\u7EC4\uFF0Capps\u7EC4\u662Fdeployment\u63A7\u5236\u5668\u6240\u5728\u7684api\u7EC4</span></span>
<span class="line"><span style="color:#DBD7CA;">  resources: </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;pods&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;deployments&quot;</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">				  </span><span style="color:#758575;">#\u5BF9\u4EC0\u4E48\u8D44\u6E90\u8FDB\u884C\u6388\u6743</span></span>
<span class="line"><span style="color:#DBD7CA;">  verbs:										</span><span style="color:#758575;">#\u5177\u4F53\u7684\u6743\u9650\u5217\u8868</span></span>
<span class="line"><span style="color:#DBD7CA;">  - get</span></span>
<span class="line"><span style="color:#DBD7CA;">  - list</span></span>
<span class="line"><span style="color:#DBD7CA;">  - watch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl create -f knowman-clusterrole.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">clusterrole.rbac.authorization.k8s.io/knowman-clusterrole created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u67E5\u770B\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get clusterrole knowman-clusterrole</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                  CREATED AT</span></span>
<span class="line"><span style="color:#DBD7CA;">knowman-clusterrole   2021-04-20T06:26:20Z</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">4.\u67E5\u770B\u8D44\u6E90\u7684\u8BE6\u7EC6\u4FE1\u606F</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl describe clusterrole knowman-clusterrole</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u7F16\u5199ClusterRole\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> vim knowman-clusterrole.yaml</span></span>
<span class="line"><span style="color:#393A34;">apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#393A34;">kind: ClusterRole</span></span>
<span class="line"><span style="color:#393A34;">metadata:</span></span>
<span class="line"><span style="color:#393A34;">  name: knowman-clusterrole</span></span>
<span class="line"><span style="color:#393A34;">rules:											</span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u89D2\u8272</span></span>
<span class="line"><span style="color:#393A34;">- apiGroups: </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;apps&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">						</span><span style="color:#A0ADA0;">#\u5BF9\u54EA\u4E2Aapi\u7EC4\u8FDB\u884C\u6388\u6743\uFF0C&quot;&quot;\u6838\u5FC3\u8D44\u6E90\u7EC4\uFF0Capps\u7EC4\u662Fdeployment\u63A7\u5236\u5668\u6240\u5728\u7684api\u7EC4</span></span>
<span class="line"><span style="color:#393A34;">  resources: </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;pods&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;deployments&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">				  </span><span style="color:#A0ADA0;">#\u5BF9\u4EC0\u4E48\u8D44\u6E90\u8FDB\u884C\u6388\u6743</span></span>
<span class="line"><span style="color:#393A34;">  verbs:										</span><span style="color:#A0ADA0;">#\u5177\u4F53\u7684\u6743\u9650\u5217\u8868</span></span>
<span class="line"><span style="color:#393A34;">  - get</span></span>
<span class="line"><span style="color:#393A34;">  - list</span></span>
<span class="line"><span style="color:#393A34;">  - watch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl create -f knowman-clusterrole.yaml</span></span>
<span class="line"><span style="color:#393A34;">clusterrole.rbac.authorization.k8s.io/knowman-clusterrole created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u67E5\u770B\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get clusterrole knowman-clusterrole</span></span>
<span class="line"><span style="color:#393A34;">NAME                  CREATED AT</span></span>
<span class="line"><span style="color:#393A34;">knowman-clusterrole   2021-04-20T06:26:20Z</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">4.\u67E5\u770B\u8D44\u6E90\u7684\u8BE6\u7EC6\u4FE1\u606F</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl describe clusterrole knowman-clusterrole</span></span>
<span class="line"></span></code></pre></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616085930519.png" alt="Kubernetes\u96C6\u7FA4RBAC\u6388\u6743\u6848\u4F8B\uFF08\u4E00\uFF09\u901A\u8FC7\u7528\u6237\u8D26\u53F7\u7684\u65B9\u5F0F\u5206\u914D\u5355\u72ECNamespace\u7684\u6743\u9650\uFF08\u56DB\u5341\uFF09_docker_02"></p><h2 id="_4-\u521B\u5EFArolebinding\u8D44\u6E90\u5C06\u7528\u6237\u548C\u89D2\u8272\u7ED1\u5B9A" tabindex="-1">4.\u521B\u5EFARoleBinding\u8D44\u6E90\u5C06\u7528\u6237\u548C\u89D2\u8272\u7ED1\u5B9A <a class="header-anchor" href="#_4-\u521B\u5EFArolebinding\u8D44\u6E90\u5C06\u7528\u6237\u548C\u89D2\u8272\u7ED1\u5B9A" aria-hidden="true">#</a></h2><p>\u901A\u8FC7RoleBinding\u89D2\u8272\u7ED1\u5B9A\u5C06\u7528\u6237\u4E0E\u96C6\u7FA4\u89D2\u8272\u8FDB\u884C\u7ED1\u5B9A</p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u7F16\u5199yaml</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> vim knowman-rolebinding.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#DBD7CA;">kind: RoleBinding</span></span>
<span class="line"><span style="color:#DBD7CA;">metadata:</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: knowman-rolebinding</span></span>
<span class="line"><span style="color:#DBD7CA;">  namespace: know-system</span></span>
<span class="line"><span style="color:#DBD7CA;">subjects:												</span><span style="color:#758575;">#\u5173\u8054\u7528\u6237\u4FE1\u606F</span></span>
<span class="line"><span style="color:#DBD7CA;">- kind: User											</span><span style="color:#758575;">#\u7C7B\u578B\u4E3A\u7528\u6237</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: knowman											</span><span style="color:#758575;">#\u7528\u6237\u540D\u79F0</span></span>
<span class="line"><span style="color:#DBD7CA;">  namespace: know-system								</span><span style="color:#758575;">#\u89D2\u8272\u6240\u80FD\u63A7\u5236\u7684\u547D\u540D\u7A7A\u95F4</span></span>
<span class="line"><span style="color:#DBD7CA;">  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#DBD7CA;">roleRef:											</span><span style="color:#758575;">#\u5173\u8054\u89D2\u8272\u4FE1\u606F</span></span>
<span class="line"><span style="color:#DBD7CA;">  kind: ClusterRole									 </span><span style="color:#758575;">#\u7C7B\u578B\u4E3AClusterRole</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: knowman-clusterrole							  </span><span style="color:#758575;">#\u89D2\u8272\u540D\u79F0</span></span>
<span class="line"><span style="color:#DBD7CA;">  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl create -f knowman-rolebinding.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">rolebinding.rbac.authorization.k8s.io/knowman-rolebinding created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u67E5\u770B\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get rolebinding knowman-rolebinding -n know-system</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                  ROLE                              AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">knowman-rolebinding   ClusterRole/knowman-clusterrole   17s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">4.\u67E5\u770B\u8D44\u6E90\u7684\u8BE6\u7EC6\u4FE1\u606F</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl describe rolebinding knowman-rolebinding -n know-system</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u7F16\u5199yaml</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> vim knowman-rolebinding.yaml</span></span>
<span class="line"><span style="color:#393A34;">apiVersion: rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#393A34;">kind: RoleBinding</span></span>
<span class="line"><span style="color:#393A34;">metadata:</span></span>
<span class="line"><span style="color:#393A34;">  name: knowman-rolebinding</span></span>
<span class="line"><span style="color:#393A34;">  namespace: know-system</span></span>
<span class="line"><span style="color:#393A34;">subjects:												</span><span style="color:#A0ADA0;">#\u5173\u8054\u7528\u6237\u4FE1\u606F</span></span>
<span class="line"><span style="color:#393A34;">- kind: User											</span><span style="color:#A0ADA0;">#\u7C7B\u578B\u4E3A\u7528\u6237</span></span>
<span class="line"><span style="color:#393A34;">  name: knowman											</span><span style="color:#A0ADA0;">#\u7528\u6237\u540D\u79F0</span></span>
<span class="line"><span style="color:#393A34;">  namespace: know-system								</span><span style="color:#A0ADA0;">#\u89D2\u8272\u6240\u80FD\u63A7\u5236\u7684\u547D\u540D\u7A7A\u95F4</span></span>
<span class="line"><span style="color:#393A34;">  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#393A34;">roleRef:											</span><span style="color:#A0ADA0;">#\u5173\u8054\u89D2\u8272\u4FE1\u606F</span></span>
<span class="line"><span style="color:#393A34;">  kind: ClusterRole									 </span><span style="color:#A0ADA0;">#\u7C7B\u578B\u4E3AClusterRole</span></span>
<span class="line"><span style="color:#393A34;">  name: knowman-clusterrole							  </span><span style="color:#A0ADA0;">#\u89D2\u8272\u540D\u79F0</span></span>
<span class="line"><span style="color:#393A34;">  apiGroup: rbac.authorization.k8s.io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl create -f knowman-rolebinding.yaml</span></span>
<span class="line"><span style="color:#393A34;">rolebinding.rbac.authorization.k8s.io/knowman-rolebinding created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u67E5\u770B\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get rolebinding knowman-rolebinding -n know-system</span></span>
<span class="line"><span style="color:#393A34;">NAME                  ROLE                              AGE</span></span>
<span class="line"><span style="color:#393A34;">knowman-rolebinding   ClusterRole/knowman-clusterrole   17s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">4.\u67E5\u770B\u8D44\u6E90\u7684\u8BE6\u7EC6\u4FE1\u606F</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl describe rolebinding knowman-rolebinding -n know-system</span></span>
<span class="line"></span></code></pre></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616085930655.png" alt="Kubernetes\u96C6\u7FA4RBAC\u6388\u6743\u6848\u4F8B\uFF08\u4E00\uFF09\u901A\u8FC7\u7528\u6237\u8D26\u53F7\u7684\u65B9\u5F0F\u5206\u914D\u5355\u72ECNamespace\u7684\u6743\u9650\uFF08\u56DB\u5341\uFF09_nginx_03"></p><h2 id="_5-\u5207\u6362knowman\u7528\u6237\u67E5\u770B\u6743\u9650" tabindex="-1">5.\u5207\u6362knowman\u7528\u6237\u67E5\u770B\u6743\u9650 <a class="header-anchor" href="#_5-\u5207\u6362knowman\u7528\u6237\u67E5\u770B\u6743\u9650" aria-hidden="true">#</a></h2><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u5207\u6362\u7528\u6237</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl config use-context knowman@kubernetes </span></span>
<span class="line"><span style="color:#DBD7CA;">Switched to context </span><span style="color:#C98A7D;">&quot;knowman@kubernetes&quot;</span><span style="color:#DBD7CA;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u67E5\u770B\u53EF\u4EE5\u64CD\u4F5C\u7684pod/deployment\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get pod,deployment -n know-system</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                                READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/deploy-nginx-5cfd6fd7bd-79z4t   1/1     Running   1          6d3h</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/deploy-nginx-5cfd6fd7bd-b67wf   1/1     Running   1          6d3h</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/deploy-nginx-5cfd6fd7bd-qpl2w   1/1     Running   1          6d3h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                           READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">deployment.apps/deploy-nginx   3/3     3            3           6d5h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u5220\u9664pod\u67E5\u770B\u662F\u5426\u6709\u6743\u9650</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master </span><span style="color:#CB7676;">~</span><span style="color:#DBD7CA;">/k8s_1.19_yaml/rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl delete pod deploy-nginx-5cfd6fd7bd-79z4t -n know-system</span></span>
<span class="line"><span style="color:#DBD7CA;">Error from server </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">Forbidden</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">: pods </span><span style="color:#C98A7D;">&quot;deploy-nginx-5cfd6fd7bd-79z4t&quot;</span><span style="color:#DBD7CA;"> is forbidden: User </span><span style="color:#C98A7D;">&quot;knowman&quot;</span><span style="color:#DBD7CA;"> cannot delete resource </span><span style="color:#C98A7D;">&quot;pods&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span><span style="color:#DBD7CA;"> API group </span><span style="color:#C98A7D;">&quot;&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span><span style="color:#DBD7CA;"> the namespace </span><span style="color:#C98A7D;">&quot;know-system&quot;</span></span>
<span class="line"><span style="color:#758575;">#\u65E0\u6743\u5220\u9664</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u5207\u6362\u7528\u6237</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl config use-context knowman@kubernetes </span></span>
<span class="line"><span style="color:#393A34;">Switched to context </span><span style="color:#B56959;">&quot;knowman@kubernetes&quot;</span><span style="color:#393A34;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u67E5\u770B\u53EF\u4EE5\u64CD\u4F5C\u7684pod/deployment\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get pod,deployment -n know-system</span></span>
<span class="line"><span style="color:#393A34;">NAME                                READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#393A34;">pod/deploy-nginx-5cfd6fd7bd-79z4t   1/1     Running   1          6d3h</span></span>
<span class="line"><span style="color:#393A34;">pod/deploy-nginx-5cfd6fd7bd-b67wf   1/1     Running   1          6d3h</span></span>
<span class="line"><span style="color:#393A34;">pod/deploy-nginx-5cfd6fd7bd-qpl2w   1/1     Running   1          6d3h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                           READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#393A34;">deployment.apps/deploy-nginx   3/3     3            3           6d5h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u5220\u9664pod\u67E5\u770B\u662F\u5426\u6709\u6743\u9650</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master </span><span style="color:#AB5959;">~</span><span style="color:#393A34;">/k8s_1.19_yaml/rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl delete pod deploy-nginx-5cfd6fd7bd-79z4t -n know-system</span></span>
<span class="line"><span style="color:#393A34;">Error from server </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">Forbidden</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">: pods </span><span style="color:#B56959;">&quot;deploy-nginx-5cfd6fd7bd-79z4t&quot;</span><span style="color:#393A34;"> is forbidden: User </span><span style="color:#B56959;">&quot;knowman&quot;</span><span style="color:#393A34;"> cannot delete resource </span><span style="color:#B56959;">&quot;pods&quot;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span><span style="color:#393A34;"> API group </span><span style="color:#B56959;">&quot;&quot;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span><span style="color:#393A34;"> the namespace </span><span style="color:#B56959;">&quot;know-system&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u65E0\u6743\u5220\u9664</span></span>
<span class="line"></span></code></pre></div><p>\u9664\u4E86deployment\u3001pod\u8D44\u6E90\u4E4B\u524D\u65E0\u6743\u64CD\u4F5C\u5176\u4ED6\u8D44\u6E90</p><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616085930822.png" alt="Kubernetes\u96C6\u7FA4RBAC\u6388\u6743\u6848\u4F8B\uFF08\u4E00\uFF09\u901A\u8FC7\u7528\u6237\u8D26\u53F7\u7684\u65B9\u5F0F\u5206\u914D\u5355\u72ECNamespace\u7684\u6743\u9650\uFF08\u56DB\u5341\uFF09_nginx_04"></p><h1 id="\uFF08\u4E8C\uFF09\u901A\u8FC7kubeconfig\u6388\u6743\u6587\u4EF6\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D" tabindex="-1">\uFF08\u4E8C\uFF09\u901A\u8FC7kubeconfig\u6388\u6743\u6587\u4EF6\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D <a class="header-anchor" href="#\uFF08\u4E8C\uFF09\u901A\u8FC7kubeconfig\u6388\u6743\u6587\u4EF6\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D" aria-hidden="true">#</a></h1><h2 id="_1-\u6848\u4F8B\u63CF\u8FF0-1" tabindex="-1">1.\u6848\u4F8B\u63CF\u8FF0 <a class="header-anchor" href="#_1-\u6848\u4F8B\u63CF\u8FF0-1" aria-hidden="true">#</a></h2><p>\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u6839\u8BC1\u4E66\u7B7E\u53D1\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8BC1\u4E66\uFF0C\u5728\u5BA2\u6237\u7AEF\u8BC1\u4E66\u91CC\u9762\u6307\u5B9A\u7528\u6237\u540D\uFF0C\u7136\u540E\u5728\u901A\u8FC7kubectl config\u547D\u4EE4\u751F\u6210\u4E00\u4E2Akubeconfig\u6388\u6743\u6587\u4EF6\uFF0C\u6587\u4EF6\u5185\u5BB9\u4E2D\u5305\u62EC\u4E86\u96C6\u7FA4\u4FE1\u606F\u3001\u7528\u6237\u4FE1\u606F\u3001\u5BA2\u6237\u7AEF\u8BC1\u4E66\u4FE1\u606F\uFF0C\u7136\u540E\u518D\u521B\u5EFA\u4E00\u4E2Arbac\u7B56\u7565\uFF0C\u5C06\u8BC1\u4E66\u4E2D\u7684\u7528\u6237\u4E0E\u521B\u5EFA\u7684role\u89D2\u8272\u8FDB\u884C\u7ED1\u5B9A\uFF0C\u5373\u53EF\u5B9E\u73B0\u901A\u8FC7\u6388\u6743\u6587\u4EF6\u7684\u65B9\u5F0F\u53BB\u8BBF\u95EE\u96C6\u7FA4\u7684\u7279\u5B9A\u8D44\u6E90</p><p><strong>\u6700\u7EC8\u5B9E\u73B0\u76EE\u7684\uFF1A</strong> \u5C06\u6388\u6743\u6587\u4EF6\u53D1\u7ED9\u5BF9\u5E94\u7684\u4EBA\u5458\uFF0C\u8BA9\u4EBA\u5458\u53EA\u9700kubectl\u547D\u4EE4\u7684\u65F6\u5019\u6307\u5B9Akubeconfig\u6587\u4EF6\u7684\u8DEF\u5F84\u5373\u53EF\u8BF7\u6C42\u96C6\u7FA4\u8D44\u6E90</p><p><strong>\u5B9E\u73B0\u6B65\u9AA4\uFF1A</strong></p><p>1.\u5B89\u88C5cfssl\u5DE5\u5177\uFF0C\u7528k8s ca\u6839\u8BC1\u4E66\u7B7E\u53D1\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8BC1\u4E66</p><p>2.\u7528kubectl config\u751F\u6210\u6388\u6743\u6587\u4EF6</p><p>3.\u521B\u5EFArbac\u6388\u6743\u7B56\u7565</p><h2 id="_2-\u51C6\u5907cfssl\u5DE5\u5177\u547D\u4EE4" tabindex="-1">2.\u51C6\u5907cfssl\u5DE5\u5177\u547D\u4EE4 <a class="header-anchor" href="#_2-\u51C6\u5907cfssl\u5DE5\u5177\u547D\u4EE4" aria-hidden="true">#</a></h2><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u7F16\u5199\u811A\u672C</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master 1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> cat cfssl.sh </span></span>
<span class="line"><span style="color:#DBD7CA;">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64</span></span>
<span class="line"><span style="color:#DBD7CA;">wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64</span></span>
<span class="line"><span style="color:#DBD7CA;">wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64</span></span>
<span class="line"><span style="color:#DBD7CA;">chmod +x cfssl</span><span style="color:#CB7676;">*</span></span>
<span class="line"><span style="color:#DBD7CA;">mv cfssl_linux-amd64 /usr/bin/cfssl</span></span>
<span class="line"><span style="color:#DBD7CA;">mv cfssljson_linux-amd64 /usr/bin/cfssljson</span></span>
<span class="line"><span style="color:#DBD7CA;">mv cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u6267\u884C\u811A\u672C</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> sh cfssl.sh </span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u67E5\u770B\u662F\u5426\u5B89\u88C5\u6210\u529F</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ll /usr/bin/cfssl</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> /usr/local/bin/cfssl</span></span>
<span class="line"><span style="color:#DBD7CA;">-rwxr-xr-x 1 root root  6595195 4\u6708  17 03:17 /usr/bin/cfssl-certinfo</span></span>
<span class="line"><span style="color:#DBD7CA;">-rwxr-xr-x 1 root root  2277873 4\u6708  17 03:17 /usr/bin/cfssljson</span></span>
<span class="line"><span style="color:#DBD7CA;">-rwxr-xr-x 1 root root 10376657 5\u6708  11 10:17 /usr/local/bin/cfssl</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u7F16\u5199\u811A\u672C</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master 1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> cat cfssl.sh </span></span>
<span class="line"><span style="color:#393A34;">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64</span></span>
<span class="line"><span style="color:#393A34;">wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64</span></span>
<span class="line"><span style="color:#393A34;">wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64</span></span>
<span class="line"><span style="color:#393A34;">chmod +x cfssl</span><span style="color:#AB5959;">*</span></span>
<span class="line"><span style="color:#393A34;">mv cfssl_linux-amd64 /usr/bin/cfssl</span></span>
<span class="line"><span style="color:#393A34;">mv cfssljson_linux-amd64 /usr/bin/cfssljson</span></span>
<span class="line"><span style="color:#393A34;">mv cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u6267\u884C\u811A\u672C</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> sh cfssl.sh </span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u67E5\u770B\u662F\u5426\u5B89\u88C5\u6210\u529F</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ll /usr/bin/cfssl</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> /usr/local/bin/cfssl</span></span>
<span class="line"><span style="color:#393A34;">-rwxr-xr-x 1 root root  6595195 4\u6708  17 03:17 /usr/bin/cfssl-certinfo</span></span>
<span class="line"><span style="color:#393A34;">-rwxr-xr-x 1 root root  2277873 4\u6708  17 03:17 /usr/bin/cfssljson</span></span>
<span class="line"><span style="color:#393A34;">-rwxr-xr-x 1 root root 10376657 5\u6708  11 10:17 /usr/local/bin/cfssl</span></span>
<span class="line"></span></code></pre></div><h2 id="_3-\u5229\u7528k8s\u6839\u8BC1\u4E66\u7B7E\u53D1\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8BC1\u4E66" tabindex="-1">3.\u5229\u7528k8s\u6839\u8BC1\u4E66\u7B7E\u53D1\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8BC1\u4E66 <a class="header-anchor" href="#_3-\u5229\u7528k8s\u6839\u8BC1\u4E66\u7B7E\u53D1\u4E00\u4E2A\u5BA2\u6237\u7AEF\u8BC1\u4E66" aria-hidden="true">#</a></h2><p>\u5229\u7528k8s\u7684ca\u6839\u8BC1\u4E66\u7B7E\u53D1\u4E00\u4E2A\u4E13\u95E8\u7ED9\u67D0\u4E2A\u5BA2\u6237\u7AEF\u4F7F\u7528\u7684\u8BC1\u4E66</p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u7F16\u5199\u811A\u672C</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> vim cert.sh</span></span>
<span class="line"><span style="color:#DBD7CA;">cat </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> ca-config.json </span><span style="color:#CB7676;">&lt;&lt;</span><span style="color:#4D9375;">EOF</span></span>
<span class="line"><span style="color:#C98A7D;">{</span></span>
<span class="line"><span style="color:#C98A7D;">  &quot;signing&quot;: {</span></span>
<span class="line"><span style="color:#C98A7D;">    &quot;default&quot;: {</span></span>
<span class="line"><span style="color:#C98A7D;">      &quot;expiry&quot;: &quot;87600h&quot;			#\u8BC1\u4E66\u7684\u6709\u6548\u671F</span></span>
<span class="line"><span style="color:#C98A7D;">    },</span></span>
<span class="line"><span style="color:#C98A7D;">    &quot;profiles&quot;: {</span></span>
<span class="line"><span style="color:#C98A7D;">      &quot;kubernetes&quot;: {</span></span>
<span class="line"><span style="color:#C98A7D;">        &quot;usages&quot;: [</span></span>
<span class="line"><span style="color:#C98A7D;">            &quot;signing&quot;,</span></span>
<span class="line"><span style="color:#C98A7D;">            &quot;key encipherment&quot;,</span></span>
<span class="line"><span style="color:#C98A7D;">            &quot;server auth&quot;,</span></span>
<span class="line"><span style="color:#C98A7D;">            &quot;client auth&quot;</span></span>
<span class="line"><span style="color:#C98A7D;">        ],</span></span>
<span class="line"><span style="color:#C98A7D;">        &quot;expiry&quot;: &quot;87600h&quot;</span></span>
<span class="line"><span style="color:#C98A7D;">      }</span></span>
<span class="line"><span style="color:#C98A7D;">    }</span></span>
<span class="line"><span style="color:#C98A7D;">  }</span></span>
<span class="line"><span style="color:#C98A7D;">}</span></span>
<span class="line"><span style="color:#4D9375;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">cat </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> jiangxl-csr.json </span><span style="color:#CB7676;">&lt;&lt;</span><span style="color:#4D9375;">EOF</span></span>
<span class="line"><span style="color:#C98A7D;">{</span></span>
<span class="line"><span style="color:#C98A7D;">  &quot;CN&quot;: &quot;jiangxl&quot;,					#\u53EF\u4EE5\u7406\u89E3\u4E3A\u662F\u7528\u6237\u540D\uFF0Crbac\u6388\u6743\u7684\u65F6\u5019\u4E5F\u662F\u6839\u636E\u8FD9\u4E2A\u503C\u6765\u6388\u6743</span></span>
<span class="line"><span style="color:#C98A7D;">  &quot;hosts&quot;: [],</span></span>
<span class="line"><span style="color:#C98A7D;">  &quot;key&quot;: {</span></span>
<span class="line"><span style="color:#C98A7D;">    &quot;algo&quot;: &quot;rsa&quot;,</span></span>
<span class="line"><span style="color:#C98A7D;">    &quot;size&quot;: 2048</span></span>
<span class="line"><span style="color:#C98A7D;">  },</span></span>
<span class="line"><span style="color:#C98A7D;">  &quot;names&quot;: [</span></span>
<span class="line"><span style="color:#C98A7D;">    {</span></span>
<span class="line"><span style="color:#C98A7D;">      &quot;C&quot;: &quot;CN&quot;,</span></span>
<span class="line"><span style="color:#C98A7D;">      &quot;ST&quot;: &quot;BeiJing&quot;,</span></span>
<span class="line"><span style="color:#C98A7D;">      &quot;L&quot;: &quot;BeiJing&quot;,</span></span>
<span class="line"><span style="color:#C98A7D;">      &quot;O&quot;: &quot;k8s&quot;,</span></span>
<span class="line"><span style="color:#C98A7D;">      &quot;OU&quot;: &quot;System&quot;</span></span>
<span class="line"><span style="color:#C98A7D;">    }</span></span>
<span class="line"><span style="color:#C98A7D;">  ]</span></span>
<span class="line"><span style="color:#C98A7D;">}</span></span>
<span class="line"><span style="color:#4D9375;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">cfssl gencert -ca=/etc/kubernetes/pki/ca.crt -ca-key=/etc/kubernetes/pki/ca.key -config=ca-config.json -profile=kubernetes jiangxl-csr.json </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> cfssljson -bare jiangxl			</span><span style="color:#758575;">#\u901A\u8FC7cfssl\u751F\u6210\u8BC1\u4E66\uFF0C\u8981\u6307\u5B9Ak8s\u6839\u8BC1\u4E66\u7684\u8DEF\u5F84</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u751F\u6210\u8BC1\u4E66</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> sh cert.sh</span></span>
<span class="line"><span style="color:#DBD7CA;">2021/07/06 14:52:58 </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">INFO</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> generate received request</span></span>
<span class="line"><span style="color:#DBD7CA;">2021/07/06 14:52:58 </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">INFO</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> received CSR</span></span>
<span class="line"><span style="color:#DBD7CA;">2021/07/06 14:52:58 </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">INFO</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> generating key: rsa-2048</span></span>
<span class="line"><span style="color:#DBD7CA;">2021/07/06 14:52:58 </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">INFO</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> encoded CSR</span></span>
<span class="line"><span style="color:#DBD7CA;">2021/07/06 14:52:58 </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">INFO</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> signed certificate with serial number 104120417046794075592128325952316827755218120119</span></span>
<span class="line"><span style="color:#DBD7CA;">2021/07/06 14:52:58 </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">WARNING</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;"> This certificate lacks a </span><span style="color:#C98A7D;">&quot;hosts&quot;</span><span style="color:#DBD7CA;"> field. This makes it unsuitable </span><span style="color:#4D9375;">for</span></span>
<span class="line"><span style="color:#DBD7CA;">websites. For more information see the Baseline Requirements </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CA;"> the Issuance and Management</span></span>
<span class="line"><span style="color:#DBD7CA;">of Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">https://cabforum.org</span><span style="color:#858585;">)</span><span style="color:#CB7676;">;</span></span>
<span class="line"><span style="color:#DBD7CA;">specifically, section 10.2.3 </span><span style="color:#858585;">(</span><span style="color:#C98A7D;">&quot;Information Requirements&quot;</span><span style="color:#858585;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u67E5\u770B\u751F\u6210\u7684\u8BC1\u4E66\u6587\u4EF6</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> ll ca-config.json jiangxl</span><span style="color:#CB7676;">*</span></span>
<span class="line"><span style="color:#DBD7CA;">-rw-r--r-- 1 root root  292 7\u6708   6 14:52 ca-config.json</span></span>
<span class="line"><span style="color:#DBD7CA;">-rw-r--r-- 1 root root  997 7\u6708   6 14:52 jiangxl.csr</span></span>
<span class="line"><span style="color:#DBD7CA;">-rw-r--r-- 1 root root  220 7\u6708   6 14:52 jiangxl-csr.json</span></span>
<span class="line"><span style="color:#DBD7CA;">-rw------- 1 root root 1679 7\u6708   6 14:52 jiangxl-key.pem</span></span>
<span class="line"><span style="color:#DBD7CA;">-rw-r--r-- 1 root root 1281 7\u6708   6 14:52 jiangxl.pem</span></span>
<span class="line"><span style="color:#758575;">#\u4E3B\u8981\u6709\u7528\u7684\u5C31\u662Fjiangxl.pem jiangxl-key.pem</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u7F16\u5199\u811A\u672C</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> vim cert.sh</span></span>
<span class="line"><span style="color:#393A34;">cat </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> ca-config.json </span><span style="color:#AB5959;">&lt;&lt;</span><span style="color:#1C6B48;">EOF</span></span>
<span class="line"><span style="color:#B56959;">{</span></span>
<span class="line"><span style="color:#B56959;">  &quot;signing&quot;: {</span></span>
<span class="line"><span style="color:#B56959;">    &quot;default&quot;: {</span></span>
<span class="line"><span style="color:#B56959;">      &quot;expiry&quot;: &quot;87600h&quot;			#\u8BC1\u4E66\u7684\u6709\u6548\u671F</span></span>
<span class="line"><span style="color:#B56959;">    },</span></span>
<span class="line"><span style="color:#B56959;">    &quot;profiles&quot;: {</span></span>
<span class="line"><span style="color:#B56959;">      &quot;kubernetes&quot;: {</span></span>
<span class="line"><span style="color:#B56959;">        &quot;usages&quot;: [</span></span>
<span class="line"><span style="color:#B56959;">            &quot;signing&quot;,</span></span>
<span class="line"><span style="color:#B56959;">            &quot;key encipherment&quot;,</span></span>
<span class="line"><span style="color:#B56959;">            &quot;server auth&quot;,</span></span>
<span class="line"><span style="color:#B56959;">            &quot;client auth&quot;</span></span>
<span class="line"><span style="color:#B56959;">        ],</span></span>
<span class="line"><span style="color:#B56959;">        &quot;expiry&quot;: &quot;87600h&quot;</span></span>
<span class="line"><span style="color:#B56959;">      }</span></span>
<span class="line"><span style="color:#B56959;">    }</span></span>
<span class="line"><span style="color:#B56959;">  }</span></span>
<span class="line"><span style="color:#B56959;">}</span></span>
<span class="line"><span style="color:#1C6B48;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">cat </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> jiangxl-csr.json </span><span style="color:#AB5959;">&lt;&lt;</span><span style="color:#1C6B48;">EOF</span></span>
<span class="line"><span style="color:#B56959;">{</span></span>
<span class="line"><span style="color:#B56959;">  &quot;CN&quot;: &quot;jiangxl&quot;,					#\u53EF\u4EE5\u7406\u89E3\u4E3A\u662F\u7528\u6237\u540D\uFF0Crbac\u6388\u6743\u7684\u65F6\u5019\u4E5F\u662F\u6839\u636E\u8FD9\u4E2A\u503C\u6765\u6388\u6743</span></span>
<span class="line"><span style="color:#B56959;">  &quot;hosts&quot;: [],</span></span>
<span class="line"><span style="color:#B56959;">  &quot;key&quot;: {</span></span>
<span class="line"><span style="color:#B56959;">    &quot;algo&quot;: &quot;rsa&quot;,</span></span>
<span class="line"><span style="color:#B56959;">    &quot;size&quot;: 2048</span></span>
<span class="line"><span style="color:#B56959;">  },</span></span>
<span class="line"><span style="color:#B56959;">  &quot;names&quot;: [</span></span>
<span class="line"><span style="color:#B56959;">    {</span></span>
<span class="line"><span style="color:#B56959;">      &quot;C&quot;: &quot;CN&quot;,</span></span>
<span class="line"><span style="color:#B56959;">      &quot;ST&quot;: &quot;BeiJing&quot;,</span></span>
<span class="line"><span style="color:#B56959;">      &quot;L&quot;: &quot;BeiJing&quot;,</span></span>
<span class="line"><span style="color:#B56959;">      &quot;O&quot;: &quot;k8s&quot;,</span></span>
<span class="line"><span style="color:#B56959;">      &quot;OU&quot;: &quot;System&quot;</span></span>
<span class="line"><span style="color:#B56959;">    }</span></span>
<span class="line"><span style="color:#B56959;">  ]</span></span>
<span class="line"><span style="color:#B56959;">}</span></span>
<span class="line"><span style="color:#1C6B48;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">cfssl gencert -ca=/etc/kubernetes/pki/ca.crt -ca-key=/etc/kubernetes/pki/ca.key -config=ca-config.json -profile=kubernetes jiangxl-csr.json </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> cfssljson -bare jiangxl			</span><span style="color:#A0ADA0;">#\u901A\u8FC7cfssl\u751F\u6210\u8BC1\u4E66\uFF0C\u8981\u6307\u5B9Ak8s\u6839\u8BC1\u4E66\u7684\u8DEF\u5F84</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u751F\u6210\u8BC1\u4E66</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> sh cert.sh</span></span>
<span class="line"><span style="color:#393A34;">2021/07/06 14:52:58 </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">INFO</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> generate received request</span></span>
<span class="line"><span style="color:#393A34;">2021/07/06 14:52:58 </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">INFO</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> received CSR</span></span>
<span class="line"><span style="color:#393A34;">2021/07/06 14:52:58 </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">INFO</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> generating key: rsa-2048</span></span>
<span class="line"><span style="color:#393A34;">2021/07/06 14:52:58 </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">INFO</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> encoded CSR</span></span>
<span class="line"><span style="color:#393A34;">2021/07/06 14:52:58 </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">INFO</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> signed certificate with serial number 104120417046794075592128325952316827755218120119</span></span>
<span class="line"><span style="color:#393A34;">2021/07/06 14:52:58 </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">WARNING</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;"> This certificate lacks a </span><span style="color:#B56959;">&quot;hosts&quot;</span><span style="color:#393A34;"> field. This makes it unsuitable </span><span style="color:#1C6B48;">for</span></span>
<span class="line"><span style="color:#393A34;">websites. For more information see the Baseline Requirements </span><span style="color:#1C6B48;">for</span><span style="color:#393A34;"> the Issuance and Management</span></span>
<span class="line"><span style="color:#393A34;">of Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">https://cabforum.org</span><span style="color:#8E8F8B;">)</span><span style="color:#AB5959;">;</span></span>
<span class="line"><span style="color:#393A34;">specifically, section 10.2.3 </span><span style="color:#8E8F8B;">(</span><span style="color:#B56959;">&quot;Information Requirements&quot;</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u67E5\u770B\u751F\u6210\u7684\u8BC1\u4E66\u6587\u4EF6</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> ll ca-config.json jiangxl</span><span style="color:#AB5959;">*</span></span>
<span class="line"><span style="color:#393A34;">-rw-r--r-- 1 root root  292 7\u6708   6 14:52 ca-config.json</span></span>
<span class="line"><span style="color:#393A34;">-rw-r--r-- 1 root root  997 7\u6708   6 14:52 jiangxl.csr</span></span>
<span class="line"><span style="color:#393A34;">-rw-r--r-- 1 root root  220 7\u6708   6 14:52 jiangxl-csr.json</span></span>
<span class="line"><span style="color:#393A34;">-rw------- 1 root root 1679 7\u6708   6 14:52 jiangxl-key.pem</span></span>
<span class="line"><span style="color:#393A34;">-rw-r--r-- 1 root root 1281 7\u6708   6 14:52 jiangxl.pem</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u4E3B\u8981\u6709\u7528\u7684\u5C31\u662Fjiangxl.pem jiangxl-key.pem</span></span>
<span class="line"></span></code></pre></div><h2 id="_4-\u751F\u6210kubeconfig\u6388\u6743\u6587\u4EF6" tabindex="-1">4.\u751F\u6210kubeconfig\u6388\u6743\u6587\u4EF6 <a class="header-anchor" href="#_4-\u751F\u6210kubeconfig\u6388\u6743\u6587\u4EF6" aria-hidden="true">#</a></h2><p>\u751F\u6210\u4E00\u4E2Akubeconfig\u6388\u6743\u6587\u4EF6\uFF0C\u6587\u4EF6\u7684\u5185\u5BB9\u548C/root/.kube/config\u6587\u4EF6\u57FA\u672C\u662F\u4E00\u81F4\u7684\uFF0C\u53EA\u662F\u8BC1\u4E66\u5185\u5BB9\u4E0D\u4E00\u6837\uFF0C\u8BC1\u4E66\u5185\u5BB9\u4E0D\u540C\u6240\u5C5E\u7684\u6743\u9650\u4E5F\u4E0D\u540C\uFF0C\u7528\u6237\u53EF\u4EE5\u901A\u8FC7\u6307\u5B9Akubeconfig\u6587\u4EF6\u53BB\u6267\u884Ck8s\u547D\u4EE4</p><p>\u751F\u6210\u6388\u6743\u6587\u4EF6\u9700\u8981\u5206\u4E3A\u4E09\u4E2A\u6B65\u9AA4\uFF1A\u8BBE\u7F6E\u96C6\u7FA4\u3001\u8BBE\u7F6E\u8BC1\u4E66\u79C1\u94A5\u6587\u4EF6\u8DEF\u5F84\u3001\u6307\u5B9A\u7528\u6237\u540D\uFF0C\u6BCF\u5F53\u6267\u884C\u4E00\u4E2A\u6B65\u9AA4\uFF0Ckubeconfig\u7684\u5185\u5BB9\u5C31\u4F1A\u589E\u52A0\u4E0A\u76F8\u5E94\u7684\u914D\u7F6E</p><p><strong>1.\u751F\u6210\u6388\u6743\u6587\u4EF6\u8BBE\u7F6E\u96C6\u7FA4\u4FE1\u606F\uFF1A\u6307\u5B9A\u6839\u8BC1\u4E66\u8DEF\u5F84\u3001k8sapi\u5730\u5740\u3001\u6388\u6743\u6587\u4EF6\u540D\u79F0</strong></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-cluster kubernetes \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --certificate-authority=/etc/kubernetes/pki/ca.crt \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --embed-certs=true \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --server=https://192.168.16.106:6443 \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --kubeconfig=jiangxl.kubeconfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#set-cluster kubernetes\uFF1A\u8BBE\u7F6E\u96C6\u7FA4\u540D\u79F0\u4E3Akubernetes</span></span>
<span class="line"><span style="color:#758575;">#--certificate-authority\uFF1A\u6307\u5B9A\u6839\u8BC1\u4E66\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#758575;">#--server\uFF1A\u6307\u5B9Ak8sapi\u5730\u5740</span></span>
<span class="line"><span style="color:#758575;">#--kubeconfig\uFF1A\u6307\u5B9A\u6388\u6743\u6587\u4EF6\u540D\u79F0  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-cluster kubernetes \\</span></span>
<span class="line"><span style="color:#393A34;">  --certificate-authority=/etc/kubernetes/pki/ca.crt \\</span></span>
<span class="line"><span style="color:#393A34;">  --embed-certs=true \\</span></span>
<span class="line"><span style="color:#393A34;">  --server=https://192.168.16.106:6443 \\</span></span>
<span class="line"><span style="color:#393A34;">  --kubeconfig=jiangxl.kubeconfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#set-cluster kubernetes\uFF1A\u8BBE\u7F6E\u96C6\u7FA4\u540D\u79F0\u4E3Akubernetes</span></span>
<span class="line"><span style="color:#A0ADA0;">#--certificate-authority\uFF1A\u6307\u5B9A\u6839\u8BC1\u4E66\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#A0ADA0;">#--server\uFF1A\u6307\u5B9Ak8sapi\u5730\u5740</span></span>
<span class="line"><span style="color:#A0ADA0;">#--kubeconfig\uFF1A\u6307\u5B9A\u6388\u6743\u6587\u4EF6\u540D\u79F0  </span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u6267\u884C\u4E86\u7B2C\u4E00\u6B65\u8BBE\u7F6E\u96C6\u7FA4\u4FE1\u606F\u540E\uFF0C\u67E5\u770Bkubeconfig\u7684\u6587\u4EF6\u5185\u5BB9\uFF0C\u4F1A\u53D1\u73B0\u6587\u4EF6\u91CC\u9762\u591A\u4E86\u6839\u8BC1\u4E66ca\u7684\u6587\u4EF6\u5185\u5BB9\u4EE5\u53CA\u96C6\u7FA4apiserver\u7684\u5730\u5740 <img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616090418303.png" alt="Kubernetes\u96C6\u7FA4RBAC\u6388\u6743\u6848\u4F8B\uFF08\u4E8C\uFF09\u901A\u8FC7kubeconfig\u6388\u6743\u6587\u4EF6\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D\uFF08\u56DB\u5341\u4E00\uFF09_linux"></p><p><strong>2.\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BA4\u8BC1\uFF1A\u6307\u5B9A\u5BA2\u6237\u7AEF\u8BC1\u4E66\u6587\u4EF6\u8DEF\u5F84\u548C\u79C1\u94A5\u6587\u4EF6\u8DEF\u5F84</strong></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-credentials jiangxl \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --client-key=jiangxl-key.pem \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --client-certificate=jiangxl.pem \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --embed-certs=true \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --kubeconfig=jiangxl.kubeconfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#--client-key\uFF1A\u6307\u5B9A\u5BA2\u6237\u7AEF\u8BC1\u4E66\u7684\u79C1\u94A5\u6587\u4EF6</span></span>
<span class="line"><span style="color:#758575;">#--client-certificate\uFF1A\u6307\u5B9A\u5BA2\u6237\u7AEF\u8BC1\u4E66\u7684\u8BC1\u4E66\u6587\u4EF6</span></span>
<span class="line"><span style="color:#758575;">#--kubeconfig\uFF1A\u6307\u5B9A\u6388\u6743\u6587\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#758575;">#set-credentials jiangxl\uFF1A\u8BBE\u7F6E\u8BC1\u4E66\u7684\u540D\u79F0\u4E3Ajiangxl</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-credentials jiangxl \\</span></span>
<span class="line"><span style="color:#393A34;">  --client-key=jiangxl-key.pem \\</span></span>
<span class="line"><span style="color:#393A34;">  --client-certificate=jiangxl.pem \\</span></span>
<span class="line"><span style="color:#393A34;">  --embed-certs=true \\</span></span>
<span class="line"><span style="color:#393A34;">  --kubeconfig=jiangxl.kubeconfig</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#--client-key\uFF1A\u6307\u5B9A\u5BA2\u6237\u7AEF\u8BC1\u4E66\u7684\u79C1\u94A5\u6587\u4EF6</span></span>
<span class="line"><span style="color:#A0ADA0;">#--client-certificate\uFF1A\u6307\u5B9A\u5BA2\u6237\u7AEF\u8BC1\u4E66\u7684\u8BC1\u4E66\u6587\u4EF6</span></span>
<span class="line"><span style="color:#A0ADA0;">#--kubeconfig\uFF1A\u6307\u5B9A\u6388\u6743\u6587\u4EF6\u540D\u79F0</span></span>
<span class="line"><span style="color:#A0ADA0;">#set-credentials jiangxl\uFF1A\u8BBE\u7F6E\u8BC1\u4E66\u7684\u540D\u79F0\u4E3Ajiangxl</span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u7B2C\u4E8C\u6B65\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BC1\u4E66\u8BA4\u8BC1\u5B8C\u6210\u540E\uFF0Ckubeconfig\u6587\u4EF6\u5C31\u4F1A\u589E\u52A0\u5BA2\u6237\u7AEF\u8BC1\u4E66\u6587\u4EF6\u7684\u5185\u5BB9 <img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616090418664.png" alt="Kubernetes\u96C6\u7FA4RBAC\u6388\u6743\u6848\u4F8B\uFF08\u4E8C\uFF09\u901A\u8FC7kubeconfig\u6388\u6743\u6587\u4EF6\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D\uFF08\u56DB\u5341\u4E00\uFF09_\u5BA2\u6237\u7AEF_02"></p><p><strong>3.\u8BBE\u7F6E\u9ED8\u8BA4\u4E0A\u4E0B\u6587\uFF1A\u6307\u5B9A\u7528\u6237\u540D\u662F\u4EC0\u4E48</strong></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-context kubernetes \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --cluster=kubernetes \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --user=jiangxl \\</span></span>
<span class="line"><span style="color:#DBD7CA;">  --kubeconfig=jiangxl.kubeconfig</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-context kubernetes \\</span></span>
<span class="line"><span style="color:#393A34;">  --cluster=kubernetes \\</span></span>
<span class="line"><span style="color:#393A34;">  --user=jiangxl \\</span></span>
<span class="line"><span style="color:#393A34;">  --kubeconfig=jiangxl.kubeconfig</span></span>
<span class="line"></span></code></pre></div><p>\u7B2C\u4E09\u6B65\u6267\u884C\u5B8C\u6210\u540E\uFF0Ckubeconfig\u6587\u4EF6\u91CC\u9762\u4F1A\u589E\u52A0\u7528\u6237\u4FE1\u606F\u914D\u7F6E\uFF0Crbac\u6388\u6743\u4E5F\u662F\u5C06\u8FD9\u4E2A\u7528\u6237\u548C\u67D0\u4E2Arole\u8FDB\u884C\u7ED1\u5B9A <img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/watermark,size_16,text_QDUxQ1RP5Y2a5a6i,color_FFFFFF,t_30,g_se,x_10,y_10,shadow_20,type_ZmFuZ3poZW5naGVpdGk=-20220616090418987.png" alt="Kubernetes\u96C6\u7FA4RBAC\u6388\u6743\u6848\u4F8B\uFF08\u4E8C\uFF09\u901A\u8FC7kubeconfig\u6388\u6743\u6587\u4EF6\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D\uFF08\u56DB\u5341\u4E00\uFF09_\u5BB9\u5668_03"></p><h2 id="_5-\u6267\u884Ckubectl\u547D\u4EE4\u65F6\u6307\u5B9A\u6388\u6743\u6587\u4EF6" tabindex="-1">5.\u6267\u884Ckubectl\u547D\u4EE4\u65F6\u6307\u5B9A\u6388\u6743\u6587\u4EF6 <a class="header-anchor" href="#_5-\u6267\u884Ckubectl\u547D\u4EE4\u65F6\u6307\u5B9A\u6388\u6743\u6587\u4EF6" aria-hidden="true">#</a></h2><p>\u4F7F\u7528<code>--kubeconfig</code>\u53C2\u6570\u53BB\u6307\u5B9A\u4F7F\u7528\u54EA\u4E2A\u6388\u6743\u6587\u4EF6\uFF0C\u5230\u6B64\u65F6\u4E5F\u5C31\u53EF\u4EE5\u628A\u6388\u6743\u6587\u4EF6\u53D1\u9001\u7ED9\u9700\u8981\u4F7F\u7528\u8FD9\u4E2A\u6388\u6743\u7684\u4EBA\uFF0C\u867D\u7136\u73B0\u5728\u8FD8\u662F\u65E0\u6743\u9650\u83B7\u53D6\u8D44\u6E90\u7684\u72B6\u6001\uFF0C\u4F46\u662F\u5DF2\u7ECF\u53EF\u4EE5\u8FDE\u63A5\u5230k8s\u96C6\u7FA4\u4E86\uFF0C\u53EA\u9700\u8981\u914D\u7F6E\u597Drbac\u7B56\u7565\uFF0C\u5373\u53EF\u6709\u6743\u9650\u8BBF\u95EE\u8D44\u6E90</p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl --kubeconfig=jiangxl.kubeconfig get pod</span></span>
<span class="line"><span style="color:#DBD7CA;">Error from server </span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">Forbidden</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">: pods is forbidden: User </span><span style="color:#C98A7D;">&quot;jiangxl&quot;</span><span style="color:#DBD7CA;"> cannot list resource </span><span style="color:#C98A7D;">&quot;pods&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span><span style="color:#DBD7CA;"> API group </span><span style="color:#C98A7D;">&quot;&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span><span style="color:#DBD7CA;"> the namespace </span><span style="color:#C98A7D;">&quot;default&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl --kubeconfig=jiangxl.kubeconfig get pod</span></span>
<span class="line"><span style="color:#393A34;">Error from server </span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">Forbidden</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">: pods is forbidden: User </span><span style="color:#B56959;">&quot;jiangxl&quot;</span><span style="color:#393A34;"> cannot list resource </span><span style="color:#B56959;">&quot;pods&quot;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span><span style="color:#393A34;"> API group </span><span style="color:#B56959;">&quot;&quot;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span><span style="color:#393A34;"> the namespace </span><span style="color:#B56959;">&quot;default&quot;</span></span>
<span class="line"></span></code></pre></div><h2 id="_6-\u914D\u7F6Erbac\u7B56\u7565\u6388\u6743kubeconfig\u76F8\u5E94\u7684\u6743\u9650" tabindex="-1">6.\u914D\u7F6Erbac\u7B56\u7565\u6388\u6743kubeconfig\u76F8\u5E94\u7684\u6743\u9650 <a class="header-anchor" href="#_6-\u914D\u7F6Erbac\u7B56\u7565\u6388\u6743kubeconfig\u76F8\u5E94\u7684\u6743\u9650" aria-hidden="true">#</a></h2><p><strong>1.\u7F16\u5199rbac yaml\u8D44\u6E90\u6587\u4EF6</strong></p><p>\u521B\u5EFA\u4E00\u4E2Arole\uFF0C\u6388\u6743\u5BF9default\u547D\u540D\u7A7A\u95F4\u4E0Bpod\u3001deployment\u3001svc\u8D44\u6E90\u7684\u8BBF\u95EE\u6743\u9650\uFF0C\u5E76\u5C06\u8BE5role\u4E0Ejiangxl\u7528\u6237\u8FDB\u884C\u7ED1\u5B9A</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# vim rbac.yaml</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Role</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">pod-reader</span></span>
<span class="line"><span style="color:#429988;">rules</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">apiGroups</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;&quot;</span><span style="color:#858585;">,</span><span style="color:#C98A7D;">&quot;apps&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">resources</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;pods&quot;</span><span style="color:#858585;">,</span><span style="color:#C98A7D;">&quot;deployments&quot;</span><span style="color:#858585;">,</span><span style="color:#C98A7D;">&quot;services&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">verbs</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;get&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;watch&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;list&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">RoleBinding</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">read-pods</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#429988;">subjects</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">User</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">jiangxl</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">apiGroup</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#429988;">roleRef</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Role</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">pod-reader</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">apiGroup</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# vim rbac.yaml</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Role</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">pod-reader</span></span>
<span class="line"><span style="color:#2F8A89;">rules</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">apiGroups</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#B56959;">&quot;apps&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">resources</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;pods&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#B56959;">&quot;deployments&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#B56959;">&quot;services&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">verbs</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;get&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;watch&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;list&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">RoleBinding</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">read-pods</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#2F8A89;">subjects</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">User</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">jiangxl</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">apiGroup</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#2F8A89;">roleRef</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Role</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">pod-reader</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">apiGroup</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io</span></span>
<span class="line"></span></code></pre></div><p><strong>2.\u521B\u5EFArbac\u8D44\u6E90</strong></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl apply -f rbac.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">role.rbac.authorization.k8s.io/pod-reader created</span></span>
<span class="line"><span style="color:#DBD7CA;">rolebinding.rbac.authorization.k8s.io/read-pods created</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl apply -f rbac.yaml</span></span>
<span class="line"><span style="color:#393A34;">role.rbac.authorization.k8s.io/pod-reader created</span></span>
<span class="line"><span style="color:#393A34;">rolebinding.rbac.authorization.k8s.io/read-pods created</span></span>
<span class="line"></span></code></pre></div><h2 id="_7-\u9A8C\u8BC1kubeconfig\u6388\u6743\u6587\u4EF6\u662F\u5426\u6709\u4E86\u5BF9\u5E94\u7684\u6743\u9650" tabindex="-1">7.\u9A8C\u8BC1kubeconfig\u6388\u6743\u6587\u4EF6\u662F\u5426\u6709\u4E86\u5BF9\u5E94\u7684\u6743\u9650 <a class="header-anchor" href="#_7-\u9A8C\u8BC1kubeconfig\u6388\u6743\u6587\u4EF6\u662F\u5426\u6709\u4E86\u5BF9\u5E94\u7684\u6743\u9650" aria-hidden="true">#</a></h2><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 rbac</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl --kubeconfig=jiangxl.kubeconfig get pod,deployment,svc</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                         READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/jenkins-0                1/1     Running   0          38s</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/tools-696bf5cc5c-z2znw   1/1     Running   0          103s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                    READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">deployment.apps/tools   1/1     1            1           27d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT</span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">S</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">service/jenkins      ClusterIP   None         </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">        42/TCP    15d</span></span>
<span class="line"><span style="color:#DBD7CA;">service/kubernetes   ClusterIP   10.96.0.1    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">        443/TCP   59d</span></span>
<span class="line"><span style="color:#DBD7CA;">service/tools        ClusterIP   None         </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">        42/TCP    27d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#\u5DF2\u7ECF\u5BF9default\u547D\u540D\u7A7A\u95F4\u4E0B\u7684pod\u3001deployment\u3001svc\u8D44\u6E90\u6709\u4E86\u8BFB\u53D6\u6743\u9650</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 rbac</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl --kubeconfig=jiangxl.kubeconfig get pod,deployment,svc</span></span>
<span class="line"><span style="color:#393A34;">NAME                         READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#393A34;">pod/jenkins-0                1/1     Running   0          38s</span></span>
<span class="line"><span style="color:#393A34;">pod/tools-696bf5cc5c-z2znw   1/1     Running   0          103s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                    READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#393A34;">deployment.apps/tools   1/1     1            1           27d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT</span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">S</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">   AGE</span></span>
<span class="line"><span style="color:#393A34;">service/jenkins      ClusterIP   None         </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">        42/TCP    15d</span></span>
<span class="line"><span style="color:#393A34;">service/kubernetes   ClusterIP   10.96.0.1    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">        443/TCP   59d</span></span>
<span class="line"><span style="color:#393A34;">service/tools        ClusterIP   None         </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">        42/TCP    27d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#\u5DF2\u7ECF\u5BF9default\u547D\u540D\u7A7A\u95F4\u4E0B\u7684pod\u3001deployment\u3001svc\u8D44\u6E90\u6709\u4E86\u8BFB\u53D6\u6743\u9650</span></span>
<span class="line"></span></code></pre></div><h1 id="\uFF08\u4E09\uFF09\u901A\u8FC7service-account\u8D26\u53F7\u6388\u6743\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D" tabindex="-1">\uFF08\u4E09\uFF09\u901A\u8FC7Service Account\u8D26\u53F7\u6388\u6743\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D <a class="header-anchor" href="#\uFF08\u4E09\uFF09\u901A\u8FC7service-account\u8D26\u53F7\u6388\u6743\u5B9E\u73B0\u7279\u5B9A\u8D44\u6E90\u7684\u6743\u9650\u5206\u914D" aria-hidden="true">#</a></h1><h2 id="_1-\u521B\u5EFA\u4E00\u4E2Asa\u8D26\u53F7" tabindex="-1">1.\u521B\u5EFA\u4E00\u4E2Asa\u8D26\u53F7 <a class="header-anchor" href="#_1-\u521B\u5EFA\u4E00\u4E2Asa\u8D26\u53F7" aria-hidden="true">#</a></h2><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 sa</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# vim nginx-sa.yaml</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ServiceAccount</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx-sa</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">kubernetes.io/cluster-service</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">addonmanager.kubernetes.io/mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Reconcile</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 sa</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# vim nginx-sa.yaml</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ServiceAccount</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx-sa</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">kubernetes.io/cluster-service</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">addonmanager.kubernetes.io/mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Reconcile</span></span>
<span class="line"></span></code></pre></div><h2 id="_2-\u7F16\u5199rbac\u8D44\u6E90\u6388\u6743yaml\u6587\u4EF6" tabindex="-1">2.\u7F16\u5199rbac\u8D44\u6E90\u6388\u6743yaml\u6587\u4EF6 <a class="header-anchor" href="#_2-\u7F16\u5199rbac\u8D44\u6E90\u6388\u6743yaml\u6587\u4EF6" aria-hidden="true">#</a></h2><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 sa</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# vim nginx-rbac.yaml</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Role</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">pod-reader</span></span>
<span class="line"><span style="color:#429988;">rules</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">apiGroups</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;&quot;</span><span style="color:#858585;">,</span><span style="color:#C98A7D;">&quot;apps&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">resources</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;pods&quot;</span><span style="color:#858585;">,</span><span style="color:#C98A7D;">&quot;deployments&quot;</span><span style="color:#858585;">,</span><span style="color:#C98A7D;">&quot;services&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">verbs</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;get&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;watch&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;list&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">RoleBinding</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">read-pods</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac</span></span>
<span class="line"><span style="color:#429988;">subjects</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ServiceAccount</span><span style="color:#DBD7CA;">        </span><span style="color:#758575;">#\u7C7B\u578B\u586B\u5199ServiceAccount</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx-sa</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac</span></span>
<span class="line"><span style="color:#429988;">roleRef</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Role</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">pod-reader</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">apiGroup</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 sa</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# vim nginx-rbac.yaml</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Role</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">pod-reader</span></span>
<span class="line"><span style="color:#2F8A89;">rules</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">apiGroups</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#B56959;">&quot;apps&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">resources</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;pods&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#B56959;">&quot;deployments&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#B56959;">&quot;services&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">verbs</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;get&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;watch&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;list&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">RoleBinding</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">read-pods</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac</span></span>
<span class="line"><span style="color:#2F8A89;">subjects</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ServiceAccount</span><span style="color:#393A34;">        </span><span style="color:#A0ADA0;">#\u7C7B\u578B\u586B\u5199ServiceAccount</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx-sa</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac</span></span>
<span class="line"><span style="color:#2F8A89;">roleRef</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Role</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">pod-reader</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">apiGroup</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io</span></span>
<span class="line"></span></code></pre></div><h2 id="_3-\u7F16\u5199nginx-pod\u8D44\u6E90\u5E76\u4F7F\u7528sa\u8D26\u53F7" tabindex="-1">3.\u7F16\u5199nginx pod\u8D44\u6E90\u5E76\u4F7F\u7528sa\u8D26\u53F7 <a class="header-anchor" href="#_3-\u7F16\u5199nginx-pod\u8D44\u6E90\u5E76\u4F7F\u7528sa\u8D26\u53F7" aria-hidden="true">#</a></h2><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">apps/v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">StatefulSet</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">web</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">stat\`</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">serviceName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;web&quot;</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;">#\u6307\u5B9A\u4F7F\u7528\u54EA\u4E2Aheadless service\u8D44\u6E90</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replicas</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">3</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">matchLabels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">template</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx</span><span style="color:#DBD7CA;">    </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">serviceAccountName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx-sa</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">containers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx:1.17</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">web</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">containerPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">apps/v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">StatefulSet</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">web</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">stat\`</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">serviceName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;web&quot;</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;">#\u6307\u5B9A\u4F7F\u7528\u54EA\u4E2Aheadless service\u8D44\u6E90</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replicas</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">3</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">matchLabels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">template</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx</span><span style="color:#393A34;">    </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">serviceAccountName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx-sa</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">containers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx:1.17</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">web</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">containerPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span></span>
<span class="line"></span></code></pre></div><h2 id="_4-\u521B\u5EFA\u6240\u6709\u8D44\u6E90\u5E76\u67E5\u770B" tabindex="-1">4.\u521B\u5EFA\u6240\u6709\u8D44\u6E90\u5E76\u67E5\u770B <a class="header-anchor" href="#_4-\u521B\u5EFA\u6240\u6709\u8D44\u6E90\u5E76\u67E5\u770B" aria-hidden="true">#</a></h2><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u521B\u5EFA\u6240\u6709\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 sa</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl apply -f ./</span></span>
<span class="line"><span style="color:#DBD7CA;">role.rbac.authorization.k8s.io/pod-reader created</span></span>
<span class="line"><span style="color:#DBD7CA;">rolebinding.rbac.authorization.k8s.io/read-pods created</span></span>
<span class="line"><span style="color:#DBD7CA;">serviceaccount/nginx-sa created</span></span>
<span class="line"><span style="color:#DBD7CA;">statefulset.apps/web created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u67E5\u770Bsa\u8D26\u53F7</span></span>
<span class="line"><span style="color:#758575;">#sa\u8D26\u53F7\u4F1A\u751F\u6210\u4E00\u4E2Atoken\uFF0C\u8FD9\u4E2Atoken\u4E2D\u4FDD\u5B58\u8FD9\u6839\u8BC1\u4E66ca\u4EE5\u53CAsa\u7528\u6237\u7684\u8BC1\u4E66kube	</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">:q</span></span>
<span class="line"><span style="color:#DBD7CA;">\uFF0C\u7528\u4E8E\u8FDE\u63A5\u5230k8s\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 sa</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get sa -n rbac</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME       SECRETS   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">default    1         4m48s</span></span>
<span class="line"><span style="color:#DBD7CA;">nginx-sa   1         103s</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 sa</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get secret -n rbac</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                   TYPE                                  DATA   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">default-token-4fkpj    kubernetes.io/service-account-token   3      5m14s</span></span>
<span class="line"><span style="color:#DBD7CA;">nginx-sa-token-vcrmv   kubernetes.io/service-account-token   3      2m9s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u67E5\u770Bnginx\u8D44\u6E90\u4E2D\u662F\u5426\u5173\u8054sa</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 sa</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl describe statefulset -n rbac</span></span>
<span class="line"><span style="color:#DBD7CA;">Name:               web</span></span>
<span class="line"><span style="color:#DBD7CA;">\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7</span></span>
<span class="line"><span style="color:#DBD7CA;">Pod Template:</span></span>
<span class="line"><span style="color:#DBD7CA;">  Labels:           app=nginx</span></span>
<span class="line"><span style="color:#DBD7CA;">  Service Account:  nginx-sa</span></span>
<span class="line"><span style="color:#DBD7CA;">\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u521B\u5EFA\u6240\u6709\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 sa</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl apply -f ./</span></span>
<span class="line"><span style="color:#393A34;">role.rbac.authorization.k8s.io/pod-reader created</span></span>
<span class="line"><span style="color:#393A34;">rolebinding.rbac.authorization.k8s.io/read-pods created</span></span>
<span class="line"><span style="color:#393A34;">serviceaccount/nginx-sa created</span></span>
<span class="line"><span style="color:#393A34;">statefulset.apps/web created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u67E5\u770Bsa\u8D26\u53F7</span></span>
<span class="line"><span style="color:#A0ADA0;">#sa\u8D26\u53F7\u4F1A\u751F\u6210\u4E00\u4E2Atoken\uFF0C\u8FD9\u4E2Atoken\u4E2D\u4FDD\u5B58\u8FD9\u6839\u8BC1\u4E66ca\u4EE5\u53CAsa\u7528\u6237\u7684\u8BC1\u4E66kube	</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">:q</span></span>
<span class="line"><span style="color:#393A34;">\uFF0C\u7528\u4E8E\u8FDE\u63A5\u5230k8s\u96C6\u7FA4</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 sa</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get sa -n rbac</span></span>
<span class="line"><span style="color:#393A34;">NAME       SECRETS   AGE</span></span>
<span class="line"><span style="color:#393A34;">default    1         4m48s</span></span>
<span class="line"><span style="color:#393A34;">nginx-sa   1         103s</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 sa</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get secret -n rbac</span></span>
<span class="line"><span style="color:#393A34;">NAME                   TYPE                                  DATA   AGE</span></span>
<span class="line"><span style="color:#393A34;">default-token-4fkpj    kubernetes.io/service-account-token   3      5m14s</span></span>
<span class="line"><span style="color:#393A34;">nginx-sa-token-vcrmv   kubernetes.io/service-account-token   3      2m9s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u67E5\u770Bnginx\u8D44\u6E90\u4E2D\u662F\u5426\u5173\u8054sa</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 sa</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl describe statefulset -n rbac</span></span>
<span class="line"><span style="color:#393A34;">Name:               web</span></span>
<span class="line"><span style="color:#393A34;">\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7</span></span>
<span class="line"><span style="color:#393A34;">Pod Template:</span></span>
<span class="line"><span style="color:#393A34;">  Labels:           app=nginx</span></span>
<span class="line"><span style="color:#393A34;">  Service Account:  nginx-sa</span></span>
<span class="line"><span style="color:#393A34;">\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7\xB7</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u6587\u7AE0\u6765\u6E90\u4E8E\uFF1A<a href="https://blog.51cto.com/jiangxl/5076630" target="_blank" rel="noopener noreferrer">https://blog.51cto.com/jiangxl/5076630</a></p><p>\u4EC5\u505A\u4E2A\u4EBA\u5907\u4EFD\u5B66\u4E60\u4F7F\u7528.</p></blockquote>`,71),e=[o];function c(t,r,y,i,A,D){return n(),a("div",null,e)}var C=s(p,[["render",c]]);export{B as __pageData,C as default};
