import{_ as s,o as a,c as n,a as o}from"./app.1e6146c3.js";const B=JSON.parse('{"title":"Filebeat Basic","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u7B80\u4ECB","slug":"\u7B80\u4ECB"},{"level":2,"title":"\u914D\u7F6E\u6587\u4EF6","slug":"\u914D\u7F6E\u6587\u4EF6"},{"level":2,"title":"\u7B80\u5355\u4F7F\u7528 - \u6536\u96C6\u65E5\u5FD7\u5230\u672C\u5730","slug":"\u7B80\u5355\u4F7F\u7528-\u6536\u96C6\u65E5\u5FD7\u5230\u672C\u5730"},{"level":2,"title":"\u6536\u96C6\u5230 ES\uFF08\u901A\u8FC7Logstash\uFF09","slug":"\u6536\u96C6\u5230-es\uFF08\u901A\u8FC7logstash\uFF09"},{"level":2,"title":"\u8F93\u51FA\u5230 Redis","slug":"\u8F93\u51FA\u5230-redis"},{"level":2,"title":"\u53C2\u8003\u94FE\u63A5","slug":"\u53C2\u8003\u94FE\u63A5"}],"relativePath":"CloudNative/ELFK/Filebeat basic.md","lastUpdated":1657272051000}'),l={name:"CloudNative/ELFK/Filebeat basic.md"},p=o(`<h1 id="filebeat-basic" tabindex="-1">Filebeat Basic <a class="header-anchor" href="#filebeat-basic" aria-hidden="true">#</a></h1><h2 id="\u7B80\u4ECB" tabindex="-1">\u7B80\u4ECB <a class="header-anchor" href="#\u7B80\u4ECB" aria-hidden="true">#</a></h2><p>Filebeat\u9644\u5E26\u9884\u6784\u5EFA\u7684\u6A21\u5757\uFF0C\u8FD9\u4E9B\u6A21\u5757\u5305\u542B\u6536\u96C6\u3001\u89E3\u6790\u3001\u5145\u5B9E\u548C\u53EF\u89C6\u5316\u5404\u79CD\u65E5\u5FD7\u6587\u4EF6\u683C\u5F0F\u6570\u636E\u6240\u9700\u7684\u914D\u7F6E\uFF0C\u6BCF\u4E2AFilebeat\u6A21\u5757\u7531\u4E00\u4E2A\u6216\u591A\u4E2A\u6587\u4EF6\u96C6\u7EC4\u6210\uFF0C\u8FD9\u4E9B\u6587\u4EF6\u96C6\u5305\u542B\u6444\u53D6\u8282\u70B9\u7BA1\u9053\u3001Elasticsearch\u6A21\u677F\u3001Filebeat\u52D8\u63A2\u8005\u914D\u7F6E\u548CKibana\u4EEA\u8868\u76D8\u3002</p><p>Filebeat\u6A21\u5757\u5F88\u597D\u7684\u5165\u95E8\uFF0C\u5B83\u662F\u8F7B\u91CF\u7EA7\u5355\u7528\u9014\u7684\u65E5\u5FD7\u6536\u96C6\u5DE5\u5177\uFF0C\u7528\u4E8E\u5728\u6CA1\u6709\u5B89\u88C5java\u7684\u670D\u52A1\u5668\u4E0A\u4E13\u95E8\u6536\u96C6\u65E5\u5FD7\uFF0C\u53EF\u4EE5\u5C06\u65E5\u5FD7\u8F6C\u53D1\u5230<code>logstash</code>\u3001<code>elasticsearch</code>\u6216<code>redis</code>\u7B49\u573A\u666F\u4E2D\u8FDB\u884C\u4E0B\u4E00\u6B65\u5904\u7406\u3002</p><blockquote><p>\u6765\u81EA\u5B98\u65B9\u7B80\u4ECB\u7FFB\u8BD1\u3002\u3002\u3002</p></blockquote><p><code>Filebeat</code>\u548C<code>Logstash</code>\u76F8\u6BD4\uFF0C\u524D\u8005\u5360\u7528\u5185\u5B58\u76F8\u5BF9\u8F83\u5C11\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">cat /proc/</span><span style="color:#C98A7D;">\`ps -ef </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;">  grep -v grep </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;">   grep logstash  </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;"> awk &#39;{print $2}&#39;\`</span><span style="color:#DBD7CA;">/status </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> grep -i vm</span></span>
<span class="line"><span style="color:#DBD7CA;">cat /proc/</span><span style="color:#C98A7D;">\`ps -ef </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;">  grep -v grep </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;">   grep filebeat  </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;"> awk &#39;{print $2}&#39;\`</span><span style="color:#DBD7CA;">/status </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> grep -i vm</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">cat /proc/</span><span style="color:#B56959;">\`ps -ef </span><span style="color:#AB5959;">|</span><span style="color:#B56959;">  grep -v grep </span><span style="color:#AB5959;">|</span><span style="color:#B56959;">   grep logstash  </span><span style="color:#AB5959;">|</span><span style="color:#B56959;"> awk &#39;{print $2}&#39;\`</span><span style="color:#393A34;">/status </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> grep -i vm</span></span>
<span class="line"><span style="color:#393A34;">cat /proc/</span><span style="color:#B56959;">\`ps -ef </span><span style="color:#AB5959;">|</span><span style="color:#B56959;">  grep -v grep </span><span style="color:#AB5959;">|</span><span style="color:#B56959;">   grep filebeat  </span><span style="color:#AB5959;">|</span><span style="color:#B56959;"> awk &#39;{print $2}&#39;\`</span><span style="color:#393A34;">/status </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> grep -i vm</span></span>
<span class="line"></span></code></pre></div><h2 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1">\u914D\u7F6E\u6587\u4EF6 <a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a></h2><p><code>filebeat</code>\u7684\u914D\u7F6E\u6587\u4EF6\u662F<code>filebeat.yml</code>, \u76EE\u5F55\u4E2D\u9644\u5E26\u6709\u5176\u793A\u4F8B\u914D\u7F6E\u6587\u4EF6<code>filebeat.yml</code></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">filebeat.inputs</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">log</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">enabled</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">paths</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/var/log/*.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#----------------------------- Elasticsearch:output(\u53EF\u9009) --------------------------------</span></span>
<span class="line"><span style="color:#429988;">output.logstash</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;127.0.0.1:5044&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#429988;">output.elasticsearch</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;myEShost:9200&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#758575;">#----------------------------- Logstash output(\u53EF\u9009) --------------------------------</span></span>
<span class="line"><span style="color:#429988;">output.logstash</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;127.0.0.1:5044&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#758575;">#----------\u5982\u679CKibana Elasticsearch\u5728\u540C\u4E00\u4E3B\u673A\u4E0A\u8FD0\u884C(\u53EF\u9009)----------</span></span>
<span class="line"><span style="color:#429988;">setup.kibana</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">host</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;mykibanahost:5601&quot;</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#758575;">#----------------------------- Kafka output(\u53EF\u9009) --------------------------------</span></span>
<span class="line"><span style="color:#429988;">output.kafka</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">  </span><span style="color:#758575;"># initial brokers for reading cluster metadata</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;kafka1:9092&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;kafka2:9092&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;kafka3:9092&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">  </span><span style="color:#758575;"># message topic selection + partitioning</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">topic</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;%{[fields.log_topic]}&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">partition.round_robin</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">reachable_only</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">required_acks</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">1</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">compression</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">gzip</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">max_message_bytes</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">1000000</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">filebeat.inputs</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">log</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">enabled</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">true</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">paths</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/var/log/*.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#----------------------------- Elasticsearch:output(\u53EF\u9009) --------------------------------</span></span>
<span class="line"><span style="color:#2F8A89;">output.logstash</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;127.0.0.1:5044&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#2F8A89;">output.elasticsearch</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;myEShost:9200&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#A0ADA0;">#----------------------------- Logstash output(\u53EF\u9009) --------------------------------</span></span>
<span class="line"><span style="color:#2F8A89;">output.logstash</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;127.0.0.1:5044&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#A0ADA0;">#----------\u5982\u679CKibana Elasticsearch\u5728\u540C\u4E00\u4E3B\u673A\u4E0A\u8FD0\u884C(\u53EF\u9009)----------</span></span>
<span class="line"><span style="color:#2F8A89;">setup.kibana</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">host</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;mykibanahost:5601&quot;</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#A0ADA0;">#----------------------------- Kafka output(\u53EF\u9009) --------------------------------</span></span>
<span class="line"><span style="color:#2F8A89;">output.kafka</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">  </span><span style="color:#A0ADA0;"># initial brokers for reading cluster metadata</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;kafka1:9092&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;kafka2:9092&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;kafka3:9092&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">  </span><span style="color:#A0ADA0;"># message topic selection + partitioning</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">topic</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;%{[fields.log_topic]}&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">partition.round_robin</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">reachable_only</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">required_acks</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">1</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">compression</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">gzip</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">max_message_bytes</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">1000000</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u914D\u7F6E\u6587\u4EF6\u6709\u5982\u4E0B\u914D\u7F6E\u6BB5\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@agou filebeat-7.7.1-linux-x86_64</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> egrep </span><span style="color:#C98A7D;">&quot;^#==&quot;</span><span style="color:#DBD7CA;"> filebeat.yml</span></span>
<span class="line"><span style="color:#758575;">#=========================== Filebeat inputs =============================</span></span>
<span class="line"><span style="color:#758575;">#============================= Filebeat modules ===============================</span></span>
<span class="line"><span style="color:#758575;">#==================== Elasticsearch template setting ==========================</span></span>
<span class="line"><span style="color:#758575;">#================================ General =====================================</span></span>
<span class="line"><span style="color:#758575;">#============================== Dashboards =====================================</span></span>
<span class="line"><span style="color:#758575;">#============================== Kibana =====================================</span></span>
<span class="line"><span style="color:#758575;">#============================= Elastic Cloud ==================================</span></span>
<span class="line"><span style="color:#758575;">#================================ Outputs =====================================</span></span>
<span class="line"><span style="color:#758575;">#================================ Processors =====================================</span></span>
<span class="line"><span style="color:#758575;">#================================ Logging =====================================</span></span>
<span class="line"><span style="color:#758575;">#============================== X-Pack Monitoring ===============================</span></span>
<span class="line"><span style="color:#758575;">#================================= Migration ==================================</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@agou filebeat-7.7.1-linux-x86_64</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> egrep </span><span style="color:#B56959;">&quot;^#==&quot;</span><span style="color:#393A34;"> filebeat.yml</span></span>
<span class="line"><span style="color:#A0ADA0;">#=========================== Filebeat inputs =============================</span></span>
<span class="line"><span style="color:#A0ADA0;">#============================= Filebeat modules ===============================</span></span>
<span class="line"><span style="color:#A0ADA0;">#==================== Elasticsearch template setting ==========================</span></span>
<span class="line"><span style="color:#A0ADA0;">#================================ General =====================================</span></span>
<span class="line"><span style="color:#A0ADA0;">#============================== Dashboards =====================================</span></span>
<span class="line"><span style="color:#A0ADA0;">#============================== Kibana =====================================</span></span>
<span class="line"><span style="color:#A0ADA0;">#============================= Elastic Cloud ==================================</span></span>
<span class="line"><span style="color:#A0ADA0;">#================================ Outputs =====================================</span></span>
<span class="line"><span style="color:#A0ADA0;">#================================ Processors =====================================</span></span>
<span class="line"><span style="color:#A0ADA0;">#================================ Logging =====================================</span></span>
<span class="line"><span style="color:#A0ADA0;">#============================== X-Pack Monitoring ===============================</span></span>
<span class="line"><span style="color:#A0ADA0;">#================================= Migration ==================================</span></span>
<span class="line"></span></code></pre></div><h2 id="\u7B80\u5355\u4F7F\u7528-\u6536\u96C6\u65E5\u5FD7\u5230\u672C\u5730" tabindex="-1">\u7B80\u5355\u4F7F\u7528 - \u6536\u96C6\u65E5\u5FD7\u5230\u672C\u5730 <a class="header-anchor" href="#\u7B80\u5355\u4F7F\u7528-\u6536\u96C6\u65E5\u5FD7\u5230\u672C\u5730" aria-hidden="true">#</a></h2><p>\u6536\u96C6<code>nginx</code>\u65E5\u5FD7\u5230\u672C\u5730\uFF1A</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># vim /usr/local/filebeat-7.7.1-linux-x86_64/filebeat.yml</span></span>
<span class="line"><span style="color:#429988;">filebeat.inputs</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">log</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">paths</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/var/log/nginx/access.log</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/var/log/yum.log</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">log</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">paths</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/var/log/message</span></span>
<span class="line"></span>
<span class="line"><span style="color:#429988;">output.file</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">enabled</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">true</span><span style="color:#DBD7CA;">		</span><span style="color:#758575;"># default: true</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;/tmp/filebeat&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">filename</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">filebeat.txt</span></span>
<span class="line"><span style="color:#DBD7CA;">  #</span><span style="color:#429988;">rotate_every_kb</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">10000</span><span style="color:#DBD7CA;">		</span><span style="color:#758575;"># \u65E5\u5FD7\u5206\u5272\u5927\u5C0F</span></span>
<span class="line"><span style="color:#DBD7CA;">  #</span><span style="color:#429988;">number_of_files</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">7</span><span style="color:#DBD7CA;">		</span><span style="color:#758575;"># \u6587\u4EF6\u4FDD\u5B58\u8DEF\u5F84\u4E0B\u7684\u6700\u5927\u6570\u91CF\uFF0C\u5F53\u6587\u4EF6\u6570\u76EE\u8D85\u51FA\u8BE5\u503C\u65F6\uFF0C\u6700\u65E7\u7684\u6587\u4EF6\u5C06\u4F1A\u88AB\u5220\u9664\uFF0C\u8BE5\u503C\u5E94\u8BE5\u4ECB\u4E8E2-1024\u4E4B\u95F4\uFF0C\u9ED8\u8BA4\u4E3A7</span></span>
<span class="line"><span style="color:#DBD7CA;">  #</span><span style="color:#429988;">permissions</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">0600</span><span style="color:#DBD7CA;">		</span><span style="color:#758575;"># \u6587\u4EF6\u6743\u9650</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># vim /usr/local/filebeat-7.7.1-linux-x86_64/filebeat.yml</span></span>
<span class="line"><span style="color:#2F8A89;">filebeat.inputs</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">log</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">paths</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/var/log/nginx/access.log</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/var/log/yum.log</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">log</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">paths</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/var/log/message</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2F8A89;">output.file</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">enabled</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">true</span><span style="color:#393A34;">		</span><span style="color:#A0ADA0;"># default: true</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;/tmp/filebeat&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">filename</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">filebeat.txt</span></span>
<span class="line"><span style="color:#393A34;">  #</span><span style="color:#2F8A89;">rotate_every_kb</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">10000</span><span style="color:#393A34;">		</span><span style="color:#A0ADA0;"># \u65E5\u5FD7\u5206\u5272\u5927\u5C0F</span></span>
<span class="line"><span style="color:#393A34;">  #</span><span style="color:#2F8A89;">number_of_files</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">7</span><span style="color:#393A34;">		</span><span style="color:#A0ADA0;"># \u6587\u4EF6\u4FDD\u5B58\u8DEF\u5F84\u4E0B\u7684\u6700\u5927\u6570\u91CF\uFF0C\u5F53\u6587\u4EF6\u6570\u76EE\u8D85\u51FA\u8BE5\u503C\u65F6\uFF0C\u6700\u65E7\u7684\u6587\u4EF6\u5C06\u4F1A\u88AB\u5220\u9664\uFF0C\u8BE5\u503C\u5E94\u8BE5\u4ECB\u4E8E2-1024\u4E4B\u95F4\uFF0C\u9ED8\u8BA4\u4E3A7</span></span>
<span class="line"><span style="color:#393A34;">  #</span><span style="color:#2F8A89;">permissions</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">0600</span><span style="color:#393A34;">		</span><span style="color:#A0ADA0;"># \u6587\u4EF6\u6743\u9650</span></span>
<span class="line"></span></code></pre></div><p>\u67E5\u770B\u751F\u6210\u7684\u672C\u5730\u6587\u4EF6\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@agou tmp</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> cat filebeat/filebeat.txt </span></span>
<span class="line"><span style="color:#DBD7CA;">{</span><span style="color:#C98A7D;">&quot;@timestamp&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;2020-07-10T23:47:33.886Z&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;@metadata&quot;</span><span style="color:#DBD7CA;">:{</span><span style="color:#C98A7D;">&quot;beat&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;filebeat&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;type&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;_doc&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;version&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;7.7.1&quot;</span><span style="color:#DBD7CA;">},</span><span style="color:#C98A7D;">&quot;log&quot;</span><span style="color:#DBD7CA;">:{</span><span style="color:#C98A7D;">&quot;file&quot;</span><span style="color:#DBD7CA;">:{</span><span style="color:#C98A7D;">&quot;path&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;/var/log/n</span></span>
<span class="line"><span style="color:#C98A7D;">ginx/access.log&quot;</span><span style="color:#DBD7CA;">},</span><span style="color:#C98A7D;">&quot;offset&quot;</span><span style="color:#DBD7CA;">:1360},</span><span style="color:#C98A7D;">&quot;message&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;::1 - - [11/Jul/2020:07:47:24 +0800] </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">GET / HTTP/1.1</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;"> 200 4833 </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">-</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;"> </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">curl/7.29.0</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;"> </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">-</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#C98A7D;">&quot;input&quot;</span><span style="color:#DBD7CA;">:{</span><span style="color:#C98A7D;">&quot;type&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;log&quot;</span><span style="color:#DBD7CA;">},</span><span style="color:#C98A7D;">&quot;ecs&quot;</span><span style="color:#DBD7CA;">:{</span><span style="color:#C98A7D;">&quot;version&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;1.5.0&quot;</span><span style="color:#DBD7CA;">},</span><span style="color:#C98A7D;">&quot;host&quot;</span><span style="color:#DBD7CA;">:{</span><span style="color:#C98A7D;">&quot;containerized&quot;</span><span style="color:#DBD7CA;">:false,</span><span style="color:#C98A7D;">&quot;ip&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;172.16.1.131&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;fe80::20c:29ff:fe01:b93c&quot;</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;mac&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;00</span></span>
<span class="line"><span style="color:#C98A7D;">:0c:29:01:b9:3c&quot;</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;hostname&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;agou&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;architecture&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;x86_64&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;os&quot;</span><span style="color:#DBD7CA;">:{</span><span style="color:#C98A7D;">&quot;version&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;7 (Core)&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;family&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;redhat&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;name&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;CentOS Linux&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;kernel&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;3</span></span>
<span class="line"><span style="color:#C98A7D;">.10.0-1127.13.1.el7.x86_64&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;codename&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;Core&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;platform&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;centos&quot;</span><span style="color:#DBD7CA;">},</span><span style="color:#C98A7D;">&quot;name&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;agou&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;id&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;84a3254a0df34b59a4d62c5a4f90cb09&quot;</span><span style="color:#DBD7CA;">},</span><span style="color:#C98A7D;">&quot;agent&quot;</span><span style="color:#DBD7CA;">:{</span><span style="color:#C98A7D;">&quot;type&quot;</span><span style="color:#DBD7CA;">:</span></span>
<span class="line"><span style="color:#C98A7D;">&quot;filebeat&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;ephemeral_id&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;d34e6811-1dc0-4597-ac02-8b1fb98c79ba&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;hostname&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;agou&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;id&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;315c67f4-2edd-46f1-8c77-1895cbe383ff&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;version&quot;</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">&quot;</span></span>
<span class="line"><span style="color:#C98A7D;">7.7.1&quot;</span><span style="color:#DBD7CA;">}}</span></span>
<span class="line"><span style="color:#DBD7CA;">...</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@agou tmp</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> cat filebeat/filebeat.txt </span></span>
<span class="line"><span style="color:#393A34;">{</span><span style="color:#B56959;">&quot;@timestamp&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;2020-07-10T23:47:33.886Z&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;@metadata&quot;</span><span style="color:#393A34;">:{</span><span style="color:#B56959;">&quot;beat&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;filebeat&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;type&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;_doc&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;version&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;7.7.1&quot;</span><span style="color:#393A34;">},</span><span style="color:#B56959;">&quot;log&quot;</span><span style="color:#393A34;">:{</span><span style="color:#B56959;">&quot;file&quot;</span><span style="color:#393A34;">:{</span><span style="color:#B56959;">&quot;path&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;/var/log/n</span></span>
<span class="line"><span style="color:#B56959;">ginx/access.log&quot;</span><span style="color:#393A34;">},</span><span style="color:#B56959;">&quot;offset&quot;</span><span style="color:#393A34;">:1360},</span><span style="color:#B56959;">&quot;message&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;::1 - - [11/Jul/2020:07:47:24 +0800] </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">GET / HTTP/1.1</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;"> 200 4833 </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">-</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;"> </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">curl/7.29.0</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;"> </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">-</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#B56959;">&quot;input&quot;</span><span style="color:#393A34;">:{</span><span style="color:#B56959;">&quot;type&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;log&quot;</span><span style="color:#393A34;">},</span><span style="color:#B56959;">&quot;ecs&quot;</span><span style="color:#393A34;">:{</span><span style="color:#B56959;">&quot;version&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;1.5.0&quot;</span><span style="color:#393A34;">},</span><span style="color:#B56959;">&quot;host&quot;</span><span style="color:#393A34;">:{</span><span style="color:#B56959;">&quot;containerized&quot;</span><span style="color:#393A34;">:false,</span><span style="color:#B56959;">&quot;ip&quot;</span><span style="color:#393A34;">:</span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;172.16.1.131&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;fe80::20c:29ff:fe01:b93c&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;mac&quot;</span><span style="color:#393A34;">:</span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;00</span></span>
<span class="line"><span style="color:#B56959;">:0c:29:01:b9:3c&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;hostname&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;agou&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;architecture&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;x86_64&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;os&quot;</span><span style="color:#393A34;">:{</span><span style="color:#B56959;">&quot;version&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;7 (Core)&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;family&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;redhat&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;name&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;CentOS Linux&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;kernel&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;3</span></span>
<span class="line"><span style="color:#B56959;">.10.0-1127.13.1.el7.x86_64&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;codename&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;Core&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;platform&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;centos&quot;</span><span style="color:#393A34;">},</span><span style="color:#B56959;">&quot;name&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;agou&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;id&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;84a3254a0df34b59a4d62c5a4f90cb09&quot;</span><span style="color:#393A34;">},</span><span style="color:#B56959;">&quot;agent&quot;</span><span style="color:#393A34;">:{</span><span style="color:#B56959;">&quot;type&quot;</span><span style="color:#393A34;">:</span></span>
<span class="line"><span style="color:#B56959;">&quot;filebeat&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;ephemeral_id&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;d34e6811-1dc0-4597-ac02-8b1fb98c79ba&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;hostname&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;agou&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;id&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;315c67f4-2edd-46f1-8c77-1895cbe383ff&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;version&quot;</span><span style="color:#393A34;">:</span><span style="color:#B56959;">&quot;</span></span>
<span class="line"><span style="color:#B56959;">7.7.1&quot;</span><span style="color:#393A34;">}}</span></span>
<span class="line"><span style="color:#393A34;">...</span></span>
<span class="line"></span></code></pre></div><h2 id="\u6536\u96C6\u5230-es\uFF08\u901A\u8FC7logstash\uFF09" tabindex="-1">\u6536\u96C6\u5230 ES\uFF08\u901A\u8FC7Logstash\uFF09 <a class="header-anchor" href="#\u6536\u96C6\u5230-es\uFF08\u901A\u8FC7logstash\uFF09" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># vim /usr/local/filebeat-7.7.1-linux-x86_64/filebeat.yml</span></span>
<span class="line"><span style="color:#DBD7CA;">filebeat.inputs:</span></span>
<span class="line"><span style="color:#DBD7CA;">- type: log</span></span>
<span class="line"><span style="color:#DBD7CA;">  paths:</span></span>
<span class="line"><span style="color:#DBD7CA;">    - /var/log/nginx/access.log</span></span>
<span class="line"><span style="color:#DBD7CA;">    - /var/log/yum.log</span></span>
<span class="line"><span style="color:#DBD7CA;">- type: log</span></span>
<span class="line"><span style="color:#DBD7CA;">  paths:</span></span>
<span class="line"><span style="color:#DBD7CA;">    - /var/log/message</span></span>
<span class="line"><span style="color:#758575;">#----------------------------- Logstash output --------------------------------</span></span>
<span class="line"><span style="color:#DBD7CA;">output.logstash:</span></span>
<span class="line"><span style="color:#858585;">  </span><span style="color:#758575;"># The Logstash hosts</span></span>
<span class="line"><span style="color:#DBD7CA;">  hosts: </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;172.16.1.131:5044&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># vim /usr/local/filebeat-7.7.1-linux-x86_64/filebeat.yml</span></span>
<span class="line"><span style="color:#393A34;">filebeat.inputs:</span></span>
<span class="line"><span style="color:#393A34;">- type: log</span></span>
<span class="line"><span style="color:#393A34;">  paths:</span></span>
<span class="line"><span style="color:#393A34;">    - /var/log/nginx/access.log</span></span>
<span class="line"><span style="color:#393A34;">    - /var/log/yum.log</span></span>
<span class="line"><span style="color:#393A34;">- type: log</span></span>
<span class="line"><span style="color:#393A34;">  paths:</span></span>
<span class="line"><span style="color:#393A34;">    - /var/log/message</span></span>
<span class="line"><span style="color:#A0ADA0;">#----------------------------- Logstash output --------------------------------</span></span>
<span class="line"><span style="color:#393A34;">output.logstash:</span></span>
<span class="line"><span style="color:#8E8F8B;">  </span><span style="color:#A0ADA0;"># The Logstash hosts</span></span>
<span class="line"><span style="color:#393A34;">  hosts: </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;172.16.1.131:5044&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"></span></code></pre></div><p>\u914D\u7F6E <code>Logstash</code> \u5230 <code>ES</code></p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># vim beat2es.conf </span></span>
<span class="line"><span style="color:#DBD7CA;">input </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">  beats </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">    port =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> 5044</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">}</span></span>
<span class="line"><span style="color:#858585;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">output </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">  elasticsearch </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">    hosts =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;http://172.16.1.131:9200&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">    index =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">}</span></span>
<span class="line"><span style="color:#858585;">}</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># vim beat2es.conf </span></span>
<span class="line"><span style="color:#393A34;">input </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">  beats </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">    port =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> 5044</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">}</span></span>
<span class="line"><span style="color:#8E8F8B;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">output </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">  elasticsearch </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">    hosts =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;http://172.16.1.131:9200&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">    index =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">}</span></span>
<span class="line"><span style="color:#8E8F8B;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4EE5\u6B64\u542F\u52A8<code>ES</code>\u3001<code>Logstash</code>\u4EE5\u53CA<code>filebeat</code>\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">bin/elasticsearch -d</span></span>
<span class="line"><span style="color:#DBD7CA;">bin/logstash -f conf/beat2es.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">./filebeat</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">bin/elasticsearch -d</span></span>
<span class="line"><span style="color:#393A34;">bin/logstash -f conf/beat2es.conf</span></span>
<span class="line"><span style="color:#393A34;">./filebeat</span></span>
<span class="line"></span></code></pre></div><p>\u6253\u5F00\u6D4F\u89C8\u5668\u7684<code>ES</code>\u63D2\u4EF6\uFF0C\u7136\u540E\u8FDE\u63A5\u4E0A\u4E3B\u673A\u7684<code>ES</code>\uFF0C\u70B9\u51FB<code>Browser</code>\u8FDB\u884C\u67E5\u770B\uFF1A</p><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/blog-images/elk%20stack/filbeat-1.png" alt="" title="\u622A\u56FE"></p><h2 id="\u8F93\u51FA\u5230-redis" tabindex="-1">\u8F93\u51FA\u5230 Redis <a class="header-anchor" href="#\u8F93\u51FA\u5230-redis" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># vim /usr/local/filebeat-7.7.1-linux-x86_64/filebeat.yml</span></span>
<span class="line"><span style="color:#DBD7CA;">filebeat.inputs:</span></span>
<span class="line"><span style="color:#DBD7CA;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">output.redis:</span></span>
<span class="line"><span style="color:#DBD7CA;">  hosts: </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;localhost&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">  password: </span><span style="color:#C98A7D;">&quot;my_password&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  key: </span><span style="color:#C98A7D;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  db: 0</span></span>
<span class="line"><span style="color:#DBD7CA;">  timeout: 5</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#output.file:</span></span>
<span class="line"><span style="color:#758575;">#  enabled: true		# default: true</span></span>
<span class="line"><span style="color:#758575;">#  path: &quot;/tmp/filebeat&quot;</span></span>
<span class="line"><span style="color:#758575;">#  filename: filebeat.txt</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># vim /usr/local/filebeat-7.7.1-linux-x86_64/filebeat.yml</span></span>
<span class="line"><span style="color:#393A34;">filebeat.inputs:</span></span>
<span class="line"><span style="color:#393A34;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">output.redis:</span></span>
<span class="line"><span style="color:#393A34;">  hosts: </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;localhost&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">  password: </span><span style="color:#B56959;">&quot;my_password&quot;</span></span>
<span class="line"><span style="color:#393A34;">  key: </span><span style="color:#B56959;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#393A34;">  db: 0</span></span>
<span class="line"><span style="color:#393A34;">  timeout: 5</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#output.file:</span></span>
<span class="line"><span style="color:#A0ADA0;">#  enabled: true		# default: true</span></span>
<span class="line"><span style="color:#A0ADA0;">#  path: &quot;/tmp/filebeat&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;">#  filename: filebeat.txt</span></span>
<span class="line"></span></code></pre></div><p>\u767B\u5F55<code>Redis</code>\u4E3B\u673A\u67E5\u770B\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">127.0.0.1:</span><span style="color:#CB7676;">6379&gt;</span><span style="color:#DBD7CA;"> KEYS </span><span style="color:#CB7676;">*</span></span>
<span class="line"><span style="color:#DBD7CA;">1) </span><span style="color:#C98A7D;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#758575;"># \u67E5\u770B\u4E00\u6761\u6570\u636E</span></span>
<span class="line"><span style="color:#DBD7CA;">127.0.0.1:</span><span style="color:#CB7676;">6379&gt;</span><span style="color:#DBD7CA;"> LPOP filebeat</span></span>
<span class="line"><span style="color:#C98A7D;">&quot;{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">@timestamp</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">2020-07-11T21:40:42.939Z</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">@metadata</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">beat</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">filebeat</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">type</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">_doc</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">version</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">7.7.1</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">input</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">t</span></span>
<span class="line"><span style="color:#C98A7D;">ype</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">log</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">ecs</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">version</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">1.5.0</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">host</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">containerized</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:false,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">ip</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:[</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">172.16.1.131</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">fe80::20c:29ff:fe01:b93c</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">],</span><span style="color:#D4976C;">\\&quot;</span></span>
<span class="line"><span style="color:#C98A7D;">mac</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:[</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">00:0c:29:01:b9:3c</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">],</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">name</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">agou</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">hostname</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">agou</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">architecture</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">x86_64</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">os</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">platform</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">centos</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">versio</span></span>
<span class="line"><span style="color:#C98A7D;">n</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">7 (Core)</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">family</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">redhat</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">name</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">CentOS Linux</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">kernel</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">3.10.0-1127.13.1.el7.x86_64</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">codename</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">Core</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">id</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span></span>
<span class="line"><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">84a3254a0df34b59a4d62c5a4f90cb09</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">agent</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">type</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">filebeat</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">ephemeral_id</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">63731e5e-da81-4b88-a390-01e4ce8d66aa</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">hostnam</span></span>
<span class="line"><span style="color:#C98A7D;">e</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">agou</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">id</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">315c67f4-2edd-46f1-8c77-1895cbe383ff</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">version</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">7.7.1</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">},</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">log</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">offset</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:14932,</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">file</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:{</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">path</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">/var/lo</span></span>
<span class="line"><span style="color:#C98A7D;">g/yum.log</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">}},</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">message</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">:</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">Jul 12 05:37:08 Installed: jemalloc-3.6.0-1.el7.x86_64</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#C98A7D;">}&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">127.0.0.1:</span><span style="color:#AB5959;">6379&gt;</span><span style="color:#393A34;"> KEYS </span><span style="color:#AB5959;">*</span></span>
<span class="line"><span style="color:#393A34;">1) </span><span style="color:#B56959;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u67E5\u770B\u4E00\u6761\u6570\u636E</span></span>
<span class="line"><span style="color:#393A34;">127.0.0.1:</span><span style="color:#AB5959;">6379&gt;</span><span style="color:#393A34;"> LPOP filebeat</span></span>
<span class="line"><span style="color:#B56959;">&quot;{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">@timestamp</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">2020-07-11T21:40:42.939Z</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">@metadata</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">beat</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">filebeat</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">type</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">_doc</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">version</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">7.7.1</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">input</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">t</span></span>
<span class="line"><span style="color:#B56959;">ype</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">log</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">ecs</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">version</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">1.5.0</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">host</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">containerized</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:false,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">ip</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:[</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">172.16.1.131</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">fe80::20c:29ff:fe01:b93c</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">],</span><span style="color:#A65E2B;">\\&quot;</span></span>
<span class="line"><span style="color:#B56959;">mac</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:[</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">00:0c:29:01:b9:3c</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">],</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">name</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">agou</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">hostname</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">agou</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">architecture</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">x86_64</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">os</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">platform</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">centos</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">versio</span></span>
<span class="line"><span style="color:#B56959;">n</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">7 (Core)</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">family</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">redhat</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">name</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">CentOS Linux</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">kernel</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">3.10.0-1127.13.1.el7.x86_64</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">codename</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">Core</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">id</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span></span>
<span class="line"><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">84a3254a0df34b59a4d62c5a4f90cb09</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">agent</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">type</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">filebeat</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">ephemeral_id</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">63731e5e-da81-4b88-a390-01e4ce8d66aa</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">hostnam</span></span>
<span class="line"><span style="color:#B56959;">e</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">agou</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">id</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">315c67f4-2edd-46f1-8c77-1895cbe383ff</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">version</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">7.7.1</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">},</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">log</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">offset</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:14932,</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">file</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:{</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">path</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">/var/lo</span></span>
<span class="line"><span style="color:#B56959;">g/yum.log</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">}},</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">message</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">:</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">Jul 12 05:37:08 Installed: jemalloc-3.6.0-1.el7.x86_64</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#B56959;">}&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u4F7F\u7528 <code>Logstash</code>\u5C06<code>redis</code>\u4E2D\u6536\u5230\u7684\u6570\u636E\u8F93\u51FA\u5230<code>ES</code>\u4E2D\u53BB\uFF1A</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># vim config/redis2es.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">input </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">  redis </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">    host =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;localhost&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    port =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;6379&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    db =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    key =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    data_type =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;list&quot;</span></span>
<span class="line"><span style="color:#858585;">    </span><span style="color:#758575;"># password =&gt; &quot;zls&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    codec  =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;json&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;"> </span><span style="color:#858585;">}</span></span>
<span class="line"><span style="color:#858585;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">output </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">    elasticsearch </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">      hosts =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;172.16.1.131:9200&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">      index =</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;%{type}-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">}</span></span>
<span class="line"><span style="color:#858585;">}</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># vim config/redis2es.conf</span></span>
<span class="line"><span style="color:#393A34;">input </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">  redis </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">    host =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;localhost&quot;</span></span>
<span class="line"><span style="color:#393A34;">    port =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;6379&quot;</span></span>
<span class="line"><span style="color:#393A34;">    db =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#393A34;">    key =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;filebeat&quot;</span></span>
<span class="line"><span style="color:#393A34;">    data_type =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;list&quot;</span></span>
<span class="line"><span style="color:#8E8F8B;">    </span><span style="color:#A0ADA0;"># password =&gt; &quot;zls&quot;</span></span>
<span class="line"><span style="color:#393A34;">    codec  =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;json&quot;</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">}</span></span>
<span class="line"><span style="color:#8E8F8B;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">output </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">    elasticsearch </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">      hosts =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;172.16.1.131:9200&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">      index =</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;%{type}-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">}</span></span>
<span class="line"><span style="color:#8E8F8B;">}</span></span>
<span class="line"></span></code></pre></div><p>\u6700\u540E\u6253\u5F00\u6D4F\u89C8\u5668\u7684<code>ES</code>\u63D2\u4EF6\u8FDB\u884C\u67E5\u770B\uFF0C\u6B65\u9AA4\u540C\u4E0A\u6240\u793A\u3002</p><h2 id="\u53C2\u8003\u94FE\u63A5" tabindex="-1">\u53C2\u8003\u94FE\u63A5 <a class="header-anchor" href="#\u53C2\u8003\u94FE\u63A5" aria-hidden="true">#</a></h2><ul><li>Filebeat Documentation: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-getting-started.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-getting-started.html</a></li><li>filebeat-configuration: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-configuration.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-configuration.html</a></li><li>input: <a href="https://www.elastic.co/guide/en/beats/filebeat/7.7/configuring-input.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/beats/filebeat/7.7/configuring-input.html</a></li><li>output: <a href="https://www.elastic.co/guide/en/beats/filebeat/7.7/configuring-output.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/beats/filebeat/7.7/configuring-output.html</a></li><li>\u4F7F\u7528Filebeat\u6536\u96C6\u65E5\u5FD7: <a href="http://www.sunrisenan.com/docs/elkstack/elkstart11.html" target="_blank" rel="noopener noreferrer">http://www.sunrisenan.com/docs/elkstack/elkstart11.html</a></li><li><a href="https://www.elastic.co/guide/en/beats/filebeat/7.7/multiline-examples.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/beats/filebeat/7.7/multiline-examples.html</a></li></ul>`,34),t=[p];function e(c,r,y,A,u,D){return a(),n("div",null,t)}var q=s(l,[["render",e]]);export{B as __pageData,q as default};
