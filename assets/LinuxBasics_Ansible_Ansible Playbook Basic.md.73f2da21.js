import{_ as s,o as n,c as a,a as l}from"./app.1e6146c3.js";const C=JSON.parse('{"title":"Ansible Playbook \u57FA\u7840","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u57FA\u7840","slug":"\u57FA\u7840"},{"level":3,"title":"ansible-playbook \u5E38\u7528\u9009\u9879","slug":"ansible-playbook-\u5E38\u7528\u9009\u9879"},{"level":3,"title":"Host \u548C Users","slug":"host-\u548C-users"},{"level":3,"title":"tasks","slug":"tasks"},{"level":3,"title":"handlers","slug":"handlers"},{"level":3,"title":"\u8FD0\u884C\u4E00\u4E2A Playbook","slug":"\u8FD0\u884C\u4E00\u4E2A-playbook"},{"level":3,"title":"ansible-Pull","slug":"ansible-pull"},{"level":3,"title":"ansible-lint(\u8BED\u6CD5\u68C0\u67E5)","slug":"ansible-lint-\u8BED\u6CD5\u68C0\u67E5"},{"level":3,"title":"ansible-galaxy","slug":"ansible-galaxy"},{"level":2,"title":"\u8FDB\u9636","slug":"\u8FDB\u9636"},{"level":3,"title":"importtasks & includetasks","slug":"import-tasks-include-tasks"},{"level":3,"title":"Role","slug":"role"},{"level":3,"title":"variables","slug":"variables"},{"level":3,"title":"lineinfile","slug":"lineinfile"},{"level":3,"title":"replace","slug":"replace"},{"level":2,"title":"\u53C2\u8003\u94FE\u63A5","slug":"\u53C2\u8003\u94FE\u63A5"}],"relativePath":"LinuxBasics/Ansible/Ansible Playbook Basic.md","lastUpdated":1657272051000}'),p={name:"LinuxBasics/Ansible/Ansible Playbook Basic.md"},o=l(`<h1 id="ansible-playbook-\u57FA\u7840" tabindex="-1">Ansible Playbook \u57FA\u7840 <a class="header-anchor" href="#ansible-playbook-\u57FA\u7840" aria-hidden="true">#</a></h1><h2 id="\u57FA\u7840" tabindex="-1">\u57FA\u7840 <a class="header-anchor" href="#\u57FA\u7840" aria-hidden="true">#</a></h2><h3 id="ansible-playbook-\u5E38\u7528\u9009\u9879" tabindex="-1">ansible-playbook \u5E38\u7528\u9009\u9879 <a class="header-anchor" href="#ansible-playbook-\u5E38\u7528\u9009\u9879" aria-hidden="true">#</a></h3><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">--step: \u6309\u6B65\u9AA4\u6267\u884C\uFF0C\u6BCF\u4E00\u6B65\u90FD\u9700\u8981\u64CD\u4F5C\u5458\u786E\u8BA4</span></span>
<span class="line"><span style="color:#DBD7CA;">--check: \u68C0\u67E5playbook\u6B63\u786E\u6027\uFF0C\u5E76\u8FD0\u884C\u5E72\u8DD1\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#DBD7CA;">--syntax-check: \u4EC5\u68C0\u67E5\u8BED\u6CD5\u9519\u8BEF</span></span>
<span class="line"><span style="color:#DBD7CA;">--list-tasks</span></span>
<span class="line"><span style="color:#DBD7CA;">--list-tags</span></span>
<span class="line"><span style="color:#DBD7CA;">--list-hosts</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">--step: \u6309\u6B65\u9AA4\u6267\u884C\uFF0C\u6BCF\u4E00\u6B65\u90FD\u9700\u8981\u64CD\u4F5C\u5458\u786E\u8BA4</span></span>
<span class="line"><span style="color:#393A34;">--check: \u68C0\u67E5playbook\u6B63\u786E\u6027\uFF0C\u5E76\u8FD0\u884C\u5E72\u8DD1\u6A21\u5F0F</span></span>
<span class="line"><span style="color:#393A34;">--syntax-check: \u4EC5\u68C0\u67E5\u8BED\u6CD5\u9519\u8BEF</span></span>
<span class="line"><span style="color:#393A34;">--list-tasks</span></span>
<span class="line"><span style="color:#393A34;">--list-tags</span></span>
<span class="line"><span style="color:#393A34;">--list-hosts</span></span>
<span class="line"></span></code></pre></div><h3 id="host-\u548C-users" tabindex="-1">Host \u548C Users <a class="header-anchor" href="#host-\u548C-users" aria-hidden="true">#</a></h3><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">webservers</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">remote_user</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">yourname</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;"># \u5207\u6362\u7528\u6237</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">become</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">yes</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">become_user</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">postgres</span></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">webservers</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">remote_user</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">yourname</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;"># \u5168\u5C40\u9ED8\u8BA4\u7684\u7528\u6237</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">tasks</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">service</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">started</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">become</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">yes</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;"># \u5BF9\u67D0\u4E00\u4E2Atask\u5F00\u542F\u7528\u6237\u5207\u6362</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">become_method</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">sudo</span><span style="color:#DBD7CA;">		</span><span style="color:#758575;"># \u5207\u6362\u65B9\u6CD5\u4E3Asudo,\u6B64\u5916\u8FD8\u53EF\u4EE5\u4F7F\u7528su</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">webservers</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">remote_user</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">yourname</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;"># \u5207\u6362\u7528\u6237</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">become</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">yes</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">become_user</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">postgres</span></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">webservers</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">remote_user</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">yourname</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;"># \u5168\u5C40\u9ED8\u8BA4\u7684\u7528\u6237</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">tasks</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">service</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">started</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">become</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">yes</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;"># \u5BF9\u67D0\u4E00\u4E2Atask\u5F00\u542F\u7528\u6237\u5207\u6362</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">become_method</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">sudo</span><span style="color:#393A34;">		</span><span style="color:#A0ADA0;"># \u5207\u6362\u65B9\u6CD5\u4E3Asudo,\u6B64\u5916\u8FD8\u53EF\u4EE5\u4F7F\u7528su</span></span>
<span class="line"></span></code></pre></div><h3 id="tasks" tabindex="-1">tasks <a class="header-anchor" href="#tasks" aria-hidden="true">#</a></h3><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">tasks</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">\u8FD0\u884C\u4E00\u4E9B\u547D\u4EE4,\u5E76\u5FFD\u7565\u5176\u8F93\u51FA\u5185\u5BB9</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">shell</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/usr/bin/somecommand || /bin/true</span><span style="color:#DBD7CA;">      </span><span style="color:#758575;"># \u6216\u8005\u4F7F\u7528\`ignore_errors: true\`</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Copy ansible inventory file to client</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">copy</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">src=/etc/ansible/hosts dest=/etc/ansible/hosts</span><span style="color:#DBD7CA;">    </span><span style="color:#758575;"># \u4F7F\u7528\u7F29\u8FDB\u8FDB\u884C\u957F\u53E5\u6362\u884C</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#C98A7D;">owner=root group=root mode=0644</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">tasks</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">\u8FD0\u884C\u4E00\u4E9B\u547D\u4EE4,\u5E76\u5FFD\u7565\u5176\u8F93\u51FA\u5185\u5BB9</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">shell</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/usr/bin/somecommand || /bin/true</span><span style="color:#393A34;">      </span><span style="color:#A0ADA0;"># \u6216\u8005\u4F7F\u7528\`ignore_errors: true\`</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Copy ansible inventory file to client</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">copy</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">src=/etc/ansible/hosts dest=/etc/ansible/hosts</span><span style="color:#393A34;">    </span><span style="color:#A0ADA0;"># \u4F7F\u7528\u7F29\u8FDB\u8FDB\u884C\u957F\u53E5\u6362\u884C</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B56959;">owner=root group=root mode=0644</span></span>
<span class="line"></span></code></pre></div><h3 id="handlers" tabindex="-1">handlers <a class="header-anchor" href="#handlers" aria-hidden="true">#</a></h3><p>\u5F53\u914D\u7F6E\u6587\u4EF6\u6539\u53D8\u65F6,\u8C03\u7528handlers\u89E6\u53D1\u91CD\u542F</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">tasks</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">template configuration file</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">template</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">src</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">template.j2</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">dest</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/foo.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">notify</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restart memcached</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restart apache</span></span>
<span class="line"><span style="color:#429988;">handlers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restart memcached</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">service</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">memcached</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restarted</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restart apache</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">service</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">apache</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restarted</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">tasks</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">template configuration file</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">template</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">src</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">template.j2</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">dest</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/foo.conf</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">notify</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restart memcached</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restart apache</span></span>
<span class="line"><span style="color:#2F8A89;">handlers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restart memcached</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">service</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">memcached</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restarted</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restart apache</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">service</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">apache</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restarted</span></span>
<span class="line"></span></code></pre></div><p>\u5728ansible2.2\u4E4B\u540E,\u53EF\u4EE5\u4F7F\u7528<code>listen</code>\u521B\u5EFA&quot;\u4E3B\u9898&quot;,tasks\u4F1A\u901A\u77E5\u8FD9\u4E9B&quot;\u4E3B\u9898&quot;</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">handlers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restart memcached</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">service</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">memcached</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restarted</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">listen</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;restart web services&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restart apache</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">service</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">apache</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restarted</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">listen</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;restart web services&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#429988;">tasks</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">restart everything</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">command</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">echo &quot;this task will restart the web services&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">notify</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;restart web services&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">handlers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restart memcached</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">service</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">memcached</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restarted</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">listen</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;restart web services&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restart apache</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">service</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">apache</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restarted</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">listen</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;restart web services&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2F8A89;">tasks</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">restart everything</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">command</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">echo &quot;this task will restart the web services&quot;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">notify</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;restart web services&quot;</span></span>
<span class="line"></span></code></pre></div><h3 id="\u8FD0\u884C\u4E00\u4E2A-playbook" tabindex="-1">\u8FD0\u884C\u4E00\u4E2A Playbook <a class="header-anchor" href="#\u8FD0\u884C\u4E00\u4E2A-playbook" aria-hidden="true">#</a></h3><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">ansible-playbook [-C] playbook.yml [-f 10] [--list-hosts] [--verbose]</span></span>
<span class="line"><span style="color:#758575;"># -C \u8868\u793A\u5E72\u8DD1\u6D4B\u8BD5\u6A21\u5F0F,\u5B9E\u9645\u8FD0\u884C\u65F6\u5E94\u5F53\u53D6\u6D88, -f \u4E3A\u6279\u6B21</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">ansible-playbook [-C] playbook.yml [-f 10] [--list-hosts] [--verbose]</span></span>
<span class="line"><span style="color:#A0ADA0;"># -C \u8868\u793A\u5E72\u8DD1\u6D4B\u8BD5\u6A21\u5F0F,\u5B9E\u9645\u8FD0\u884C\u65F6\u5E94\u5F53\u53D6\u6D88, -f \u4E3A\u6279\u6B21</span></span>
<span class="line"></span></code></pre></div><h3 id="ansible-pull" tabindex="-1">ansible-Pull <a class="header-anchor" href="#ansible-pull" aria-hidden="true">#</a></h3><p>\u5BA2\u6237\u7AEF\u4E3B\u52A8\u62C9\u53D6</p><h3 id="ansible-lint-\u8BED\u6CD5\u68C0\u67E5" tabindex="-1">ansible-lint(\u8BED\u6CD5\u68C0\u67E5) <a class="header-anchor" href="#ansible-lint-\u8BED\u6CD5\u68C0\u67E5" aria-hidden="true">#</a></h3><p><code>playbook</code>\u8BED\u6CD5\u53CA\u89C4\u8303\u68C0\u67E5\u5DE5\u5177, \u9ED8\u8BA4\u5B89\u88C5\u65F6\u5E76\u4E3A\u5B89\u88C5, \u4F7F\u7528<code>yum install -y ansible-lint</code>\u8FDB\u884C\u5B89\u88C5\u5373\u53EF</p><p>\u4F7F\u7528\u65B9\u6CD5:</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">ansible-lint playbook.yaml</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">ansible-lint playbook.yaml</span></span>
<span class="line"></span></code></pre></div><p>\u5F53\u7136, \u4F60\u4E5F\u53EF\u4EE5\u4F7F\u7528<code>ansible-playbook</code>\u81EA\u5E26\u7684<code>ansible-playbook --syntax-check</code>\u6765\u68C0\u67E5</p><h3 id="ansible-galaxy" tabindex="-1">ansible-galaxy <a class="header-anchor" href="#ansible-galaxy" aria-hidden="true">#</a></h3><p><code>ansible-galaxy</code>\u5BA2\u6237\u7AEF\u5141\u8BB8\u60A8\u4ECE<a href="https://galaxy.ansible.com/?extIdCarryOver=true&amp;sc_cid=701f2000001OH7YAAW" target="_blank" rel="noopener noreferrer">Ansible Galaxy</a>\u4E0B\u8F7D\u89D2\u8272\uFF0C\u5E76\u4E14\u8FD8\u63D0\u4F9B\u4E86\u4E00\u4E2A\u51FA\u8272\u7684\u9ED8\u8BA4\u6846\u67B6\u6765\u521B\u5EFA\u60A8\u81EA\u5DF1\u7684\u89D2\u8272.</p><h2 id="\u8FDB\u9636" tabindex="-1">\u8FDB\u9636 <a class="header-anchor" href="#\u8FDB\u9636" aria-hidden="true">#</a></h2><h3 id="import-tasks-include-tasks" tabindex="-1">import_tasks &amp; include_tasks <a class="header-anchor" href="#import-tasks-include-tasks" aria-hidden="true">#</a></h3><p>\u4E8C\u8005\u533A\u522B:</p><ul><li><code>import*</code>: \u9884\u5904\u7406\u8FD0\u884C</li><li><code>include*</code>: \u4E2D\u9014\u8FD0\u884C</li></ul><p>\u5982\u679C\u4EFB\u52A1\u5C31\u4E00\u4E2A\u7684\u8BDD,\u4E24\u4E2A\u7528\u54EA\u4E2A\u90FD\u65E0\u6240\u8C13.</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">tasks</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">import_tasks</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">common_tasks.yml</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">vars</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">   </span><span style="color:#758575;"># \u53EF\u4EE5\u5411\u6307\u5B9Aplaybook\u4F20\u9012\u53C2\u6570</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">foot</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">bar</span></span>
<span class="line"><span style="color:#758575;"># or</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">include_tasks</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">common_tasks.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># handlers\u4E2D\u4E5F\u53EF\u4EE5\u4F7F\u7528</span></span>
<span class="line"><span style="color:#429988;">handlers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">include_tasks</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">more_handlers.yml</span></span>
<span class="line"><span style="color:#758575;"># or</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">import_tasks</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">more_handlers.yml</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">tasks</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">import_tasks</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">common_tasks.yml</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">vars</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">   </span><span style="color:#A0ADA0;"># \u53EF\u4EE5\u5411\u6307\u5B9Aplaybook\u4F20\u9012\u53C2\u6570</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">foot</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">bar</span></span>
<span class="line"><span style="color:#A0ADA0;"># or</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">include_tasks</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">common_tasks.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># handlers\u4E2D\u4E5F\u53EF\u4EE5\u4F7F\u7528</span></span>
<span class="line"><span style="color:#2F8A89;">handlers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">include_tasks</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">more_handlers.yml</span></span>
<span class="line"><span style="color:#A0ADA0;"># or</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">import_tasks</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">more_handlers.yml</span></span>
<span class="line"></span></code></pre></div><h3 id="role" tabindex="-1">Role <a class="header-anchor" href="#role" aria-hidden="true">#</a></h3><h4 id="role-\u76EE\u5F55\u7ED3\u6784" tabindex="-1">Role \u76EE\u5F55\u7ED3\u6784 <a class="header-anchor" href="#role-\u76EE\u5F55\u7ED3\u6784" aria-hidden="true">#</a></h4><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">roles/</span></span>
<span class="line"><span style="color:#C98A7D;">\u251C\u2500\u2500 dbsrvs</span></span>
<span class="line"><span style="color:#C98A7D;">\u2502\xA0\xA0 \u251C\u2500\u2500 defaults</span><span style="color:#DBD7CA;">		</span><span style="color:#758575;"># \u9ED8\u8BA4\u53D8\u91CF\u5B58\u653E\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#C98A7D;">\u2502\xA0\xA0 \u251C\u2500\u2500 files</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;"># \u6240\u8981\u4F20\u8F93\u6216\u8005\u4F7F\u7528\u7684\u6587\u4EF6\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#C98A7D;">\u2502\xA0\xA0 \u251C\u2500\u2500 handlers</span></span>
<span class="line"><span style="color:#C98A7D;">\u2502\xA0\xA0 \u251C\u2500\u2500 meta</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;"># \u5143\u6570\u636E\u5B58\u653E\u4F4D\u7F6E,\u53EF\u5B58\u653E\u89D2\u8272\u4F9D\u8D56,\u53C2\u8003https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html#role-dependencies</span></span>
<span class="line"><span style="color:#C98A7D;">\u2502\xA0\xA0 \u251C\u2500\u2500 tasks</span></span>
<span class="line"><span style="color:#C98A7D;">\u2502\xA0\xA0 \u251C\u2500\u2500 templates</span></span>
<span class="line"><span style="color:#C98A7D;">\u2502\xA0\xA0 \u2514\u2500\u2500 vars</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;"># \u53D8\u91CF\u5B58\u653E\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#C98A7D;">\u2514\u2500\u2500 websrvs</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">\u251C\u2500\u2500 files</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">\u251C\u2500\u2500 handlers</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">\u251C\u2500\u2500 tasks</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">\u251C\u2500\u2500 templates</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">\u2514\u2500\u2500 vars</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">roles/</span></span>
<span class="line"><span style="color:#B56959;">\u251C\u2500\u2500 dbsrvs</span></span>
<span class="line"><span style="color:#B56959;">\u2502\xA0\xA0 \u251C\u2500\u2500 defaults</span><span style="color:#393A34;">		</span><span style="color:#A0ADA0;"># \u9ED8\u8BA4\u53D8\u91CF\u5B58\u653E\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#B56959;">\u2502\xA0\xA0 \u251C\u2500\u2500 files</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;"># \u6240\u8981\u4F20\u8F93\u6216\u8005\u4F7F\u7528\u7684\u6587\u4EF6\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#B56959;">\u2502\xA0\xA0 \u251C\u2500\u2500 handlers</span></span>
<span class="line"><span style="color:#B56959;">\u2502\xA0\xA0 \u251C\u2500\u2500 meta</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;"># \u5143\u6570\u636E\u5B58\u653E\u4F4D\u7F6E,\u53EF\u5B58\u653E\u89D2\u8272\u4F9D\u8D56,\u53C2\u8003https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html#role-dependencies</span></span>
<span class="line"><span style="color:#B56959;">\u2502\xA0\xA0 \u251C\u2500\u2500 tasks</span></span>
<span class="line"><span style="color:#B56959;">\u2502\xA0\xA0 \u251C\u2500\u2500 templates</span></span>
<span class="line"><span style="color:#B56959;">\u2502\xA0\xA0 \u2514\u2500\u2500 vars</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;"># \u53D8\u91CF\u5B58\u653E\u4F4D\u7F6E</span></span>
<span class="line"><span style="color:#B56959;">\u2514\u2500\u2500 websrvs</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">\u251C\u2500\u2500 files</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">\u251C\u2500\u2500 handlers</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">\u251C\u2500\u2500 tasks</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">\u251C\u2500\u2500 templates</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">\u2514\u2500\u2500 vars</span></span>
<span class="line"></span></code></pre></div><h4 id="\u793A\u4F8B\u53CA\u4F7F\u7528" tabindex="-1">\u793A\u4F8B\u53CA\u4F7F\u7528 <a class="header-anchor" href="#\u793A\u4F8B\u53CA\u4F7F\u7528" aria-hidden="true">#</a></h4><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># roles/example/tasks/main.yml</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">added in 2.4, previously you used &#39;include&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">import_tasks</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">redhat.yml</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">when</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ansible_facts[&#39;os_family&#39;]|lower == &#39;redhat&#39;</span><span style="color:#DBD7CA;">		</span><span style="color:#758575;"># when\u76F8\u5F53\u4E8E\u6761\u4EF6\u8BED\u53E5</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">import_tasks</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">debian.yml</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">when</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ansible_facts[&#39;os_family&#39;]|lower == &#39;debian&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># roles/example/tasks/redhat.yml</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">yum</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;httpd&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">present</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># roles/example/tasks/debian.yml</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">apt</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;apache2&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">present</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># roles/example/tasks/main.yml</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">added in 2.4, previously you used &#39;include&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">import_tasks</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">redhat.yml</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">when</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ansible_facts[&#39;os_family&#39;]|lower == &#39;redhat&#39;</span><span style="color:#393A34;">		</span><span style="color:#A0ADA0;"># when\u76F8\u5F53\u4E8E\u6761\u4EF6\u8BED\u53E5</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">import_tasks</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">debian.yml</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">when</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ansible_facts[&#39;os_family&#39;]|lower == &#39;debian&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># roles/example/tasks/redhat.yml</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">yum</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;httpd&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">present</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># roles/example/tasks/debian.yml</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">apt</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;apache2&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">present</span></span>
<span class="line"></span></code></pre></div><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># \u8C03\u7528\u89D2\u8272</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">webservers</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">roles</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">example</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">webservers</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u8C03\u7528\u89D2\u8272</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">webservers</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">roles</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">example</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">webservers</span></span>
<span class="line"></span></code></pre></div><p>\u5728ansible2.4\u4E4B\u540E,\u53EF\u4EE5\u4F7F\u7528<code>import_role</code> \u548C<code>include_role</code>:</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">webservers</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">tasks</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">msg</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;before we run our role&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">import_role</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">example</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">include_role</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">example</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">msg</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;after we ran our role&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">webservers</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">tasks</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">msg</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;before we run our role&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">import_role</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">example</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">include_role</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">example</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">msg</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;after we ran our role&quot;</span></span>
<span class="line"></span></code></pre></div><h4 id="\u81EA\u5B9A\u4E49role\u6587\u4EF6\u8DEF\u5F84-\u4F20\u9012\u53C2\u6570-tags" tabindex="-1">\u81EA\u5B9A\u4E49role\u6587\u4EF6\u8DEF\u5F84, \u4F20\u9012\u53C2\u6570 ,tags <a class="header-anchor" href="#\u81EA\u5B9A\u4E49role\u6587\u4EF6\u8DEF\u5F84-\u4F20\u9012\u53C2\u6570-tags" aria-hidden="true">#</a></h4><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">webservers</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">tasks</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">include_role</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">foo_app_instance</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">vars</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">dir</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;/path/to/my/roles/common&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">app_port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">5000</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">when</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;ansible_facts[&#39;os_family&#39;] == &#39;RedHat&#39;&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">tags</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      	</span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">web</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">redhat</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">webservers</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">tasks</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">include_role</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">foo_app_instance</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">vars</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">dir</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;/path/to/my/roles/common&#39;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">app_port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">5000</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">when</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;ansible_facts[&#39;os_family&#39;] == &#39;RedHat&#39;&quot;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">tags</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      	</span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">web</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">redhat</span></span>
<span class="line"></span></code></pre></div><h3 id="variables" tabindex="-1">variables <a class="header-anchor" href="#variables" aria-hidden="true">#</a></h3><p><strong>\u5728<code>playbook</code>\u4E2D\u76F4\u63A5\u5B9A\u4E49:</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">webservers</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">vars</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">http_port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">webservers</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">vars</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">http_port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span></span>
<span class="line"></span></code></pre></div><p><strong>\u5728\u6587\u4EF6\u4E2D\u5B9A\u4E49:</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">all</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">remote_user</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">root</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">vars</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">favcolor</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">blue</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">vars_files</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/vars/external_vars.yml</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">all</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">remote_user</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">root</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">vars</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">favcolor</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">blue</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">vars_files</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/vars/external_vars.yml</span></span>
<span class="line"></span></code></pre></div><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># /vars/external_vars.yml</span></span>
<span class="line"><span style="color:#429988;">somevar</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">somevalue</span></span>
<span class="line"><span style="color:#429988;">password</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">magic</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># /vars/external_vars.yml</span></span>
<span class="line"><span style="color:#2F8A89;">somevar</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">somevalue</span></span>
<span class="line"><span style="color:#2F8A89;">password</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">magic</span></span>
<span class="line"></span></code></pre></div><p><strong>\u5728\u547D\u4EE4\u884C\u4E2D\u4F20\u9012:</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">ansible-playbook websrvs.yml --extra-vars &quot;http_ver=2.4.6&quot;</span></span>
<span class="line"><span style="color:#C98A7D;">ansible-playbook release.yml --extra-vars &quot;@some_file.json&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">ansible-playbook websrvs.yml --extra-vars &quot;http_ver=2.4.6&quot;</span></span>
<span class="line"><span style="color:#B56959;">ansible-playbook release.yml --extra-vars &quot;@some_file.json&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u4F20\u9012<code>json</code>\u6216\u8005<code>json file</code> \u53C2\u8003:<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#passing-variables-on-the-command-line" target="_blank" rel="noopener noreferrer">https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#passing-variables-on-the-command-line</a></p><p><strong>\u8C03\u7528<code>Facts</code>\u4E2D\u7684\u53D8\u91CF:</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># \u67E5\u770B</span></span>
<span class="line"><span style="color:#C98A7D;">ansible websrvs -m setup</span></span>
<span class="line"><span style="color:#758575;"># \u8C03\u7528</span></span>
<span class="line"><span style="color:#C98A7D;">\u3010\u3010 ansible_facts[&#39;devices&#39;][&#39;xvda&#39;][&#39;model&#39;] \u3011\u3011</span><span style="color:#DBD7CA;">		</span><span style="color:#758575;"># \u5C42\u7EA7\u7ED3\u6784</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">\u3010\u3010 ansible_facts[&#39;nodename&#39;] \u3011\u3011</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#758575;"># \u6216\u8005</span></span>
<span class="line"><span style="color:#C98A7D;">\u3010\u3010 ansible_nodename \u3011\u3011</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u67E5\u770B</span></span>
<span class="line"><span style="color:#B56959;">ansible websrvs -m setup</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u8C03\u7528</span></span>
<span class="line"><span style="color:#B56959;">\u3010\u3010 ansible_facts[&#39;devices&#39;][&#39;xvda&#39;][&#39;model&#39;] \u3011\u3011</span><span style="color:#393A34;">		</span><span style="color:#A0ADA0;"># \u5C42\u7EA7\u7ED3\u6784</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">\u3010\u3010 ansible_facts[&#39;nodename&#39;] \u3011\u3011</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#A0ADA0;"># \u6216\u8005</span></span>
<span class="line"><span style="color:#B56959;">\u3010\u3010 ansible_nodename \u3011\u3011</span></span>
<span class="line"></span></code></pre></div><p>\u2139\uFE0F\u6CE8\u610F:\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u6267\u884C\u547D\u4EE4\u6216\u8005playbook\u4F1A\u5148\u6536\u96C6<code>facts</code>,\u5982\u679C\u4F60\u77E5\u9053\u4F60\u4E0D\u9700\u8981\u4EFB\u4F55\u6765\u81EA<code>facts</code>\u7684\u6570\u636E,\u90A3\u4E48\u53EF\u4EE5\u4F7F\u7528\u4EE5\u4E0B\u53C2\u6570\u6765\u8FDB\u884C\u5173\u95ED:</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">whatever</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">gather_facts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">no</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">whatever</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">gather_facts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">no</span></span>
<span class="line"></span></code></pre></div><p><strong>\u4F20\u9012\u672C\u5730<code>facts</code>:</strong></p><p>\u5728<code>/etc/ansible/facts.d</code>\u76EE\u5F55\u4E0B\u521B\u5EFA\u4E00\u4E2A<code>*.fact</code>\u7684\u6587\u4EF6, \u5373\u53EF\u5C06\u672C\u5730<code>facts</code>\u4F20\u9012\u7ED9\u4E3B\u673A<code>setup</code>\u7684<code>ansible_local\`\`facts</code>\u4E2D\u53BB.</p><p>\u793A\u4F8B:</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># /etc/ansible/facts.d/preferences.fact</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">general</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#C98A7D;">asdf=1</span></span>
<span class="line"><span style="color:#C98A7D;">bar=2</span></span>
<span class="line"><span style="color:#758575;"># \u67E5\u770B\u672C\u5730facts</span></span>
<span class="line"><span style="color:#C98A7D;">ansible local -m setup -a &quot;filter=ansible_local&quot;</span></span>
<span class="line"><span style="color:#758575;"># \u8C03\u7528</span></span>
<span class="line"><span style="color:#C98A7D;">\u3010\u3010 ansible_local[&#39;preferences&#39;][&#39;general&#39;][&#39;asdf&#39;] \u3011\u3011</span></span>
<span class="line"><span style="color:#758575;"># \u6216\u8005</span></span>
<span class="line"><span style="color:#C98A7D;">\u3010\u3010 ansible_local.prefetences.general.asdf \u3011\u3011</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># /etc/ansible/facts.d/preferences.fact</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">general</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#B56959;">asdf=1</span></span>
<span class="line"><span style="color:#B56959;">bar=2</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u67E5\u770B\u672C\u5730facts</span></span>
<span class="line"><span style="color:#B56959;">ansible local -m setup -a &quot;filter=ansible_local&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u8C03\u7528</span></span>
<span class="line"><span style="color:#B56959;">\u3010\u3010 ansible_local[&#39;preferences&#39;][&#39;general&#39;][&#39;asdf&#39;] \u3011\u3011</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u6216\u8005</span></span>
<span class="line"><span style="color:#B56959;">\u3010\u3010 ansible_local.prefetences.general.asdf \u3011\u3011</span></span>
<span class="line"></span></code></pre></div><p>\u8BE6\u60C5\u53C2\u8003:<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#local-facts-facts-d" target="_blank" rel="noopener noreferrer">https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#local-facts-facts-d</a></p><p><a href="https://www.cnblogs.com/f-ck-need-u/p/7571974.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/f-ck-need-u/p/7571974.html</a></p><p><strong>\u6CE8\u518C\u4E0E\u81EA\u5B9A\u4E49\u53D8\u91CF:</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">register vars</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">shell</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">echo bar</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">register</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">foo</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">set_fact</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">var1=&quot;\u3010\u3010 foo.stdout \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">set_fact</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">var2=&quot; foo ///  &quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot;\u3010\u3010 var2 \u3011\u3011 \u3010\u3010var1\u3011\u3011&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">register vars</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">shell</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">echo bar</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">register</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">foo</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">set_fact</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">var1=&quot;\u3010\u3010 foo.stdout \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">set_fact</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">var2=&quot; foo ///  &quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot;\u3010\u3010 var2 \u3011\u3011 \u3010\u3010var1\u3011\u3011&quot;</span></span>
<span class="line"></span></code></pre></div><p><strong><code>with_item</code>\u8FED\u4EE3\u53D8\u91CF</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">with_items</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">shell</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">echo &quot;\u3010\u3010 item \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">with_items</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">hello</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ansible</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">with_items</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">shell</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">echo &quot;\u3010\u3010 item \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">with_items</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">hello</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ansible</span></span>
<span class="line"></span></code></pre></div><p><strong><code>inventroy</code>\u4E3B\u673A\u7EC4\u53D8\u91CF\u548C\u4E3B\u673A\u53D8\u91CF</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># /etc/ansible/hosts</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">websvrs</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#C98A7D;">node01	var1=&quot;var1 node01&quot;</span></span>
<span class="line"><span style="color:#C98A7D;">node02</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">websrvs:vars</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#C98A7D;">var2=&quot;var2 websrvs&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># /etc/ansible/hosts</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">websvrs</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#B56959;">node01	var1=&quot;var1 node01&quot;</span></span>
<span class="line"><span style="color:#B56959;">node02</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">websrvs:vars</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#B56959;">var2=&quot;var2 websrvs&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u{1F4D3}\u7EFC\u5408vars\u793A\u4F8B:</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">localhost</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">gather_facts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">yes</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">vars</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">http_port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">https_port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">443</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">vars_files</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/root/playbooks/vars/external_vars.yml</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/root/playbooks/vars/external_vars2.yml</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">tasks</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">show playbook vars</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot; the http_port is  \u3010\u3010 http_port \u3011\u3011 /// https_port is  \u3010\u3010 https_port \u3011\u3011 &quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">vars</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">http_port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">8080</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">import vars form localfile</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot; vars from localfile \u3010\u3010 hello \u3011\u3011 /// \u3010\u3010 ansible \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">import vars form local facts</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot; vars form local facts --- \u3010\u3010 ansible_local.preferences.general.bar \u3011\u3011 &quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">import vars form commandline</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot; vars form commandline -- \u3010\u3010 command \u3011\u3011  &quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">ignore_errors</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">yes</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">import vars form json file</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot;ipv6 address is  --- \u3010\u3010 ipv6[0].address \u3011\u3011&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">register vars</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">shell</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">echo bar</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">register</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">foo</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">set_fact</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">var1=&quot;\u3010\u3010 foo.stdout \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">set_fact</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">var2=&quot; foo ///  &quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot;\u3010\u3010 var2 \u3011\u3011 \u3010\u3010var1\u3011\u3011&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">with_items</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">shell</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">echo &quot;\u3010\u3010 item \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">with_items</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">hello</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ansible</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">register</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">items</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">tags</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">items</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">var=items.results[0].stdout</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">tags</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">items</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot; {% for i in items.results %} \u3010\u3010 i.stdout \u3011\u3011 {% endfor %} &quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">tags</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">items</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">inventory var</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">debug</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">msg=&quot; \u3010\u3010 inventory_var1 \u3011\u3011 /// \u3010\u3010 inventory_var2  \u3011\u3011 &quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">tags</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">inventory</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">localhost</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">gather_facts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">yes</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">vars</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">http_port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">https_port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">443</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">vars_files</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/root/playbooks/vars/external_vars.yml</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/root/playbooks/vars/external_vars2.yml</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">tasks</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">show playbook vars</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot; the http_port is  \u3010\u3010 http_port \u3011\u3011 /// https_port is  \u3010\u3010 https_port \u3011\u3011 &quot;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">vars</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">http_port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">8080</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">import vars form localfile</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot; vars from localfile \u3010\u3010 hello \u3011\u3011 /// \u3010\u3010 ansible \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">import vars form local facts</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot; vars form local facts --- \u3010\u3010 ansible_local.preferences.general.bar \u3011\u3011 &quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">import vars form commandline</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot; vars form commandline -- \u3010\u3010 command \u3011\u3011  &quot;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">ignore_errors</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">yes</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">import vars form json file</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot;ipv6 address is  --- \u3010\u3010 ipv6[0].address \u3011\u3011&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">register vars</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">shell</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">echo bar</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">register</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">foo</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">set_fact</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">var1=&quot;\u3010\u3010 foo.stdout \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">set_fact</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">var2=&quot; foo ///  &quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot;\u3010\u3010 var2 \u3011\u3011 \u3010\u3010var1\u3011\u3011&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">with_items</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">shell</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">echo &quot;\u3010\u3010 item \u3011\u3011&quot;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">with_items</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">hello</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ansible</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">register</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">items</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">tags</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">items</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">var=items.results[0].stdout</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">tags</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">items</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot; {% for i in items.results %} \u3010\u3010 i.stdout \u3011\u3011 {% endfor %} &quot;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">tags</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">items</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">inventory var</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">debug</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">msg=&quot; \u3010\u3010 inventory_var1 \u3011\u3011 /// \u3010\u3010 inventory_var2  \u3011\u3011 &quot;</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">tags</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">inventory</span></span>
<span class="line"></span></code></pre></div><p>\u{1F6E9}\uFE0F\u6269\u5C55\u9605\u8BFB:</p><ul><li>jinja2 <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html" target="_blank" rel="noopener noreferrer">https://docs.ansible.com/ansible/latest/user_guide/playbooks_filters.html</a></li><li>\u7279\u6B8A\u5185\u7F6E\u53D8\u91CF: <a href="https://docs.ansible.com/ansible/latest/reference_appendices/special_variables.html" target="_blank" rel="noopener noreferrer">https://docs.ansible.com/ansible/latest/reference_appendices/special_variables.html</a></li></ul><h3 id="lineinfile" tabindex="-1">lineinfile <a class="header-anchor" href="#lineinfile" aria-hidden="true">#</a></h3><p>\u8BE5\u6A21\u5757\u786E\u4FDD\u6587\u4EF6\u4E2D<strong>\u5305\u542B\u7279\u5B9A\u884C</strong>\uFF0C\u6216\u4F7F\u7528\u5411\u540E\u5F15\u7528\u7684\u6B63\u5219\u8868\u8FBE\u5F0F<strong>\u66FF\u6362</strong>\u73B0\u6709\u884C\u3002</p><p>\u53EA\u9002\u7528\u4E8E\u4E00\u884C\u5185\u5BB9.</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># NOTE: Before 2.3, option &#39;dest&#39;, &#39;destfile&#39; or &#39;name&#39; was used instead of &#39;path&#39;</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">\u786E\u4FDDSElinux\u4E3Aenforce\u7A97\u53F0</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">lineinfile</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/selinux/config</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^SELINUX=&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">line</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">SELINUX=enforcing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">\u786E\u4FDDwheel\u7EC4\u4E0D\u5728sudoers\u914D\u7F6E\u6587\u4EF6\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">lineinfile</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/sudoers</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">absent</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^%wheel&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">\u786E\u4FDD127.0.0.1\u4E3A\u672C\u5730localhost</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">lineinfile</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/hosts</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^127\\.0\\.0\\.1&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">line</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">127.0.0.1 localhost</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">owner</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">root</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">group</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">root</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;0644&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">\u786E\u4FDDhttpd\u7684\u76D1\u542C\u7AEF\u53E3\u4E3A8080</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">lineinfile</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^Listen &#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">insertafter</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^#Listen &#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">line</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Listen 8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">\u786E\u4FDD\u6CE8\u91CA\u5728\u5339\u914D\u6587\u672C\u4E0A\u9762</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">lineinfile</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/services</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^# port for http&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">insertbefore</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^www.*80/tcp&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">line</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;# port for http by default&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">\u4E3A\u7A7A\u6587\u4EF6\u6DFB\u52A0\u4E00\u884C\u5185\u5BB9</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">lineinfile</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/tmp/testfile</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">line</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">192.168.1.99 foo.lab.net foo</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">create</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># NOTE: Yaml requires escaping backslashes in double quotes but not in single quotes</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Ensure the JBoss memory settings are exactly as needed</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">lineinfile</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/opt/jboss-as/bin/standalone.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^(.*)Xms(\\\\d+)m(.*)$&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">line</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;\\1Xms\${xms}m\\3&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">backrefs</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># NOTE: Fully quoted because of the &#39;: &#39; on the line. See the Gotchas in the YAML docs.</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Validate the sudoers file before saving</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">lineinfile</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/sudoers</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">state</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">present</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^%ADMIN ALL=&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">line</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;%ADMIN ALL=(ALL) NOPASSWD: ALL&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">validate</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/usr/sbin/visudo -cf %s</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># NOTE: Before 2.3, option &#39;dest&#39;, &#39;destfile&#39; or &#39;name&#39; was used instead of &#39;path&#39;</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">\u786E\u4FDDSElinux\u4E3Aenforce\u7A97\u53F0</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">lineinfile</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/selinux/config</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^SELINUX=&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">line</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">SELINUX=enforcing</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">\u786E\u4FDDwheel\u7EC4\u4E0D\u5728sudoers\u914D\u7F6E\u6587\u4EF6\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">lineinfile</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/sudoers</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">absent</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^%wheel&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">\u786E\u4FDD127.0.0.1\u4E3A\u672C\u5730localhost</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">lineinfile</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/hosts</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^127\\.0\\.0\\.1&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">line</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">127.0.0.1 localhost</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">owner</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">root</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">group</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">root</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;0644&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">\u786E\u4FDDhttpd\u7684\u76D1\u542C\u7AEF\u53E3\u4E3A8080</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">lineinfile</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^Listen &#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">insertafter</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^#Listen &#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">line</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Listen 8080</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">\u786E\u4FDD\u6CE8\u91CA\u5728\u5339\u914D\u6587\u672C\u4E0A\u9762</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">lineinfile</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/services</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^# port for http&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">insertbefore</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^www.*80/tcp&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">line</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;# port for http by default&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">\u4E3A\u7A7A\u6587\u4EF6\u6DFB\u52A0\u4E00\u884C\u5185\u5BB9</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">lineinfile</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/tmp/testfile</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">line</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">192.168.1.99 foo.lab.net foo</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">create</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># NOTE: Yaml requires escaping backslashes in double quotes but not in single quotes</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Ensure the JBoss memory settings are exactly as needed</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">lineinfile</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/opt/jboss-as/bin/standalone.conf</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^(.*)Xms(\\\\d+)m(.*)$&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">line</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;\\1Xms\${xms}m\\3&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">backrefs</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">yes</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># NOTE: Fully quoted because of the &#39;: &#39; on the line. See the Gotchas in the YAML docs.</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Validate the sudoers file before saving</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">lineinfile</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/sudoers</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">state</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">present</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^%ADMIN ALL=&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">line</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;%ADMIN ALL=(ALL) NOPASSWD: ALL&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">validate</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/usr/sbin/visudo -cf %s</span></span>
<span class="line"></span></code></pre></div><h3 id="replace" tabindex="-1">replace <a class="header-anchor" href="#replace" aria-hidden="true">#</a></h3><p>\u66FF\u6362\u6240\u6709, \u4E0El<code>ineinfile</code>\u4E0D\u540C</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Before Ansible 2.3, option &#39;dest&#39;, &#39;destfile&#39; or &#39;name&#39; was used instead of &#39;path&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/hosts</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;(\\s+)old\\.host\\.name(\\s+.*)?$&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;\\1new.host.name\\2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Replace after the expression till the end of the file (requires Ansible &gt;= 2.4)</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/apache2/sites-available/default.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">after</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;NameVirtualHost [*]&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^(.+)$&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;# \\1&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Replace before the expression till the begin of the file (requires Ansible &gt;= 2.4)</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/apache2/sites-available/default.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">before</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;# live site config&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^(.+)$&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;# \\1&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># Prior to Ansible 2.7.10, using before and after in combination did the opposite of what was intended.</span></span>
<span class="line"><span style="color:#758575;"># see https://github.com/ansible/ansible/issues/31354 for details.</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Replace between the expressions (requires Ansible &gt;= 2.4)</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/hosts</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">after</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;&lt;VirtualHost [*]&gt;&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">before</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;&lt;/VirtualHost&gt;&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^(.+)$&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;# \\1&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Supports common file attributes</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/home/jdoe/.ssh/known_hosts</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^old\\.host\\.name[^\\n]*\\n&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">owner</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">jdoe</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">group</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">jdoe</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;0644&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Supports a validate command</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/apache/ports</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^(NameVirtualHost|Listen)\\s+80\\s*$&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;\\1 127.0.0.1:8080&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">validate</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;/usr/sbin/apache2ctl -f %s -t&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Short form task (in ansible 2+) necessitates backslash-escaped sequences</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">path=/etc/hosts regexp=&#39;\\\\b(localhost)(\\\\d*)\\\\b&#39; replace=&#39;\\\\1\\\\2.localdomain\\\\2 \\\\1\\\\2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Long form task does not</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/hosts</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;\\b(localhost)(\\d*)\\b&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;\\1\\2.localdomain\\2 \\1\\2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Explicitly specifying positional matched groups in replacement</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/ssh/sshd_config</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^(ListenAddress[ ]+)[^\\n]+$&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;\\g&lt;1&gt;0.0.0.0&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Explicitly specifying named matched groups</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/etc/ssh/sshd_config</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">regexp</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;^(?P&lt;dctv&gt;ListenAddress[ ]+)(?P&lt;host&gt;[^\\n]+)$&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">replace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;#\\g&lt;dctv&gt;\\g&lt;host&gt;\\n\\g&lt;dctv&gt;0.0.0.0&#39;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Before Ansible 2.3, option &#39;dest&#39;, &#39;destfile&#39; or &#39;name&#39; was used instead of &#39;path&#39;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/hosts</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;(\\s+)old\\.host\\.name(\\s+.*)?$&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;\\1new.host.name\\2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Replace after the expression till the end of the file (requires Ansible &gt;= 2.4)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/apache2/sites-available/default.conf</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">after</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;NameVirtualHost [*]&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^(.+)$&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;# \\1&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Replace before the expression till the begin of the file (requires Ansible &gt;= 2.4)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/apache2/sites-available/default.conf</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">before</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;# live site config&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^(.+)$&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;# \\1&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># Prior to Ansible 2.7.10, using before and after in combination did the opposite of what was intended.</span></span>
<span class="line"><span style="color:#A0ADA0;"># see https://github.com/ansible/ansible/issues/31354 for details.</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Replace between the expressions (requires Ansible &gt;= 2.4)</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/hosts</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">after</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;&lt;VirtualHost [*]&gt;&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">before</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;&lt;/VirtualHost&gt;&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^(.+)$&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;# \\1&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Supports common file attributes</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/home/jdoe/.ssh/known_hosts</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^old\\.host\\.name[^\\n]*\\n&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">owner</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">jdoe</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">group</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">jdoe</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;0644&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Supports a validate command</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/apache/ports</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^(NameVirtualHost|Listen)\\s+80\\s*$&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;\\1 127.0.0.1:8080&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">validate</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;/usr/sbin/apache2ctl -f %s -t&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Short form task (in ansible 2+) necessitates backslash-escaped sequences</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">path=/etc/hosts regexp=&#39;\\\\b(localhost)(\\\\d*)\\\\b&#39; replace=&#39;\\\\1\\\\2.localdomain\\\\2 \\\\1\\\\2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Long form task does not</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/hosts</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;\\b(localhost)(\\d*)\\b&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;\\1\\2.localdomain\\2 \\1\\2&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Explicitly specifying positional matched groups in replacement</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/ssh/sshd_config</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^(ListenAddress[ ]+)[^\\n]+$&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;\\g&lt;1&gt;0.0.0.0&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Explicitly specifying named matched groups</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/etc/ssh/sshd_config</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">regexp</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;^(?P&lt;dctv&gt;ListenAddress[ ]+)(?P&lt;host&gt;[^\\n]+)$&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">replace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;#\\g&lt;dctv&gt;\\g&lt;host&gt;\\n\\g&lt;dctv&gt;0.0.0.0&#39;</span></span>
<span class="line"></span></code></pre></div><h2 id="\u53C2\u8003\u94FE\u63A5" tabindex="-1">\u53C2\u8003\u94FE\u63A5 <a class="header-anchor" href="#\u53C2\u8003\u94FE\u63A5" aria-hidden="true">#</a></h2><ul><li>Ansible Playbook : <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html" target="_blank" rel="noopener noreferrer">https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html</a></li><li>Ansible-Galaxy : <a href="https://galaxy.ansible.com/docs/?extIdCarryOver=true&amp;sc_cid=701f2000001OH7YAAW" target="_blank" rel="noopener noreferrer">https://galaxy.ansible.com/docs/?extIdCarryOver=true&amp;sc_cid=701f2000001OH7YAAW</a></li></ul>`,78),e=[o];function c(t,r,y,A,i,D){return n(),a("div",null,e)}var d=s(p,[["render",c]]);export{C as __pageData,d as default};
