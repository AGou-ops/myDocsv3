import{_ as s,o as n,c as a,a as l}from"./app.1e6146c3.js";const C=JSON.parse('{"title":"Nginx\u65E5\u5FD7\u5206\u6790","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u529F\u80FD","slug":"\u529F\u80FD"},{"level":2,"title":"Usage","slug":"usage"}],"relativePath":"Scripts/shell/Nginx Log Check.md","lastUpdated":1657272051000}'),p={name:"Scripts/shell/Nginx Log Check.md"},o=l(`<h1 id="nginx\u65E5\u5FD7\u5206\u6790" tabindex="-1">Nginx\u65E5\u5FD7\u5206\u6790 <a class="header-anchor" href="#nginx\u65E5\u5FD7\u5206\u6790" aria-hidden="true">#</a></h1><p>Nginx\u65E5\u5FD7\u5B89\u5168\u5206\u6790\u811A\u672C</p><h2 id="\u529F\u80FD" tabindex="-1">\u529F\u80FD <a class="header-anchor" href="#\u529F\u80FD" aria-hidden="true">#</a></h2><ul><li>\u7EDF\u8BA1Top 20 \u5730\u5740</li><li>SQL\u6CE8\u5165\u5206\u6790</li><li>\u626B\u63CF\u5668\u544A\u8B66\u5206\u6790</li><li>\u6F0F\u6D1E\u5229\u7528\u68C0\u6D4B</li><li>\u654F\u611F\u8DEF\u5F84\u8BBF\u95EE</li><li>\u6587\u4EF6\u5305\u542B\u653B\u51FB</li><li>Webshell</li><li>\u5BFB\u627E\u54CD\u5E94\u957F\u5EA6\u7684url Top 20</li><li>\u5BFB\u627E\u7F55\u89C1\u7684\u811A\u672C\u6587\u4EF6\u8BBF\u95EE</li><li>\u5BFB\u627E302\u8DF3\u8F6C\u7684\u811A\u672C\u6587\u4EF6</li></ul><h2 id="usage" tabindex="-1">Usage <a class="header-anchor" href="#usage" aria-hidden="true">#</a></h2><p>\u8BBE\u7F6E\u62A5\u544A\u4FDD\u5B58\u5730\u5740 outfile \u8BBE\u7F6E\u65E5\u5FD7\u5206\u6790\u76EE\u5F55 access_dir \u8BBE\u7F6E\u65E5\u5FD7\u540D\u79F0 access_log ./nginx_check.sh</p><p>\u811A\u672C\u5185\u5BB9\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-shell"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot; ========================================================= &quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot; \\                 Nginx\u65E5\u5FD7\u5B89\u5168\u5206\u6790\u811A\u672C V1.0            / &quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot; ========================================================= &quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot; # \u652F\u6301Nginx\u65E5\u5FD7\u5206\u6790\uFF0C\u653B\u51FB\u544A\u8B66\u5206\u6790\u7B49                    &quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot; # author\uFF1Aal0ne                    &quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot; # https://github.com/al0ne                    &quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#\u6B64\u811A\u672C\u662F\u53C2\u8003nmgxy/klionsec\u4FEE\u6539\u800C\u6765,\u91CD\u65B0\u6DFB\u52A0\u4E86\u4E00\u4E9B\u7279\u5F81\uFF0C\u53EA\u7528\u6765\u4E34\u65F6\u6551\u6025\uFF0C\u8FD8\u662F\u63A8\u8350\u5230ELK\u6216\u8005Splunk\u4E2D\u5206\u6790</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#\u529F\u80FD</span></span>
<span class="line"><span style="color:#758575;">###\u7EDF\u8BA1Top 20 \u5730\u5740</span></span>
<span class="line"><span style="color:#758575;">###SQL\u6CE8\u5165\u5206\u6790</span></span>
<span class="line"><span style="color:#758575;">###SQL\u6CE8\u5165 FROM\u67E5\u8BE2\u7EDF\u8BA1</span></span>
<span class="line"><span style="color:#758575;">###\u626B\u63CF\u5668/\u5E38\u7528\u9ED1\u5BA2\u5DE5\u5177</span></span>
<span class="line"><span style="color:#758575;">###\u6F0F\u6D1E\u5229\u7528\u68C0\u6D4B</span></span>
<span class="line"><span style="color:#758575;">###\u654F\u611F\u8DEF\u5F84\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#758575;">###\u6587\u4EF6\u5305\u542B\u653B\u51FB</span></span>
<span class="line"><span style="color:#758575;">###HTTP Tunnel</span></span>
<span class="line"><span style="color:#758575;">###Webshell</span></span>
<span class="line"><span style="color:#758575;">###\u5BFB\u627E\u54CD\u5E94\u957F\u5EA6\u7684url Top 20</span></span>
<span class="line"><span style="color:#758575;">###\u5BFB\u627E\u7F55\u89C1\u7684\u811A\u672C\u6587\u4EF6\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#758575;">###\u5BFB\u627E302\u8DF3\u8F6C\u7684\u811A\u672C\u6587\u4EF6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#\u5982\u679C\u5B58\u5728\u591A\u4E2Aaccess\u6587\u4EF6\u6216\u8005\u6709\u591A\u4E2Aaccess.x.gz \u5EFA\u8BAE\u5148zcat access*.gz &gt;&gt; access.log\u6587\u4EF6\u4E2D</span></span>
<span class="line"><span style="color:#758575;">#\u8BBE\u7F6E\u5206\u6790\u7ED3\u679C\u5B58\u50A8\u76EE\u5F55,\u7ED3\u5C3E\u4E0D\u80FD\u52A0/</span></span>
<span class="line"><span style="color:#DBD7CA;">outfile=/tmp/logs</span></span>
<span class="line"><span style="color:#758575;">#\u5982\u679C\u76EE\u5F55\u4EE5\u5B58\u5728\u5219\u6E05\u7A7A\uFF0C\u672A\u5B58\u5728\u5219\u65B0\u5EFA\u76EE\u5F55</span></span>
<span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">-d</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">outfile</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">]</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">    rm -rf </span><span style="color:#858585;">$</span><span style="color:#B8A965;">outfile</span><span style="color:#DBD7CA;">/</span><span style="color:#CB7676;">*</span></span>
<span class="line"><span style="color:#4D9375;">else</span></span>
<span class="line"><span style="color:#DBD7CA;">    mkdir -p </span><span style="color:#858585;">$</span><span style="color:#B8A965;">outfile</span></span>
<span class="line"><span style="color:#4D9375;">fi</span></span>
<span class="line"><span style="color:#758575;">#\u8BBE\u7F6Enginx\u65E5\u5FD7\u76EE\u5F55\uFF0C\u7ED3\u5C3E\u5FC5\u987B\u52A0/</span></span>
<span class="line"><span style="color:#DBD7CA;">access_dir=/var/log/nginx/</span></span>
<span class="line"><span style="color:#758575;">#\u8BBE\u7F6E\u6587\u4EF6\u540D\uFF0C\u5982\u679C\u6587\u4EF6\u540D\u4E3Aaccess\u90A3\u4E48\u5339\u914D\u7684\u662Faccess*\u6587\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CA;">access_log=access</span></span>
<span class="line"><span style="color:#758575;">#\u5224\u65AD\u65E5\u5FD7\u6587\u4EF6\u662F\u5426\u5B58\u5728</span></span>
<span class="line"><span style="color:#DBD7CA;">num=</span><span style="color:#C98A7D;">$(ls </span><span style="color:#858585;">\${</span><span style="color:#C98A7D;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#C98A7D;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#C98A7D;"> </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;"> wc -l)</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">/dev/null </span><span style="color:#CB7676;">2&gt;&amp;1</span></span>
<span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">num</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">-eq</span><span style="color:#DBD7CA;"> 0 </span><span style="color:#858585;">]</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;\u65E5\u5FD7\u6587\u4EF6\u4E0D\u5B58\u5728&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">exit</span><span style="color:#DBD7CA;"> 1</span></span>
<span class="line"><span style="color:#4D9375;">fi</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u9A8C\u8BC1\u64CD\u4F5C\u7CFB\u7EDF\u662Fdebian\u7CFB\u8FD8\u662Fcentos</span></span>
<span class="line"><span style="color:#DBD7CA;">OS=</span><span style="color:#C98A7D;">&#39;None&#39;</span></span>
<span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">-e</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;/etc/os-release&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">]</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">source</span><span style="color:#DBD7CA;"> /etc/os-release</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">case</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">ID</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">in</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;debian&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">|</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;ubuntu&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">|</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;devuan&quot;</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">        OS=</span><span style="color:#C98A7D;">&#39;Debian&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;centos&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">|</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;rhel fedora&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">|</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;rhel&quot;</span><span style="color:#858585;">)</span></span>
<span class="line"><span style="color:#DBD7CA;">        OS=</span><span style="color:#C98A7D;">&#39;Centos&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">;;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">esac</span></span>
<span class="line"><span style="color:#4D9375;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">OS</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">=</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;None&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">]</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">command</span><span style="color:#DBD7CA;"> -v apt-get </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">/dev/null </span><span style="color:#CB7676;">2&gt;&amp;1;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">        OS=</span><span style="color:#C98A7D;">&#39;Debian&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">elif</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">command</span><span style="color:#DBD7CA;"> -v yum </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">/dev/null </span><span style="color:#CB7676;">2&gt;&amp;1;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">        OS=</span><span style="color:#C98A7D;">&#39;Centos&#39;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">else</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n\u4E0D\u652F\u6301\u8FD9\u4E2A\u7CFB\u7EDF\\n&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\u5DF2\u9000\u51FA&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#E0A569;">exit</span><span style="color:#DBD7CA;"> 1</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">fi</span></span>
<span class="line"><span style="color:#4D9375;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u68C0\u6D4Bag\u8F6F\u4EF6\u6709\u6CA1\u6709\u5B89\u88C5</span></span>
<span class="line"><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> ag -V </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">/dev/null </span><span style="color:#CB7676;">2&gt;&amp;1;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;32msilversearcher-ag\u5DF2\u5B89\u88C5 \\e[00m&quot;</span></span>
<span class="line"><span style="color:#4D9375;">else</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">if</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">OS</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">=</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&#39;Centos&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">]</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">then</span></span>
<span class="line"><span style="color:#DBD7CA;">        yum -y install the_silver_searcher </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">/dev/null </span><span style="color:#CB7676;">2&gt;&amp;1</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">else</span></span>
<span class="line"><span style="color:#DBD7CA;">        apt-get -y install silversearcher-ag </span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">/dev/null </span><span style="color:#CB7676;">2&gt;&amp;1</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#4D9375;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#4D9375;">fi</span></span>
<span class="line"><span style="color:#758575;">#\u5982\u679C\u68C0\u6D4B\u522B\u7684\u65E5\u5FD7\u8BF7\u624B\u52A8\u66FF\u6362\u504F\u79FB\uFF0C\u4F8B\u5982awk\u7684$7\u4EE3\u8868url\uFF0C$9\u4EE3\u8868\u72B6\u6001\u7801\uFF0C$10\u4EE3\u8868\u957F\u5EA6,\u672C\u811A\u672C\u662F\u4EE5nginx\u65E5\u5FD7\u4E3A\u57FA\u7840</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;\u5206\u6790\u7ED3\u679C\u65E5\u5FD7\uFF1A</span><span style="color:#858585;">\${</span><span style="color:#C98A7D;">outfile</span><span style="color:#858585;">}</span><span style="color:#C98A7D;">&quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;Nginx\u65E5\u5FD7\u76EE\u5F55\uFF1A</span><span style="color:#858585;">\${</span><span style="color:#C98A7D;">access_dir</span><span style="color:#858585;">}</span><span style="color:#C98A7D;">&quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;Nginx\u6587\u4EF6\u540D\uFF1A</span><span style="color:#858585;">\${</span><span style="color:#C98A7D;">access_log</span><span style="color:#858585;">}</span><span style="color:#C98A7D;">&quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]TOP 20 IP \u5730\u5740\\e[00m&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -a -o --nofilename </span><span style="color:#C98A7D;">&#39;((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq -c </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -nr </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> head -n 20 </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/top20.log</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]SQL\u6CE8\u5165\u653B\u51FB\u5206\u6790\\e[00m&quot;</span></span>
<span class="line"><span style="color:#758575;">#\u5728SQL\u6CE8\u5165\u4E2D\u6392\u9664\u6389\u4E86\u4E00\u4E9B\u626B\u63CFcss/js/png\u56FE\u7247\u7C7B\u7B49\u65E0\u7528\u544A\u8B66\uFF0C\u5E76\u4E14\u91CD\u70B9\u7B5B\u9009\u72B6\u6001\u7801200\u6216\u8005500\u7684\u544A\u8B66</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -a </span><span style="color:#C98A7D;">&quot;xp_cmdshell|%20xor|%20and|%20AND|%20or|%20OR|select%20|%20and%201=1|%20and%201=2|%20from|%27exec|information_schema.tables|load_file|benchmark|substring|table_name|table_schema|%20where%20|%20union%20|%20UNION%20|concat\\(|concat_ws\\(|%20group%20|0x5f|0x7e|0x7c|0x27|%20limit|\\bcurrent_user\\b|%20LIMIT|version%28|version\\(|database%28|database\\(|user%28|user\\(|%20extractvalue|%updatexml|rand\\(0\\)\\*2|%20group%20by%20x|%20NULL%2C|sqlmap&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> ag -v </span><span style="color:#C98A7D;">&#39;/\\w+\\.(?:js|css|html|jpg|jpeg|png|htm|swf)(?:\\?| )&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/sql.log</span></span>
<span class="line"><span style="color:#DBD7CA;">awk </span><span style="color:#C98A7D;">&#39;{print &quot;SQL\u6CE8\u5165\u653B\u51FB&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/sql.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tail -n1</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;SQL\u6CE8\u5165 TOP 20 IP\u5730\u5740&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -o </span><span style="color:#C98A7D;">&#39;(?&lt;=:)((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/sql.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq -c </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -nr </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> head -n 20 </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/sql_top20.log</span></span>
<span class="line"><span style="color:#758575;"># \u91CD\u70B9\u5173\u6CE8from\u67E5\u8BE2\uFF0C\u662F\u5426\u5B58\u5728\u8131\u88E4\u884C\u4E3A\uFF0C\u6392\u9664\u626B\u63CF\u884C\u4E3A</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;SQL\u6CE8\u5165 FROM \u67E5\u8BE2&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">cat </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/sql.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> ag </span><span style="color:#C98A7D;">&#39;\\bfrom\\b&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> ag -v </span><span style="color:#C98A7D;">&#39;information_schema&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/sql_from_query.log</span></span>
<span class="line"><span style="color:#DBD7CA;">awk </span><span style="color:#C98A7D;">&#39;{print &quot;SQL\u6CE8\u5165FROM\u67E5\u8BE2&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/sql_from_query.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tail -n1</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]\u626B\u63CF\u5668scan &amp; \u9ED1\u5BA2\u5DE5\u5177\\e[00m&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -a </span><span style="color:#C98A7D;">&quot;acunetix|by_wvs|nikto|netsparker|HP404|nsfocus|WebCruiser|owasp|nmap|nessus|HEAD /|AppScan|burpsuite|w3af|ZAP|openVAS|.+avij|.+angolin|360webscan|webscan|XSS@HERE|XSS%40HERE|NOSEC.JSky|wwwscan|wscan|antSword|WebVulnScan|WebInspect|ltx71|masscan|python-requests|Python-urllib|WinHttpRequest&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> ag -v </span><span style="color:#C98A7D;">&#39;/\\w+\\.(?:js|css|jpg|jpeg|png|swf)(?:\\?| )&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/scan.log</span></span>
<span class="line"><span style="color:#DBD7CA;">awk </span><span style="color:#C98A7D;">&#39;{print &quot;\u5171\u68C0\u6D4B\u5230\u626B\u63CF\u653B\u51FB&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/scan.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tail -n1</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;\u626B\u63CF\u5DE5\u5177\u6D41\u91CF TOP 20&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -o </span><span style="color:#C98A7D;">&#39;(?&lt;=:)\\d+\\.\\d+\\.\\d+\\.\\d+&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/scan.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq -c </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -nr </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> head -n 20 </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/scan_top20.log</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]\u654F\u611F\u8DEF\u5F84\u8BBF\u95EE\\e[00m&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -a </span><span style="color:#C98A7D;">&quot;/_cat/|/_config/|include=|phpinfo|info\\.php|/web-console|JMXInvokerServlet|/manager/html|axis2-admin|axis2-web|phpMyAdmin|phpmyadmin|/admin-console|/jmx-console|/console/|\\.tar.gz|\\.tar|\\.tar.xz|\\.xz|\\.zip|\\.rar|\\.mdb|\\.inc|\\.sql|/\\.config\\b|\\.bak|/.svn/|/\\.git/|\\.hg|\\.DS_Store|\\.htaccess|nginx\\.conf|\\.bash_history|/CVS/|\\.bak|wwwroot|\u5907\u4EFD|/Web.config|/web.config|/1.txt|/test.txt&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/dir.log</span></span>
<span class="line"><span style="color:#DBD7CA;">awk </span><span style="color:#C98A7D;">&#39;{print &quot;\u5171\u68C0\u6D4B\u5230\u9488\u5BF9\u654F\u611F\u6587\u4EF6\u626B\u63CF&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/dir.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tail -n1</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;\u654F\u611F\u6587\u4EF6\u8BBF\u95EE\u6D41\u91CF TOP 20&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -o </span><span style="color:#C98A7D;">&#39;(?&lt;=:)\\d+\\.\\d+\\.\\d+\\.\\d+&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/dir.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq -c </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -nr </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> head -n 20 </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/dir_top20.log</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]\u6F0F\u6D1E\u5229\u7528\u68C0\u6D4B\\e[00m&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -a </span><span style="color:#C98A7D;">&quot;%00|/win.ini|/my.ini|\\.\\./\\.\\./|/etc/shadow|%0D%0A|file:/|gopher:/|dict:/|WindowsPowerShell|/wls-wsat/|call_user_func_array|uddiexplorer|@DEFAULT_MEMBER_ACCESS|@java\\.lang\\.Runtime|OgnlContext|/bin/bash|cmd\\.exe|wget\\s|curl\\s|s=/index/\\think&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/exploit.log</span></span>
<span class="line"><span style="color:#DBD7CA;">awk </span><span style="color:#C98A7D;">&#39;{print &quot;\u6F0F\u6D1E\u5229\u7528\u63A2\u6D4B&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/exploit.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tail -n1</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;\u6F0F\u6D1E\u5229\u7528\u68C0\u6D4B TOP 20&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -o </span><span style="color:#C98A7D;">&#39;(?&lt;=:)\\d+\\.\\d+\\.\\d+\\.\\d+&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/exploit.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq -c </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -nr </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> head -n 20 </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/exploit_top20.log</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]webshell\\e[00m&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -a </span><span style="color:#C98A7D;">&quot;=whoami|dbname=|exec=|cmd=|\\br57\\b|\\bc99\\b|\\bc100\\b|\\bb374k\\b|adminer.php|eval\\(|assert\\(|%eval|%execute|tunnel\\.[asp|php|jsp|aspx]{3,4}|makewebtaski|ma\\.[asp|php|jsp|aspx]{3,4}|\\bup\\.[asp|php|jsp|aspx]{3,4}|cmd\\.[asp|php|jsp|aspx]{3,4}|201\\d\\.[asp|php|jsp|aspx]{3,4}|xiaoma\\.[asp|php|jsp|aspx]{3,4}|shell\\.[asp|php|jsp|aspx]{3,4}|404\\.[asp|php|jsp|aspx]{3,4}|tom\\.[asp|php|jsp|aspx]{3,4}|k8cmd\\.[asp|php|jsp|aspx]{3,4}|ver[0-9]{3,4}\\.[asp|php|jsp|aspx]{3,4}|\\.aar|[asp|php|jsp|aspx]{3,4}spy\\.|o=vLogin|aioshell|admine|ghost\\.[asp|php|jsp|aspx]{3,4}|r00ts|90sec|t00ls|editor\\.aspx|wso\\.[asp|aspx]{3,4}&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/webshell.log</span></span>
<span class="line"><span style="color:#DBD7CA;">awk </span><span style="color:#C98A7D;">&#39;{print &quot;\u5171\u68C0\u6D4B\u5230webshell\u884C\u4E3A&quot; NR &quot;\u6B21&quot;}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/webshell.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tail -n1</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;Webshell TOP 20&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -o </span><span style="color:#C98A7D;">&#39;(?&lt;=:)\\d+\\.\\d+\\.\\d+\\.\\d+&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/webshell.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq -c </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -nr </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> head -n 20 </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/webshell_top20.log</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]HTTP Tunnel\\e[00m&quot;</span></span>
<span class="line"><span style="color:#758575;">#Regeorg\u4EE3\u7406\u7279\u5F81</span></span>
<span class="line"><span style="color:#DBD7CA;">ag -a </span><span style="color:#C98A7D;">&quot;cmd=disconnect|cmd=read|cmd=forward|cmd=connect|127.0.0.1&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/tunnel.log</span></span>
<span class="line"><span style="color:#DBD7CA;">awk </span><span style="color:#C98A7D;">&#39;{print &quot;\u5171\u68C0\u6D4B\u5230\u96A7\u9053\u884C\u4E3A&quot; NR &quot;\u6B21&quot;}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/tunnel.log </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tail -n1</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]Top 20 url\u54CD\u5E94\u957F\u5EA6\\e[00m&quot;</span></span>
<span class="line"><span style="color:#758575;"># \u67E5\u627Eurl\u54CD\u5E94\u957F\u5EA6\u6700\u957F\u7684url\u6392\u5E8F\uFF0C\u76EE\u7684\u662F\u6709\u6CA1\u6709\u4E0B\u8F7D\u670D\u52A1\u5668\u7684\u4E00\u4E9B\u6253\u5305\u6587\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CA;">len=</span><span style="color:#C98A7D;">$(cat </span><span style="color:#858585;">\${</span><span style="color:#C98A7D;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#C98A7D;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#C98A7D;"> </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;"> awk &#39;{print $10}&#39; </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;"> sort -nr </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;"> head -n 20)</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">len</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;BEGIN{ RS=&quot; &quot; }{ print $0 }&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> xargs -i{} ag -a --nocolor </span><span style="color:#C98A7D;">&#39;\\d+\\s{}\\s&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;{print $7,$10}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -k 2 -nr </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/url_rsp_len.log</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]\u7F55\u89C1\u7684\u811A\u672C\u6587\u4EF6\u8BBF\u95EE\\e[00m&quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;\u8BBF\u95EE\u91CF\u7279\u522B\u7279\u522B\u5C11\u7684\u811A\u672C\u6587\u4EF6\u6781\u6709\u53EF\u80FD\u662Fwebshell&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">cat </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;($9==200)||($9==500) {print $7}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq -c </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -n </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> ag -v </span><span style="color:#C98A7D;">&#39;\\?&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> ag </span><span style="color:#C98A7D;">&#39;\\.php|\\.jsp|\\.asp|\\.aspx&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> head -n 20 </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/rare_url.log</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\e[00;31m[+]302\u8DF3\u8F6C\\e[00m&quot;</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;\u6B64\u76EE\u7684\u662F\u5BFB\u627E\u4E00\u4E9B\u767B\u5F55\u6210\u529F\u7684\u811A\u672C\u6587\u4EF6&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">cat </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">access_dir</span><span style="color:#858585;">}\${</span><span style="color:#B8A965;">access_log</span><span style="color:#858585;">}</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> awk </span><span style="color:#C98A7D;">&#39;($9==302)||($9==301) {print $7}&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> uniq -c </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> sort -n </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> ag -v </span><span style="color:#C98A7D;">&#39;\\?&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> ag </span><span style="color:#C98A7D;">&#39;\\.php|\\.jsp|\\.asp|\\.aspx&#39;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> head -n 20 </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;"> tee -a </span><span style="color:#858585;">\${</span><span style="color:#B8A965;">outfile</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">/302_goto.log</span></span>
<span class="line"><span style="color:#E0A569;">echo</span><span style="color:#DBD7CA;"> -e </span><span style="color:#C98A7D;">&quot;\\n&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;">#!/usr/bin/env bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;&quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot; ========================================================= &quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot; \\                 Nginx\u65E5\u5FD7\u5B89\u5168\u5206\u6790\u811A\u672C V1.0            / &quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot; ========================================================= &quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot; # \u652F\u6301Nginx\u65E5\u5FD7\u5206\u6790\uFF0C\u653B\u51FB\u544A\u8B66\u5206\u6790\u7B49                    &quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot; # author\uFF1Aal0ne                    &quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot; # https://github.com/al0ne                    &quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#\u6B64\u811A\u672C\u662F\u53C2\u8003nmgxy/klionsec\u4FEE\u6539\u800C\u6765,\u91CD\u65B0\u6DFB\u52A0\u4E86\u4E00\u4E9B\u7279\u5F81\uFF0C\u53EA\u7528\u6765\u4E34\u65F6\u6551\u6025\uFF0C\u8FD8\u662F\u63A8\u8350\u5230ELK\u6216\u8005Splunk\u4E2D\u5206\u6790</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#\u529F\u80FD</span></span>
<span class="line"><span style="color:#A0ADA0;">###\u7EDF\u8BA1Top 20 \u5730\u5740</span></span>
<span class="line"><span style="color:#A0ADA0;">###SQL\u6CE8\u5165\u5206\u6790</span></span>
<span class="line"><span style="color:#A0ADA0;">###SQL\u6CE8\u5165 FROM\u67E5\u8BE2\u7EDF\u8BA1</span></span>
<span class="line"><span style="color:#A0ADA0;">###\u626B\u63CF\u5668/\u5E38\u7528\u9ED1\u5BA2\u5DE5\u5177</span></span>
<span class="line"><span style="color:#A0ADA0;">###\u6F0F\u6D1E\u5229\u7528\u68C0\u6D4B</span></span>
<span class="line"><span style="color:#A0ADA0;">###\u654F\u611F\u8DEF\u5F84\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#A0ADA0;">###\u6587\u4EF6\u5305\u542B\u653B\u51FB</span></span>
<span class="line"><span style="color:#A0ADA0;">###HTTP Tunnel</span></span>
<span class="line"><span style="color:#A0ADA0;">###Webshell</span></span>
<span class="line"><span style="color:#A0ADA0;">###\u5BFB\u627E\u54CD\u5E94\u957F\u5EA6\u7684url Top 20</span></span>
<span class="line"><span style="color:#A0ADA0;">###\u5BFB\u627E\u7F55\u89C1\u7684\u811A\u672C\u6587\u4EF6\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#A0ADA0;">###\u5BFB\u627E302\u8DF3\u8F6C\u7684\u811A\u672C\u6587\u4EF6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#\u5982\u679C\u5B58\u5728\u591A\u4E2Aaccess\u6587\u4EF6\u6216\u8005\u6709\u591A\u4E2Aaccess.x.gz \u5EFA\u8BAE\u5148zcat access*.gz &gt;&gt; access.log\u6587\u4EF6\u4E2D</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u8BBE\u7F6E\u5206\u6790\u7ED3\u679C\u5B58\u50A8\u76EE\u5F55,\u7ED3\u5C3E\u4E0D\u80FD\u52A0/</span></span>
<span class="line"><span style="color:#393A34;">outfile=/tmp/logs</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u5982\u679C\u76EE\u5F55\u4EE5\u5B58\u5728\u5219\u6E05\u7A7A\uFF0C\u672A\u5B58\u5728\u5219\u65B0\u5EFA\u76EE\u5F55</span></span>
<span class="line"><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-d</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">outfile</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">    rm -rf </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">outfile</span><span style="color:#393A34;">/</span><span style="color:#AB5959;">*</span></span>
<span class="line"><span style="color:#1C6B48;">else</span></span>
<span class="line"><span style="color:#393A34;">    mkdir -p </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">outfile</span></span>
<span class="line"><span style="color:#1C6B48;">fi</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u8BBE\u7F6Enginx\u65E5\u5FD7\u76EE\u5F55\uFF0C\u7ED3\u5C3E\u5FC5\u987B\u52A0/</span></span>
<span class="line"><span style="color:#393A34;">access_dir=/var/log/nginx/</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u8BBE\u7F6E\u6587\u4EF6\u540D\uFF0C\u5982\u679C\u6587\u4EF6\u540D\u4E3Aaccess\u90A3\u4E48\u5339\u914D\u7684\u662Faccess*\u6587\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">access_log=access</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u5224\u65AD\u65E5\u5FD7\u6587\u4EF6\u662F\u5426\u5B58\u5728</span></span>
<span class="line"><span style="color:#393A34;">num=</span><span style="color:#B56959;">$(ls </span><span style="color:#8E8F8B;">\${</span><span style="color:#B56959;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#B56959;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#B56959;"> </span><span style="color:#AB5959;">|</span><span style="color:#B56959;"> wc -l)</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">/dev/null </span><span style="color:#AB5959;">2&gt;&amp;1</span></span>
<span class="line"><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">num</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-eq</span><span style="color:#393A34;"> 0 </span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;\u65E5\u5FD7\u6587\u4EF6\u4E0D\u5B58\u5728&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">exit</span><span style="color:#393A34;"> 1</span></span>
<span class="line"><span style="color:#1C6B48;">fi</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u9A8C\u8BC1\u64CD\u4F5C\u7CFB\u7EDF\u662Fdebian\u7CFB\u8FD8\u662Fcentos</span></span>
<span class="line"><span style="color:#393A34;">OS=</span><span style="color:#B56959;">&#39;None&#39;</span></span>
<span class="line"><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-e</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;/etc/os-release&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">source</span><span style="color:#393A34;"> /etc/os-release</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">case</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">ID</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">in</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;debian&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">|</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;ubuntu&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">|</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;devuan&quot;</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">        OS=</span><span style="color:#B56959;">&#39;Debian&#39;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;centos&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">|</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;rhel fedora&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">|</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;rhel&quot;</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"><span style="color:#393A34;">        OS=</span><span style="color:#B56959;">&#39;Centos&#39;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">;;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">esac</span></span>
<span class="line"><span style="color:#1C6B48;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">OS</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">=</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;None&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> </span><span style="color:#B58451;">command</span><span style="color:#393A34;"> -v apt-get </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">/dev/null </span><span style="color:#AB5959;">2&gt;&amp;1;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">        OS=</span><span style="color:#B56959;">&#39;Debian&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">elif</span><span style="color:#393A34;"> </span><span style="color:#B58451;">command</span><span style="color:#393A34;"> -v yum </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">/dev/null </span><span style="color:#AB5959;">2&gt;&amp;1;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">        OS=</span><span style="color:#B56959;">&#39;Centos&#39;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">else</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n\u4E0D\u652F\u6301\u8FD9\u4E2A\u7CFB\u7EDF\\n&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\u5DF2\u9000\u51FA&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#B58451;">exit</span><span style="color:#393A34;"> 1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">fi</span></span>
<span class="line"><span style="color:#1C6B48;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u68C0\u6D4Bag\u8F6F\u4EF6\u6709\u6CA1\u6709\u5B89\u88C5</span></span>
<span class="line"><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> ag -V </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">/dev/null </span><span style="color:#AB5959;">2&gt;&amp;1;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;32msilversearcher-ag\u5DF2\u5B89\u88C5 \\e[00m&quot;</span></span>
<span class="line"><span style="color:#1C6B48;">else</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">if</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">OS</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">=</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&#39;Centos&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">then</span></span>
<span class="line"><span style="color:#393A34;">        yum -y install the_silver_searcher </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">/dev/null </span><span style="color:#AB5959;">2&gt;&amp;1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">else</span></span>
<span class="line"><span style="color:#393A34;">        apt-get -y install silversearcher-ag </span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">/dev/null </span><span style="color:#AB5959;">2&gt;&amp;1</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#1C6B48;">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1C6B48;">fi</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u5982\u679C\u68C0\u6D4B\u522B\u7684\u65E5\u5FD7\u8BF7\u624B\u52A8\u66FF\u6362\u504F\u79FB\uFF0C\u4F8B\u5982awk\u7684$7\u4EE3\u8868url\uFF0C$9\u4EE3\u8868\u72B6\u6001\u7801\uFF0C$10\u4EE3\u8868\u957F\u5EA6,\u672C\u811A\u672C\u662F\u4EE5nginx\u65E5\u5FD7\u4E3A\u57FA\u7840</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;\u5206\u6790\u7ED3\u679C\u65E5\u5FD7\uFF1A</span><span style="color:#8E8F8B;">\${</span><span style="color:#B56959;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#B56959;">&quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;Nginx\u65E5\u5FD7\u76EE\u5F55\uFF1A</span><span style="color:#8E8F8B;">\${</span><span style="color:#B56959;">access_dir</span><span style="color:#8E8F8B;">}</span><span style="color:#B56959;">&quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;Nginx\u6587\u4EF6\u540D\uFF1A</span><span style="color:#8E8F8B;">\${</span><span style="color:#B56959;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#B56959;">&quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]TOP 20 IP \u5730\u5740\\e[00m&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -a -o --nofilename </span><span style="color:#B56959;">&#39;((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq -c </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -nr </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> head -n 20 </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/top20.log</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]SQL\u6CE8\u5165\u653B\u51FB\u5206\u6790\\e[00m&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u5728SQL\u6CE8\u5165\u4E2D\u6392\u9664\u6389\u4E86\u4E00\u4E9B\u626B\u63CFcss/js/png\u56FE\u7247\u7C7B\u7B49\u65E0\u7528\u544A\u8B66\uFF0C\u5E76\u4E14\u91CD\u70B9\u7B5B\u9009\u72B6\u6001\u7801200\u6216\u8005500\u7684\u544A\u8B66</span></span>
<span class="line"><span style="color:#393A34;">ag -a </span><span style="color:#B56959;">&quot;xp_cmdshell|%20xor|%20and|%20AND|%20or|%20OR|select%20|%20and%201=1|%20and%201=2|%20from|%27exec|information_schema.tables|load_file|benchmark|substring|table_name|table_schema|%20where%20|%20union%20|%20UNION%20|concat\\(|concat_ws\\(|%20group%20|0x5f|0x7e|0x7c|0x27|%20limit|\\bcurrent_user\\b|%20LIMIT|version%28|version\\(|database%28|database\\(|user%28|user\\(|%20extractvalue|%updatexml|rand\\(0\\)\\*2|%20group%20by%20x|%20NULL%2C|sqlmap&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> ag -v </span><span style="color:#B56959;">&#39;/\\w+\\.(?:js|css|html|jpg|jpeg|png|htm|swf)(?:\\?| )&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/sql.log</span></span>
<span class="line"><span style="color:#393A34;">awk </span><span style="color:#B56959;">&#39;{print &quot;SQL\u6CE8\u5165\u653B\u51FB&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/sql.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tail -n1</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;SQL\u6CE8\u5165 TOP 20 IP\u5730\u5740&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -o </span><span style="color:#B56959;">&#39;(?&lt;=:)((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})(\\.((2(5[0-5]|[0-4]\\d))|[0-1]?\\d{1,2})){3}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/sql.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq -c </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -nr </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> head -n 20 </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/sql_top20.log</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u91CD\u70B9\u5173\u6CE8from\u67E5\u8BE2\uFF0C\u662F\u5426\u5B58\u5728\u8131\u88E4\u884C\u4E3A\uFF0C\u6392\u9664\u626B\u63CF\u884C\u4E3A</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;SQL\u6CE8\u5165 FROM \u67E5\u8BE2&quot;</span></span>
<span class="line"><span style="color:#393A34;">cat </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/sql.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> ag </span><span style="color:#B56959;">&#39;\\bfrom\\b&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> ag -v </span><span style="color:#B56959;">&#39;information_schema&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/sql_from_query.log</span></span>
<span class="line"><span style="color:#393A34;">awk </span><span style="color:#B56959;">&#39;{print &quot;SQL\u6CE8\u5165FROM\u67E5\u8BE2&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/sql_from_query.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tail -n1</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]\u626B\u63CF\u5668scan &amp; \u9ED1\u5BA2\u5DE5\u5177\\e[00m&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -a </span><span style="color:#B56959;">&quot;acunetix|by_wvs|nikto|netsparker|HP404|nsfocus|WebCruiser|owasp|nmap|nessus|HEAD /|AppScan|burpsuite|w3af|ZAP|openVAS|.+avij|.+angolin|360webscan|webscan|XSS@HERE|XSS%40HERE|NOSEC.JSky|wwwscan|wscan|antSword|WebVulnScan|WebInspect|ltx71|masscan|python-requests|Python-urllib|WinHttpRequest&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> ag -v </span><span style="color:#B56959;">&#39;/\\w+\\.(?:js|css|jpg|jpeg|png|swf)(?:\\?| )&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/scan.log</span></span>
<span class="line"><span style="color:#393A34;">awk </span><span style="color:#B56959;">&#39;{print &quot;\u5171\u68C0\u6D4B\u5230\u626B\u63CF\u653B\u51FB&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/scan.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tail -n1</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;\u626B\u63CF\u5DE5\u5177\u6D41\u91CF TOP 20&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -o </span><span style="color:#B56959;">&#39;(?&lt;=:)\\d+\\.\\d+\\.\\d+\\.\\d+&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/scan.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq -c </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -nr </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> head -n 20 </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/scan_top20.log</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]\u654F\u611F\u8DEF\u5F84\u8BBF\u95EE\\e[00m&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -a </span><span style="color:#B56959;">&quot;/_cat/|/_config/|include=|phpinfo|info\\.php|/web-console|JMXInvokerServlet|/manager/html|axis2-admin|axis2-web|phpMyAdmin|phpmyadmin|/admin-console|/jmx-console|/console/|\\.tar.gz|\\.tar|\\.tar.xz|\\.xz|\\.zip|\\.rar|\\.mdb|\\.inc|\\.sql|/\\.config\\b|\\.bak|/.svn/|/\\.git/|\\.hg|\\.DS_Store|\\.htaccess|nginx\\.conf|\\.bash_history|/CVS/|\\.bak|wwwroot|\u5907\u4EFD|/Web.config|/web.config|/1.txt|/test.txt&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/dir.log</span></span>
<span class="line"><span style="color:#393A34;">awk </span><span style="color:#B56959;">&#39;{print &quot;\u5171\u68C0\u6D4B\u5230\u9488\u5BF9\u654F\u611F\u6587\u4EF6\u626B\u63CF&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/dir.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tail -n1</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;\u654F\u611F\u6587\u4EF6\u8BBF\u95EE\u6D41\u91CF TOP 20&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -o </span><span style="color:#B56959;">&#39;(?&lt;=:)\\d+\\.\\d+\\.\\d+\\.\\d+&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/dir.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq -c </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -nr </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> head -n 20 </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/dir_top20.log</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]\u6F0F\u6D1E\u5229\u7528\u68C0\u6D4B\\e[00m&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -a </span><span style="color:#B56959;">&quot;%00|/win.ini|/my.ini|\\.\\./\\.\\./|/etc/shadow|%0D%0A|file:/|gopher:/|dict:/|WindowsPowerShell|/wls-wsat/|call_user_func_array|uddiexplorer|@DEFAULT_MEMBER_ACCESS|@java\\.lang\\.Runtime|OgnlContext|/bin/bash|cmd\\.exe|wget\\s|curl\\s|s=/index/\\think&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/exploit.log</span></span>
<span class="line"><span style="color:#393A34;">awk </span><span style="color:#B56959;">&#39;{print &quot;\u6F0F\u6D1E\u5229\u7528\u63A2\u6D4B&quot; NR&quot;\u6B21&quot;}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/exploit.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tail -n1</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;\u6F0F\u6D1E\u5229\u7528\u68C0\u6D4B TOP 20&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -o </span><span style="color:#B56959;">&#39;(?&lt;=:)\\d+\\.\\d+\\.\\d+\\.\\d+&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/exploit.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq -c </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -nr </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> head -n 20 </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/exploit_top20.log</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]webshell\\e[00m&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -a </span><span style="color:#B56959;">&quot;=whoami|dbname=|exec=|cmd=|\\br57\\b|\\bc99\\b|\\bc100\\b|\\bb374k\\b|adminer.php|eval\\(|assert\\(|%eval|%execute|tunnel\\.[asp|php|jsp|aspx]{3,4}|makewebtaski|ma\\.[asp|php|jsp|aspx]{3,4}|\\bup\\.[asp|php|jsp|aspx]{3,4}|cmd\\.[asp|php|jsp|aspx]{3,4}|201\\d\\.[asp|php|jsp|aspx]{3,4}|xiaoma\\.[asp|php|jsp|aspx]{3,4}|shell\\.[asp|php|jsp|aspx]{3,4}|404\\.[asp|php|jsp|aspx]{3,4}|tom\\.[asp|php|jsp|aspx]{3,4}|k8cmd\\.[asp|php|jsp|aspx]{3,4}|ver[0-9]{3,4}\\.[asp|php|jsp|aspx]{3,4}|\\.aar|[asp|php|jsp|aspx]{3,4}spy\\.|o=vLogin|aioshell|admine|ghost\\.[asp|php|jsp|aspx]{3,4}|r00ts|90sec|t00ls|editor\\.aspx|wso\\.[asp|aspx]{3,4}&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/webshell.log</span></span>
<span class="line"><span style="color:#393A34;">awk </span><span style="color:#B56959;">&#39;{print &quot;\u5171\u68C0\u6D4B\u5230webshell\u884C\u4E3A&quot; NR &quot;\u6B21&quot;}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/webshell.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tail -n1</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;Webshell TOP 20&quot;</span></span>
<span class="line"><span style="color:#393A34;">ag -o </span><span style="color:#B56959;">&#39;(?&lt;=:)\\d+\\.\\d+\\.\\d+\\.\\d+&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/webshell.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq -c </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -nr </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> head -n 20 </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/webshell_top20.log</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]HTTP Tunnel\\e[00m&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;">#Regeorg\u4EE3\u7406\u7279\u5F81</span></span>
<span class="line"><span style="color:#393A34;">ag -a </span><span style="color:#B56959;">&quot;cmd=disconnect|cmd=read|cmd=forward|cmd=connect|127.0.0.1&quot;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;($9==200)||($9==500) {print $0}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/tunnel.log</span></span>
<span class="line"><span style="color:#393A34;">awk </span><span style="color:#B56959;">&#39;{print &quot;\u5171\u68C0\u6D4B\u5230\u96A7\u9053\u884C\u4E3A&quot; NR &quot;\u6B21&quot;}&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/tunnel.log </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tail -n1</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]Top 20 url\u54CD\u5E94\u957F\u5EA6\\e[00m&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u67E5\u627Eurl\u54CD\u5E94\u957F\u5EA6\u6700\u957F\u7684url\u6392\u5E8F\uFF0C\u76EE\u7684\u662F\u6709\u6CA1\u6709\u4E0B\u8F7D\u670D\u52A1\u5668\u7684\u4E00\u4E9B\u6253\u5305\u6587\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">len=</span><span style="color:#B56959;">$(cat </span><span style="color:#8E8F8B;">\${</span><span style="color:#B56959;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#B56959;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#B56959;"> </span><span style="color:#AB5959;">|</span><span style="color:#B56959;"> awk &#39;{print $10}&#39; </span><span style="color:#AB5959;">|</span><span style="color:#B56959;"> sort -nr </span><span style="color:#AB5959;">|</span><span style="color:#B56959;"> head -n 20)</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">len</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;BEGIN{ RS=&quot; &quot; }{ print $0 }&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> xargs -i{} ag -a --nocolor </span><span style="color:#B56959;">&#39;\\d+\\s{}\\s&#39;</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;{print $7,$10}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -k 2 -nr </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/url_rsp_len.log</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]\u7F55\u89C1\u7684\u811A\u672C\u6587\u4EF6\u8BBF\u95EE\\e[00m&quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;\u8BBF\u95EE\u91CF\u7279\u522B\u7279\u522B\u5C11\u7684\u811A\u672C\u6587\u4EF6\u6781\u6709\u53EF\u80FD\u662Fwebshell&quot;</span></span>
<span class="line"><span style="color:#393A34;">cat </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;($9==200)||($9==500) {print $7}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq -c </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -n </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> ag -v </span><span style="color:#B56959;">&#39;\\?&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> ag </span><span style="color:#B56959;">&#39;\\.php|\\.jsp|\\.asp|\\.aspx&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> head -n 20 </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/rare_url.log</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\e[00;31m[+]302\u8DF3\u8F6C\\e[00m&quot;</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;\u6B64\u76EE\u7684\u662F\u5BFB\u627E\u4E00\u4E9B\u767B\u5F55\u6210\u529F\u7684\u811A\u672C\u6587\u4EF6&quot;</span></span>
<span class="line"><span style="color:#393A34;">cat </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">access_dir</span><span style="color:#8E8F8B;">}\${</span><span style="color:#8C862B;">access_log</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">*</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> awk </span><span style="color:#B56959;">&#39;($9==302)||($9==301) {print $7}&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> uniq -c </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> sort -n </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> ag -v </span><span style="color:#B56959;">&#39;\\?&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> ag </span><span style="color:#B56959;">&#39;\\.php|\\.jsp|\\.asp|\\.aspx&#39;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> head -n 20 </span><span style="color:#AB5959;">|</span><span style="color:#393A34;"> tee -a </span><span style="color:#8E8F8B;">\${</span><span style="color:#8C862B;">outfile</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">/302_goto.log</span></span>
<span class="line"><span style="color:#B58451;">echo</span><span style="color:#393A34;"> -e </span><span style="color:#B56959;">&quot;\\n&quot;</span></span>
<span class="line"></span></code></pre></div><blockquote><p>\u8BE5\u811A\u672C\u6765\u6E90\u4E8E\uFF1A<a href="https://github.com/al0ne/nginx_log_check" target="_blank" rel="noopener noreferrer">https://github.com/al0ne/nginx_log_check</a></p></blockquote>`,9),e=[o];function t(c,r,y,A,B,D){return n(),a("div",null,e)}var u=s(p,[["render",t]]);export{C as __pageData,u as default};
