import{_ as s,o as a,c as e,a as n}from"./app.1e6146c3.js";const h=JSON.parse('{"title":"\u5341\u4E94 dashboard","description":"","frontmatter":{},"headers":[{"level":2,"title":"15.1 \u90E8\u7F72\u6D41\u7A0B","slug":"_15-1-\u90E8\u7F72\u6D41\u7A0B"},{"level":2,"title":"15.2 \u4F7F\u7528\u4EE4\u724C\u767B\u5F55","slug":"_15-2-\u4F7F\u7528\u4EE4\u724C\u767B\u5F55"},{"level":2,"title":"15.3 \u5206\u7EA7\u7BA1\u7406","slug":"_15-3-\u5206\u7EA7\u7BA1\u7406"},{"level":2,"title":"15.4 \u914D\u7F6E\u6587\u4EF6\u8BA4\u8BC1","slug":"_15-4-\u914D\u7F6E\u6587\u4EF6\u8BA4\u8BC1"}],"relativePath":"CloudNative/k8s/Quicklystart/\u5341\u4E94 dashboard.md","lastUpdated":1657272051000}'),l={name:"CloudNative/k8s/Quicklystart/\u5341\u4E94 dashboard.md"},c=n(`<h1 id="\u5341\u4E94-dashboard" tabindex="-1">\u5341\u4E94 dashboard <a class="header-anchor" href="#\u5341\u4E94-dashboard" aria-hidden="true">#</a></h1><p>\u5B83\u4F5C\u4E3A k8s \u96C6\u7FA4\u7684\u9644\u4EF6\u5B58\u5728\uFF0C\u662F kubernetes \u5B98\u65B9\u7684\u9879\u76EE\u4E4B\u4E00\uFF0C\u8BE6\u89C1\uFF1A<a href="https://github.com/kubernetes/dashboard" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/dashboard</a></p><h2 id="_15-1-\u90E8\u7F72\u6D41\u7A0B" tabindex="-1">15.1 \u90E8\u7F72\u6D41\u7A0B <a class="header-anchor" href="#_15-1-\u90E8\u7F72\u6D41\u7A0B" aria-hidden="true">#</a></h2><ul><li>\u4E3A dashboard \u63D0\u4F9B ssl \u8BC1\u4E66</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># \u751F\u6210\u79C1\u94A5</span></span>
<span class="line"><span style="color:#858585;">(</span><span style="color:#DBD7CA;">umask 077</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> openssl genrsa -out dashboard.key 2048</span><span style="color:#858585;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u751F\u6210\u4E00\u4E2A\u81EA\u7B7E\u8BC1\u4E66\uFF0C\u6CE8\u610F CN \u7684\u503C\u5FC5\u987B\u8981\u4E0E\u81EA\u5DF1\u7684\u57DF\u540D\u5B8C\u5168\u4E00\u81F4</span></span>
<span class="line"><span style="color:#DBD7CA;">openssl req -new -x509 -key dashboard.key -out dashboard.crt -subj </span><span style="color:#C98A7D;">&quot;/O=dashboard/CN=k8s.dashboard.com&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u67E5\u770B\u8BC1\u4E66</span></span>
<span class="line"><span style="color:#DBD7CA;">openssl x509 -in dashboard.crt -text -noout</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u751F\u6210\u79C1\u94A5</span></span>
<span class="line"><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">umask 077</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> openssl genrsa -out dashboard.key 2048</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u751F\u6210\u4E00\u4E2A\u81EA\u7B7E\u8BC1\u4E66\uFF0C\u6CE8\u610F CN \u7684\u503C\u5FC5\u987B\u8981\u4E0E\u81EA\u5DF1\u7684\u57DF\u540D\u5B8C\u5168\u4E00\u81F4</span></span>
<span class="line"><span style="color:#393A34;">openssl req -new -x509 -key dashboard.key -out dashboard.crt -subj </span><span style="color:#B56959;">&quot;/O=dashboard/CN=k8s.dashboard.com&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u67E5\u770B\u8BC1\u4E66</span></span>
<span class="line"><span style="color:#393A34;">openssl x509 -in dashboard.crt -text -noout</span></span>
<span class="line"></span></code></pre></div><ul><li>\u4E0B\u8F7D dashboard \u7684\u6E05\u5355\u6587\u4EF6</li></ul><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">wget https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">wget https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml</span></span>
<span class="line"></span></code></pre></div><ul><li>\u4E3A dashboard \u521B\u5EFA secret \u5BF9\u8C61</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl -n kube-system create secret generic kubernetes-dashboard-certs --from-file=dashboard.crt=./dashboard.crt --from-file=dashboard.key=./dashboard.key</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl -n kube-system create secret generic kubernetes-dashboard-certs --from-file=dashboard.crt=./dashboard.crt --from-file=dashboard.key=./dashboard.key</span></span>
<span class="line"></span></code></pre></div><ul><li>\u4FEE\u6539 dashboard \u6E05\u5355\u4E2D service \u7684\u5DE5\u4F5C\u6A21\u5F0F\u4E3A nodeport</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">sed -i </span><span style="color:#C98A7D;">&#39;/targetPort: 8443/a\\ \\ type: NodePort&#39;</span><span style="color:#DBD7CA;"> kubernetes-dashboard.yaml</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">sed -i </span><span style="color:#B56959;">&#39;/targetPort: 8443/a\\ \\ type: NodePort&#39;</span><span style="color:#393A34;"> kubernetes-dashboard.yaml</span></span>
<span class="line"></span></code></pre></div><ul><li>\u6CE8\u91CA\u6389 kubernetes-dashboard.yaml \u6E05\u5355\u6587\u4EF6\u4E2D\u7684 Dashboard Secret \u8FD9\u4E2A\u8BC1\u4E66\u7684\u6E05\u5355\u5B9A\u4E49</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># ------------------- Dashboard Secret ------------------- #</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#apiVersion: v1</span></span>
<span class="line"><span style="color:#758575;">#kind: Secret</span></span>
<span class="line"><span style="color:#758575;">#metadata:</span></span>
<span class="line"><span style="color:#758575;">#  labels:</span></span>
<span class="line"><span style="color:#758575;">#    k8s-app: kubernetes-dashboard</span></span>
<span class="line"><span style="color:#758575;">#  name: kubernetes-dashboard-certs</span></span>
<span class="line"><span style="color:#758575;">#  namespace: kube-system</span></span>
<span class="line"><span style="color:#758575;">#type: Opaque</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;">#---</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># ------------------- Dashboard Secret ------------------- #</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#apiVersion: v1</span></span>
<span class="line"><span style="color:#A0ADA0;">#kind: Secret</span></span>
<span class="line"><span style="color:#A0ADA0;">#metadata:</span></span>
<span class="line"><span style="color:#A0ADA0;">#  labels:</span></span>
<span class="line"><span style="color:#A0ADA0;">#    k8s-app: kubernetes-dashboard</span></span>
<span class="line"><span style="color:#A0ADA0;">#  name: kubernetes-dashboard-certs</span></span>
<span class="line"><span style="color:#A0ADA0;">#  namespace: kube-system</span></span>
<span class="line"><span style="color:#A0ADA0;">#type: Opaque</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;">#---</span></span>
<span class="line"></span></code></pre></div><ul><li>\u90E8\u7F72 dashboard \u6E05\u5355</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl apply -f kubernetes-dashboard.yaml</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl apply -f kubernetes-dashboard.yaml</span></span>
<span class="line"></span></code></pre></div><ul><li>\u53D6\u5F97 service \u8FD0\u884C\u7684\u7AEF\u53E3</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl get service -n kube-system</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl get service -n kube-system</span></span>
<span class="line"></span></code></pre></div><ul><li>\u4F7F\u7528 chrome \u8BBF\u95EE dashboard</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">https://172.16.100.102:31097/</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">https://172.16.100.102:31097/</span></span>
<span class="line"></span></code></pre></div><h2 id="_15-2-\u4F7F\u7528\u4EE4\u724C\u767B\u5F55" tabindex="-1">15.2 \u4F7F\u7528\u4EE4\u724C\u767B\u5F55 <a class="header-anchor" href="#_15-2-\u4F7F\u7528\u4EE4\u724C\u767B\u5F55" aria-hidden="true">#</a></h2><ul><li>\u4E3A POD \u521B\u5EFA\u4E00\u4E2A serviceaccount \u5BF9\u8C61\uFF0C\u5B83\u662F POD \u8BBF\u95EE apiserver \u7684\u51ED\u8BC1</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl create serviceaccount dashborad-admin -n kube-system</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl create serviceaccount dashborad-admin -n kube-system</span></span>
<span class="line"></span></code></pre></div><ul><li>\u521B\u5EFA clusterrolebinding \u5C06\u7528\u6237\u7ED1\u5B9A\u81F3 cluster-admin \u96C6\u7FA4\u7BA1\u7406\u5458\uFF08\u6700\u9AD8\u6743\u9650\uFF09</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl create clusterrolebinding dashborad-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashborad-admin</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl create clusterrolebinding dashborad-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashborad-admin</span></span>
<span class="line"></span></code></pre></div><ul><li>\u627E\u5230\u521A\u624D\u521B\u5EFA\u7684 serviceaccount \u5BF9\u8C61</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl get secret -n kube-system</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl get secret -n kube-system</span></span>
<span class="line"></span></code></pre></div><ul><li>\u5F97\u5230 serviceaccount \u5BF9\u8C61\u4E2D\u7684 Token</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl describe secret -n kube-system dashborad-admin</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl describe secret -n kube-system dashborad-admin</span></span>
<span class="line"></span></code></pre></div><h2 id="_15-3-\u5206\u7EA7\u7BA1\u7406" tabindex="-1">15.3 \u5206\u7EA7\u7BA1\u7406 <a class="header-anchor" href="#_15-3-\u5206\u7EA7\u7BA1\u7406" aria-hidden="true">#</a></h2><p>\u73B0\u5728\u9700\u8981\u521B\u5EFA\u4E00\u4E2A\u53EA\u80FD\u7BA1\u7406 default \u540D\u79F0\u7A7A\u95F4\u7684\u7528\u6237\uFF0C\u90A3\u4E48\u6211\u4EEC\u53EF\u4EE5\u7528 rolebinding \u53BB\u7ED1\u5B9A admin \u8FD9\u4E2A clusterrolue \u5BF9\u8C61\uFF0C\u90A3\u4E48\u5C31\u83B7\u5F97\u4E86\u5F53\u524D\u540D\u79F0\u7A7A\u95F4\u7684\u7BA1\u7406\u5458\u6743\u9650\u4E86\u3002</p><ul><li>\u521B\u5EFA serviceaccount \u767B\u5F55</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl create serviceaccount def-ns-admin -n default</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl create serviceaccount def-ns-admin -n default</span></span>
<span class="line"></span></code></pre></div><ul><li>\u4F7F\u7528 rolebinding \u5BF9\u8C61\uFF0C\u5C06 default \u540D\u79F0\u7A7A\u95F4\u7684 def-ns-admin \u8FD9\u4E2A serviceaccunt \u4E0E admin \u8FD9\u4E2A clusterrole \u7ED1\u5B9A</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl create rolebinding def-ns-admin --clusterrole=admin --serviceaccount=default:def-ns-admin</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl create rolebinding def-ns-admin --clusterrole=admin --serviceaccount=default:def-ns-admin</span></span>
<span class="line"></span></code></pre></div><ul><li>\u627E\u5230\u521A\u624D\u521B\u5EFA\u7684 serviceaccount \u5BF9\u8C61</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl get secret -n kube-system</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl get secret -n kube-system</span></span>
<span class="line"></span></code></pre></div><ul><li>\u5F97\u5230 serviceaccount \u5BF9\u8C61\u4E2D\u7684 Token</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl describe secret def-ns-admin</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl describe secret def-ns-admin</span></span>
<span class="line"></span></code></pre></div><h2 id="_15-4-\u914D\u7F6E\u6587\u4EF6\u8BA4\u8BC1" tabindex="-1">15.4 \u914D\u7F6E\u6587\u4EF6\u8BA4\u8BC1 <a class="header-anchor" href="#_15-4-\u914D\u7F6E\u6587\u4EF6\u8BA4\u8BC1" aria-hidden="true">#</a></h2><p>\u4E0E\u4E4B\u524D\u57FA\u4E8E SSL \u8BC1\u4E66\u7684 config \u6587\u4EF6\u4E0D\u540C\uFF0C\u8FD9\u6B21\u4F7F\u7528\u662F\u57FA\u4E8E Token \u7684 config \u6587\u4EF6\uFF0C\u53EF\u4EE5\u4E0D\u7528\u521B\u5EFA\u8BC1\u4E66\u4E86\uFF0C\u4F7F\u7528\u5DF2\u6709\u7684 serviceaccount \u5BF9\u8C61\u7684 token\u3002</p><ul><li>\u8BBE\u7F6E\u96C6\u7FA4\u7684\u8FDE\u63A5\u7684 ca \u673A\u6784\u8BC1\u4E66\uFF0C--kubeconfig \u53EF\u4EE5\u6307\u5B9A kubectl \u4F7F\u7528\u7684\u914D\u7F6E\u6587\u4EF6\u4F4D\u7F6E\uFF0C\u9ED8\u8BA4\u4E3A\u7528\u6237\u5BB6\u76EE\u5F55 .kube \u76EE\u5F55\u4E2D\u7684 config</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-cluster k8s-cluster --server=https://172.16.100.101:6443 --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true --kubeconfig=/tmp/test.conf </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-cluster k8s-cluster --server=https://172.16.100.101:6443 --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true --kubeconfig=/tmp/test.conf </span></span>
<span class="line"></span></code></pre></div><ul><li>\u53D6\u5F97\u4E00\u4E2A\u5DF2\u7ECF\u7ED1\u5B9A\u89D2\u8272\u7684 serviceaccount \u5BF9\u8C61\u7684 Token</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl describe secret def-ns-admin</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl describe secret def-ns-admin</span></span>
<span class="line"></span></code></pre></div><ul><li>\u4F7F\u7528 Token \u6765\u521B\u5EFA\u914D\u7F6E\u6587\u4EF6\u4E2D\u7684\u7528\u6237</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-credentials def-ns-admin --token=</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">TOKEN</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;"> --kubeconfig=/tmp/test.conf</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-credentials def-ns-admin --token=</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">TOKEN</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;"> --kubeconfig=/tmp/test.conf</span></span>
<span class="line"></span></code></pre></div><ul><li>\u521B\u5EFA\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u6388\u6743 kaliarch \u7528\u6237\u8BBF\u95EE\u540D\u79F0\u4E3A kubernetes \u7684\u96C6\u7FA4</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-context def-ns-admin@k8s-cluster --cluster=k8s-cluster --user=def-ns-admin --kubeconfig=/tmp/test.conf</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-context def-ns-admin@k8s-cluster --cluster=k8s-cluster --user=def-ns-admin --kubeconfig=/tmp/test.conf</span></span>
<span class="line"></span></code></pre></div><ul><li>\u5207\u6362\u5F53\u524D\u4F7F\u7528\u7684\u4E0A\u4E0B\u6587\uFF0C\u5230\u6388\u6743 kaliarch \u5230 kubernetes \u7684\u4E0A\u4E0B\u6587\u4E0A</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config use-context def-ns-admin@k8s-cluster --kubeconfig=/tmp/test.conf</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config use-context def-ns-admin@k8s-cluster --kubeconfig=/tmp/test.conf</span></span>
<span class="line"></span></code></pre></div><ul><li>\u590D\u5236 /tmp/test.conf \u8FD9\u4E2A\u6587\u4EF6\u5230 dashboard \u4E2D\u5C31\u53EF\u4EE5\u767B\u5F55\u4E86</li></ul>`,51),p=[c];function o(r,t,d,i,u,b){return a(),e("div",null,p)}var k=s(l,[["render",o]]);export{h as __pageData,k as default};
