import{_ as s,o as n,c as a,a as l}from"./app.1e6146c3.js";const C=JSON.parse('{"title":"1.EFK\u5DE5\u4F5C\u539F\u7406","description":"","frontmatter":{},"headers":[{"level":2,"title":"1.EFK\u5DE5\u4F5C\u539F\u7406","slug":"_1-efk\u5DE5\u4F5C\u539F\u7406"},{"level":2,"title":"2.\u90E8\u7F72EFK\u5E73\u53F0","slug":"_2-\u90E8\u7F72efk\u5E73\u53F0"},{"level":3,"title":"2.1.\u90E8\u7F72nfs","slug":"_2-1-\u90E8\u7F72nfs"},{"level":3,"title":"2.2.\u90E8\u7F72elasticsearch","slug":"_2-2-\u90E8\u7F72elasticsearch"},{"level":3,"title":"2.3.\u90E8\u7F72kibana","slug":"_2-3-\u90E8\u7F72kibana"},{"level":3,"title":"2.4.\u90E8\u7F72fluentd","slug":"_2-4-\u90E8\u7F72fluentd"},{"level":3,"title":"2.5.\u67E5\u770Befk\u6240\u6709\u7EC4\u4EF6\u8D44\u6E90\u72B6\u6001","slug":"_2-5-\u67E5\u770Befk\u6240\u6709\u7EC4\u4EF6\u8D44\u6E90\u72B6\u6001"},{"level":3,"title":"2.6.\u5C06es\u914D\u7F6E\u4E00\u4E2Anodeport\u7528\u4E8E\u67E5\u770B\u7D22\u5F15","slug":"_2-6-\u5C06es\u914D\u7F6E\u4E00\u4E2Anodeport\u7528\u4E8E\u67E5\u770B\u7D22\u5F15"},{"level":2,"title":"3.\u9A8C\u8BC1EFK\u96C6\u7FA4\u53EF\u7528\u6027","slug":"_3-\u9A8C\u8BC1efk\u96C6\u7FA4\u53EF\u7528\u6027"},{"level":3,"title":"3.1.\u8FD0\u884C\u4E00\u4E2Apod\u6301\u7EED\u4EA7\u751F\u65E5\u5FD7","slug":"_3-1-\u8FD0\u884C\u4E00\u4E2Apod\u6301\u7EED\u4EA7\u751F\u65E5\u5FD7"},{"level":3,"title":"3.2.\u89C2\u5BDFfluentd\u65E5\u5FD7\u8F93\u51FA","slug":"_3-2-\u89C2\u5BDFfluentd\u65E5\u5FD7\u8F93\u51FA"},{"level":3,"title":"3.3.\u89C2\u5BDFes\u4E0A\u7684\u7D22\u5F15\u53D8\u5316","slug":"_3-3-\u89C2\u5BDFes\u4E0A\u7684\u7D22\u5F15\u53D8\u5316"},{"level":3,"title":"3.4.\u5728kibana\u4E0A\u5173\u8054es\u7D22\u5F15\u5E93","slug":"_3-4-\u5728kibana\u4E0A\u5173\u8054es\u7D22\u5F15\u5E93"},{"level":3,"title":"3.5.\u67E5\u770B\u65E5\u5FD7\u6536\u96C6\u7684\u7EDF\u8BA1\u56FE","slug":"_3-5-\u67E5\u770B\u65E5\u5FD7\u6536\u96C6\u7684\u7EDF\u8BA1\u56FE"}],"relativePath":"CloudNative/k8s/\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F.md","lastUpdated":1657272051000}'),p={name:"CloudNative/k8s/\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F.md"},o=l(`<h2 id="_1-efk\u5DE5\u4F5C\u539F\u7406" tabindex="-1">1.EFK\u5DE5\u4F5C\u539F\u7406 <a class="header-anchor" href="#_1-efk\u5DE5\u4F5C\u539F\u7406" aria-hidden="true">#</a></h2><blockquote><p>EFK\u5176\u5B9E\u548CELK\u5DEE\u4E0D\u591A\uFF0C\u53EA\u4E0D\u8FC7EFK\u662Fk8s\u4E13\u95E8\u7684\u65E5\u5FD7\u6536\u96C6\u5E73\u53F0\uFF0C\u5176\u4E2D\u7684F\u662Ffluentd</p><p>\u9996\u5148\u901A\u8FC7fluentd\u6536\u96C6\u7A0B\u5E8F\u7684\u65E5\u5FD7\uFF0C\u7136\u540E\u5C06\u65E5\u5FD7\u5B58\u50A8\u5230elasticsearch\u96C6\u7FA4\uFF0C\u6700\u540E\u5728kibana\u4E0A\u5173\u8054elasticsearch\uFF0C\u5B9E\u73B0\u65E5\u5FD7\u7684\u67E5\u8BE2\u3002 <img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044814_620c118edfe6953900.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_docker"></p></blockquote><ul><li>Elasticsearch <ul><li>\u4E00\u4E2A\u5F00\u6E90\u7684\u5206\u5E03\u5F0F\u3001Restful \u98CE\u683C\u7684\u641C\u7D22\u548C\u6570\u636E\u5206\u6790\u5F15\u64CE\uFF0C\u5B83\u7684\u5E95\u5C42\u662F\u5F00\u6E90\u5E93Apache Lucene\u3002</li><li>\u4E00\u4E2A\u5206\u5E03\u5F0F\u7684\u5B9E\u65F6\u6587\u6863\u5B58\u50A8\uFF0C\u6BCF\u4E2A\u5B57\u6BB5\u53EF\u4EE5\u88AB\u7D22\u5F15\u4E0E\u641C\u7D22\uFF1B</li><li>\u4E00\u4E2A\u5206\u5E03\u5F0F\u5B9E\u65F6\u5206\u6790\u641C\u7D22\u5F15\u64CE\uFF1B</li><li>\u80FD\u80DC\u4EFB\u4E0A\u767E\u4E2A\u670D\u52A1\u8282\u70B9\u7684\u6269\u5C55\uFF0C\u5E76\u652F\u6301 PB \u7EA7\u522B\u7684\u7ED3\u6784\u5316\u6216\u8005\u975E\u7ED3\u6784\u5316\u6570\u636E\u3002</li></ul></li><li>Fluentd <ul><li>\u4E00\u4E2A\u9488\u5BF9\u65E5\u5FD7\u7684\u6536\u96C6\u3001\u5904\u7406\u3001\u8F6C\u53D1\u7CFB\u7EDF\u3002\u901A\u8FC7\u4E30\u5BCC\u7684\u63D2\u4EF6\u7CFB\u7EDF\uFF0C\u53EF\u4EE5\u6536\u96C6\u6765\u81EA\u4E8E\u5404\u79CD\u7CFB\u7EDF\u6216\u5E94\u7528\u7684\u65E5\u5FD7\uFF0C\u8F6C\u5316\u4E3A\u7528\u6237\u6307\u5B9A\u7684\u683C\u5F0F\u540E\uFF0C\u8F6C\u53D1\u5230\u7528\u6237\u6240\u6307\u5B9A\u7684\u65E5\u5FD7\u5B58\u50A8\u7CFB\u7EDF\u4E4B\u4E2D\u3002</li><li>Fluentd\u901A\u8FC7\u4E00\u7EC4\u7ED9\u5B9A\u7684\u6570\u636E\u6E90\u6293\u53D6\u65E5\u5FD7\u6570\u636E\uFF0C\u5904\u7406\u540E\uFF0C\u5C06\u5B83\u4EEC\u8F6C\u53D1\u7ED9\u5176\u4ED6\u670D\u52A1\uFF0C\u6BD4\u5982elasticsearch\u3001\u5BF9\u8C61\u5B58\u50A8\u3001kafka\u7B49</li></ul></li></ul><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044815_620c118f332f876321.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_nginx_02"></p><ul><li><p>Kibana</p><p>\u5206\u6790\u3001\u53EF\u89C6\u5316\u5E73\u53F0\uFF0C\u8BBE\u8BA1\u7528\u4E8E\u548CElasticsearch\u4E00\u8D77\u5DE5\u4F5C\u3002\u53EF\u4EE5\u901A\u8FC7Kibana\u6765\u641C\u7D22\uFF0C\u67E5\u770B\uFF0C\u5E76\u548C\u5B58\u50A8\u5728Elasticsearch\u7D22\u5F15\u4E2D\u7684\u6570\u636E\u8FDB\u884C\u4EA4\u4E92\u3002\u4E5F\u53EF\u4EE5\u8F7B\u677E\u5730\u6267\u884C\u9AD8\u7EA7\u6570\u636E\u5206\u6790\uFF0C \u5E76\u4E14\u4EE5\u5404\u79CD\u56FE\u6807\u3001\u8868\u683C\u548C\u5730\u56FE\u7684\u5F62\u5F0F\u53EF\u89C6\u5316\u6570\u636E\u3002</p></li></ul><p><strong>\u4F7F\u7528docker\u8FD0\u884Cfluentd\u6A21\u62DF\u65E5\u5FD7\u6536\u96C6</strong></p><blockquote><p>\u4F7F\u7528docker\u8FD0\u884Cfluentd\uFF0C\u7136\u540E\u521B\u5EFA\u4E00\u4E2A\u65E5\u5FD7\u6587\u4EF6\uFF0C\u8F93\u5165\u5185\u5BB9\uFF0C\u89C2\u5BDFfluentd\u7684\u53D8\u5316</p><p>fluentd\u914D\u7F6E\u6587\u4EF6\u5185\u5BB9\uFF1A</p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">source</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                               </span><span style="color:#758575;">#\u5B9A\u4E49\u65E5\u5FD7\u7684\u6E90</span></span>
<span class="line"><span style="color:#DBD7CA;"> @type tail                        </span><span style="color:#758575;">#\u7C7B\u578B\u4E3Atail\uFF0C\u8FFD\u8E2A\u65E5\u5FD7\u7684\u8F93\u51FA</span></span>
<span class="line"><span style="color:#DBD7CA;"> @id nginx_access                   </span><span style="color:#758575;">#\u5B9A\u4E49\u4E00\u4E2Aid\u53F7</span></span>
<span class="line"><span style="color:#DBD7CA;"> @label @nginx_access               </span><span style="color:#758575;">#\u5B9A\u4E49\u4E00\u4E2A\u6807\u7B7E\uFF0C\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7A0B\u5E8F\u7684\u65E5\u5FD7        </span></span>
<span class="line"><span style="color:#DBD7CA;"> path /fluentd/access.log             </span><span style="color:#758575;">#\u65E5\u5FD7\u6240\u5728\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#DBD7CA;"> exclude_path </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;/fluentd/nginx/*.gz&quot;</span><span style="color:#DBD7CA;">,</span><span style="color:#C98A7D;">&quot;/fluentd/nginx/*.zip&quot;</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">             </span><span style="color:#758575;">#\u6392\u9664\u7684\u6587\u4EF6\u540D</span></span>
<span class="line"><span style="color:#DBD7CA;"> pos_file /fluentd/nginx_access.posg                                   </span><span style="color:#758575;">#\u5F53fluentd\u4E2D\u65AD\u540E\uFF0C\u65E5\u5FD7\u4FDD\u5B58\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#DBD7CA;"> tag nginx_access                                   </span><span style="color:#758575;">#\u5B9A\u4E49\u4E00\u4E2Atag\u6807\u7B7E\uFF0C\u53EF\u4EE5\u901A\u8FC7tag\u6807\u7B7E\u6765\u51B3\u5B9A\u65E5\u5FD7\u5B58\u50A8\u5728\u54EA\u4E2Aes\u7D22\u5F15\u5E93</span></span>
<span class="line"><span style="color:#DBD7CA;"> format none </span></span>
<span class="line"><span style="color:#DBD7CA;"> @log_level trace</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/source</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">label @nginx_access</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                          </span><span style="color:#758575;">#\u9488\u5BF9nginx_access\u6807\u7B7E\u7684\u65E5\u5FD7\u505A\u4E00\u4E9B\u5904\u7406\u89C4\u5219</span></span>
<span class="line"><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">filter nginx_access</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                        </span><span style="color:#758575;">#\u8F6C\u53D1\u89C4\u5219</span></span>
<span class="line"><span style="color:#DBD7CA;">     @type parser</span></span>
<span class="line"><span style="color:#DBD7CA;">     key_name message</span></span>
<span class="line"><span style="color:#DBD7CA;">     format /</span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">serverIp</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+.</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+.</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+.</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">timestamp</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\S</span><span style="color:#DBD7CA;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">respondTime</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+.</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">httpcode</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">{2,3}</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">0</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">eventTime</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\[\\d</span><span style="color:#DBD7CA;">{2}</span><span style="color:#D4976C;">\\S</span><span style="color:#CB7676;">*</span><span style="color:#D4976C;">\\s\\S</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">clientIp</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+.</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+.</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+.</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">clientPort</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">method</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\b\\w</span><span style="color:#DBD7CA;">+</span><span style="color:#D4976C;">\\b</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">protocol</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">http</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">https</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">channel</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">.</span><span style="color:#CB7676;">*|</span><span style="color:#DBD7CA;">-</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">url</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\S</span><span style="color:#DBD7CA;">+</span><span style="color:#858585;">)(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">httpversion</span><span style="color:#C98A7D;">&gt;(HTTP</span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;">HTTPS)</span><span style="color:#D4976C;">\\/</span><span style="color:#DBD7CA;">S+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">bodyBytes</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\d</span><span style="color:#DBD7CA;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">destIp</span><span style="color:#CB7676;">&gt;</span><span style="color:#D4976C;">\\S</span><span style="color:#DBD7CA;">+</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">-</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">status</span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">^</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">]</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">referer</span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">^</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">]</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">ua</span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">^</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">]</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">fileType</span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">^</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">]</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">(</span><span style="color:#CB7676;">?&lt;</span><span style="color:#DBD7CA;">from</span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">^</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#858585;">]</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#D4976C;">\\&quot;</span><span style="color:#DBD7CA;">/              </span><span style="color:#758575;">#\u5C06\u8F93\u5165\u7684\u65E5\u5FD7\u901A\u8FC7\u6B63\u5219\u7684\u65B9\u5F0F\u8FDB\u884C\u89E3\u6790</span></span>
<span class="line"><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/filter</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                            </span></span>
<span class="line"><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">filter nginx_access</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                </span><span style="color:#758575;">#\u53EF\u4EE5\u5B9A\u4E49\u591A\u4E2A\u8F6C\u53D1\u89C4\u5219</span></span>
<span class="line"><span style="color:#DBD7CA;">     @type record_transformer                </span><span style="color:#758575;">#\u8BB0\u5F55\u8F6C\u6362</span></span>
<span class="line"><span style="color:#DBD7CA;">     </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">record</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                                </span><span style="color:#758575;">#\u589E\u52A0\u4E24\u4E2A\u5B57\u6BB5\u5230\u65E5\u5FD7\u4E2D\uFF0C\u8FD9\u6837\u4E00\u6765\u5C31\u53EF\u4EE5\u505A\u8DEF\u7531\u5339\u914D\uFF0C\u5206\u522B\u5B58\u50A8\u5728\u4E0D\u540C\u7684\u7D22\u5F15\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CA;">         host_name </span><span style="color:#C98A7D;">&quot;#{Socket.gethostname}&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">         my_key </span><span style="color:#C98A7D;">&quot;my_val&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">     </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/record</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/filter</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">match nginx_access</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                        </span><span style="color:#758575;">#\u8F93\u51FA\u5230\u54EA\u91CC</span></span>
<span class="line"><span style="color:#DBD7CA;">     @type file                           </span><span style="color:#758575;">#\u8F93\u51FA\u5230\u6587\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CA;">     path /fluentd/data               </span><span style="color:#758575;">#\u6587\u4EF6\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/match</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/label</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">source</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                               </span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u65E5\u5FD7\u7684\u6E90</span></span>
<span class="line"><span style="color:#393A34;"> @type tail                        </span><span style="color:#A0ADA0;">#\u7C7B\u578B\u4E3Atail\uFF0C\u8FFD\u8E2A\u65E5\u5FD7\u7684\u8F93\u51FA</span></span>
<span class="line"><span style="color:#393A34;"> @id nginx_access                   </span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u4E00\u4E2Aid\u53F7</span></span>
<span class="line"><span style="color:#393A34;"> @label @nginx_access               </span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u4E00\u4E2A\u6807\u7B7E\uFF0C\u7528\u4E8E\u533A\u5206\u4E0D\u540C\u7A0B\u5E8F\u7684\u65E5\u5FD7        </span></span>
<span class="line"><span style="color:#393A34;"> path /fluentd/access.log             </span><span style="color:#A0ADA0;">#\u65E5\u5FD7\u6240\u5728\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#393A34;"> exclude_path </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;/fluentd/nginx/*.gz&quot;</span><span style="color:#393A34;">,</span><span style="color:#B56959;">&quot;/fluentd/nginx/*.zip&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">             </span><span style="color:#A0ADA0;">#\u6392\u9664\u7684\u6587\u4EF6\u540D</span></span>
<span class="line"><span style="color:#393A34;"> pos_file /fluentd/nginx_access.posg                                   </span><span style="color:#A0ADA0;">#\u5F53fluentd\u4E2D\u65AD\u540E\uFF0C\u65E5\u5FD7\u4FDD\u5B58\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#393A34;"> tag nginx_access                                   </span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u4E00\u4E2Atag\u6807\u7B7E\uFF0C\u53EF\u4EE5\u901A\u8FC7tag\u6807\u7B7E\u6765\u51B3\u5B9A\u65E5\u5FD7\u5B58\u50A8\u5728\u54EA\u4E2Aes\u7D22\u5F15\u5E93</span></span>
<span class="line"><span style="color:#393A34;"> format none </span></span>
<span class="line"><span style="color:#393A34;"> @log_level trace</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/source</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">label @nginx_access</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                          </span><span style="color:#A0ADA0;">#\u9488\u5BF9nginx_access\u6807\u7B7E\u7684\u65E5\u5FD7\u505A\u4E00\u4E9B\u5904\u7406\u89C4\u5219</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">filter nginx_access</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                        </span><span style="color:#A0ADA0;">#\u8F6C\u53D1\u89C4\u5219</span></span>
<span class="line"><span style="color:#393A34;">     @type parser</span></span>
<span class="line"><span style="color:#393A34;">     key_name message</span></span>
<span class="line"><span style="color:#393A34;">     format /</span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">serverIp</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+.</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+.</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+.</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">timestamp</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\S</span><span style="color:#393A34;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">respondTime</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+.</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">httpcode</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">{2,3}</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">0</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">eventTime</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\[\\d</span><span style="color:#393A34;">{2}</span><span style="color:#A65E2B;">\\S</span><span style="color:#AB5959;">*</span><span style="color:#A65E2B;">\\s\\S</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">clientIp</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+.</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+.</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+.</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">clientPort</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">method</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\b\\w</span><span style="color:#393A34;">+</span><span style="color:#A65E2B;">\\b</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">protocol</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">http</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">https</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">channel</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">.</span><span style="color:#AB5959;">*|</span><span style="color:#393A34;">-</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">url</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\S</span><span style="color:#393A34;">+</span><span style="color:#8E8F8B;">)(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">httpversion</span><span style="color:#B56959;">&gt;(HTTP</span><span style="color:#AB5959;">|</span><span style="color:#B56959;">HTTPS)</span><span style="color:#A65E2B;">\\/</span><span style="color:#393A34;">S+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">bodyBytes</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\d</span><span style="color:#393A34;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">destIp</span><span style="color:#AB5959;">&gt;</span><span style="color:#A65E2B;">\\S</span><span style="color:#393A34;">+</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">-</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">status</span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">^</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">referer</span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">^</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">ua</span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">^</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">fileType</span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">^</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#393A34;"> </span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">(</span><span style="color:#AB5959;">?&lt;</span><span style="color:#393A34;">from</span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">^</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#A65E2B;">\\&quot;</span><span style="color:#393A34;">/              </span><span style="color:#A0ADA0;">#\u5C06\u8F93\u5165\u7684\u65E5\u5FD7\u901A\u8FC7\u6B63\u5219\u7684\u65B9\u5F0F\u8FDB\u884C\u89E3\u6790</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/filter</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                            </span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">filter nginx_access</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                </span><span style="color:#A0ADA0;">#\u53EF\u4EE5\u5B9A\u4E49\u591A\u4E2A\u8F6C\u53D1\u89C4\u5219</span></span>
<span class="line"><span style="color:#393A34;">     @type record_transformer                </span><span style="color:#A0ADA0;">#\u8BB0\u5F55\u8F6C\u6362</span></span>
<span class="line"><span style="color:#393A34;">     </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">record</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                                </span><span style="color:#A0ADA0;">#\u589E\u52A0\u4E24\u4E2A\u5B57\u6BB5\u5230\u65E5\u5FD7\u4E2D\uFF0C\u8FD9\u6837\u4E00\u6765\u5C31\u53EF\u4EE5\u505A\u8DEF\u7531\u5339\u914D\uFF0C\u5206\u522B\u5B58\u50A8\u5728\u4E0D\u540C\u7684\u7D22\u5F15\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">         host_name </span><span style="color:#B56959;">&quot;#{Socket.gethostname}&quot;</span></span>
<span class="line"><span style="color:#393A34;">         my_key </span><span style="color:#B56959;">&quot;my_val&quot;</span></span>
<span class="line"><span style="color:#393A34;">     </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/record</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/filter</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;"> </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">match nginx_access</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                        </span><span style="color:#A0ADA0;">#\u8F93\u51FA\u5230\u54EA\u91CC</span></span>
<span class="line"><span style="color:#393A34;">     @type file                           </span><span style="color:#A0ADA0;">#\u8F93\u51FA\u5230\u6587\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">     path /fluentd/data               </span><span style="color:#A0ADA0;">#\u6587\u4EF6\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/match</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/label</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"></span></code></pre></div></blockquote><div class="language-powershell"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#6394BF;">1.</span><span style="color:#DBD7CA;">\u8FD0\u884Cfluentd</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#CB7676;">root</span><span style="color:#858585;">@</span><span style="color:#B8A965;">k8s</span><span style="color:#CB7676;">-master1</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">EFK</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">\\# docker run </span><span style="color:#CB7676;">-</span><span style="color:#DBD7CA;">u root </span><span style="color:#CB7676;">-</span><span style="color:#DBD7CA;">it </span><span style="color:#CB7676;">--</span><span style="color:#DBD7CA;">name fluentd fluent</span><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">fluentd:v1.</span><span style="color:#6394BF;">6.2</span><span style="color:#CB7676;">-</span><span style="color:#6394BF;">1.0</span><span style="color:#DBD7CA;"> sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6394BF;">2.</span><span style="color:#DBD7CA;">\u7F16\u5199fluentd\u914D\u7F6E\u6587\u4EF6</span></span>
<span class="line"><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;"> </span><span style="color:#758575;"># cat fluentd/etc/fluent.conf </span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">source</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">@</span><span style="color:#B8A965;">type</span><span style="color:#DBD7CA;"> tail</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">@</span><span style="color:#B8A965;">id</span><span style="color:#DBD7CA;"> nginx_access</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">@</span><span style="color:#B8A965;">label</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">@</span><span style="color:#B8A965;">nginx_access</span></span>
<span class="line"><span style="color:#DBD7CA;">    path </span><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">fluentd</span><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">access.log</span></span>
<span class="line"><span style="color:#DBD7CA;">    exclude_path </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;/fluentd/nginx/*.gz&quot;</span><span style="color:#CB7676;">,</span><span style="color:#C98A7D;">&quot;/fluentd/nginx/*.zip&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">    pos_file </span><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">fluentd</span><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">nginx_access.posg</span></span>
<span class="line"><span style="color:#DBD7CA;">    tag nginx_access</span></span>
<span class="line"><span style="color:#DBD7CA;">    format none</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">@</span><span style="color:#B8A965;">log_level</span><span style="color:#DBD7CA;"> trace</span></span>
<span class="line"><span style="color:#CB7676;">&lt;/</span><span style="color:#DBD7CA;">source</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">label </span><span style="color:#858585;">@</span><span style="color:#B8A965;">nginx_access</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">filter nginx_access</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">@</span><span style="color:#B8A965;">type</span><span style="color:#DBD7CA;"> parser</span></span>
<span class="line"><span style="color:#DBD7CA;">        key_name message</span></span>
<span class="line"><span style="color:#DBD7CA;">        format </span><span style="color:#CB7676;">/</span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">serverIp</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\d</span><span style="color:#CB7676;">+</span><span style="color:#DBD7CA;">.\\d</span><span style="color:#CB7676;">+</span><span style="color:#DBD7CA;">.\\d</span><span style="color:#CB7676;">+</span><span style="color:#DBD7CA;">.\\d</span><span style="color:#CB7676;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">timestamp</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\S</span><span style="color:#CB7676;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">respondTime</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\d</span><span style="color:#CB7676;">+</span><span style="color:#DBD7CA;">.\\d</span><span style="color:#CB7676;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">httpcode</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\d</span><span style="color:#858585;">{</span><span style="color:#6394BF;">2</span><span style="color:#CB7676;">,</span><span style="color:#6394BF;">3</span><span style="color:#858585;">}</span><span style="color:#CB7676;">|</span><span style="color:#6394BF;">0</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">eventTime</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">\\</span><span style="color:#CB7676;">d</span><span style="color:#858585;">{</span><span style="color:#6394BF;">2</span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">\\</span><span style="color:#CB7676;">S*</span><span style="color:#DBD7CA;">\\</span><span style="color:#CB7676;">s</span><span style="color:#DBD7CA;">\\</span><span style="color:#CB7676;">S*</span><span style="color:#DBD7CA;">) </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">clientIp</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\d</span><span style="color:#CB7676;">+</span><span style="color:#DBD7CA;">.\\d</span><span style="color:#CB7676;">+</span><span style="color:#DBD7CA;">.\\d</span><span style="color:#CB7676;">+</span><span style="color:#DBD7CA;">.\\d</span><span style="color:#CB7676;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">clientPort</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\d</span><span style="color:#CB7676;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">method</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\b\\w</span><span style="color:#CB7676;">+</span><span style="color:#DBD7CA;">\\b</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">protocol</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">http</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">https</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">channel</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">.</span><span style="color:#CB7676;">*|-</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">url</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\S</span><span style="color:#CB7676;">+</span><span style="color:#858585;">)(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">httpversion</span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">HTTP</span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">HTTPS</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">\\</span><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">S</span><span style="color:#CB7676;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">bodyBytes</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\d</span><span style="color:#CB7676;">+</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">destIp</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">\\S</span><span style="color:#CB7676;">+|-</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;"> \\</span><span style="color:#C98A7D;">&quot;(?&lt;status&gt;[^\\&quot;</span><span style="color:#858585;">]</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">\\</span><span style="color:#C98A7D;">&quot; \\&quot;</span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">referer</span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">^\\</span><span style="color:#C98A7D;">&quot;]*)\\&quot;</span><span style="color:#DBD7CA;"> \\</span><span style="color:#C98A7D;">&quot;(?&lt;ua&gt;[^\\&quot;</span><span style="color:#858585;">]</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">\\</span><span style="color:#C98A7D;">&quot; \\&quot;</span><span style="color:#858585;">(</span><span style="color:#4D9375;">?</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">fileType</span><span style="color:#CB7676;">&gt;</span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">^\\</span><span style="color:#C98A7D;">&quot;]*)\\&quot;</span><span style="color:#DBD7CA;"> \\</span><span style="color:#C98A7D;">&quot;(?&lt;from&gt;[^\\&quot;</span><span style="color:#858585;">]</span><span style="color:#CB7676;">*</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">\\</span><span style="color:#C98A7D;">&quot;/</span></span>
<span class="line"><span style="color:#C98A7D;">    &lt;/filter&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">    &lt;filter nginx_access&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">        @type record_transformer</span></span>
<span class="line"><span style="color:#C98A7D;">        &lt;record&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">            host_name &quot;</span><span style="color:#758575;">#{Socket.gethostname}&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">            my_key </span><span style="color:#C98A7D;">&quot;my_val&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#CB7676;">&lt;/</span><span style="color:#DBD7CA;">record</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;/</span><span style="color:#DBD7CA;">filter</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">match nginx_access</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">@</span><span style="color:#B8A965;">type</span><span style="color:#DBD7CA;"> file</span></span>
<span class="line"><span style="color:#DBD7CA;">        path </span><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">fluentd</span><span style="color:#CB7676;">/</span><span style="color:#4D9375;">data</span></span>
<span class="line"><span style="color:#DBD7CA;">   </span><span style="color:#CB7676;">&lt;/</span><span style="color:#DBD7CA;">match</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#CB7676;">&lt;/</span><span style="color:#DBD7CA;">label</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6394BF;">3.</span><span style="color:#DBD7CA;">\u542F\u52A8fluentd</span></span>
<span class="line"><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;"> </span><span style="color:#758575;"># fluentd -c fluentd/etc/fluent.conf </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6394BF;">4.</span><span style="color:#DBD7CA;">\u5199\u5165\u65E5\u5FD7\u6587\u4EF6</span></span>
<span class="line"><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">fluentd </span><span style="color:#758575;"># touch access.log</span></span>
<span class="line"><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;">fluentd </span><span style="color:#758575;"># echo &#39;10.10.1.1 1561620585.973 0.005 502 [27/Jun/2020:15:29:45 +0800] 178.73.215.171 33337 GE</span></span>
<span class="line"><span style="color:#DBD7CA;">T https microsoft.test2.cn https:</span><span style="color:#CB7676;">//</span><span style="color:#DBD7CA;">microsoft.test2.cn</span><span style="color:#CB7676;">/</span><span style="color:#DBD7CA;"> HTTP</span><span style="color:#CB7676;">/</span><span style="color:#6394BF;">1.0</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">247</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">58.49</span><span style="color:#DBD7CA;">.</span><span style="color:#6394BF;">156.139</span><span style="color:#DBD7CA;">:</span><span style="color:#6394BF;">8080</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;MISS from 58.49.</span></span>
<span class="line"><span style="color:#C98A7D;">156.139&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;_&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;_&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;_&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;_&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#CB7676;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">0.005</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">502</span><span style="color:#DBD7CA;"> 0f547fb6de9odc9778c48e35b9a8acb7</span><span style="color:#C98A7D;">&#39; &gt;&gt;/fluentd/access.log</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#296AA3;">1.</span><span style="color:#393A34;">\u8FD0\u884Cfluentd</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#AB5959;">root</span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">k8s</span><span style="color:#AB5959;">-master1</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">\\# docker run </span><span style="color:#AB5959;">-</span><span style="color:#393A34;">u root </span><span style="color:#AB5959;">-</span><span style="color:#393A34;">it </span><span style="color:#AB5959;">--</span><span style="color:#393A34;">name fluentd fluent</span><span style="color:#AB5959;">/</span><span style="color:#393A34;">fluentd:v1.</span><span style="color:#296AA3;">6.2</span><span style="color:#AB5959;">-</span><span style="color:#296AA3;">1.0</span><span style="color:#393A34;"> sh</span></span>
<span class="line"></span>
<span class="line"><span style="color:#296AA3;">2.</span><span style="color:#393A34;">\u7F16\u5199fluentd\u914D\u7F6E\u6587\u4EF6</span></span>
<span class="line"><span style="color:#AB5959;">/</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;"># cat fluentd/etc/fluent.conf </span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">source</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">type</span><span style="color:#393A34;"> tail</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">id</span><span style="color:#393A34;"> nginx_access</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">label</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">nginx_access</span></span>
<span class="line"><span style="color:#393A34;">    path </span><span style="color:#AB5959;">/</span><span style="color:#393A34;">fluentd</span><span style="color:#AB5959;">/</span><span style="color:#393A34;">access.log</span></span>
<span class="line"><span style="color:#393A34;">    exclude_path </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;/fluentd/nginx/*.gz&quot;</span><span style="color:#AB5959;">,</span><span style="color:#B56959;">&quot;/fluentd/nginx/*.zip&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">    pos_file </span><span style="color:#AB5959;">/</span><span style="color:#393A34;">fluentd</span><span style="color:#AB5959;">/</span><span style="color:#393A34;">nginx_access.posg</span></span>
<span class="line"><span style="color:#393A34;">    tag nginx_access</span></span>
<span class="line"><span style="color:#393A34;">    format none</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">log_level</span><span style="color:#393A34;"> trace</span></span>
<span class="line"><span style="color:#AB5959;">&lt;/</span><span style="color:#393A34;">source</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">label </span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">nginx_access</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">filter nginx_access</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">type</span><span style="color:#393A34;"> parser</span></span>
<span class="line"><span style="color:#393A34;">        key_name message</span></span>
<span class="line"><span style="color:#393A34;">        format </span><span style="color:#AB5959;">/</span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">serverIp</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\d</span><span style="color:#AB5959;">+</span><span style="color:#393A34;">.\\d</span><span style="color:#AB5959;">+</span><span style="color:#393A34;">.\\d</span><span style="color:#AB5959;">+</span><span style="color:#393A34;">.\\d</span><span style="color:#AB5959;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">timestamp</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\S</span><span style="color:#AB5959;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">respondTime</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\d</span><span style="color:#AB5959;">+</span><span style="color:#393A34;">.\\d</span><span style="color:#AB5959;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">httpcode</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\d</span><span style="color:#8E8F8B;">{</span><span style="color:#296AA3;">2</span><span style="color:#AB5959;">,</span><span style="color:#296AA3;">3</span><span style="color:#8E8F8B;">}</span><span style="color:#AB5959;">|</span><span style="color:#296AA3;">0</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">eventTime</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">\\</span><span style="color:#AB5959;">d</span><span style="color:#8E8F8B;">{</span><span style="color:#296AA3;">2</span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">\\</span><span style="color:#AB5959;">S*</span><span style="color:#393A34;">\\</span><span style="color:#AB5959;">s</span><span style="color:#393A34;">\\</span><span style="color:#AB5959;">S*</span><span style="color:#393A34;">) </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">clientIp</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\d</span><span style="color:#AB5959;">+</span><span style="color:#393A34;">.\\d</span><span style="color:#AB5959;">+</span><span style="color:#393A34;">.\\d</span><span style="color:#AB5959;">+</span><span style="color:#393A34;">.\\d</span><span style="color:#AB5959;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">clientPort</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\d</span><span style="color:#AB5959;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">method</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\b\\w</span><span style="color:#AB5959;">+</span><span style="color:#393A34;">\\b</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">protocol</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">http</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">https</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">channel</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">.</span><span style="color:#AB5959;">*|-</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">url</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\S</span><span style="color:#AB5959;">+</span><span style="color:#8E8F8B;">)(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">httpversion</span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">HTTP</span><span style="color:#AB5959;">|</span><span style="color:#393A34;">HTTPS</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">\\</span><span style="color:#AB5959;">/</span><span style="color:#393A34;">S</span><span style="color:#AB5959;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">bodyBytes</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\d</span><span style="color:#AB5959;">+</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">destIp</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">\\S</span><span style="color:#AB5959;">+|-</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;"> \\</span><span style="color:#B56959;">&quot;(?&lt;status&gt;[^\\&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">\\</span><span style="color:#B56959;">&quot; \\&quot;</span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">referer</span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">^\\</span><span style="color:#B56959;">&quot;]*)\\&quot;</span><span style="color:#393A34;"> \\</span><span style="color:#B56959;">&quot;(?&lt;ua&gt;[^\\&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">\\</span><span style="color:#B56959;">&quot; \\&quot;</span><span style="color:#8E8F8B;">(</span><span style="color:#1C6B48;">?</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">fileType</span><span style="color:#AB5959;">&gt;</span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">^\\</span><span style="color:#B56959;">&quot;]*)\\&quot;</span><span style="color:#393A34;"> \\</span><span style="color:#B56959;">&quot;(?&lt;from&gt;[^\\&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#AB5959;">*</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">\\</span><span style="color:#B56959;">&quot;/</span></span>
<span class="line"><span style="color:#B56959;">    &lt;/filter&gt;</span></span>
<span class="line"><span style="color:#B56959;">    &lt;filter nginx_access&gt;</span></span>
<span class="line"><span style="color:#B56959;">        @type record_transformer</span></span>
<span class="line"><span style="color:#B56959;">        &lt;record&gt;</span></span>
<span class="line"><span style="color:#B56959;">            host_name &quot;</span><span style="color:#A0ADA0;">#{Socket.gethostname}&quot;</span></span>
<span class="line"><span style="color:#393A34;">            my_key </span><span style="color:#B56959;">&quot;my_val&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#AB5959;">&lt;/</span><span style="color:#393A34;">record</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;/</span><span style="color:#393A34;">filter</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">match nginx_access</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">@</span><span style="color:#8C862B;">type</span><span style="color:#393A34;"> file</span></span>
<span class="line"><span style="color:#393A34;">        path </span><span style="color:#AB5959;">/</span><span style="color:#393A34;">fluentd</span><span style="color:#AB5959;">/</span><span style="color:#1C6B48;">data</span></span>
<span class="line"><span style="color:#393A34;">   </span><span style="color:#AB5959;">&lt;/</span><span style="color:#393A34;">match</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#AB5959;">&lt;/</span><span style="color:#393A34;">label</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#296AA3;">3.</span><span style="color:#393A34;">\u542F\u52A8fluentd</span></span>
<span class="line"><span style="color:#AB5959;">/</span><span style="color:#393A34;"> </span><span style="color:#A0ADA0;"># fluentd -c fluentd/etc/fluent.conf </span></span>
<span class="line"></span>
<span class="line"><span style="color:#296AA3;">4.</span><span style="color:#393A34;">\u5199\u5165\u65E5\u5FD7\u6587\u4EF6</span></span>
<span class="line"><span style="color:#AB5959;">/</span><span style="color:#393A34;">fluentd </span><span style="color:#A0ADA0;"># touch access.log</span></span>
<span class="line"><span style="color:#AB5959;">/</span><span style="color:#393A34;">fluentd </span><span style="color:#A0ADA0;"># echo &#39;10.10.1.1 1561620585.973 0.005 502 [27/Jun/2020:15:29:45 +0800] 178.73.215.171 33337 GE</span></span>
<span class="line"><span style="color:#393A34;">T https microsoft.test2.cn https:</span><span style="color:#AB5959;">//</span><span style="color:#393A34;">microsoft.test2.cn</span><span style="color:#AB5959;">/</span><span style="color:#393A34;"> HTTP</span><span style="color:#AB5959;">/</span><span style="color:#296AA3;">1.0</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">247</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">58.49</span><span style="color:#393A34;">.</span><span style="color:#296AA3;">156.139</span><span style="color:#393A34;">:</span><span style="color:#296AA3;">8080</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;MISS from 58.49.</span></span>
<span class="line"><span style="color:#B56959;">156.139&quot;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;_&quot;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;_&quot;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;_&quot;</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;_&quot;</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-</span><span style="color:#393A34;"> </span><span style="color:#AB5959;">-</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">0.005</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">502</span><span style="color:#393A34;"> 0f547fb6de9odc9778c48e35b9a8acb7</span><span style="color:#B56959;">&#39; &gt;&gt;/fluentd/access.log</span></span>
<span class="line"></span></code></pre></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044815_620c118f926e91114.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_elasticsearch_03"></p><h2 id="_2-\u90E8\u7F72efk\u5E73\u53F0" tabindex="-1">2.\u90E8\u7F72EFK\u5E73\u53F0 <a class="header-anchor" href="#_2-\u90E8\u7F72efk\u5E73\u53F0" aria-hidden="true">#</a></h2><blockquote><ul><li>\u90E8\u7F72elasticsearch\u3001kibana\u3001fluentd\uFF0C\u5BF9elasticsearch\u3001kibana\u521B\u5EFApv\u3001pvc\u6301\u4E45\u5316\u6570\u636E</li><li>\u90E8\u7F72nfs\uFF0C\u5B58\u50A8\u5BB9\u5668\u7684\u6570\u636E</li><li>\u5C06\u6240\u6709\u7EC4\u4EF6\u7684\u955C\u50CF\u90FD\u63A8\u9001\u81F3harbor\u955C\u50CF\u4ED3\u5E93</li></ul></blockquote><h3 id="_2-1-\u90E8\u7F72nfs" tabindex="-1">2.1.\u90E8\u7F72nfs <a class="header-anchor" href="#_2-1-\u90E8\u7F72nfs" aria-hidden="true">#</a></h3><p>\u5728master2\u4E0A\u90E8\u7F72nfs\u5B58\u50A8k8s\u96C6\u7FA4\u6570\u636E</p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master2 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> yum -y install nfs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master2 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> vim /etc/exports</span></span>
<span class="line"><span style="color:#DBD7CA;">/data2/k8s  192.168.16.0/24</span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">rw,sync,no_root_squash</span><span style="color:#858585;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master2 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> mkdir -p /data2/k8s/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master2 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> systemctl restart nfs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master2 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> showmount -e</span></span>
<span class="line"><span style="color:#DBD7CA;">Export list </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CA;"> k8s-master2:</span></span>
<span class="line"><span style="color:#DBD7CA;">/data2/k8s 192.168.16.0/24</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master2 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> yum -y install nfs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master2 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> vim /etc/exports</span></span>
<span class="line"><span style="color:#393A34;">/data2/k8s  192.168.16.0/24</span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">rw,sync,no_root_squash</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master2 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> mkdir -p /data2/k8s/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master2 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> systemctl restart nfs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master2 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> showmount -e</span></span>
<span class="line"><span style="color:#393A34;">Export list </span><span style="color:#1C6B48;">for</span><span style="color:#393A34;"> k8s-master2:</span></span>
<span class="line"><span style="color:#393A34;">/data2/k8s 192.168.16.0/24</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-2-\u90E8\u7F72elasticsearch" tabindex="-1">2.2.\u90E8\u7F72elasticsearch <a class="header-anchor" href="#_2-2-\u90E8\u7F72elasticsearch" aria-hidden="true">#</a></h3><blockquote><ul><li>\u6211\u4EEC\u91C7\u7528\u5355\u8282\u70B9\u7684es\uFF0C\u96C6\u7FA4\u7684es\u53EA\u9700\u8981\u51C6\u5907\u4E09\u4E2Astatfulset\u8D44\u6E90\u5373\u53EF</li><li>\u91C7\u7528PV\u3001PVC\u5C06\u6570\u636E\u5E93\u6301\u4E45\u5316\u5B58\u50A8</li><li>es\u9ED8\u8BA4\u4F7F\u7528elasticsearch\u7528\u6237\u542F\u52A8\u8FDB\u7A0B\uFF0Ces\u7684\u6570\u636E\u76EE\u5F55\u662F\u901A\u8FC7\u6302\u8F7Dnfs\u7684\u8DEF\u5F84\uFF0C\u56E0\u6B64\u76EE\u5F55\u6743\u9650\u88ABnfs\u7684\u76EE\u5F55\u6743\u9650\u8986\u76D6\uFF0C\u6240\u4EE5\u53EF\u4EE5\u5229\u7528\u521D\u59CB\u5316\u5BB9\u5668\u5728es\u8FDB\u7A0B\u542F\u52A8\u4E4B\u524D\u628A\u76EE\u5F55\u7684\u6743\u9650\u4FEE\u6539\u6389\uFF0C\u6CE8\u610F\u521D\u59CB\u5316\u5BB9\u5668\u8981\u7528\u7279\u6743\u6A21\u5F0F\u542F\u52A8\u3002</li></ul></blockquote><h4 id="_2-2-1-\u521B\u5EFAes\u7684pv\u53CApvc\u8D44\u6E90" tabindex="-1">2.2.1.\u521B\u5EFAes\u7684pv\u53CApvc\u8D44\u6E90 <a class="header-anchor" href="#_2-2-1-\u521B\u5EFAes\u7684pv\u53CApvc\u8D44\u6E90" aria-hidden="true">#</a></h4><p><strong>1.\u5728nfs\u521B\u5EFA\u5B58\u50A8\u8DEF\u5F84</strong></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master2 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> mkdir -p /data2/k8s/es-data </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master2 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> mkdir -p /data2/k8s/es-data </span></span>
<span class="line"></span></code></pre></div><p><strong>2.\u7F16\u5199pv\u3001pvc\u7684yaml\u6587\u4EF6</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# cat es-pv-pvc.yaml</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">PersistentVolume</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">es-pv</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">pv</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">es-pv</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">capacity</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">storage</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">10Gi</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">accessModes</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ReadWriteMany</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">persistentVolumeReclaimPolicy</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Retain</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">nfs</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/data2/k8s/es-data</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">server</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">192.168.16.105</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">es-pvc</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">accessModes</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ReadWriteMany</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">resources</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">requests</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">storage</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">1Gi</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">matchLabels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">pv</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">es-pv</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# cat es-pv-pvc.yaml</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span><span style="color:#B56959;">PersistentVolume</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">es-pv</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">pv</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">es-pv</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">capacity</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">storage</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">10Gi</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">accessModes</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ReadWriteMany</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">persistentVolumeReclaimPolicy</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Retain</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">nfs</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/data2/k8s/es-data</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">server</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">192.168.16.105</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">es-pvc</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">accessModes</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ReadWriteMany</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">resources</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">requests</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">storage</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">1Gi</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">matchLabels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">pv</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">es-pv</span></span>
<span class="line"></span></code></pre></div><p><strong>3.\u521B\u5EFA\u8D44\u6E90\u5E76\u67E5\u770B\u8D44\u6E90\u7684\u72B6\u6001</strong></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl create -f es-pv-pvc.yaml </span></span>
<span class="line"><span style="color:#DBD7CA;">persistentvolume/es-pv created</span></span>
<span class="line"><span style="color:#DBD7CA;">persistentvolumeclaim/es-pvc created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u67E5\u770B\u8D44\u6E90\u7684\u72B6\u6001</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get pv,pvc -n efk</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM        STORAGECLASS   REASON   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">persistentvolume/es-pv   10Gi       RWX            Retain           Bound    efk/es-pvc                           2m10s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                           STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">persistentvolumeclaim/es-pvc   Bound    es-pv    10Gi       RWX                           2m10s</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl create -f es-pv-pvc.yaml </span></span>
<span class="line"><span style="color:#393A34;">persistentvolume/es-pv created</span></span>
<span class="line"><span style="color:#393A34;">persistentvolumeclaim/es-pvc created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u67E5\u770B\u8D44\u6E90\u7684\u72B6\u6001</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get pv,pvc -n efk</span></span>
<span class="line"><span style="color:#393A34;">NAME                     CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM        STORAGECLASS   REASON   AGE</span></span>
<span class="line"><span style="color:#393A34;">persistentvolume/es-pv   10Gi       RWX            Retain           Bound    efk/es-pvc                           2m10s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                           STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span>
<span class="line"><span style="color:#393A34;">persistentvolumeclaim/es-pvc   Bound    es-pv    10Gi       RWX                           2m10s</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-2-2-\u51C6\u5907elasticsearch\u955C\u50CF\u5E76\u63A8\u9001\u81F3harbor" tabindex="-1">2.2.2.\u51C6\u5907elasticsearch\u955C\u50CF\u5E76\u63A8\u9001\u81F3harbor <a class="header-anchor" href="#_2-2-2-\u51C6\u5907elasticsearch\u955C\u50CF\u5E76\u63A8\u9001\u81F3harbor" aria-hidden="true">#</a></h4><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u62C9\u53D6\u955C\u50CF</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker pull elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">7.4.2: Pulling from library/elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">d8d02d457314: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">f26fec8fc1eb: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">8177ad1fe56d: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">d8fdf75b73c1: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">47ac89c1da81: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">fc8e09b48887: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">367b97f47d5c: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">Digest: sha256:543bf7a3d61781bad337d31e6cc5895f16b55aed4da48f40c346352420927f74</span></span>
<span class="line"><span style="color:#DBD7CA;">Status: Downloaded newer image </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CA;"> elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">docker.io/library/elasticsearch:7.4.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u6DFB\u52A0harbor\u4ED3\u5E93</span></span>
<span class="line"><span style="color:#758575;">#\u6240\u6709\u8282\u70B9\u90FD\u6309\u5982\u4E0B\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#DBD7CA;">1\uFF09\u589E\u52A0harbor\u4ED3\u5E93\u5730\u5740</span></span>
<span class="line"><span style="color:#DBD7CA;">vim /etc/docker/daemon.json </span></span>
<span class="line"><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">&quot;registry-mirrors&quot;</span><span style="color:#DBD7CA;">: </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;https://7lhvut0q.mirror.aliyuncs.com&quot;</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">&quot;insecure-registries&quot;</span><span style="color:#DBD7CA;">: </span><span style="color:#858585;">[</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;harbor.jiangxl.com&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#858585;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2)\u6DFB\u52A0hosts\u89E3\u6790</span></span>
<span class="line"><span style="color:#DBD7CA;">vim /etc/hosts</span></span>
<span class="line"><span style="color:#DBD7CA;">192.168.16.106 harbor.jiangxl.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3)\u91CD\u542Fdocker</span></span>
<span class="line"><span style="color:#DBD7CA;">systemctl restart docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">4)\u767B\u9646Harbor</span></span>
<span class="line"><span style="color:#DBD7CA;">docker login harbor.jiangxl.com</span></span>
<span class="line"><span style="color:#DBD7CA;">Username: admin</span></span>
<span class="line"><span style="color:#DBD7CA;">Password: admin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u63A8\u9001\u955C\u50CF\u5230harbor</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker tag elasticsearch:7.4.2 harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker push elasticsearch:7.4.2</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u62C9\u53D6\u955C\u50CF</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker pull elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#393A34;">7.4.2: Pulling from library/elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">d8d02d457314: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">f26fec8fc1eb: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">8177ad1fe56d: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">d8fdf75b73c1: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">47ac89c1da81: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">fc8e09b48887: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">367b97f47d5c: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">Digest: sha256:543bf7a3d61781bad337d31e6cc5895f16b55aed4da48f40c346352420927f74</span></span>
<span class="line"><span style="color:#393A34;">Status: Downloaded newer image </span><span style="color:#1C6B48;">for</span><span style="color:#393A34;"> elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#393A34;">docker.io/library/elasticsearch:7.4.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u6DFB\u52A0harbor\u4ED3\u5E93</span></span>
<span class="line"><span style="color:#A0ADA0;">#\u6240\u6709\u8282\u70B9\u90FD\u6309\u5982\u4E0B\u64CD\u4F5C</span></span>
<span class="line"><span style="color:#393A34;">1\uFF09\u589E\u52A0harbor\u4ED3\u5E93\u5730\u5740</span></span>
<span class="line"><span style="color:#393A34;">vim /etc/docker/daemon.json </span></span>
<span class="line"><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959;">&quot;registry-mirrors&quot;</span><span style="color:#393A34;">: </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;https://7lhvut0q.mirror.aliyuncs.com&quot;</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959;">&quot;insecure-registries&quot;</span><span style="color:#393A34;">: </span><span style="color:#8E8F8B;">[</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;harbor.jiangxl.com&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#8E8F8B;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2)\u6DFB\u52A0hosts\u89E3\u6790</span></span>
<span class="line"><span style="color:#393A34;">vim /etc/hosts</span></span>
<span class="line"><span style="color:#393A34;">192.168.16.106 harbor.jiangxl.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3)\u91CD\u542Fdocker</span></span>
<span class="line"><span style="color:#393A34;">systemctl restart docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">4)\u767B\u9646Harbor</span></span>
<span class="line"><span style="color:#393A34;">docker login harbor.jiangxl.com</span></span>
<span class="line"><span style="color:#393A34;">Username: admin</span></span>
<span class="line"><span style="color:#393A34;">Password: admin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u63A8\u9001\u955C\u50CF\u5230harbor</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker tag elasticsearch:7.4.2 harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker push elasticsearch:7.4.2</span></span>
<span class="line"></span></code></pre></div><p>\u5728harbor\u4E0A\u65B0\u5EFA\u9879\u76EE <img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044816_620c11902a94067440.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_elasticsearch_04"></p><p>\u8FDB\u5165\u9879\u76EE\uFF0C\u5C06\u9879\u76EE\u8BBE\u7F6E\u4E3A\u516C\u5F00\uFF0C\u5982\u679C\u4E0D\u8BBE\u7F6E\u4E3A\u516C\u5F00\uFF0C\u62C9\u53D6\u955C\u50CF\u4F1A\u5931\u8D25</p><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044816_620c11907050745715.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_\u5176\u4ED6_05"></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">3.\u7ED9\u955C\u50CF\u6253\u6807\u7B7E</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker tag elasticsearch:7.4.2 harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker tag alpine:3.6 harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">4.\u63A8\u9001\u81F3harbor</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker push harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker push harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">3.\u7ED9\u955C\u50CF\u6253\u6807\u7B7E</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker tag elasticsearch:7.4.2 harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker tag alpine:3.6 harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">4.\u63A8\u9001\u81F3harbor</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker push harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker push harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"></span></code></pre></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044816_620c1190b5cba39236.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_nginx_06"></p><h4 id="_2-2-3-\u7F16\u5199elasticsearch-yaml\u6587\u4EF6" tabindex="-1">2.2.3.\u7F16\u5199elasticsearch yaml\u6587\u4EF6 <a class="header-anchor" href="#_2-2-3-\u7F16\u5199elasticsearch-yaml\u6587\u4EF6" aria-hidden="true">#</a></h4><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">1.\u7F16\u5199yaml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# cat elasticsearch.yaml</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">apps/v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">StatefulSet</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">addonmanager.kubernetes.io/mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Reconcile</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">version</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replicas</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">1</span><span style="color:#DBD7CA;">							</span><span style="color:#758575;">#\u526F\u672C\u6570\u4E3A1\u8868\u793A\u662F1\u4E2Aes\u8282\u70B9</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">revisionHistoryLimit</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">10</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">matchLabels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">version</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">serviceName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">template</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">version</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">containers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">env</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">NAMESPACE</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">valueFrom</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#429988;">fieldRef</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">fieldPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">metadata.namespace</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">cluster.initial_master_nodes</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">value</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch-0</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ES_JAVA_OPTS</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">value</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;-Xms512m -Xmx512m&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">containerPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">9200</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">db</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">protocol</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">TCP</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">containerPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">9300</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">transport</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">protocol</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">TCP</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">volumeMounts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">										</span><span style="color:#758575;">#\u5C06pvc\u6302\u8F7D\u5230/usr/share/elasticsearch/data\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/usr/share/elasticsearch/data</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">dnsConfig</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">options</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">single-request-reopen</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">initContainers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">command</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/sbin/sysctl</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">-w</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">vm.max_map_count=262144</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">imagePullPolicy</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">IfNotPresent</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch-init</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">resources</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">{}</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">securityContext</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">privileged</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fix-permissions</span><span style="color:#DBD7CA;">							</span><span style="color:#758575;">#\u5B9A\u4E49\u521D\u59CB\u5316\u5BB9\u5668\uFF0C\u5C06pvc\u6302\u8F7D\u8FDB\u53BB\u5E76\u5728es\u4E3B\u5BB9\u5668\u542F\u52A8\u4E4B\u524D\u5C06\u76EE\u5F55\u6743\u9650\u8FDB\u884C\u4FEE\u6539</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">command</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;sh&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;-c&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;chown -R 1000:1000 /usr/share/elasticsearch/data&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">securityContext</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">privileged</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">volumeMounts</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/usr/share/elasticsearch/data</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">volumes</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">								</span><span style="color:#758575;">#\u5B9A\u4E49\u6211\u4EEC\u521A\u521A\u521B\u5EFA\u7684pvc</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">persistentVolumeClaim</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">claimName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">es-pvc</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">readOnly</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">false</span></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Service</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">9200</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">protocol</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">TCP</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">targetPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">9200</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterIP</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">1.\u7F16\u5199yaml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# cat elasticsearch.yaml</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">apps/v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">StatefulSet</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">addonmanager.kubernetes.io/mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Reconcile</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">version</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v7.4.2</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replicas</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">1</span><span style="color:#393A34;">							</span><span style="color:#A0ADA0;">#\u526F\u672C\u6570\u4E3A1\u8868\u793A\u662F1\u4E2Aes\u8282\u70B9</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">revisionHistoryLimit</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">10</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">matchLabels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">version</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v7.4.2</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">serviceName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">template</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">version</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v7.4.2</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">containers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">env</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">NAMESPACE</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">valueFrom</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#2F8A89;">fieldRef</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">fieldPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">metadata.namespace</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">cluster.initial_master_nodes</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">value</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch-0</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ES_JAVA_OPTS</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">value</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;-Xms512m -Xmx512m&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">containerPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">9200</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">db</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">protocol</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">TCP</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">containerPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">9300</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">transport</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">protocol</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">TCP</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">volumeMounts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">										</span><span style="color:#A0ADA0;">#\u5C06pvc\u6302\u8F7D\u5230/usr/share/elasticsearch/data\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/usr/share/elasticsearch/data</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">dnsConfig</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">options</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">single-request-reopen</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">initContainers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">command</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/sbin/sysctl</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">-w</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">vm.max_map_count=262144</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">imagePullPolicy</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">IfNotPresent</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch-init</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">resources</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">{}</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">securityContext</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">privileged</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">true</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fix-permissions</span><span style="color:#393A34;">							</span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u521D\u59CB\u5316\u5BB9\u5668\uFF0C\u5C06pvc\u6302\u8F7D\u8FDB\u53BB\u5E76\u5728es\u4E3B\u5BB9\u5668\u542F\u52A8\u4E4B\u524D\u5C06\u76EE\u5F55\u6743\u9650\u8FDB\u884C\u4FEE\u6539</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">command</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;sh&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;-c&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;chown -R 1000:1000 /usr/share/elasticsearch/data&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">securityContext</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">privileged</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">true</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">volumeMounts</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/usr/share/elasticsearch/data</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">volumes</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">								</span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u6211\u4EEC\u521A\u521A\u521B\u5EFA\u7684pvc</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">persistentVolumeClaim</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">claimName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">es-pvc</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">readOnly</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">false</span></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Service</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">9200</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">protocol</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">TCP</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">targetPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">9200</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterIP</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-2-4-\u521B\u5EFAlasticsearch\u8D44\u6E90\u5E76\u67E5\u770B\u72B6\u6001" tabindex="-1">2.2.4.\u521B\u5EFAlasticsearch\u8D44\u6E90\u5E76\u67E5\u770B\u72B6\u6001 <a class="header-anchor" href="#_2-2-4-\u521B\u5EFAlasticsearch\u8D44\u6E90\u5E76\u67E5\u770B\u72B6\u6001" aria-hidden="true">#</a></h4><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl apply -f elasticsearch.yaml </span></span>
<span class="line"><span style="color:#DBD7CA;">statefulset.apps/elasticsearch created</span></span>
<span class="line"><span style="color:#DBD7CA;">service/elasticsearch created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u67E5\u770B\u8D44\u6E90\u7684\u72B6\u6001</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 harbor</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get all -n efk -o wide</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                  READY   STATUS    RESTARTS   AGE   IP                NODE        NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/elasticsearch-0   1/1     Running   0          18s   100.111.156.122   k8s-node1   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">           </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT</span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">S</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">    AGE   SELECTOR</span></span>
<span class="line"><span style="color:#DBD7CA;">service/elasticsearch   ClusterIP   10.110.161.181   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">        9200/TCP   33m   k8s-app=elasticsearch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                             READY   AGE   CONTAINERS      IMAGES</span></span>
<span class="line"><span style="color:#DBD7CA;">statefulset.apps/elasticsearch   1/1     33m   elasticsearch   harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u8BBF\u95EEelasticsearch</span></span>
<span class="line"><span style="color:#758575;">#svcip+svc\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 harbor</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> curl 10.110.161.181:9200</span></span>
<span class="line"><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">&quot;name&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;elasticsearch-0&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">&quot;cluster_name&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;docker-cluster&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">&quot;cluster_uuid&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;od39aNdaRUi8hZTbbvfjdA&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">&quot;version&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">{</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;number&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;7.4.2&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;build_flavor&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;default&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;build_type&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;docker&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;build_hash&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;2f90bbf7b93631e52bafb59b3b049cb44ec25e96&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;build_date&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;2019-10-28T20:40:44.881551Z&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;build_snapshot&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> false,</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;lucene_version&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;8.2.0&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;minimum_wire_compatibility_version&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;6.8.0&quot;</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#C98A7D;">&quot;minimum_index_compatibility_version&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;6.0.0-beta1&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">}</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">&quot;tagline&quot;</span><span style="color:#DBD7CA;"> </span><span style="color:#E0A569;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;You Know, for Search&quot;</span></span>
<span class="line"><span style="color:#858585;">}</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl apply -f elasticsearch.yaml </span></span>
<span class="line"><span style="color:#393A34;">statefulset.apps/elasticsearch created</span></span>
<span class="line"><span style="color:#393A34;">service/elasticsearch created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u67E5\u770B\u8D44\u6E90\u7684\u72B6\u6001</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 harbor</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get all -n efk -o wide</span></span>
<span class="line"><span style="color:#393A34;">NAME                  READY   STATUS    RESTARTS   AGE   IP                NODE        NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#393A34;">pod/elasticsearch-0   1/1     Running   0          18s   100.111.156.122   k8s-node1   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">           </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT</span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">S</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">    AGE   SELECTOR</span></span>
<span class="line"><span style="color:#393A34;">service/elasticsearch   ClusterIP   10.110.161.181   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">        9200/TCP   33m   k8s-app=elasticsearch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                             READY   AGE   CONTAINERS      IMAGES</span></span>
<span class="line"><span style="color:#393A34;">statefulset.apps/elasticsearch   1/1     33m   elasticsearch   harbor.jiangxl.com/efk/elasticsearch:7.4.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u8BBF\u95EEelasticsearch</span></span>
<span class="line"><span style="color:#A0ADA0;">#svcip+svc\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 harbor</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> curl 10.110.161.181:9200</span></span>
<span class="line"><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959;">&quot;name&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;elasticsearch-0&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959;">&quot;cluster_name&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;docker-cluster&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959;">&quot;cluster_uuid&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;od39aNdaRUi8hZTbbvfjdA&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959;">&quot;version&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">{</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;number&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;7.4.2&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;build_flavor&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;default&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;build_type&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;docker&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;build_hash&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;2f90bbf7b93631e52bafb59b3b049cb44ec25e96&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;build_date&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;2019-10-28T20:40:44.881551Z&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;build_snapshot&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> false,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;lucene_version&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;8.2.0&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;minimum_wire_compatibility_version&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;6.8.0&quot;</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#B56959;">&quot;minimum_index_compatibility_version&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;6.0.0-beta1&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">}</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#B56959;">&quot;tagline&quot;</span><span style="color:#393A34;"> </span><span style="color:#B58451;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;You Know, for Search&quot;</span></span>
<span class="line"><span style="color:#8E8F8B;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-3-\u90E8\u7F72kibana" tabindex="-1">2.3.\u90E8\u7F72kibana <a class="header-anchor" href="#_2-3-\u90E8\u7F72kibana" aria-hidden="true">#</a></h3><blockquote><ul><li>kibana\u9700\u8981\u5728web\u9875\u9762\u4F7F\u7528\uFF0C\u56E0\u6B64\u4F7F\u7528ingress\u914D\u7F6E\u57DF\u540D\u6765\u5B9E\u73B0\u5BF9kibana\u7684\u8BBF\u95EE</li><li>kibana\u4E3A\u65E0\u72B6\u6001\u5E94\u7528\uFF0C\u76F4\u63A5\u4F7F\u7528Deployment\u6765\u542F\u52A8</li><li>kibana\u7684\u6570\u636E\u76EE\u5F55\u91C7\u7528pvc\u8FDB\u884C\u6301\u4E45\u5316\u5B58\u50A8\uFF0Ckibana\u9ED8\u8BA4\u4F7F\u7528kibana\u7528\u6237\u542F\u52A8\u8FDB\u7A0B\uFF0Ckibana\u7684\u6570\u636E\u76EE\u5F55\u662F\u901A\u8FC7\u6302\u8F7Dnfs\u7684\u8DEF\u5F84\uFF0C\u56E0\u6B64\u76EE\u5F55\u6743\u9650\u88ABnfs\u7684\u76EE\u5F55\u6743\u9650\u8986\u76D6\uFF0C\u6240\u4EE5\u53EF\u4EE5\u5229\u7528\u521D\u59CB\u5316\u5BB9\u5668\u5728kibana\u8FDB\u7A0B\u542F\u52A8\u4E4B\u524D\u628A\u76EE\u5F55\u7684\u6743\u9650\u4FEE\u6539\u6389\uFF0C\u6CE8\u610F\u521D\u59CB\u5316\u5BB9\u5668\u8981\u7528\u7279\u6743\u6A21\u5F0F\u542F\u52A8\u3002</li><li>kibana\u9700\u8981\u8BBF\u95EEes\uFF0C\u76F4\u63A5\u5229\u7528k8s coredns\u670D\u52A1\u53D1\u73B0\u8BBF\u95EE\u6B64\u5730\u5740\uFF1Ahttp://elasticsearch:9200\u5373\u53EF</li></ul></blockquote><h4 id="_2-3-1-\u51C6\u5907kibana\u7684pv\u53CApvc\u8D44\u6E90" tabindex="-1">2.3.1.\u51C6\u5907kibana\u7684pv\u53CApvc\u8D44\u6E90 <a class="header-anchor" href="#_2-3-1-\u51C6\u5907kibana\u7684pv\u53CApvc\u8D44\u6E90" aria-hidden="true">#</a></h4><p><strong>1.\u51C6\u5907nfs\u5B58\u50A8\u8DEF\u5F84</strong></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master2 </span><span style="color:#CB7676;">~</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> mkdir /data2/k8s/kibana-data</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master2 </span><span style="color:#AB5959;">~</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> mkdir /data2/k8s/kibana-data</span></span>
<span class="line"></span></code></pre></div><p><strong>2.\u7F16\u5199pv\u53CApvc\u7684yaml\u6587\u4EF6</strong></p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# vim kibana-pv-pvc.yaml</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">  </span><span style="color:#C98A7D;">PersistentVolume</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana-pv</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">pv</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana-pv</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">capacity</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">storage</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">10Gi</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">accessModes</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ReadWriteMany</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">persistentVolumeReclaimPolicy</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Retain</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">nfs</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/data2/k8s/kibana-data</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">server</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">192.168.16.105</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana-pvc</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">accessModes</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ReadWriteMany</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">resources</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">requests</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">storage</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">1Gi</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">matchLabels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">pv</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana-pv</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# vim kibana-pv-pvc.yaml</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">  </span><span style="color:#B56959;">PersistentVolume</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana-pv</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">pv</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana-pv</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">capacity</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">storage</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">10Gi</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">accessModes</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ReadWriteMany</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">persistentVolumeReclaimPolicy</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Retain</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">nfs</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/data2/k8s/kibana-data</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">server</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">192.168.16.105</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana-pvc</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">accessModes</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ReadWriteMany</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">resources</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">requests</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">storage</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">1Gi</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">matchLabels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">pv</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana-pv</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p><strong>3.\u521B\u5EFA\u8D44\u6E90\u5E76\u67E5\u770B\u8D44\u6E90\u7684\u72B6\u6001</strong></p><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl create -f kibana-pv-pvc.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">persistentvolume/kibana-pv created</span></span>
<span class="line"><span style="color:#DBD7CA;">persistentvolumeclaim/kibana-pvc created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u67E5\u770B\u8D44\u6E90\u7684\u72B6\u6001</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get pv,pvc -n efk</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM            STORAGECLASS   REASON   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">persistentvolume/kibana-pv   10Gi       RWX            Retain           Bound    efk/kibana-pvc                           167m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                               STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">persistentvolumeclaim/kibana-pvc   Bound    kibana-pv   10Gi       RWX                           167m</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl create -f kibana-pv-pvc.yaml</span></span>
<span class="line"><span style="color:#393A34;">persistentvolume/kibana-pv created</span></span>
<span class="line"><span style="color:#393A34;">persistentvolumeclaim/kibana-pvc created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u67E5\u770B\u8D44\u6E90\u7684\u72B6\u6001</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get pv,pvc -n efk</span></span>
<span class="line"><span style="color:#393A34;">NAME                         CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM            STORAGECLASS   REASON   AGE</span></span>
<span class="line"><span style="color:#393A34;">persistentvolume/kibana-pv   10Gi       RWX            Retain           Bound    efk/kibana-pvc                           167m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                               STATUS   VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span></span>
<span class="line"><span style="color:#393A34;">persistentvolumeclaim/kibana-pvc   Bound    kibana-pv   10Gi       RWX                           167m</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h4 id="_2-3-2-\u51C6\u5907kibana\u955C\u50CF\u5E76\u63A8\u9001\u81F3harbor\u4ED3\u5E93" tabindex="-1">2.3.2.\u51C6\u5907kibana\u955C\u50CF\u5E76\u63A8\u9001\u81F3harbor\u4ED3\u5E93 <a class="header-anchor" href="#_2-3-2-\u51C6\u5907kibana\u955C\u50CF\u5E76\u63A8\u9001\u81F3harbor\u4ED3\u5E93" aria-hidden="true">#</a></h4><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u62C9\u53D6\u955C\u50CF</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 harbor</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker pull kibana:7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">7.4.2: Pulling from library/kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">d8d02d457314: Already exists </span></span>
<span class="line"><span style="color:#DBD7CA;">bc64069ca967: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">c7aae8f7d300: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">8da0971e3b41: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">58ea4bb2901c: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">b1e21d4c2a7e: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">3953eac632cb: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">5f4406500758: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">340d85e0d1c7: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">1768564d16fb: Pull </span><span style="color:#E0A569;">complete</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#DBD7CA;">Digest: sha256:355f9c979dc9cdac3ff9a75a817b8b7660575e492bf7dbe796e705168f167efc</span></span>
<span class="line"><span style="color:#DBD7CA;">Status: Downloaded newer image </span><span style="color:#4D9375;">for</span><span style="color:#DBD7CA;"> kibana:7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">docker.io/library/kibana:7.4.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u7ED9\u955C\u50CF\u6253\u6807\u7B7E</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 harbor</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker tag kibana:7.4.2 harbor.jiangxl.com/efk/kibana:7.4.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">3.\u63A8\u9001\u81F3Harbor</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 harbor</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> docker push harbor.jiangxl.com/efk/kibana:7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">The push refers to repository </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">harbor.jiangxl.com/efk/kibana</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">ccde9566aa40: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">3234e7f24c9c: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">cb5328c9d961: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">b34d7a00ef38: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">0b8e2117240b: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">90cabfea98a8: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">80642e52e3f7: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">9cfbbc5ed16e: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">01fc07851996: Pushed </span></span>
<span class="line"><span style="color:#DBD7CA;">877b494a9f30: Mounted from efk/elasticsearch </span></span>
<span class="line"><span style="color:#DBD7CA;">7.4.2: digest: sha256:d10acb82cc2872b4eb1319eff2d693c47be62d1bb22520f28000a596a637f727 size: 2409</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u62C9\u53D6\u955C\u50CF</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 harbor</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker pull kibana:7.4.2</span></span>
<span class="line"><span style="color:#393A34;">7.4.2: Pulling from library/kibana</span></span>
<span class="line"><span style="color:#393A34;">d8d02d457314: Already exists </span></span>
<span class="line"><span style="color:#393A34;">bc64069ca967: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">c7aae8f7d300: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">8da0971e3b41: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">58ea4bb2901c: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">b1e21d4c2a7e: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">3953eac632cb: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">5f4406500758: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">340d85e0d1c7: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">1768564d16fb: Pull </span><span style="color:#B58451;">complete</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#393A34;">Digest: sha256:355f9c979dc9cdac3ff9a75a817b8b7660575e492bf7dbe796e705168f167efc</span></span>
<span class="line"><span style="color:#393A34;">Status: Downloaded newer image </span><span style="color:#1C6B48;">for</span><span style="color:#393A34;"> kibana:7.4.2</span></span>
<span class="line"><span style="color:#393A34;">docker.io/library/kibana:7.4.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u7ED9\u955C\u50CF\u6253\u6807\u7B7E</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 harbor</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker tag kibana:7.4.2 harbor.jiangxl.com/efk/kibana:7.4.2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">3.\u63A8\u9001\u81F3Harbor</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 harbor</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> docker push harbor.jiangxl.com/efk/kibana:7.4.2</span></span>
<span class="line"><span style="color:#393A34;">The push refers to repository </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">harbor.jiangxl.com/efk/kibana</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">ccde9566aa40: Pushed </span></span>
<span class="line"><span style="color:#393A34;">3234e7f24c9c: Pushed </span></span>
<span class="line"><span style="color:#393A34;">cb5328c9d961: Pushed </span></span>
<span class="line"><span style="color:#393A34;">b34d7a00ef38: Pushed </span></span>
<span class="line"><span style="color:#393A34;">0b8e2117240b: Pushed </span></span>
<span class="line"><span style="color:#393A34;">90cabfea98a8: Pushed </span></span>
<span class="line"><span style="color:#393A34;">80642e52e3f7: Pushed </span></span>
<span class="line"><span style="color:#393A34;">9cfbbc5ed16e: Pushed </span></span>
<span class="line"><span style="color:#393A34;">01fc07851996: Pushed </span></span>
<span class="line"><span style="color:#393A34;">877b494a9f30: Mounted from efk/elasticsearch </span></span>
<span class="line"><span style="color:#393A34;">7.4.2: digest: sha256:d10acb82cc2872b4eb1319eff2d693c47be62d1bb22520f28000a596a637f727 size: 2409</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-3-3-\u7F16\u5199kibana-yaml\u6587\u4EF6" tabindex="-1">2.3.3.\u7F16\u5199kibana yaml\u6587\u4EF6 <a class="header-anchor" href="#_2-3-3-\u7F16\u5199kibana-yaml\u6587\u4EF6" aria-hidden="true">#</a></h4><blockquote><p>\u4F7F\u7528pvc\u4F5C\u4E3A\u6570\u636E\u6301\u4E45\u5316\uFF0C\u901A\u8FC7ingress\u5C06kibana\u8FDB\u884C\u66B4\u9732</p></blockquote><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# vim kibana.yaml</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">apps/v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Deployment</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">matchLabels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">template</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">containers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">harbor.jiangxl.com/efk/kibana:7.4.2</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">env</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ELASTICSEARCH_URL</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#429988;">value</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">http://elasticsearch:9200</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">containerPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">5601</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">volumeMounts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">							</span><span style="color:#758575;">#\u5C06pvc\u6302\u8F7D\u5230\u6570\u636E\u76EE\u5F55\uFF0C\u5B9E\u73B0\u6301\u4E45\u5316</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/usr/share/kibana/data</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">initContainers</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">									</span><span style="color:#758575;">#\u5B9A\u4E49\u4E00\u4E2A\u521D\u59CB\u5316\u5BB9\u5668\uFF0C\u5C06pvc\u8FDB\u884C\u6302\u8F7D\uFF0C\u7136\u540E\u4FEE\u6539\u76EE\u5F55\u6743\u9650\uFF0C\u5F53\u4E3B\u5BB9\u5668kibana\u542F\u52A8\u65F6\u5C31\u6709\u6743\u9650\u5199\u5165\u6570\u636E\u4E86</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana-permissions</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">command</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">[</span><span style="color:#C98A7D;">&quot;sh&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;-c&quot;</span><span style="color:#858585;">,</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;chown -R 1000:1000 /usr/share/kibana&quot;</span><span style="color:#858585;">]</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">securityContext</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">privileged</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">volumeMounts</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/usr/share/kibana/data</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">volumes</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">							</span><span style="color:#758575;">#\u5B9A\u4E49pvc</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">persistentVolumeClaim</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">claimName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana-pvc</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">readOnly</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">false</span></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Service</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">5601</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">protocol</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">TCP</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">targetPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">5601</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterIP</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">extensions/v1beta1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Ingress</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">rules</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">host</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana.jiangxl.com</span><span style="color:#DBD7CA;">					</span><span style="color:#758575;">#\u8FD9\u4E2A\u57DF\u540D\u8981\u5199\u5230Windows\u7684hosts\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">http</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">paths</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">backend</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">serviceName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kibana</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">servicePort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">5601</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# vim kibana.yaml</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">apps/v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Deployment</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">matchLabels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">template</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">containers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">harbor.jiangxl.com/efk/kibana:7.4.2</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">env</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ELASTICSEARCH_URL</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#2F8A89;">value</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">http://elasticsearch:9200</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">containerPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">5601</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">volumeMounts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">							</span><span style="color:#A0ADA0;">#\u5C06pvc\u6302\u8F7D\u5230\u6570\u636E\u76EE\u5F55\uFF0C\u5B9E\u73B0\u6301\u4E45\u5316</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/usr/share/kibana/data</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">initContainers</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">									</span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u4E00\u4E2A\u521D\u59CB\u5316\u5BB9\u5668\uFF0C\u5C06pvc\u8FDB\u884C\u6302\u8F7D\uFF0C\u7136\u540E\u4FEE\u6539\u76EE\u5F55\u6743\u9650\uFF0C\u5F53\u4E3B\u5BB9\u5668kibana\u542F\u52A8\u65F6\u5C31\u6709\u6743\u9650\u5199\u5165\u6570\u636E\u4E86</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana-permissions</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">command</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">&quot;sh&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;-c&quot;</span><span style="color:#8E8F8B;">,</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;chown -R 1000:1000 /usr/share/kibana&quot;</span><span style="color:#8E8F8B;">]</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">securityContext</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">privileged</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">true</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">volumeMounts</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/usr/share/kibana/data</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">volumes</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">							</span><span style="color:#A0ADA0;">#\u5B9A\u4E49pvc</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">persistentVolumeClaim</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">claimName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana-pvc</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">readOnly</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">false</span></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Service</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">5601</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">protocol</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">TCP</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">targetPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">5601</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterIP</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">extensions/v1beta1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Ingress</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">rules</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">host</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana.jiangxl.com</span><span style="color:#393A34;">					</span><span style="color:#A0ADA0;">#\u8FD9\u4E2A\u57DF\u540D\u8981\u5199\u5230Windows\u7684hosts\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">http</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">paths</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">backend</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">serviceName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kibana</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">servicePort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">5601</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-3-4-\u521B\u5EFAkibana\u8D44\u6E90\u5E76\u67E5\u770B\u72B6\u6001" tabindex="-1">2.3.4.\u521B\u5EFAkibana\u8D44\u6E90\u5E76\u67E5\u770B\u72B6\u6001 <a class="header-anchor" href="#_2-3-4-\u521B\u5EFAkibana\u8D44\u6E90\u5E76\u67E5\u770B\u72B6\u6001" aria-hidden="true">#</a></h4><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl create -f kibana.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">deployment.apps/kibana created</span></span>
<span class="line"><span style="color:#DBD7CA;">service/kibana created</span></span>
<span class="line"><span style="color:#DBD7CA;">ingress.extensions/kibana created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u67E5\u770B\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get pod,svc,ingress -n efk</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                          READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/elasticsearch-0           1/1     Running   0          18s</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/kibana-58cfc9fdc5-qqljb   1/1     Running   0          26m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT</span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">S</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">    AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">service/elasticsearch   ClusterIP   10.110.161.181   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">        9200/TCP   4h8m</span></span>
<span class="line"><span style="color:#DBD7CA;">service/kibana          ClusterIP   10.109.237.120   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">        5601/TCP   26m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                        CLASS    HOSTS                ADDRESS   PORTS   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">ingress.extensions/kibana   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">   kibana.jiangxl.com             80      26m</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl create -f kibana.yaml</span></span>
<span class="line"><span style="color:#393A34;">deployment.apps/kibana created</span></span>
<span class="line"><span style="color:#393A34;">service/kibana created</span></span>
<span class="line"><span style="color:#393A34;">ingress.extensions/kibana created</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u67E5\u770B\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get pod,svc,ingress -n efk</span></span>
<span class="line"><span style="color:#393A34;">NAME                          READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#393A34;">pod/elasticsearch-0           1/1     Running   0          18s</span></span>
<span class="line"><span style="color:#393A34;">pod/kibana-58cfc9fdc5-qqljb   1/1     Running   0          26m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT</span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">S</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">    AGE</span></span>
<span class="line"><span style="color:#393A34;">service/elasticsearch   ClusterIP   10.110.161.181   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">        9200/TCP   4h8m</span></span>
<span class="line"><span style="color:#393A34;">service/kibana          ClusterIP   10.109.237.120   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">        5601/TCP   26m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                        CLASS    HOSTS                ADDRESS   PORTS   AGE</span></span>
<span class="line"><span style="color:#393A34;">ingress.extensions/kibana   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">   kibana.jiangxl.com             80      26m</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-3-5-\u8BBF\u95EEkibana" tabindex="-1">2.3.5.\u8BBF\u95EEkibana <a class="header-anchor" href="#_2-3-5-\u8BBF\u95EEkibana" aria-hidden="true">#</a></h4><blockquote><p>\u6211\u4EEC\u7684ingress 80\u7AEF\u53E3\u6620\u5C04\u5728node\u8282\u70B9\u768480\u7AEF\u53E3\uFF0C443\u7AEF\u53E3\u6620\u5C04\u5728node\u8282\u70B9\u7684443\u7AEF\u53E3</p><p>\u76F4\u63A5\u5728Windows\u4E0A\u7ED1\u4E0Anode\u8282\u70B9\u5730\u5740\u548Ckibana\u57DF\u540D\u5373\u53EF\u8BBF\u95EEkibana</p><p><a href="http://kibana.jiangxl.com" target="_blank" rel="noopener noreferrer">http://kibana.jiangxl.com</a></p></blockquote><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044817_620c1191081b724117.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_nginx_07"></p><h3 id="_2-4-\u90E8\u7F72fluentd" tabindex="-1">2.4.\u90E8\u7F72fluentd <a class="header-anchor" href="#_2-4-\u90E8\u7F72fluentd" aria-hidden="true">#</a></h3><blockquote><ul><li>fluentd\u662F\u65E5\u5FD7\u91C7\u96C6\u670D\u52A1\uFF0Ckubernetes\u96C6\u7FA4\u7684\u6BCF\u4E2Anode\u8282\u70B9\u90FD\u6709\u65E5\u5FD7\u4EA7\u751F\uFF0C\u56E0\u6B64\u9700\u8981\u4F7F\u7528daemonset\u7684\u6A21\u5F0F\u8FDB\u884C\u90E8\u7F72\uFF0C\u6536\u96C6node\u8282\u70B9\u4EA7\u751F\u7684\u7EC4\u4EF6\u65E5\u5FD7</li><li>\u65E5\u5FD7\u91C7\u96C6\uFF0C\u9700\u8981\u91C7\u96C6\u54EA\u4E9B\u76EE\u5F55\u4E0B\u7684\u65E5\u5FD7\uFF0C\u91C7\u96C6\u540E\u53D1\u9001\u5230es\u7AEF\uFF0C\u56E0\u6B64\u9700\u8981\u914D\u7F6E\u7684\u5185\u5BB9\u6BD4\u8F83\u591A\uFF0C\u6211\u4EEC\u9009\u62E9\u4F7F\u7528configmap\u7684\u65B9\u5F0F\u628A\u914D\u7F6E\u6587\u4EF6\u6574\u4E2A\u6302\u8F7D\u51FA\u6765</li></ul></blockquote><h4 id="_2-4-1-\u521B\u5EFAfluentd\u914D\u7F6E\u6587\u4EF6\u7684configmap\u8D44\u6E90" tabindex="-1">2.4.1.\u521B\u5EFAfluentd\u914D\u7F6E\u6587\u4EF6\u7684configmap\u8D44\u6E90 <a class="header-anchor" href="#_2-4-1-\u521B\u5EFAfluentd\u914D\u7F6E\u6587\u4EF6\u7684configmap\u8D44\u6E90" aria-hidden="true">#</a></h4><blockquote><p>\u7F16\u8F91\u4E3B\u914D\u7F6E\u6587\u4EF6\uFF0C\u589E\u52A0\u4E00\u4E2Ainclude\uFF0C\u5F15\u5165\u5176\u4ED6\u76EE\u5F55\u7684\u914D\u7F6E\u6587\u4EF6</p></blockquote><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">1.\u7F16\u5199yaml</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# vim fluentd-es-main.yaml</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ConfigMap</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">addonmanager.kubernetes.io/mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Reconcile</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es-config-main</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#429988;">data</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">fluent.conf</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">|</span><span style="color:#CB7676;">-</span></span>
<span class="line"><span style="color:#C98A7D;">    &lt;match fluent.**&gt;</span></span>
<span class="line"><span style="color:#C98A7D;">    @type null</span></span>
<span class="line"><span style="color:#C98A7D;">    &lt;/match&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">    @include /fluentd/etc/config.d/*.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# kubectl create -f fluentd-es-main.yaml</span></span>
<span class="line"><span style="color:#C98A7D;">configmap/fluentd-es-config-main created</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">1.\u7F16\u5199yaml</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# vim fluentd-es-main.yaml</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ConfigMap</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">addonmanager.kubernetes.io/mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Reconcile</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es-config-main</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#2F8A89;">data</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">fluent.conf</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">|</span><span style="color:#AB5959;">-</span></span>
<span class="line"><span style="color:#B56959;">    &lt;match fluent.**&gt;</span></span>
<span class="line"><span style="color:#B56959;">    @type null</span></span>
<span class="line"><span style="color:#B56959;">    &lt;/match&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">    @include /fluentd/etc/config.d/*.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# kubectl create -f fluentd-es-main.yaml</span></span>
<span class="line"><span style="color:#B56959;">configmap/fluentd-es-config-main created</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-4-2-\u521B\u5EFAfluentd\u65E5\u5FD7\u6536\u96C6\u7684configmap" tabindex="-1">2.4.2.\u521B\u5EFAfluentd\u65E5\u5FD7\u6536\u96C6\u7684configmap <a class="header-anchor" href="#_2-4-2-\u521B\u5EFAfluentd\u65E5\u5FD7\u6536\u96C6\u7684configmap" aria-hidden="true">#</a></h4><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u7F16\u5199yaml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> vi fluentd-config.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">kind: ConfigMap</span></span>
<span class="line"><span style="color:#DBD7CA;">apiVersion: v1</span></span>
<span class="line"><span style="color:#DBD7CA;">metadata:</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: fluentd-config</span></span>
<span class="line"><span style="color:#DBD7CA;">  namespace: efk</span></span>
<span class="line"><span style="color:#DBD7CA;">  labels:</span></span>
<span class="line"><span style="color:#DBD7CA;">    addonmanager.kubernetes.io/mode: Reconcile</span></span>
<span class="line"><span style="color:#DBD7CA;">data:</span></span>
<span class="line"><span style="color:#DBD7CA;">  containers.input.conf: </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">-              </span><span style="color:#758575;">#\u5B9A\u4E49\u65E5\u5FD7\u6E90</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">source</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                                            </span><span style="color:#758575;">#\u65E5\u5FD7\u6765\u6E90</span></span>
<span class="line"><span style="color:#DBD7CA;">      @id fluentd-containers.log</span></span>
<span class="line"><span style="color:#DBD7CA;">      @type tail                    </span><span style="color:#758575;">#\u7C7B\u578B\u4E3Atail\uFF0C\u8FFD\u8E2A\u65E5\u5FD7\u7684\u8F93\u51FA</span></span>
<span class="line"><span style="color:#DBD7CA;">      path /var/log/containers/</span><span style="color:#CB7676;">*</span><span style="color:#DBD7CA;">.log                       </span><span style="color:#758575;">#\u65E5\u5FD7\u6240\u5728\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#DBD7CA;">      pos_file /var/log/es-containers.log.pos</span></span>
<span class="line"><span style="color:#DBD7CA;">      time_format %Y-%m-%dT%H:%M:%S.%NZ</span></span>
<span class="line"><span style="color:#DBD7CA;">      localtime</span></span>
<span class="line"><span style="color:#DBD7CA;">      tag raw.kubernetes.</span><span style="color:#CB7676;">*</span></span>
<span class="line"><span style="color:#DBD7CA;">      format json</span></span>
<span class="line"><span style="color:#DBD7CA;">      read_from_head </span><span style="color:#E0A569;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/source</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#858585;">    </span><span style="color:#758575;"># Detect exceptions in the log output and forward them as one log entry.</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">match raw.kubernetes.</span><span style="color:#CB7676;">**&gt;</span><span style="color:#DBD7CA;">             </span><span style="color:#758575;">#\u5B9A\u4E49\u5F02\u5E38\u65E5\u5FD7\u5904\u7406\u65B9\u5F0F\uFF0C\u5373\u591A\u884C\u62A5\u9519\u6536\u96C6\u5728\u4E00\u8D77              </span></span>
<span class="line"><span style="color:#DBD7CA;">      @id raw.kubernetes</span></span>
<span class="line"><span style="color:#DBD7CA;">      @type detect_exceptions</span></span>
<span class="line"><span style="color:#DBD7CA;">      remove_tag_prefix raw</span></span>
<span class="line"><span style="color:#DBD7CA;">      message log</span></span>
<span class="line"><span style="color:#DBD7CA;">      stream stream</span></span>
<span class="line"><span style="color:#DBD7CA;">      multiline_flush_interval 5</span></span>
<span class="line"><span style="color:#DBD7CA;">      max_bytes 500000</span></span>
<span class="line"><span style="color:#DBD7CA;">      max_lines 1000</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/match</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">  forward.input.conf: </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">-</span></span>
<span class="line"><span style="color:#858585;">    </span><span style="color:#758575;"># Takes the messages sent over TCP</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">source</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">      @type forward</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/source</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">  output.conf: </span><span style="color:#CB7676;">|</span><span style="color:#DBD7CA;">-						</span><span style="color:#758575;">#\u8FD9\u4E2A\u6587\u4EF6\u7528\u4E8E\u5B9A\u4E49\u5C06\u65E5\u5FD7\u8F93\u51FA\u7ED9\u8C01\uFF0C\u53EF\u4EE5\u662Fes\u3001kafka</span></span>
<span class="line"><span style="color:#858585;">    </span><span style="color:#758575;"># Enriches records with Kubernetes metadata</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">filter kubernetes.</span><span style="color:#CB7676;">**&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">      @type kubernetes_metadata</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/filter</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">match </span><span style="color:#CB7676;">**&gt;</span><span style="color:#DBD7CA;">                       </span><span style="color:#758575;">#\u5B9A\u4E49\u65E5\u5FD7\u5B58\u50A8\u5728\u54EA</span></span>
<span class="line"><span style="color:#DBD7CA;">      @id elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">      @type elasticsearch            </span><span style="color:#758575;">#\u7C7B\u578B\u4E3Aelasticsearch\uFF0C\u8868\u793A\u5B58\u50A8\u5728es\u4E2D</span></span>
<span class="line"><span style="color:#DBD7CA;">      @log_level info</span></span>
<span class="line"><span style="color:#DBD7CA;">      include_tag_key </span><span style="color:#E0A569;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">      host elasticsearch           </span><span style="color:#758575;">#es\u7684\u5730\u5740</span></span>
<span class="line"><span style="color:#DBD7CA;">      port 9200</span></span>
<span class="line"><span style="color:#DBD7CA;">      logstash_format </span><span style="color:#E0A569;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">      request_timeout    30s</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">buffer</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">                       </span><span style="color:#758575;">#\u5B9A\u4E49\u7F13\u5B58\u533A\uFF0C\u907F\u514Des\u6302\u6389\u540E\uFF0C\u6570\u636E\u4E22\u5931\uFF0Ces\u6302\u6389\u4E4B\u540E\uFF0C\u6570\u636E\u5199\u5165\u5230\u7F13\u533A</span></span>
<span class="line"><span style="color:#DBD7CA;">        @type file           </span><span style="color:#758575;">#\u7F13\u5B58\u533A\u7C7B\u578B\u4E3A\u6587\u4EF6\uFF0C\u8868\u793A\u5C06\u6570\u636E\u7F13\u5B58\u5230\u6587\u4EF6</span></span>
<span class="line"><span style="color:#DBD7CA;">        path /var/log/fluentd-buffers/kubernetes.system.buffer        </span><span style="color:#758575;">#\u7F13\u5B58\u6587\u4EF6\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#DBD7CA;">        flush_mode interval                     </span><span style="color:#758575;">#\u63A8\u9001\u6A21\u5F0F\u4E3A\u65F6\u95F4\uFF0C\u6839\u636E\u65F6\u95F4\u7684\u957F\u4E45\u5237\u65B0\u6570\u636E\u5230es</span></span>
<span class="line"><span style="color:#DBD7CA;">        retry_type exponential_backoff</span></span>
<span class="line"><span style="color:#DBD7CA;">        flush_thread_count 2       </span></span>
<span class="line"><span style="color:#DBD7CA;">        flush_interval 5s      </span><span style="color:#758575;">#5\u79D2\u540C\u6B65\u4E00\u6B21</span></span>
<span class="line"><span style="color:#DBD7CA;">        retry_forever</span></span>
<span class="line"><span style="color:#DBD7CA;">        retry_max_interval 30</span></span>
<span class="line"><span style="color:#DBD7CA;">        chunk_limit_size 2M            </span><span style="color:#758575;">#\u7F13\u51B2\u671F\u5757\u5927\u5C0F\uFF0C\u5F53\u8D85\u8FC7\u8FD9\u4E2A\u5927\u5C0F\u65F6\u5C31\u5199\u5165es</span></span>
<span class="line"><span style="color:#DBD7CA;">        queue_limit_length 8           </span><span style="color:#758575;">#\u5757\u7684\u4E2A\u6570\u4E3A8\uFF0C\u537316M</span></span>
<span class="line"><span style="color:#DBD7CA;">        overflow_action block</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/buffer</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">/match</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl create -f fluentd-config.yaml </span></span>
<span class="line"><span style="color:#DBD7CA;">configmap/fluentd-config created</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u7F16\u5199yaml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> vi fluentd-config.yaml</span></span>
<span class="line"><span style="color:#393A34;">kind: ConfigMap</span></span>
<span class="line"><span style="color:#393A34;">apiVersion: v1</span></span>
<span class="line"><span style="color:#393A34;">metadata:</span></span>
<span class="line"><span style="color:#393A34;">  name: fluentd-config</span></span>
<span class="line"><span style="color:#393A34;">  namespace: efk</span></span>
<span class="line"><span style="color:#393A34;">  labels:</span></span>
<span class="line"><span style="color:#393A34;">    addonmanager.kubernetes.io/mode: Reconcile</span></span>
<span class="line"><span style="color:#393A34;">data:</span></span>
<span class="line"><span style="color:#393A34;">  containers.input.conf: </span><span style="color:#AB5959;">|</span><span style="color:#393A34;">-              </span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u65E5\u5FD7\u6E90</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">source</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                                            </span><span style="color:#A0ADA0;">#\u65E5\u5FD7\u6765\u6E90</span></span>
<span class="line"><span style="color:#393A34;">      @id fluentd-containers.log</span></span>
<span class="line"><span style="color:#393A34;">      @type tail                    </span><span style="color:#A0ADA0;">#\u7C7B\u578B\u4E3Atail\uFF0C\u8FFD\u8E2A\u65E5\u5FD7\u7684\u8F93\u51FA</span></span>
<span class="line"><span style="color:#393A34;">      path /var/log/containers/</span><span style="color:#AB5959;">*</span><span style="color:#393A34;">.log                       </span><span style="color:#A0ADA0;">#\u65E5\u5FD7\u6240\u5728\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#393A34;">      pos_file /var/log/es-containers.log.pos</span></span>
<span class="line"><span style="color:#393A34;">      time_format %Y-%m-%dT%H:%M:%S.%NZ</span></span>
<span class="line"><span style="color:#393A34;">      localtime</span></span>
<span class="line"><span style="color:#393A34;">      tag raw.kubernetes.</span><span style="color:#AB5959;">*</span></span>
<span class="line"><span style="color:#393A34;">      format json</span></span>
<span class="line"><span style="color:#393A34;">      read_from_head </span><span style="color:#B58451;">true</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/source</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#8E8F8B;">    </span><span style="color:#A0ADA0;"># Detect exceptions in the log output and forward them as one log entry.</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">match raw.kubernetes.</span><span style="color:#AB5959;">**&gt;</span><span style="color:#393A34;">             </span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u5F02\u5E38\u65E5\u5FD7\u5904\u7406\u65B9\u5F0F\uFF0C\u5373\u591A\u884C\u62A5\u9519\u6536\u96C6\u5728\u4E00\u8D77              </span></span>
<span class="line"><span style="color:#393A34;">      @id raw.kubernetes</span></span>
<span class="line"><span style="color:#393A34;">      @type detect_exceptions</span></span>
<span class="line"><span style="color:#393A34;">      remove_tag_prefix raw</span></span>
<span class="line"><span style="color:#393A34;">      message log</span></span>
<span class="line"><span style="color:#393A34;">      stream stream</span></span>
<span class="line"><span style="color:#393A34;">      multiline_flush_interval 5</span></span>
<span class="line"><span style="color:#393A34;">      max_bytes 500000</span></span>
<span class="line"><span style="color:#393A34;">      max_lines 1000</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/match</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">  forward.input.conf: </span><span style="color:#AB5959;">|</span><span style="color:#393A34;">-</span></span>
<span class="line"><span style="color:#8E8F8B;">    </span><span style="color:#A0ADA0;"># Takes the messages sent over TCP</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">source</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">      @type forward</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/source</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">  output.conf: </span><span style="color:#AB5959;">|</span><span style="color:#393A34;">-						</span><span style="color:#A0ADA0;">#\u8FD9\u4E2A\u6587\u4EF6\u7528\u4E8E\u5B9A\u4E49\u5C06\u65E5\u5FD7\u8F93\u51FA\u7ED9\u8C01\uFF0C\u53EF\u4EE5\u662Fes\u3001kafka</span></span>
<span class="line"><span style="color:#8E8F8B;">    </span><span style="color:#A0ADA0;"># Enriches records with Kubernetes metadata</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">filter kubernetes.</span><span style="color:#AB5959;">**&gt;</span></span>
<span class="line"><span style="color:#393A34;">      @type kubernetes_metadata</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/filter</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">match </span><span style="color:#AB5959;">**&gt;</span><span style="color:#393A34;">                       </span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u65E5\u5FD7\u5B58\u50A8\u5728\u54EA</span></span>
<span class="line"><span style="color:#393A34;">      @id elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">      @type elasticsearch            </span><span style="color:#A0ADA0;">#\u7C7B\u578B\u4E3Aelasticsearch\uFF0C\u8868\u793A\u5B58\u50A8\u5728es\u4E2D</span></span>
<span class="line"><span style="color:#393A34;">      @log_level info</span></span>
<span class="line"><span style="color:#393A34;">      include_tag_key </span><span style="color:#B58451;">true</span></span>
<span class="line"><span style="color:#393A34;">      host elasticsearch           </span><span style="color:#A0ADA0;">#es\u7684\u5730\u5740</span></span>
<span class="line"><span style="color:#393A34;">      port 9200</span></span>
<span class="line"><span style="color:#393A34;">      logstash_format </span><span style="color:#B58451;">true</span></span>
<span class="line"><span style="color:#393A34;">      request_timeout    30s</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">buffer</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">                       </span><span style="color:#A0ADA0;">#\u5B9A\u4E49\u7F13\u5B58\u533A\uFF0C\u907F\u514Des\u6302\u6389\u540E\uFF0C\u6570\u636E\u4E22\u5931\uFF0Ces\u6302\u6389\u4E4B\u540E\uFF0C\u6570\u636E\u5199\u5165\u5230\u7F13\u533A</span></span>
<span class="line"><span style="color:#393A34;">        @type file           </span><span style="color:#A0ADA0;">#\u7F13\u5B58\u533A\u7C7B\u578B\u4E3A\u6587\u4EF6\uFF0C\u8868\u793A\u5C06\u6570\u636E\u7F13\u5B58\u5230\u6587\u4EF6</span></span>
<span class="line"><span style="color:#393A34;">        path /var/log/fluentd-buffers/kubernetes.system.buffer        </span><span style="color:#A0ADA0;">#\u7F13\u5B58\u6587\u4EF6\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#393A34;">        flush_mode interval                     </span><span style="color:#A0ADA0;">#\u63A8\u9001\u6A21\u5F0F\u4E3A\u65F6\u95F4\uFF0C\u6839\u636E\u65F6\u95F4\u7684\u957F\u4E45\u5237\u65B0\u6570\u636E\u5230es</span></span>
<span class="line"><span style="color:#393A34;">        retry_type exponential_backoff</span></span>
<span class="line"><span style="color:#393A34;">        flush_thread_count 2       </span></span>
<span class="line"><span style="color:#393A34;">        flush_interval 5s      </span><span style="color:#A0ADA0;">#5\u79D2\u540C\u6B65\u4E00\u6B21</span></span>
<span class="line"><span style="color:#393A34;">        retry_forever</span></span>
<span class="line"><span style="color:#393A34;">        retry_max_interval 30</span></span>
<span class="line"><span style="color:#393A34;">        chunk_limit_size 2M            </span><span style="color:#A0ADA0;">#\u7F13\u51B2\u671F\u5757\u5927\u5C0F\uFF0C\u5F53\u8D85\u8FC7\u8FD9\u4E2A\u5927\u5C0F\u65F6\u5C31\u5199\u5165es</span></span>
<span class="line"><span style="color:#393A34;">        queue_limit_length 8           </span><span style="color:#A0ADA0;">#\u5757\u7684\u4E2A\u6570\u4E3A8\uFF0C\u537316M</span></span>
<span class="line"><span style="color:#393A34;">        overflow_action block</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/buffer</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">/match</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl create -f fluentd-config.yaml </span></span>
<span class="line"><span style="color:#393A34;">configmap/fluentd-config created</span></span>
<span class="line"></span></code></pre></div><h4 id="_2-4-3-\u521B\u5EFAfluentd-daemonset\u8D44\u6E90" tabindex="-1">2.4.3.\u521B\u5EFAfluentd daemonset\u8D44\u6E90 <a class="header-anchor" href="#_2-4-3-\u521B\u5EFAfluentd-daemonset\u8D44\u6E90" aria-hidden="true">#</a></h4><blockquote><ul><li>\u9700\u8981\u914D\u7F6Erbac\u89C4\u5219\uFF0C\u56E0\u4E3A\u9700\u8981\u8BBF\u95EEk8s api\u53BB\u6839\u636E\u65E5\u5FD7\u67E5\u8BE2\u5143\u6570\u636E</li><li>\u9700\u8981\u5C06/var/log/containers/\u76EE\u5F55\u6302\u8F7D\u5230\u5BB9\u5668\u4E2D</li><li>\u9700\u8981\u5C06fluentd\u7684configmap\u4E2D\u7684\u914D\u7F6E\u6587\u4EF6\u6302\u8F7D\u5230\u5BB9\u5668\u5185</li><li>\u7531\u4E8Epod\u65E5\u5FD7\u90FD\u662F\u5B58\u50A8\u5728node\u8282\u70B9\u7684/var/log/containers\u76EE\u5F55\u4E2D\uFF0C\u4E3A\u4E86\u6536\u96C6\u6240\u6709\u8282\u70B9\u7684pod\u65E5\u5FD7\uFF0C\u56E0\u6B64\u9700\u8981\u91C7\u7528daemonset\u91C7\u7528\u90E8\u7F72fluentd</li></ul></blockquote><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">1.\u51C6\u5907fluentd\u955C\u50CF\u5E76\u63A8\u9001\u81F3harbor</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# docker tag fluent/fluentd:v1.6.2-1.0 harbor.jiangxl.com/efk/fluentd:v1.6.2-1.0</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# docker push harbor.jiangxl.com/efk/fluentd:v1.6.2-1.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C98A7D;">2.\u7F16\u5199fluentd yaml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# vim fluentd-daemonset.yaml</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ServiceAccount</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">kubernetes.io/cluster-service</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">addonmanager.kubernetes.io/mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Reconcile</span></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterRole</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">kubernetes.io/cluster-service</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">addonmanager.kubernetes.io/mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Reconcile</span></span>
<span class="line"><span style="color:#429988;">rules</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">apiGroups</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">resources</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;namespaces&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;pods&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">verbs</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;get&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;watch&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;list&quot;</span></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">kubernetes.io/cluster-service</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">addonmanager.kubernetes.io/mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Reconcile</span></span>
<span class="line"><span style="color:#429988;">subjects</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ServiceAccount</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">apiGroup</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;&quot;</span></span>
<span class="line"><span style="color:#429988;">roleRef</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterRole</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">apiGroup</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;&quot;</span></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">apps/v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">DaemonSet</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">addonmanager.kubernetes.io/mode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Reconcile</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">efk</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">matchLabels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">template</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">k8s-app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">containers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">env</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">FLUENTD_ARGS</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">value</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">--no-supervisor -q</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">harbor.jiangxl.com/efk/fluentd-es-root:v1.6.2-1.0</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">imagePullPolicy</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">IfNotPresent</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">resources</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">limits</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#429988;">memory</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">500Mi</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">requests</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#429988;">cpu</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">100m</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#429988;">memory</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">200Mi</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">volumeMounts</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/var/log</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">varlog</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/var/lib/docker/containers</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">varlibdockercontainers</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">readOnly</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/home/docker/containers</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">varlibdockercontainershome</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">readOnly</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#4D9375;">true</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/fluentd/etc/config.d</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">config-volume</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">mountPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/fluentd/etc/fluent.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">config-volume-main</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">subPath</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluent.conf</span></span>
<span class="line"><span style="color:#858585;">      </span><span style="color:#758575;">#nodeName: k8s-node2</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">securityContext</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">{}</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">serviceAccount</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">serviceAccountName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">volumes</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hostPath</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/var/log</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">varlog</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hostPath</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/var/lib/docker/containers</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">varlibdockercontainers</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hostPath</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">/home/docker/containers</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;&quot;</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">varlibdockercontainershome</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">configMap</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">defaultMode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">420</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-config</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">config-volume</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">configMap</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">defaultMode</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">420</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">items</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">key</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluent.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluent.conf</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">fluentd-es-config-main</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">config-volume-main</span></span>
<span class="line"><span style="color:#6394BF;">1.2.3.4.5.6.7.8.9.10.11.12.13.14.15.16.17.18.19.20.21.22.23.24.25.26.27.28.29.30.31.32.33.34.35.36.37.38.39.40.41.42.43.44.45.46.47.48.49.50.51.52.53.54.55.56.57.58.59.60.61.62.63.64.65.66.67.68.69.70.71.72.73.74.75.76.77.78.79.80.81.82.83.84.85.86.87.88.89.90.91.92.93.94.95.96.97.98.99.100.101.102.103.104.105.106.107.108.109.110.111.112.113.114.115.116.117.118.119.120.121.122.123.124.125.</span></span>
<span class="line"><span style="color:#C98A7D;">3.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#C98A7D;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#C98A7D;">\\# kubectl create -f fluentd-daemonset.yaml</span></span>
<span class="line"><span style="color:#C98A7D;">serviceaccount/fluentd-es created</span></span>
<span class="line"><span style="color:#C98A7D;">clusterrole.rbac.authorization.k8s.io/fluentd-es created</span></span>
<span class="line"><span style="color:#C98A7D;">clusterrolebinding.rbac.authorization.k8s.io/fluentd-es created</span></span>
<span class="line"><span style="color:#C98A7D;">daemonset.apps/fluentd-es created</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">1.\u51C6\u5907fluentd\u955C\u50CF\u5E76\u63A8\u9001\u81F3harbor</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# docker tag fluent/fluentd:v1.6.2-1.0 harbor.jiangxl.com/efk/fluentd:v1.6.2-1.0</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# docker push harbor.jiangxl.com/efk/fluentd:v1.6.2-1.0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B56959;">2.\u7F16\u5199fluentd yaml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# vim fluentd-daemonset.yaml</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ServiceAccount</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">kubernetes.io/cluster-service</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">addonmanager.kubernetes.io/mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Reconcile</span></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterRole</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">kubernetes.io/cluster-service</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">addonmanager.kubernetes.io/mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Reconcile</span></span>
<span class="line"><span style="color:#2F8A89;">rules</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">apiGroups</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">resources</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;namespaces&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;pods&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">verbs</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;get&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;watch&quot;</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;list&quot;</span></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">kubernetes.io/cluster-service</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;true&quot;</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">addonmanager.kubernetes.io/mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Reconcile</span></span>
<span class="line"><span style="color:#2F8A89;">subjects</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ServiceAccount</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">apiGroup</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;&quot;</span></span>
<span class="line"><span style="color:#2F8A89;">roleRef</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterRole</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">apiGroup</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;&quot;</span></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">apps/v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">DaemonSet</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">addonmanager.kubernetes.io/mode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Reconcile</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">efk</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">matchLabels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">template</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">k8s-app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">containers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">env</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">FLUENTD_ARGS</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">value</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">--no-supervisor -q</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">harbor.jiangxl.com/efk/fluentd-es-root:v1.6.2-1.0</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">imagePullPolicy</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">IfNotPresent</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">resources</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">limits</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#2F8A89;">memory</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">500Mi</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">requests</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#2F8A89;">cpu</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">100m</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#2F8A89;">memory</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">200Mi</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">volumeMounts</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/var/log</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">varlog</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/var/lib/docker/containers</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">varlibdockercontainers</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">readOnly</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">true</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/home/docker/containers</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">varlibdockercontainershome</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">readOnly</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#1C6B48;">true</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/fluentd/etc/config.d</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">config-volume</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">mountPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/fluentd/etc/fluent.conf</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">config-volume-main</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">subPath</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluent.conf</span></span>
<span class="line"><span style="color:#8E8F8B;">      </span><span style="color:#A0ADA0;">#nodeName: k8s-node2</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">securityContext</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">{}</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">serviceAccount</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">serviceAccountName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">volumes</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hostPath</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/var/log</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">varlog</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hostPath</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/var/lib/docker/containers</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">varlibdockercontainers</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hostPath</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">/home/docker/containers</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;&quot;</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">varlibdockercontainershome</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">configMap</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">defaultMode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">420</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-config</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">config-volume</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">configMap</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">defaultMode</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">420</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">items</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">key</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluent.conf</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluent.conf</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">fluentd-es-config-main</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">config-volume-main</span></span>
<span class="line"><span style="color:#296AA3;">1.2.3.4.5.6.7.8.9.10.11.12.13.14.15.16.17.18.19.20.21.22.23.24.25.26.27.28.29.30.31.32.33.34.35.36.37.38.39.40.41.42.43.44.45.46.47.48.49.50.51.52.53.54.55.56.57.58.59.60.61.62.63.64.65.66.67.68.69.70.71.72.73.74.75.76.77.78.79.80.81.82.83.84.85.86.87.88.89.90.91.92.93.94.95.96.97.98.99.100.101.102.103.104.105.106.107.108.109.110.111.112.113.114.115.116.117.118.119.120.121.122.123.124.125.</span></span>
<span class="line"><span style="color:#B56959;">3.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#B56959;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#B56959;">\\# kubectl create -f fluentd-daemonset.yaml</span></span>
<span class="line"><span style="color:#B56959;">serviceaccount/fluentd-es created</span></span>
<span class="line"><span style="color:#B56959;">clusterrole.rbac.authorization.k8s.io/fluentd-es created</span></span>
<span class="line"><span style="color:#B56959;">clusterrolebinding.rbac.authorization.k8s.io/fluentd-es created</span></span>
<span class="line"><span style="color:#B56959;">daemonset.apps/fluentd-es created</span></span>
<span class="line"></span></code></pre></div><h3 id="_2-5-\u67E5\u770Befk\u6240\u6709\u7EC4\u4EF6\u8D44\u6E90\u72B6\u6001" tabindex="-1">2.5.\u67E5\u770Befk\u6240\u6709\u7EC4\u4EF6\u8D44\u6E90\u72B6\u6001 <a class="header-anchor" href="#_2-5-\u67E5\u770Befk\u6240\u6709\u7EC4\u4EF6\u8D44\u6E90\u72B6\u6001" aria-hidden="true">#</a></h3><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get all -n efk</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                          READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/elasticsearch-0           1/1     Running   0          27h</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/fluentd-es-nfgbj          1/1     Running   0          8m32s</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/fluentd-es-r2mhj          1/1     Running   0          8m32s</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/kibana-58cfc9fdc5-qqljb   1/1     Running   0          27h</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/test-efk                  1/1     Running   0          18m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT</span><span style="color:#858585;">(</span><span style="color:#DBD7CA;">S</span><span style="color:#858585;">)</span><span style="color:#DBD7CA;">          AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">service/elasticsearch   NodePort    10.110.161.181   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">        9200:39200/TCP   31h</span></span>
<span class="line"><span style="color:#DBD7CA;">service/kibana          ClusterIP   10.109.237.120   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">        5601/TCP         27h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">daemonset.apps/fluentd-es   2         2         2       2            2           </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">          8m32s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                     READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">deployment.apps/kibana   1/1     1            1           27h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                                DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">replicaset.apps/kibana-58cfc9fdc5   1         1         1       27h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">NAME                             READY   AGE</span></span>
<span class="line"><span style="color:#DBD7CA;">statefulset.apps/elasticsearch   1/1     31h</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get all -n efk</span></span>
<span class="line"><span style="color:#393A34;">NAME                          READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#393A34;">pod/elasticsearch-0           1/1     Running   0          27h</span></span>
<span class="line"><span style="color:#393A34;">pod/fluentd-es-nfgbj          1/1     Running   0          8m32s</span></span>
<span class="line"><span style="color:#393A34;">pod/fluentd-es-r2mhj          1/1     Running   0          8m32s</span></span>
<span class="line"><span style="color:#393A34;">pod/kibana-58cfc9fdc5-qqljb   1/1     Running   0          27h</span></span>
<span class="line"><span style="color:#393A34;">pod/test-efk                  1/1     Running   0          18m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT</span><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">S</span><span style="color:#8E8F8B;">)</span><span style="color:#393A34;">          AGE</span></span>
<span class="line"><span style="color:#393A34;">service/elasticsearch   NodePort    10.110.161.181   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">        9200:39200/TCP   31h</span></span>
<span class="line"><span style="color:#393A34;">service/kibana          ClusterIP   10.109.237.120   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">        5601/TCP         27h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                        DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span></span>
<span class="line"><span style="color:#393A34;">daemonset.apps/fluentd-es   2         2         2       2            2           </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">          8m32s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                     READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#393A34;">deployment.apps/kibana   1/1     1            1           27h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                                DESIRED   CURRENT   READY   AGE</span></span>
<span class="line"><span style="color:#393A34;">replicaset.apps/kibana-58cfc9fdc5   1         1         1       27h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">NAME                             READY   AGE</span></span>
<span class="line"><span style="color:#393A34;">statefulset.apps/elasticsearch   1/1     31h</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044817_620c11914da0258358.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_\u5176\u4ED6_08"></p><h3 id="_2-6-\u5C06es\u914D\u7F6E\u4E00\u4E2Anodeport\u7528\u4E8E\u67E5\u770B\u7D22\u5F15" tabindex="-1">2.6.\u5C06es\u914D\u7F6E\u4E00\u4E2Anodeport\u7528\u4E8E\u67E5\u770B\u7D22\u5F15 <a class="header-anchor" href="#_2-6-\u5C06es\u914D\u7F6E\u4E00\u4E2Anodeport\u7528\u4E8E\u67E5\u770B\u7D22\u5F15" aria-hidden="true">#</a></h3><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> vim elasticsearch.yaml </span></span>
<span class="line"><span style="color:#DBD7CA;">\xB7\xB7\xB7\xB7\xB7\xB7\xB7</span></span>
<span class="line"><span style="color:#DBD7CA;">apiVersion: v1</span></span>
<span class="line"><span style="color:#DBD7CA;">kind: Service</span></span>
<span class="line"><span style="color:#DBD7CA;">metadata:</span></span>
<span class="line"><span style="color:#DBD7CA;">  labels:</span></span>
<span class="line"><span style="color:#DBD7CA;">    k8s-app: elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">  namespace: efk</span></span>
<span class="line"><span style="color:#DBD7CA;">spec:</span></span>
<span class="line"><span style="color:#DBD7CA;">  ports:</span></span>
<span class="line"><span style="color:#DBD7CA;">  - port: 9200</span></span>
<span class="line"><span style="color:#DBD7CA;">    protocol: TCP</span></span>
<span class="line"><span style="color:#DBD7CA;">    targetPort: 9200</span></span>
<span class="line"><span style="color:#DBD7CA;">    nodePort: 39200</span></span>
<span class="line"><span style="color:#DBD7CA;">  selector:</span></span>
<span class="line"><span style="color:#DBD7CA;">    k8s-app: elasticsearch</span></span>
<span class="line"><span style="color:#DBD7CA;">  type: NodePort</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl apply -f elasticsearch.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">statefulset.apps/elasticsearch configured</span></span>
<span class="line"><span style="color:#DBD7CA;">service/elasticsearch configured</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> vim elasticsearch.yaml </span></span>
<span class="line"><span style="color:#393A34;">\xB7\xB7\xB7\xB7\xB7\xB7\xB7</span></span>
<span class="line"><span style="color:#393A34;">apiVersion: v1</span></span>
<span class="line"><span style="color:#393A34;">kind: Service</span></span>
<span class="line"><span style="color:#393A34;">metadata:</span></span>
<span class="line"><span style="color:#393A34;">  labels:</span></span>
<span class="line"><span style="color:#393A34;">    k8s-app: elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">  name: elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">  namespace: efk</span></span>
<span class="line"><span style="color:#393A34;">spec:</span></span>
<span class="line"><span style="color:#393A34;">  ports:</span></span>
<span class="line"><span style="color:#393A34;">  - port: 9200</span></span>
<span class="line"><span style="color:#393A34;">    protocol: TCP</span></span>
<span class="line"><span style="color:#393A34;">    targetPort: 9200</span></span>
<span class="line"><span style="color:#393A34;">    nodePort: 39200</span></span>
<span class="line"><span style="color:#393A34;">  selector:</span></span>
<span class="line"><span style="color:#393A34;">    k8s-app: elasticsearch</span></span>
<span class="line"><span style="color:#393A34;">  type: NodePort</span></span>
<span class="line"><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl apply -f elasticsearch.yaml</span></span>
<span class="line"><span style="color:#393A34;">statefulset.apps/elasticsearch configured</span></span>
<span class="line"><span style="color:#393A34;">service/elasticsearch configured</span></span>
<span class="line"></span></code></pre></div><h2 id="_3-\u9A8C\u8BC1efk\u96C6\u7FA4\u53EF\u7528\u6027" tabindex="-1">3.\u9A8C\u8BC1EFK\u96C6\u7FA4\u53EF\u7528\u6027 <a class="header-anchor" href="#_3-\u9A8C\u8BC1efk\u96C6\u7FA4\u53EF\u7528\u6027" aria-hidden="true">#</a></h2><h3 id="_3-1-\u8FD0\u884C\u4E00\u4E2Apod\u6301\u7EED\u4EA7\u751F\u65E5\u5FD7" tabindex="-1">3.1.\u8FD0\u884C\u4E00\u4E2Apod\u6301\u7EED\u4EA7\u751F\u65E5\u5FD7 <a class="header-anchor" href="#_3-1-\u8FD0\u884C\u4E00\u4E2Apod\u6301\u7EED\u4EA7\u751F\u65E5\u5FD7" aria-hidden="true">#</a></h3><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u7F16\u5199yaml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> vim test-efk.yaml </span></span>
<span class="line"><span style="color:#DBD7CA;">apiVersion: v1</span></span>
<span class="line"><span style="color:#DBD7CA;">kind: Pod</span></span>
<span class="line"><span style="color:#DBD7CA;">metadata:</span></span>
<span class="line"><span style="color:#DBD7CA;">  name: test-efk</span></span>
<span class="line"><span style="color:#DBD7CA;">  namespace: efk</span></span>
<span class="line"><span style="color:#DBD7CA;">spec:</span></span>
<span class="line"><span style="color:#DBD7CA;">  containers:</span></span>
<span class="line"><span style="color:#DBD7CA;">  - name: test-efk</span></span>
<span class="line"><span style="color:#DBD7CA;">    image: harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"><span style="color:#DBD7CA;">    args: </span><span style="color:#858585;">[</span><span style="color:#DBD7CA;">/bin/sh, </span><span style="color:#CB7676;">-c</span><span style="color:#DBD7CA;">,</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#C98A7D;">&#39;i=0; while true; do echo &quot;$i: $(date)&quot;; i=$((i+1)); sleep 1; done&#39;</span><span style="color:#858585;">]</span><span style="color:#DBD7CA;">			</span><span style="color:#758575;">#\u6BCF\u79D2\u8F93\u51FA\u4E00\u4E2A\u5F53\u524D\u65F6\u95F4</span></span>
<span class="line"><span style="color:#DBD7CA;">  nodeName: k8s-node2</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span></span>
<span class="line"><span style="color:#DBD7CA;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl create -f test-efk.yaml</span></span>
<span class="line"><span style="color:#DBD7CA;">pod/counter created</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u7F16\u5199yaml\u6587\u4EF6</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> vim test-efk.yaml </span></span>
<span class="line"><span style="color:#393A34;">apiVersion: v1</span></span>
<span class="line"><span style="color:#393A34;">kind: Pod</span></span>
<span class="line"><span style="color:#393A34;">metadata:</span></span>
<span class="line"><span style="color:#393A34;">  name: test-efk</span></span>
<span class="line"><span style="color:#393A34;">  namespace: efk</span></span>
<span class="line"><span style="color:#393A34;">spec:</span></span>
<span class="line"><span style="color:#393A34;">  containers:</span></span>
<span class="line"><span style="color:#393A34;">  - name: test-efk</span></span>
<span class="line"><span style="color:#393A34;">    image: harbor.jiangxl.com/efk/alpine:3.6</span></span>
<span class="line"><span style="color:#393A34;">    args: </span><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">/bin/sh, </span><span style="color:#AB5959;">-c</span><span style="color:#393A34;">,</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#B56959;">&#39;i=0; while true; do echo &quot;$i: $(date)&quot;; i=$((i+1)); sleep 1; done&#39;</span><span style="color:#8E8F8B;">]</span><span style="color:#393A34;">			</span><span style="color:#A0ADA0;">#\u6BCF\u79D2\u8F93\u51FA\u4E00\u4E2A\u5F53\u524D\u65F6\u95F4</span></span>
<span class="line"><span style="color:#393A34;">  nodeName: k8s-node2</span></span>
<span class="line"><span style="color:#393A34;">  </span></span>
<span class="line"><span style="color:#393A34;">2.\u521B\u5EFA\u8D44\u6E90</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl create -f test-efk.yaml</span></span>
<span class="line"><span style="color:#393A34;">pod/counter created</span></span>
<span class="line"></span></code></pre></div><h3 id="_3-2-\u89C2\u5BDFfluentd\u65E5\u5FD7\u8F93\u51FA" tabindex="-1">3.2.\u89C2\u5BDFfluentd\u65E5\u5FD7\u8F93\u51FA <a class="header-anchor" href="#_3-2-\u89C2\u5BDFfluentd\u65E5\u5FD7\u8F93\u51FA" aria-hidden="true">#</a></h3><div class="language-sh"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">1.\u67E5\u770Btest-efk\u8FD0\u884C\u5728\u54EA\u4E2Anode\u8282\u70B9</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl get pod -n efk -o wide</span></span>
<span class="line"><span style="color:#DBD7CA;">NAME                      READY   STATUS    RESTARTS   AGE    IP               NODE        NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#DBD7CA;">elasticsearch-0           1/1     Running   0          27h    100.64.169.189   k8s-node2   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">           </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">fluentd-es-nfgbj          1/1     Running   0          9m3s   100.64.169.149   k8s-node2   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">           </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">fluentd-es-r2mhj          1/1     Running   0          9m3s   100.111.156.91   k8s-node1   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">           </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">kibana-58cfc9fdc5-qqljb   1/1     Running   0          27h    100.111.156.75   k8s-node1   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">           </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">test-efk                  1/1     Running   0          18m    100.64.169.147   k8s-node2   </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">           </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">2.\u8FFD\u8E2A\u4E0Etest-efk pod\u8FD0\u884C\u5728\u540C\u4E00node\u8282\u70B9\u7684fluentd\u5BB9\u5668\u7684\u65E5\u5FD7</span></span>
<span class="line"><span style="color:#858585;">[</span><span style="color:#DBD7CA;">root@k8s-master1 EFK</span><span style="color:#858585;">]</span><span style="color:#D4976C;">\\#</span><span style="color:#DBD7CA;"> kubectl -n efk logs -f fluentd-es-nfgbj </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">1.\u67E5\u770Btest-efk\u8FD0\u884C\u5728\u54EA\u4E2Anode\u8282\u70B9</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl get pod -n efk -o wide</span></span>
<span class="line"><span style="color:#393A34;">NAME                      READY   STATUS    RESTARTS   AGE    IP               NODE        NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#393A34;">elasticsearch-0           1/1     Running   0          27h    100.64.169.189   k8s-node2   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">           </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">fluentd-es-nfgbj          1/1     Running   0          9m3s   100.64.169.149   k8s-node2   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">           </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">fluentd-es-r2mhj          1/1     Running   0          9m3s   100.111.156.91   k8s-node1   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">           </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">kibana-58cfc9fdc5-qqljb   1/1     Running   0          27h    100.111.156.75   k8s-node1   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">           </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">test-efk                  1/1     Running   0          18m    100.64.169.147   k8s-node2   </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">           </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">2.\u8FFD\u8E2A\u4E0Etest-efk pod\u8FD0\u884C\u5728\u540C\u4E00node\u8282\u70B9\u7684fluentd\u5BB9\u5668\u7684\u65E5\u5FD7</span></span>
<span class="line"><span style="color:#8E8F8B;">[</span><span style="color:#393A34;">root@k8s-master1 EFK</span><span style="color:#8E8F8B;">]</span><span style="color:#A65E2B;">\\#</span><span style="color:#393A34;"> kubectl -n efk logs -f fluentd-es-nfgbj </span></span>
<span class="line"></span></code></pre></div><p>\u5DF2\u7ECF\u6536\u96C6\u5230test-efk pod\u7684\u65E5\u5FD7\u4E86 <img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044817_620c1191963a769274.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_nginx_09"></p><h3 id="_3-3-\u89C2\u5BDFes\u4E0A\u7684\u7D22\u5F15\u53D8\u5316" tabindex="-1">3.3.\u89C2\u5BDFes\u4E0A\u7684\u7D22\u5F15\u53D8\u5316 <a class="header-anchor" href="#_3-3-\u89C2\u5BDFes\u4E0A\u7684\u7D22\u5F15\u53D8\u5316" aria-hidden="true">#</a></h3><blockquote><p>\u7531\u4E8E2.6\u4E2D\u5DF2\u7ECF\u5C06es\u76849200\u505A\u4E86\u4E00\u4E2Anodeport\u66B4\u9732\uFF0C\u53EF\u4EE5\u901A\u8FC7es-head\u63D2\u4EF6\u67E5\u770Bes\u7D22\u5F15\u5E93</p><p>\u53EF\u4EE5\u770B\u5230\u5728es\u4E0A\u5DF2\u7ECF\u6709\u7D22\u5F15\u4EA7\u751F\u4E86 <img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044817_620c1191f112c87951.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_docker_10"></p></blockquote><h3 id="_3-4-\u5728kibana\u4E0A\u5173\u8054es\u7D22\u5F15\u5E93" tabindex="-1">3.4.\u5728kibana\u4E0A\u5173\u8054es\u7D22\u5F15\u5E93 <a class="header-anchor" href="#_3-4-\u5728kibana\u4E0A\u5173\u8054es\u7D22\u5F15\u5E93" aria-hidden="true">#</a></h3><p><strong>1\uFF09\u70B9\u51FB\u8BBE\u7F6E\u2014&gt;index patterns\u2014&gt;create index pattern</strong></p><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044818_620c11924ad7b37598.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_docker_11"></p><p><strong>2\uFF09\u7D22\u5F15\u540D\u79F0\u586B\u5199logstash-*\u5373\u53EF\u5339\u914D\u6240\u6709logstash\u7684\u7D22\u5F15\u5E93</strong></p><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044818_620c11929a48715584.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_elasticsearch_12"></p><p><strong>3\uFF09\u5339\u914D\u6240\u6709\u5B57\u6BB5\uFF0C\u70B9\u51FB\u521B\u5EFA\u7D22\u5F15</strong><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044818_620c1192f3c2f49565.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_nginx_13"></p><p><strong>4\uFF09\u53EF\u4EE5\u770B\u5230\u6536\u96C6\u8FC7\u6765\u5F88\u591A\u65E5\u5FD7\u5B57\u6BB5</strong><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044819_620c119334a455865.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_docker_14"></p><h3 id="_3-5-\u67E5\u770B\u65E5\u5FD7\u6536\u96C6\u7684\u7EDF\u8BA1\u56FE" tabindex="-1">3.5.\u67E5\u770B\u65E5\u5FD7\u6536\u96C6\u7684\u7EDF\u8BA1\u56FE <a class="header-anchor" href="#_3-5-\u67E5\u770B\u65E5\u5FD7\u6536\u96C6\u7684\u7EDF\u8BA1\u56FE" aria-hidden="true">#</a></h3><p><strong>1\uFF09\u67E5\u770B\u5168\u90E8\u65E5\u5FD7</strong></p><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044819_620c11937e76417952.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_elasticsearch_15"></p><p><strong>2\uFF09\u8FC7\u6EE4test-efk pod\u7684\u65E5\u5FD7</strong></p><p><img src="https://agou-images.oss-cn-qingdao.aliyuncs.com/others/16044819_620c1193ddd5617506.png" alt="\u5B9E\u73B0\u57FA\u4E8EEFK\u65E5\u5FD7\u5E73\u53F0\u6536\u96C6Kubernetes\u96C6\u7FA4\u65E5\u5FD7\u4FE1\u606F_elasticsearch_16"></p><blockquote><p>\u8BE5\u6587\u7AE0\u4E3A\u8F6C\u8F7D\u5185\u5BB9\uFF0C\u4EC5\u505A\u5907\u4EFD\u79C1\u4EBA\u5B66\u4E60\u4F7F\u7528\uFF0C\u539F\u6587\uFF1A<a href="https://blog.51cto.com/jiangxl/5076636" target="_blank" rel="noopener noreferrer">https://blog.51cto.com/jiangxl/5076636</a></p></blockquote>`,89),e=[o];function c(t,r,y,A,i,D){return n(),a("div",null,e)}var d=s(p,[["render",c]]);export{C as __pageData,d as default};
