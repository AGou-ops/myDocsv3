import{_ as s,o as a,c as n,a as l}from"./app.1e6146c3.js";const v=JSON.parse('{"title":"\u516B Service \u914D\u7F6E\u6E05\u5355","description":"","frontmatter":{},"headers":[{"level":2,"title":"8.1 Service \u5DE5\u4F5C\u6A21\u5F0F","slug":"_8-1-service-\u5DE5\u4F5C\u6A21\u5F0F"},{"level":2,"title":"8.2 Service \u7C7B\u578B","slug":"_8-2-service-\u7C7B\u578B"},{"level":2,"title":"8.3 \u8D44\u6E90\u8BB0\u5F55","slug":"_8-3-\u8D44\u6E90\u8BB0\u5F55"},{"level":2,"title":"8.4 Service \u6E05\u5355","slug":"_8-4-service-\u6E05\u5355"},{"level":2,"title":"8.5 service.spec \u89C4\u8303","slug":"_8-5-service-spec-\u89C4\u8303"},{"level":2,"title":"8.6 ClusterIP \u7C7B\u578B\u7684 service","slug":"_8-6-clusterip-\u7C7B\u578B\u7684-service"},{"level":2,"title":"8.7 NodePort \u7C7B\u578B\u7684 service","slug":"_8-7-nodeport-\u7C7B\u578B\u7684-service"},{"level":2,"title":"8.8 loadBalancerIP \u7C7B\u578B","slug":"_8-8-loadbalancerip-\u7C7B\u578B"},{"level":2,"title":"8.9 \u65E0\u96C6\u7FA4\u5730\u5740\u7684 Service","slug":"_8-9-\u65E0\u96C6\u7FA4\u5730\u5740\u7684-service"},{"level":2,"title":"8.10 externalName \u7C7B\u578B","slug":"_8-10-externalname-\u7C7B\u578B"}],"relativePath":"CloudNative/k8s/Quicklystart/\u516B Service \u914D\u7F6E\u6E05\u5355.md","lastUpdated":1657272051000}'),p={name:"CloudNative/k8s/Quicklystart/\u516B Service \u914D\u7F6E\u6E05\u5355.md"},e=l(`<h1 id="\u516B-service-\u914D\u7F6E\u6E05\u5355" tabindex="-1">\u516B Service \u914D\u7F6E\u6E05\u5355 <a class="header-anchor" href="#\u516B-service-\u914D\u7F6E\u6E05\u5355" aria-hidden="true">#</a></h1><p>Service \u4E3A POD \u63A7\u5236\u5668\u63A7\u5236\u7684 POD \u96C6\u7FA4\u63D0\u4F9B\u4E00\u4E2A\u56FA\u5B9A\u7684\u8BBF\u95EE\u7AEF\u70B9\uFF0CService \u7684\u5DE5\u4F5C\u8FD8\u4F9D\u8D56\u4E8E K8s \u4E2D\u7684\u4E00\u4E2A\u9644\u4EF6\uFF0C\u5C31\u662F CoreDNS \uFF0C\u5B83\u5C06 Service \u5730\u5740\u63D0\u4F9B\u4E00\u4E2A\u57DF\u540D\u89E3\u6790\u3002</p><h2 id="_8-1-service-\u5DE5\u4F5C\u6A21\u5F0F" tabindex="-1">8.1 Service \u5DE5\u4F5C\u6A21\u5F0F <a class="header-anchor" href="#_8-1-service-\u5DE5\u4F5C\u6A21\u5F0F" aria-hidden="true">#</a></h2><ol><li>userspace: 1.1 \u4E4B\u524D\u7248\u672C</li><li>iptables: 1.10 \u4E4B\u524D\u7248\u672C</li><li>ipvs\uFF1A1.11 \u4E4B\u540E\u7248\u672C</li></ol><h2 id="_8-2-service-\u7C7B\u578B" tabindex="-1">8.2 Service \u7C7B\u578B <a class="header-anchor" href="#_8-2-service-\u7C7B\u578B" aria-hidden="true">#</a></h2><table><thead><tr><th>\u7C7B\u578B</th><th>\u4F5C\u7528</th></tr></thead><tbody><tr><td>ClusterIP</td><td>\u9ED8\u8BA4\u503C\uFF0C\u5206\u914D\u4E00\u4E2A Service \u7F51\u7EDC\u7684\u5730\u5740\uFF0C\u4EC5\u7528\u4E8E\u96C6\u7FA4\u5185\u90E8\u901A\u4FE1</td></tr><tr><td>NodePort</td><td>\u5982\u679C\u9700\u8981\u96C6\u7FA4\u5916\u90E8\u8BBF\u95EE\uFF0C\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E2A\u7C7B\u578B</td></tr><tr><td>ExternalName</td><td>\u628A\u96C6\u7FA4\u5916\u90E8\u7684\u670D\u52A1\u5F15\u5165\u5230\u96C6\u7FA4\u5185\u90E8\uFF0C\u65B9\u4FBF\u5728\u96C6\u7FA4\u5185\u90E8\u4F7F\u7528</td></tr><tr><td>LoadBalancer</td><td>K8S \u5DE5\u4F5C\u5728\u4E91\u73AF\u5883\u4E2D\uFF0C\u8C03\u7528\u4E91\u73AF\u5883\u521B\u5EFA\u8D1F\u8F7D\u5747\u8861\u5668</td></tr></tbody></table><h2 id="_8-3-\u8D44\u6E90\u8BB0\u5F55" tabindex="-1">8.3 \u8D44\u6E90\u8BB0\u5F55 <a class="header-anchor" href="#_8-3-\u8D44\u6E90\u8BB0\u5F55" aria-hidden="true">#</a></h2><p>SVC_NAME.NS_NAME.DOMAIN.LTD</p><p>\u4F8B\u5982\uFF1Aredis.default.svc.cluster.local.</p><h2 id="_8-4-service-\u6E05\u5355" tabindex="-1">8.4 Service \u6E05\u5355 <a class="header-anchor" href="#_8-4-service-\u6E05\u5355" aria-hidden="true">#</a></h2><ul><li>\u6E05\u5355\u7EC4\u6210</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">apiVersion	</span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">string</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">    </span><span style="color:#758575;"># api \u7248\u672C\u53F7\uFF0Cv1</span></span>
<span class="line"><span style="color:#DBD7CA;">kind	    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">string</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">    </span><span style="color:#758575;"># \u8D44\u6E90\u7C7B\u522B\uFF0C\u6807\u8BB0\u521B\u5EFA\u4EC0\u4E48\u7C7B\u578B\u7684\u8D44\u6E90</span></span>
<span class="line"><span style="color:#DBD7CA;">metadata    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">Object</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">    </span><span style="color:#758575;"># POD \u5143\u6570\u636E</span></span>
<span class="line"><span style="color:#DBD7CA;">spec	    </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">Object</span><span style="color:#CB7676;">&gt;</span><span style="color:#DBD7CA;">    </span><span style="color:#758575;"># \u5143\u6570\u636E</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">apiVersion	</span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">string</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">    </span><span style="color:#A0ADA0;"># api \u7248\u672C\u53F7\uFF0Cv1</span></span>
<span class="line"><span style="color:#393A34;">kind	    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">string</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">    </span><span style="color:#A0ADA0;"># \u8D44\u6E90\u7C7B\u522B\uFF0C\u6807\u8BB0\u521B\u5EFA\u4EC0\u4E48\u7C7B\u578B\u7684\u8D44\u6E90</span></span>
<span class="line"><span style="color:#393A34;">metadata    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">Object</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">    </span><span style="color:#A0ADA0;"># POD \u5143\u6570\u636E</span></span>
<span class="line"><span style="color:#393A34;">spec	    </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">Object</span><span style="color:#AB5959;">&gt;</span><span style="color:#393A34;">    </span><span style="color:#A0ADA0;"># \u5143\u6570\u636E</span></span>
<span class="line"></span></code></pre></div><h2 id="_8-5-service-spec-\u89C4\u8303" tabindex="-1">8.5 service.spec \u89C4\u8303 <a class="header-anchor" href="#_8-5-service-spec-\u89C4\u8303" aria-hidden="true">#</a></h2><ol><li>clusterIP\uFF1A\u6307\u5B9A Service \u5904\u4E8E service \u7F51\u7EDC\u7684\u54EA\u4E2A IP\uFF0C\u9ED8\u8BA4\u4E3A\u52A8\u6001\u5206\u914D</li><li>type\uFF1A service \u7C7B\u578B\uFF0C\u53EF\u7528\uFF1AExternalName, ClusterIP, NodePort, and LoadBalancer</li></ol><h2 id="_8-6-clusterip-\u7C7B\u578B\u7684-service" tabindex="-1">8.6 ClusterIP \u7C7B\u578B\u7684 service <a class="header-anchor" href="#_8-6-clusterip-\u7C7B\u578B\u7684-service" aria-hidden="true">#</a></h2><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Service</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">redis</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">redis</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">role</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">logstor</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterIP</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">clusterIP</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">10.96.0.100</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">6379</span><span style="color:#DBD7CA;">         </span><span style="color:#758575;"># service \u7AEF\u53E3</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">targetPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">6379</span><span style="color:#DBD7CA;">   </span><span style="color:#758575;"># pod \u76D1\u542C\u7684\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">protocol</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">TCP</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Service</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">redis</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">redis</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">role</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">logstor</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterIP</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">clusterIP</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">10.96.0.100</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">6379</span><span style="color:#393A34;">         </span><span style="color:#A0ADA0;"># service \u7AEF\u53E3</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">targetPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">6379</span><span style="color:#393A34;">   </span><span style="color:#A0ADA0;"># pod \u76D1\u542C\u7684\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">protocol</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">TCP</span></span>
<span class="line"></span></code></pre></div><h2 id="_8-7-nodeport-\u7C7B\u578B\u7684-service" tabindex="-1">8.7 NodePort \u7C7B\u578B\u7684 service <a class="header-anchor" href="#_8-7-nodeport-\u7C7B\u578B\u7684-service" aria-hidden="true">#</a></h2><p>NodePort \u662F\u5728 ClusterIP \u7C7B\u578B\u4E0A\u589E\u52A0\u4E86\u4E00\u4E2A\u66B4\u9732\u5728\u4E86 node \u7684\u7F51\u7EDC\u547D\u540D\u7A7A\u95F4\u4E0A\u7684\u4E00\u4E2A nodePort\uFF0C\u6240\u4EE5\u7528\u6237\u53EF\u4EE5\u4ECE\u96C6\u7FA4\u5916\u90E8\u8BBF\u95EE\u5230\u96C6\u7FA4\u4E86\uFF0C\u56E0\u800C\u7528\u6237\u7684\u8BF7\u6C42\u6D41\u7A0B\u662F\uFF1AClient -&gt; NodeIP:NodePort -&gt; ClusterIP:ServicePort -&gt; PodIP:ContainerPort\u3002</p><p>\u53EF\u4EE5\u7406\u89E3\u4E3A NodePort \u589E\u5F3A\u4E86 ClusterIP \u7684\u529F\u80FD\uFF0C\u8BA9\u5BA2\u6237\u7AEF\u53EF\u4EE5\u5728\u6BCF\u4E2A\u96C6\u7FA4\u5916\u90E8\u8BBF\u95EE\u4EFB\u610F\u4E00\u4E2A nodeip \u4ECE\u800C\u8BBF\u95EE\u5230 clusterIP\uFF0C\u518D\u7531 clusterIP \u8FDB\u884C\u8D1F\u8F7D\u5747\u8861\u81F3 POD\u3002</p><ul><li>\u6E05\u5355\u793A\u4F8B</li></ul><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Service</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">release</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">canary</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">type</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">NodePort</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span><span style="color:#DBD7CA;">         </span><span style="color:#758575;"># service \u7AEF\u53E3</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">targetPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span><span style="color:#DBD7CA;">   </span><span style="color:#758575;"># pod \u76D1\u542C\u7684\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">nodePort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">30080</span><span style="color:#DBD7CA;">    </span><span style="color:#758575;"># service \u4F1A\u5728\u6BCF\u4E2A node \u4E0A\u6DFB\u52A0 iptables/ipvs \u89C4\u5219\u91CD\u5B9A\u5411\u8FD9\u4E2A\u7AEF\u53E3\u7684\u8BBF\u95EE\uFF0C\u6240\u4EE5\u5FC5\u987B\u4FDD\u8BC1\u6240\u6709 node \u7684\u8FD9\u4E2A\u7AEF\u53E3\u6CA1\u88AB\u5360\u7528</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">protocol</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">TCP</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Service</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">release</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">canary</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">type</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">NodePort</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span><span style="color:#393A34;">         </span><span style="color:#A0ADA0;"># service \u7AEF\u53E3</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">targetPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span><span style="color:#393A34;">   </span><span style="color:#A0ADA0;"># pod \u76D1\u542C\u7684\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">nodePort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">30080</span><span style="color:#393A34;">    </span><span style="color:#A0ADA0;"># service \u4F1A\u5728\u6BCF\u4E2A node \u4E0A\u6DFB\u52A0 iptables/ipvs \u89C4\u5219\u91CD\u5B9A\u5411\u8FD9\u4E2A\u7AEF\u53E3\u7684\u8BBF\u95EE\uFF0C\u6240\u4EE5\u5FC5\u987B\u4FDD\u8BC1\u6240\u6709 node \u7684\u8FD9\u4E2A\u7AEF\u53E3\u6CA1\u88AB\u5360\u7528</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">protocol</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">TCP</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">\u5728\u96C6\u7FA4\u5916\u90E8\u5C31\u53EF\u4EE5\u4F7F\u7528: http://172.16.100.102:30080 \u6765\u8BBF\u95EE\u8FD9\u4E2A service \u5730\u5740\u4E86</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">\u5728\u96C6\u7FA4\u5916\u90E8\u5C31\u53EF\u4EE5\u4F7F\u7528: http://172.16.100.102:30080 \u6765\u8BBF\u95EE\u8FD9\u4E2A service \u5730\u5740\u4E86</span></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">\u5728\u96C6\u7FA4\u5185\u53EF\u4EE5\u4F7F\u7528 service \u7684\u57DF\u540D\u5728 coredns \u4E0A\u89E3\u6790\u5F97\u5230 service \u5730\u5740: dig -t A myapp.default.svc.cluster.local @10.96.0.10</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">\u5728\u96C6\u7FA4\u5185\u53EF\u4EE5\u4F7F\u7528 service \u7684\u57DF\u540D\u5728 coredns \u4E0A\u89E3\u6790\u5F97\u5230 service \u5730\u5740: dig -t A myapp.default.svc.cluster.local @10.96.0.10</span></span>
<span class="line"></span></code></pre></div><h2 id="_8-8-loadbalancerip-\u7C7B\u578B" tabindex="-1">8.8 loadBalancerIP \u7C7B\u578B <a class="header-anchor" href="#_8-8-loadbalancerip-\u7C7B\u578B" aria-hidden="true">#</a></h2><p>service \u5728\u6BCF\u53F0\u4E3B\u673A\u7684 iptables/ipvs \u89C4\u5219\u5185\uFF0C\u8BBF\u95EE\u4EFB\u610F\u4E00\u53F0 node \u90FD\u53EF\u4EE5\u5230\u8FBE pod\uFF0C\u6240\u4EE5\u5E94\u8BE5\u5728\u8FD9\u4E9B nodeip \u524D\u52A0\u8D1F\u8F7D\u5747\u8861\u5668\uFF0C\u5982\u679C\u5DE5\u4F5C\u5728\u516C\u6709\u4E91\uFF0C\u53EF\u4EE5\u4F7F\u7528 k8s \u5185\u7F6E\u7684 loadBalancerIP\uFF0C\u64CD\u4F5C\u516C\u6709\u4E91\u7684\u8D1F\u8F7D\u5747\u8861\u5668\u5373\u670D\u52A1\uFF0C\u5B9E\u73B0\u52A8\u6001\u7684\u589E\u5220\u3002</p><p>\u53EF\u4EE5\u7406\u89E3\u4E3A loadBalancerIP \u589E\u5F3A\u4E86 NodePort \u7C7B\u578B\u7684 service \uFF0C\u5728\u96C6\u7FA4\u5916\u90E8\u5BF9\u6BCF\u53F0 nodeip \u8FDB\u884C\u8D1F\u8F7D\u5747\u8861\u3002</p><h2 id="_8-9-\u65E0\u96C6\u7FA4\u5730\u5740\u7684-service" tabindex="-1">8.9 \u65E0\u96C6\u7FA4\u5730\u5740\u7684 Service <a class="header-anchor" href="#_8-9-\u65E0\u96C6\u7FA4\u5730\u5740\u7684-service" aria-hidden="true">#</a></h2><p>\u65E0\u5934 service \u8868\u793A service \u6CA1\u6709 ClusterIP \u4E5F\u4E0D\u6620\u5C04 NodePort\uFF0C\u800C\u662F\u5C06 service \u7684\u57DF\u540D\u76F4\u63A5\u89E3\u6790\u4E3A nodeIP \u4ECE\u800C\u76F4\u63A5\u8BBF\u95EE nodeIP \u4E0A\u7684 POD\u3002</p><ul><li>\u6E05\u5355\u793A\u4F8B</li></ul><div class="language-"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#dbd7ca;">apiVersion: v1</span></span>
<span class="line"><span style="color:#dbd7ca;">kind: Service</span></span>
<span class="line"><span style="color:#dbd7ca;">metadata:</span></span>
<span class="line"><span style="color:#dbd7ca;">  name: myapp-nohead</span></span>
<span class="line"><span style="color:#dbd7ca;">  namespace: default</span></span>
<span class="line"><span style="color:#dbd7ca;">spec:</span></span>
<span class="line"><span style="color:#dbd7ca;">  selector:</span></span>
<span class="line"><span style="color:#dbd7ca;">    app: myapp-nohead</span></span>
<span class="line"><span style="color:#dbd7ca;">    release: canary</span></span>
<span class="line"><span style="color:#dbd7ca;">  type: ClusterIP</span></span>
<span class="line"><span style="color:#dbd7ca;">  clusterIP: None</span></span>
<span class="line"><span style="color:#dbd7ca;">  ports:</span></span>
<span class="line"><span style="color:#dbd7ca;">    - port: 80         # service \u7AEF\u53E3</span></span>
<span class="line"><span style="color:#dbd7ca;">      targetPort: 80   # pod \u76D1\u542C\u7684\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#dbd7ca;"></span></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393a34;">apiVersion: v1</span></span>
<span class="line"><span style="color:#393a34;">kind: Service</span></span>
<span class="line"><span style="color:#393a34;">metadata:</span></span>
<span class="line"><span style="color:#393a34;">  name: myapp-nohead</span></span>
<span class="line"><span style="color:#393a34;">  namespace: default</span></span>
<span class="line"><span style="color:#393a34;">spec:</span></span>
<span class="line"><span style="color:#393a34;">  selector:</span></span>
<span class="line"><span style="color:#393a34;">    app: myapp-nohead</span></span>
<span class="line"><span style="color:#393a34;">    release: canary</span></span>
<span class="line"><span style="color:#393a34;">  type: ClusterIP</span></span>
<span class="line"><span style="color:#393a34;">  clusterIP: None</span></span>
<span class="line"><span style="color:#393a34;">  ports:</span></span>
<span class="line"><span style="color:#393a34;">    - port: 80         # service \u7AEF\u53E3</span></span>
<span class="line"><span style="color:#393a34;">      targetPort: 80   # pod \u76D1\u542C\u7684\u7AEF\u53E3</span></span>
<span class="line"><span style="color:#393a34;"></span></span></code></pre></div><ul><li>\u67E5\u770B CoreDNS \u670D\u52A1\u5668\u7684\u5730\u5740</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl get svc -n kube-system</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl get svc -n kube-system</span></span>
<span class="line"></span></code></pre></div><ul><li>\u5728\u96C6\u7FA4\u5185\u4F7F\u7528 CoreDNS \u7684\u5730\u5740\u89E3\u6790\u65E0\u5934\u7684 serive \u57DF\u540D\uFF0C\u5F97\u5230\u7684\u76F4\u63A5\u4E3A nodeip \u4E2D\u7684 pod \u5730\u5740\uFF0C\u5229\u7528 dns \u7684\u591A\u6761 A \u8BB0\u5F55\u6765\u8D1F\u8F7D\u5747\u8861</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">dig -t A myapp-nohead.default.svc.cluster.local. @10.96.0.10</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">dig -t A myapp-nohead.default.svc.cluster.local. @10.96.0.10</span></span>
<span class="line"></span></code></pre></div><div class="language-"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#dbd7ca;">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#dbd7ca;">myapp-nohead.default.svc.cluster.local.	5 IN A	10.244.1.75</span></span>
<span class="line"><span style="color:#dbd7ca;">myapp-nohead.default.svc.cluster.local.	5 IN A	10.244.2.74</span></span>
<span class="line"><span style="color:#dbd7ca;"></span></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393a34;">;; ANSWER SECTION:</span></span>
<span class="line"><span style="color:#393a34;">myapp-nohead.default.svc.cluster.local.	5 IN A	10.244.1.75</span></span>
<span class="line"><span style="color:#393a34;">myapp-nohead.default.svc.cluster.local.	5 IN A	10.244.2.74</span></span>
<span class="line"><span style="color:#393a34;"></span></span></code></pre></div><h2 id="_8-10-externalname-\u7C7B\u578B" tabindex="-1">8.10 externalName \u7C7B\u578B <a class="header-anchor" href="#_8-10-externalname-\u7C7B\u578B" aria-hidden="true">#</a></h2><p>\u5F53 POD \u9700\u8981\u8BBF\u95EE\u4E00\u4E2A\u96C6\u7FA4\u5916\u90E8\u7684\u670D\u52A1\u65F6\u5019\uFF0CexternalName \u53EF\u4EE5\u6620\u5C04\u4E00\u4E2A\u96C6\u7FA4\u5916\u90E8\u7684\u670D\u52A1\u5230\u96C6\u7FA4\u5185\u90E8\uFF0C\u4F9B\u96C6\u7FA4\u5185 POD \u8BBF\u95EE\u3002</p><p>\u5C31\u662F\u628A\u5916\u90E8\u7684\u4E00\u4E2A\u57DF\u540D\u5730\u5740\uFF0C\u6620\u5C04\u4E3A\u96C6\u7FA4\u5185\u90E8 coredns \u89E3\u6790\u7684\u4E00\u4E2A\u5185\u90E8\u5730\u5740\uFF0C\u63D0\u4F9B\u96C6\u7FA4\u5185\u90E8\u8BBF\u95EE\u3002</p>`,38),o=[e];function c(r,t,y,i,d,A){return a(),n("div",null,o)}var B=s(p,[["render",c]]);export{v as __pageData,B as default};
