import{_ as s,o as n,c as a,a as p}from"./app.1e6146c3.js";const d=JSON.parse('{"title":"\u4E5D ingress \u63A7\u5236\u5668","description":"","frontmatter":{},"headers":[{"level":2,"title":"9.1 ingress.spec \u89C4\u8303","slug":"_9-1-ingress-spec-\u89C4\u8303"},{"level":2,"title":"9.2 ingress-nginx \u4EE3\u7406","slug":"_9-2-ingress-nginx-\u4EE3\u7406"},{"level":2,"title":"9.3 ingress-tomcat \u4EE3\u7406","slug":"_9-3-ingress-tomcat-\u4EE3\u7406"}],"relativePath":"CloudNative/k8s/Quicklystart/\u4E5D ingress \u63A7\u5236\u5668.md","lastUpdated":1657272051000}'),l={name:"CloudNative/k8s/Quicklystart/\u4E5D ingress \u63A7\u5236\u5668.md"},o=p(`<h1 id="\u4E5D-ingress-\u63A7\u5236\u5668" tabindex="-1">\u4E5D ingress \u63A7\u5236\u5668 <a class="header-anchor" href="#\u4E5D-ingress-\u63A7\u5236\u5668" aria-hidden="true">#</a></h1><p>\u5982\u679C k8s \u9700\u8981\u63D0\u4F9B\u4E00\u4E2A\u7F51\u7AD9\uFF0C\u5E76\u4E14\u8FD9\u4E2A\u7AD9\u70B9\u9700\u8981\u4EE5 https \u8BBF\u95EE\uFF0C\u800C iptables/ipvs \u5DE5\u4F5C\u5728 4 \u5C42\uFF0C\u5BA2\u6237\u53D1\u51FA\u7684 ssl \u8BF7\u6C42\u6839\u672C\u4E0D\u88AB\u89E3\u6790\u5C31\u88AB\u8C03\u5EA6\u5230\u540E\u7AEF POD\u4E86\u3002\u89E3\u51B3\u65B9\u6CD5\u6709\u4E24\u4E2A\uFF1A</p><ol><li><p>\u53EF\u4EE5\u5728\u516C\u6709\u4E91\u7684\u8D1F\u8F7D\u5747\u8861\u5668\u4E0A\u914D\u7F6E\u4E0A ssl \u8BC1\u4E66\u3002</p></li><li><p>\u65B0\u5EFA\u4E00\u4E2A\u8D1F\u8F7D\u5747\u8861\u5668\u7684 POD \uFF0C\u4F8B\u5982 nignx \uFF0C\u8FD9\u4E2A POD \u5171\u4EAB\u4E3B\u673A\u7684\u7F51\u7EDC\u547D\u540D\u7A7A\u95F4\uFF0C\u4E5F\u5C31\u662F\u8BF4\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7 nodeip \u8BBF\u95EE\u5230\u8D1F\u8F7D\u5747\u8861\u5668\uFF0Cssl \u8BC1\u4E66\u914D\u7F6E\u5728\u8FD9\u4E2A\u8D1F\u8F7D\u5747\u8861\u5668\u4E0A\uFF0C\u5BF9\u5916\u8FDE\u63A5\u4E3A https \u800C\u5BF9\u5185\u7684\u4EE3\u7406\u4E3A http \u534F\u8BAE\u5230 POD \u7F51\u7EDC\u7684 POD \u4E0A\u3002</p></li></ol><ul><li>\u5B58\u5728\u7684\u95EE\u9898</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">- \u8D1F\u8F7D\u5747\u8861\u5668 POD \u4F7F\u7528\u8282\u70B9\u7684\u7F51\u7EDC\u540D\u79F0\u7A7A\u95F4, \u90A3\u4E48\u5B83\u53EA   \u80FD\u5728\u8FD9\u4E2A node \u8282\u70B9\u4E0A\u8FD0\u884C\u4E00\u4E2A\u4E86,\u5426\u5219\u5C31\u51FA\u73B0\u7AEF\u53E3\u51B2\u7A81</span></span>
<span class="line"><span style="color:#DBD7CA;">- \u8D1F\u8F7D\u5747\u8861\u5668\u662F\u4EE3\u7406 POD \u5378\u8F7D ssl \u8BC1\u4E66\u7684\u5173\u952E\u8282\u70B9, \u5B83\u4E0D\u80FD\u53EA\u8FD0\u884C\u4E00\u4E2A, \u5B83\u9700\u8981\u5728\u6240\u6709\u8282\u70B9\u8FD0\u884C\u4E00\u4E2A</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">- \u8D1F\u8F7D\u5747\u8861\u5668 POD \u4F7F\u7528\u8282\u70B9\u7684\u7F51\u7EDC\u540D\u79F0\u7A7A\u95F4, \u90A3\u4E48\u5B83\u53EA   \u80FD\u5728\u8FD9\u4E2A node \u8282\u70B9\u4E0A\u8FD0\u884C\u4E00\u4E2A\u4E86,\u5426\u5219\u5C31\u51FA\u73B0\u7AEF\u53E3\u51B2\u7A81</span></span>
<span class="line"><span style="color:#393A34;">- \u8D1F\u8F7D\u5747\u8861\u5668\u662F\u4EE3\u7406 POD \u5378\u8F7D ssl \u8BC1\u4E66\u7684\u5173\u952E\u8282\u70B9, \u5B83\u4E0D\u80FD\u53EA\u8FD0\u884C\u4E00\u4E2A, \u5B83\u9700\u8981\u5728\u6240\u6709\u8282\u70B9\u8FD0\u884C\u4E00\u4E2A</span></span>
<span class="line"></span></code></pre></div><ul><li>\u89E3\u51B3\u65B9\u6CD5</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">- \u8D1F\u8F7D\u5747\u8861\u5668\u4F7F\u7528 DaemonSet \u5728\u6BCF\u4E2A node \u8282\u70B9\u8FD0\u884C\u4E00\u4E2A,\u4EE3\u7406\u8BF7\u6C42\u81F3 POD \u7F51\u7EDC\u7684\u4E2D\u7684 POD \u4E0A</span></span>
<span class="line"><span style="color:#DBD7CA;">- \u5982\u679C\u96C6\u7FA4\u8282\u70B9\u975E\u5E38\u7684\u591A,\u5176\u5B9E\u4E0D\u5FC5\u5728\u6BCF\u4E2A node \u8282\u70B9\u90FD\u5FC5\u987B\u8FD0\u884C\u4E00\u4E2A\u8D1F\u8F7D\u5747\u8861\u5668 POD</span></span>
<span class="line"><span style="color:#DBD7CA;">- \u63A7\u5236\u8D1F\u8F7D\u5747\u8861\u5668 POD \u8FD0\u884C\u7684\u6570\u91CF\u53EF\u4EE5\u901A\u8FC7 lables \u6307\u5B9A\u8FD0\u884C\u90A3\u51E0\u4E2A node \u8282\u70B9\u4E0A</span></span>
<span class="line"><span style="color:#DBD7CA;">- \u7136\u540E\u53EF\u4EE5\u5728\u8D1F\u8F7D\u5747\u8861\u5668 POD \u6240\u5728\u7684 node \u8282\u70B9\u4E0A\u6253\u4E0A </span><span style="color:#C98A7D;">&quot;\u6C61\u70B9&quot;</span><span style="color:#DBD7CA;"> \u4F7F\u5176\u4ED6\u7684 POD \u4E0D\u4F1A\u518D\u88AB\u8C03\u5EA6\u4E0A\u6765, \u800C\u53EA\u6709\u8D1F\u8F7D\u5747\u8861\u5668 POD \u53EF\u4EE5\u5BB9\u5FCD\u8FD9\u4E9B </span><span style="color:#C98A7D;">&quot;\u6C61\u70B9&quot;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">- \u8D1F\u8F7D\u5747\u8861\u5668\u4F7F\u7528 DaemonSet \u5728\u6BCF\u4E2A node \u8282\u70B9\u8FD0\u884C\u4E00\u4E2A,\u4EE3\u7406\u8BF7\u6C42\u81F3 POD \u7F51\u7EDC\u7684\u4E2D\u7684 POD \u4E0A</span></span>
<span class="line"><span style="color:#393A34;">- \u5982\u679C\u96C6\u7FA4\u8282\u70B9\u975E\u5E38\u7684\u591A,\u5176\u5B9E\u4E0D\u5FC5\u5728\u6BCF\u4E2A node \u8282\u70B9\u90FD\u5FC5\u987B\u8FD0\u884C\u4E00\u4E2A\u8D1F\u8F7D\u5747\u8861\u5668 POD</span></span>
<span class="line"><span style="color:#393A34;">- \u63A7\u5236\u8D1F\u8F7D\u5747\u8861\u5668 POD \u8FD0\u884C\u7684\u6570\u91CF\u53EF\u4EE5\u901A\u8FC7 lables \u6307\u5B9A\u8FD0\u884C\u90A3\u51E0\u4E2A node \u8282\u70B9\u4E0A</span></span>
<span class="line"><span style="color:#393A34;">- \u7136\u540E\u53EF\u4EE5\u5728\u8D1F\u8F7D\u5747\u8861\u5668 POD \u6240\u5728\u7684 node \u8282\u70B9\u4E0A\u6253\u4E0A </span><span style="color:#B56959;">&quot;\u6C61\u70B9&quot;</span><span style="color:#393A34;"> \u4F7F\u5176\u4ED6\u7684 POD \u4E0D\u4F1A\u518D\u88AB\u8C03\u5EA6\u4E0A\u6765, \u800C\u53EA\u6709\u8D1F\u8F7D\u5747\u8861\u5668 POD \u53EF\u4EE5\u5BB9\u5FCD\u8FD9\u4E9B </span><span style="color:#B56959;">&quot;\u6C61\u70B9&quot;</span></span>
<span class="line"></span></code></pre></div><ul><li>\u8D1F\u8F7D\u5747\u8861\u5668\u53EF\u9009\uFF0C\u6309\u7167\u4F18\u5148\u7EA7\u5148\u540E\u6392\u5E8F</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">Envoy            </span><span style="color:#758575;"># \u4E91\u539F\u751F\u9AD8\u6027\u80FD\u670D\u52A1\u4EE3\u7406,\u5DF2\u4ECEcncf\u6BD5\u4E1A</span></span>
<span class="line"><span style="color:#DBD7CA;">Traefik          </span><span style="color:#758575;"># \u4E3A\u5FAE\u670D\u52A1\u800C\u751F\u7684\u53CD\u5411\u4EE3\u7406</span></span>
<span class="line"><span style="color:#DBD7CA;">Nginx            </span><span style="color:#758575;"># \u6539\u9020\u540E\u53EF\u4EE5\u9002\u7528\u4E8E\u5FAE\u670D\u52A1\u73AF\u5883</span></span>
<span class="line"><span style="color:#DBD7CA;">HAproxy          </span><span style="color:#758575;"># \u4E0D\u63A8\u8350\u4F7F\u7528</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">Envoy            </span><span style="color:#A0ADA0;"># \u4E91\u539F\u751F\u9AD8\u6027\u80FD\u670D\u52A1\u4EE3\u7406,\u5DF2\u4ECEcncf\u6BD5\u4E1A</span></span>
<span class="line"><span style="color:#393A34;">Traefik          </span><span style="color:#A0ADA0;"># \u4E3A\u5FAE\u670D\u52A1\u800C\u751F\u7684\u53CD\u5411\u4EE3\u7406</span></span>
<span class="line"><span style="color:#393A34;">Nginx            </span><span style="color:#A0ADA0;"># \u6539\u9020\u540E\u53EF\u4EE5\u9002\u7528\u4E8E\u5FAE\u670D\u52A1\u73AF\u5883</span></span>
<span class="line"><span style="color:#393A34;">HAproxy          </span><span style="color:#A0ADA0;"># \u4E0D\u63A8\u8350\u4F7F\u7528</span></span>
<span class="line"></span></code></pre></div><p>\u65B0\u5EFA\u4E00\u4E2A service \u5C06\u9700\u8981\u4EE3\u7406\u7684\u4E0D\u540C\u670D\u52A1\u7684 pod \u5206\u7C7B</p><p>\u65B0\u5EFA\u4E00\u4E2A ingress \u8D44\u6E90\uFF0C\u4ECE service \u4E2D\u53D6\u5F97\u5206\u7C7B\u7ED3\u679C\uFF0C\u6620\u5C04\u8FDB Envoy \u4E2D\uFF0C\u91CD\u8F7D Envoy \u8F6F\u4EF6\u3002</p><h2 id="_9-1-ingress-spec-\u89C4\u8303" tabindex="-1">9.1 ingress.spec \u89C4\u8303 <a class="header-anchor" href="#_9-1-ingress-spec-\u89C4\u8303" aria-hidden="true">#</a></h2><ul><li>API \u548C kind</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">apiVersion: extensions</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">kind: ingress</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">apiVersion: extensions</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">kind: ingress</span></span>
<span class="line"></span></code></pre></div><ul><li>ingress.spec</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">backend         </span><span style="color:#758575;"># \u540E\u7AEF\u6709\u54EA\u4E9B POD</span></span>
<span class="line"><span style="color:#DBD7CA;">rules           </span><span style="color:#758575;"># \u8C03\u5EA6\u89C4\u5219</span></span>
<span class="line"><span style="color:#DBD7CA;">    host        </span><span style="color:#758575;"># \u865A\u62DF\u4E3B\u673A</span></span>
<span class="line"><span style="color:#DBD7CA;">    http        </span><span style="color:#758575;"># http \u8DEF\u5F84</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">backend         </span><span style="color:#A0ADA0;"># \u540E\u7AEF\u6709\u54EA\u4E9B POD</span></span>
<span class="line"><span style="color:#393A34;">rules           </span><span style="color:#A0ADA0;"># \u8C03\u5EA6\u89C4\u5219</span></span>
<span class="line"><span style="color:#393A34;">    host        </span><span style="color:#A0ADA0;"># \u865A\u62DF\u4E3B\u673A</span></span>
<span class="line"><span style="color:#393A34;">    http        </span><span style="color:#A0ADA0;"># http \u8DEF\u5F84</span></span>
<span class="line"></span></code></pre></div><h2 id="_9-2-ingress-nginx-\u4EE3\u7406" tabindex="-1">9.2 ingress-nginx \u4EE3\u7406 <a class="header-anchor" href="#_9-2-ingress-nginx-\u4EE3\u7406" aria-hidden="true">#</a></h2><ul><li>\u540E\u7AEF service \u548C pods</li></ul><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Service</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">service-ingress-myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">release</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">canary</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">http</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">targetPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">apps/v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Deployment</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replicas</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">4</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">matchLabels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">release</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">canary</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">template</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">release</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">canary</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">containers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ikubernetes/myapp:v2</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">http</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">containerPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Service</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">service-ingress-myapp</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">release</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">canary</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">http</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">targetPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">apps/v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Deployment</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replicas</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">4</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">matchLabels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">release</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">canary</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">template</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">release</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">canary</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">containers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ikubernetes/myapp:v2</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">http</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">containerPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span></span>
<span class="line"></span></code></pre></div><ul><li>\u521B\u5EFA ingress-nginx</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.21.0/deploy/mandatory.yaml</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.21.0/deploy/mandatory.yaml</span></span>
<span class="line"></span></code></pre></div><ul><li>\u8BA9 ingress-nginx \u5728\u96C6\u7FA4\u5916\u90E8\u8BBF\u95EE</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.21.0/deploy/provider/baremetal/service-nodeport.yaml</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.21.0/deploy/provider/baremetal/service-nodeport.yaml</span></span>
<span class="line"></span></code></pre></div><ul><li>\u521B\u5EFA ingress \u5BF9\u8C61\uFF0C\u5B83\u80FD\u5C06 ingress-nginx \u4E0E service \u5173\u8054\uFF0C\u4ECE\u800C\u5728 service \u540E\u4E3B\u673A\u53D1\u751F\u53D8\u52A8\u7684\u65F6\u5019\uFF0C\u53CD\u5E94\u5728 ingress-nginx \u8FD9\u4E2A\u5BB9\u5668\u7684\u914D\u7F6E\u6587\u4EF6\u4E2D</li></ul><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">extensions/v1beta1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Ingress</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ingress-deploy-myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">annotations</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">kubernetes.io/ingress.class</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;nginx&quot;</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">rules</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">host</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp.kaliarch.com</span><span style="color:#DBD7CA;">                       </span><span style="color:#758575;"># \u57FA\u4E8E\u4E3B\u673A\u540D\u7684\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">http</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">paths</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">                                   </span><span style="color:#758575;"># \u7A7A\u7684\u65F6\u5019\u4EE3\u8868\u6839\uFF0C\u8BBF\u95EE\u6839\u7684\u65F6\u5019\u6620\u5C04\u5230 backend</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#429988;">backend</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">                                </span><span style="color:#758575;"># \u540E\u7AEF\u7684 service \u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">serviceName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">service-ingress-myapp</span><span style="color:#DBD7CA;">    </span><span style="color:#758575;"># \u5173\u8054 service \u4ECE\u800C\u83B7\u53D6\u5230\u540E\u7AEF\u4E3B\u673A\u7684\u53D8\u52A8</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">servicePort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span><span style="color:#DBD7CA;">                       </span><span style="color:#758575;"># \u5173\u8054 service \u7684\u5730\u5740</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">extensions/v1beta1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Ingress</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ingress-deploy-myapp</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">annotations</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">kubernetes.io/ingress.class</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;nginx&quot;</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">rules</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">host</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp.kaliarch.com</span><span style="color:#393A34;">                       </span><span style="color:#A0ADA0;"># \u57FA\u4E8E\u4E3B\u673A\u540D\u7684\u8BBF\u95EE</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">http</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">paths</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">                                   </span><span style="color:#A0ADA0;"># \u7A7A\u7684\u65F6\u5019\u4EE3\u8868\u6839\uFF0C\u8BBF\u95EE\u6839\u7684\u65F6\u5019\u6620\u5C04\u5230 backend</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#2F8A89;">backend</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">                                </span><span style="color:#A0ADA0;"># \u540E\u7AEF\u7684 service \u7684\u914D\u7F6E</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">serviceName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">service-ingress-myapp</span><span style="color:#393A34;">    </span><span style="color:#A0ADA0;"># \u5173\u8054 service \u4ECE\u800C\u83B7\u53D6\u5230\u540E\u7AEF\u4E3B\u673A\u7684\u53D8\u52A8</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">servicePort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span><span style="color:#393A34;">                       </span><span style="color:#A0ADA0;"># \u5173\u8054 service \u7684\u5730\u5740</span></span>
<span class="line"></span></code></pre></div><ul><li>\u67E5\u770B ingress-nginx \u5BF9\u5916\u66B4\u9732\u7684\u7AEF\u53E3\uFF0C\u8FD9\u91CC\u4E3A30080\uFF0C\u548C 30443 \u4E24\u4E2A</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl get service -n ingress-nginx</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl get service -n ingress-nginx</span></span>
<span class="line"></span></code></pre></div><ul><li>\u4F7F\u7528 nodeip + ingress-nginx \u66B4\u9732\u7AEF\u53E3\u8BBF\u95EE\uFF0C\u7531\u4E8E\u4E0A\u9762\u521B\u5EFA\u7684 ingress \u4E3A\u57FA\u4E8E\u4E3B\u673A\u540D\u79F0\u7684\uFF0C\u6240\u4EE5\u9700\u8981\u5728\u8BBF\u95EE\u65F6\u5728 /etc/hosts \u505A\u597D\u6620\u5C04\u5230 node\u3002</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">http://myapp.kaliarch.com:30080/index.html  </span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">http://myapp.kaliarch.com:30080/index.html  </span></span>
<span class="line"></span></code></pre></div><h2 id="_9-3-ingress-tomcat-\u4EE3\u7406" tabindex="-1">9.3 ingress-tomcat \u4EE3\u7406 <a class="header-anchor" href="#_9-3-ingress-tomcat-\u4EE3\u7406" aria-hidden="true">#</a></h2><ul><li>\u540E\u7AEF service \u548C pods</li></ul><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Service</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">service-ingress-tomcat</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">tomcat</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">release</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">canary</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">http</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">8080</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">targetPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">http</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ajp</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">port</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">8009</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">targetPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ajp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">apps/v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Deployment</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">deploy-tomcat</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">replicas</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">4</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">selector</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">matchLabels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">tomcat</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">release</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">canary</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">template</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">tomcat</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">release</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">canary</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">containers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">tomcat</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">tomcat:8.5.32-jre8-alpine</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">http</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">containerPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">8080</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ajp</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">containerPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">8009</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Service</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">service-ingress-tomcat</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">tomcat</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">release</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">canary</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">http</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">8080</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">targetPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">http</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ajp</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">port</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">8009</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">targetPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ajp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">apps/v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Deployment</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">deploy-tomcat</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">replicas</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">4</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">selector</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">matchLabels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">tomcat</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">release</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">canary</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">template</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">tomcat</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">release</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">canary</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">containers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">tomcat</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">tomcat:8.5.32-jre8-alpine</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">http</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">containerPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">8080</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ajp</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">containerPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">8009</span></span>
<span class="line"></span></code></pre></div><ul><li>\u5236\u4F5C\u81EA\u7B7E\u540D\u8BC1\u4E66\uFF0C\u8BA9 ingress-nginx \u5E26\u6709\u8BC1\u4E66\u6765\u8BBF\u95EE</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># \u751F\u6210 key</span></span>
<span class="line"><span style="color:#DBD7CA;">openssl genrsa -out tls.key 2048</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u751F\u6210\u81EA\u7B7E\u8BC1\u4E66\uFF0CCN=\u57DF\u540D\u5FC5\u987B\u8981\u4E0E\u81EA\u5DF1\u7684\u57DF\u540D\u5B8C\u5168\u4E00\u81F4</span></span>
<span class="line"><span style="color:#DBD7CA;">openssl req -new -x509 -key tls.key -out tls.crt -subj /C=CN/ST=Beijing/L=Beijing/O=DevOps/CN=tomcat.kaliarch.com</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u751F\u6210 key</span></span>
<span class="line"><span style="color:#393A34;">openssl genrsa -out tls.key 2048</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u751F\u6210\u81EA\u7B7E\u8BC1\u4E66\uFF0CCN=\u57DF\u540D\u5FC5\u987B\u8981\u4E0E\u81EA\u5DF1\u7684\u57DF\u540D\u5B8C\u5168\u4E00\u81F4</span></span>
<span class="line"><span style="color:#393A34;">openssl req -new -x509 -key tls.key -out tls.crt -subj /C=CN/ST=Beijing/L=Beijing/O=DevOps/CN=tomcat.kaliarch.com</span></span>
<span class="line"></span></code></pre></div><ul><li>\u521B\u5EFA secret \u8BC1\u4E66\u5BF9\u8C61\uFF0C\u5B83\u662F\u6807\u51C6\u7684 k8s \u5BF9\u8C61</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl create secret tls tomcat-ingress-secret --cert=tls.crt --key=tls.key</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl create secret tls tomcat-ingress-secret --cert=tls.crt --key=tls.key</span></span>
<span class="line"></span></code></pre></div><ul><li>\u521B\u5EFA\u5E26\u8BC1\u4E66\u7684 ingress \u5BF9\u8C61\uFF0C\u5B83\u80FD\u5C06 ingress-tomcat \u4E0E service \u5173\u8054\uFF0C\u4ECE\u800C\u5728 service \u540E\u4E3B\u673A\u53D1\u751F\u53D8\u52A8\u7684\u65F6\u5019\uFF0C\u53CD\u5E94\u5728 ingress-tomcat \u8FD9\u4E2A\u5BB9\u5668\u7684\u914D\u7F6E\u6587\u4EF6\u4E2D</li></ul><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">extensions/v1beta1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Ingress</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ingress-deploy-tomcat-tls</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">annotations</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">kubernetes.io/ingress.class</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">&quot;nginx&quot;</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">tls</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">hosts</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">tomcat.kaliarch.com</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">secretName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">tomcat-ingress-secret</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">rules</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">host</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">tomcat.kaliarch.com</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">http</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#429988;">paths</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">path</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">            </span><span style="color:#429988;">backend</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">serviceName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">service-ingress-tomcat</span></span>
<span class="line"><span style="color:#DBD7CA;">              </span><span style="color:#429988;">servicePort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">8080</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">extensions/v1beta1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Ingress</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ingress-deploy-tomcat-tls</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">annotations</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">kubernetes.io/ingress.class</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">&quot;nginx&quot;</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">tls</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">hosts</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#B56959;">tomcat.kaliarch.com</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">secretName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">tomcat-ingress-secret</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">rules</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">host</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">tomcat.kaliarch.com</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">http</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#2F8A89;">paths</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">path</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">            </span><span style="color:#2F8A89;">backend</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">serviceName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">service-ingress-tomcat</span></span>
<span class="line"><span style="color:#393A34;">              </span><span style="color:#2F8A89;">servicePort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">8080</span></span>
<span class="line"></span></code></pre></div><ul><li>\u67E5\u770B ingress-nginx \u5BF9\u5916\u66B4\u9732\u7684\u7AEF\u53E3\uFF0C\u8FD9\u91CC\u4E3A30080\uFF0C\u548C 30443 \u4E24\u4E2A</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl get service -n ingress-nginx</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl get service -n ingress-nginx</span></span>
<span class="line"></span></code></pre></div><ul><li>\u4F7F\u7528 nodeip + ingress-nginx \u66B4\u9732\u7AEF\u53E3\u8BBF\u95EE\uFF0C\u7531\u4E8E\u4E0A\u9762\u521B\u5EFA\u7684 ingress \u4E3A\u57FA\u4E8E\u4E3B\u673A\u540D\u79F0\u7684\uFF0C\u6240\u4EE5\u9700\u8981\u5728\u8BBF\u95EE\u65F6\u5728 /etc/hosts \u505A\u597D\u6620\u5C04\u5230 node\u3002</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">https://tomcat.kaliarch.com:30443</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">https://tomcat.kaliarch.com:30443</span></span>
<span class="line"></span></code></pre></div>`,42),e=[o];function c(t,r,y,i,A,D){return n(),a("div",null,e)}var C=s(l,[["render",c]]);export{d as __pageData,C as default};
