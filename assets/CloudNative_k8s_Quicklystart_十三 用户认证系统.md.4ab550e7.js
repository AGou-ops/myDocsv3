import{_ as s,o as a,c as n,a as l}from"./app.1e6146c3.js";const D=JSON.parse('{"title":"\u5341\u4E09 \u7528\u6237\u8BA4\u8BC1\u7CFB\u7EDF","description":"","frontmatter":{},"headers":[{"level":2,"title":"13.1 \u7528\u6237\u7684\u7C7B\u578B","slug":"_13-1-\u7528\u6237\u7684\u7C7B\u578B"},{"level":2,"title":"13.2 POD\u5982\u4F55\u8FDE\u63A5\u96C6\u7FA4","slug":"_13-2-pod\u5982\u4F55\u8FDE\u63A5\u96C6\u7FA4"},{"level":2,"title":"13.3 serviceaccount \u5BF9\u8C61","slug":"_13-3-serviceaccount-\u5BF9\u8C61"},{"level":3,"title":"13.3.1 \u5728 POD \u4E2D\u4F7F\u7528 serviceaccount","slug":"_13-3-1-\u5728-pod-\u4E2D\u4F7F\u7528-serviceaccount"},{"level":2,"title":"13.4 kubectl \u914D\u7F6E\u6587\u4EF6","slug":"_13-4-kubectl-\u914D\u7F6E\u6587\u4EF6"},{"level":2,"title":"13.5 \u6DFB\u52A0\u8BC1\u4E66\u7528\u6237\u5230 config","slug":"_13-5-\u6DFB\u52A0\u8BC1\u4E66\u7528\u6237\u5230-config"},{"level":3,"title":"13.5.1 \u521B\u5EFASSL\u8BC1\u4E66\u7528\u6237","slug":"_13-5-1-\u521B\u5EFAssl\u8BC1\u4E66\u7528\u6237"},{"level":3,"title":"13.5.2 \u6DFB\u52A0SSL\u8BC1\u4E66\u7528\u6237\u5230config","slug":"_13-5-2-\u6DFB\u52A0ssl\u8BC1\u4E66\u7528\u6237\u5230config"},{"level":3,"title":"13.5.3 \u521B\u5EFA\u5207\u6362\u4E0A\u4E0B\u6587","slug":"_13-5-3-\u521B\u5EFA\u5207\u6362\u4E0A\u4E0B\u6587"},{"level":2,"title":"13.6 \u521B\u5EFA\u65B0 config \u6587\u4EF6","slug":"_13-6-\u521B\u5EFA\u65B0-config-\u6587\u4EF6"},{"level":2,"title":"13.7 \u57FA\u4E8E token \u8BA4\u8BC1","slug":"_13-7-\u57FA\u4E8E-token-\u8BA4\u8BC1"},{"level":3,"title":"13.7.1 \u521B\u5EFA serviceaccount","slug":"_13-7-1-\u521B\u5EFA-serviceaccount"},{"level":3,"title":"13.7.2 \u7ED1\u5B9A\u96C6\u7FA4\u7BA1\u7406\u5458\u89D2\u8272","slug":"_13-7-2-\u7ED1\u5B9A\u96C6\u7FA4\u7BA1\u7406\u5458\u89D2\u8272"},{"level":3,"title":"13.7.3 \u901A\u8FC7 serviceaccount \u5F97\u5230 Token","slug":"_13-7-3-\u901A\u8FC7-serviceaccount-\u5F97\u5230-token"}],"relativePath":"CloudNative/k8s/Quicklystart/\u5341\u4E09 \u7528\u6237\u8BA4\u8BC1\u7CFB\u7EDF.md","lastUpdated":1657272051000}'),e={name:"CloudNative/k8s/Quicklystart/\u5341\u4E09 \u7528\u6237\u8BA4\u8BC1\u7CFB\u7EDF.md"},p=l(`<h1 id="\u5341\u4E09-\u7528\u6237\u8BA4\u8BC1\u7CFB\u7EDF" tabindex="-1">\u5341\u4E09 \u7528\u6237\u8BA4\u8BC1\u7CFB\u7EDF <a class="header-anchor" href="#\u5341\u4E09-\u7528\u6237\u8BA4\u8BC1\u7CFB\u7EDF" aria-hidden="true">#</a></h1><p>apiserver \u662F\u6240\u6709\u8BF7\u6C42\u8BBF\u95EE\u7684\u7F51\u5173\u63A5\u53E3\uFF0C\u8BF7\u6C42\u8FC7\u7A0B\u4E2D\uFF0C\u8BA4\u8BC1\u7528\u4E8E\u5B9E\u73B0\u8EAB\u4EFD\u8BC6\u522B\uFF0C\u6388\u6743\u7528\u4E8E\u5B9E\u73B0\u6743\u9650\u68C0\u67E5\uFF0C\u5B9E\u9645\u4E0A\uFF0C\u6211\u4EEC\u4F7F\u7528\u547D\u4EE4\u884C\uFF1Akubectl apply -f ment.yaml\uFF0C\u5B9E\u9645\u4E0A\u662F\u8F6C\u6362\u4E3A HTTP \u534F\u8BAE\u5411 apiserver \u53D1\u8D77\u8BF7\u6C42\u7684\uFF0C\u800C\u8BA4\u8BC1\u662F\u4FE1\u606F\u7531 ~/.kube/config \u8FD9\u4E2A\u6587\u4EF6\u63D0\u4F9B\u7684\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u8BB0\u5F55\u4E86\u7BA1\u7406\u5458\u6743\u9650\u7684\u7528\u6237\u4FE1\u606F\u3002</p><ul><li>k8s \u7684 API \u662F RESTfull \u98CE\u683C\u7684\uFF0C\u6240\u4EE5\u8D44\u6E90\u662F\u7531\u8DEF\u5F84\u6807\u660E\u7684\uFF0C\u5728 k8s \u4E2D\uFF0C\u8D44\u6E90\u53EA\u80FD\u5C5E\u4E8E\u4E24\u4E2A\u5730\u65B9\uFF1A\u5C5E\u4E8E\u96C6\u7FA4 \u6216 \u5C5E\u4E8E\u540D\u79F0\u7A7A\u95F4\u3002</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">\u96C6\u7FA4\u7EA7\u522B\uFF1Anamespace\u3001pv</span></span>
<span class="line"><span style="color:#DBD7CA;">\u540D\u79F0\u7A7A\u95F4\uFF1APOD\u3001deployment\u3001daemonSet\u3001 service\u3001PCV</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">\u96C6\u7FA4\u7EA7\u522B\uFF1Anamespace\u3001pv</span></span>
<span class="line"><span style="color:#393A34;">\u540D\u79F0\u7A7A\u95F4\uFF1APOD\u3001deployment\u3001daemonSet\u3001 service\u3001PCV</span></span>
<span class="line"></span></code></pre></div><p>\u4F8B\u5982\uFF1A\u8BF7\u6C42 delfault \u540D\u79F0\u7A7A\u95F4\u4E0B\u7684 myapp-deploy \u63A7\u5236\u5668\uFF0C\u5C31\u662F\u4E0B\u9762\u7684\u5199\u6CD5</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">http://172.16.100.100/apis/apps/v1/namespaces/default/deployments/myapp-deploy</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">http://172.16.100.100/apis/apps/v1/namespaces/default/deployments/myapp-deploy</span></span>
<span class="line"></span></code></pre></div><p>\u4E0A\u9762\u8868\u793A\uFF1A<a href="http://172.16.100.100:6443" target="_blank" rel="noopener noreferrer">http://172.16.100.100:6443</a> \u96C6\u7FA4\u7684 apis \u4E0B\u7684 apps \u7EC4\u7684 v1 \u7248\u672C\u7684 namespaces \u4E0B\u5BFB\u627E default \u4E0B\u7684 myapp-deploy \u63A7\u5236\u5668</p><h2 id="_13-1-\u7528\u6237\u7684\u7C7B\u578B" tabindex="-1">13.1 \u7528\u6237\u7684\u7C7B\u578B <a class="header-anchor" href="#_13-1-\u7528\u6237\u7684\u7C7B\u578B" aria-hidden="true">#</a></h2><p>\u6211\u4EEC\u4F7F\u7528 kubectl \u8FDE\u63A5 k8s \u96C6\u7FA4\u8FDB\u884C\u63A7\u5236\uFF0C\u5B9E\u9645\u4E0A\u662F\u4F7F\u7528\u7528\u6237\u5BB6\u76EE\u5F55\u4E0B .kube/config \u8FD9\u4E2A\u6587\u4EF6\u4E2D\u7684\u7528\u6237\u8FDE\u63A5\u5230 apiserver \u5B9E\u73B0\u8BA4\u8BC1\u7684\uFF0C\u800C\u6709\u4E9B POD \uFF08\u5982\uFF1ACoreDNS\uFF09\u4E5F\u9700\u8981\u83B7\u53D6\u96C6\u7FA4\u7684\u4FE1\u606F\uFF0C\u5B83\u4EEC\u4E5F\u9700\u8981\u8FDE\u63A5\u5230 k8s \u96C6\u7FA4\u4E2D\uFF0C\u6240\u4EE5 k8s \u4E2D\u7528\u6237\u7684\u7C7B\u578B\u6709\u4E24\u79CD\uFF1A</p><ol><li>\u4EBA\u7C7B\u4F7F\u7528\u7684\u7528\u6237\uFF1Auseraccount\uFF0C\u5904\u4E8E\u7528\u6237\u5BB6\u76EE\u5F55 .kube/config \u6587\u4EF6\u4E2D\uFF0C\u53EF\u4F7F\u7528 kubectl config --help \u83B7\u53D6\u5E2E\u52A9\u521B\u5EFA</li><li>POD \u4F7F\u7528\u7684\u7528\u6237\uFF1Aserviceaccunt\uFF0C\u662F\u4E00\u79CD k8s \u5BF9\u8C61\uFF0C\u5B83\u53EF\u4EE5\u4F7F\u7528 kubectl create serviceaccount --help \u83B7\u53D6\u5E2E\u52A9\u521B\u5EFA</li></ol><h2 id="_13-2-pod\u5982\u4F55\u8FDE\u63A5\u96C6\u7FA4" tabindex="-1">13.2 POD\u5982\u4F55\u8FDE\u63A5\u96C6\u7FA4 <a class="header-anchor" href="#_13-2-pod\u5982\u4F55\u8FDE\u63A5\u96C6\u7FA4" aria-hidden="true">#</a></h2><p>POD \u9700\u8981\u4F7F\u7528 serviceaccount \u8FDE\u63A5\u5E76\u8BA4\u8BC1\u5230\u96C6\u7FA4\uFF0CPOD \u4E4B\u6240\u4EE5\u80FD\u591F\u8FDE\u63A5\u5230\u96C6\u7FA4\u662F\u56E0\u4E3A\u6709\u4E00\u4E2A\u5185\u7F6E\u7684 service \u5C06 POD \u7684\u8BF7\u6C42\u4EE3\u7406\u81F3 apiserver \u7684\u5730\u5740\u4E86\u3002</p><ul><li>\u540D\u5B57\u4E3A kubernetes \u7684 servie \u4E3A POD \u8FDE\u63A5\u5230 apiserver \u63D0\u4F9B\u4E86\u901A\u4FE1</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ kubectl describe service kubernetes                            </span><span style="color:#758575;"># \u96C6\u7FA4\u5185\u90E8\u7684 POD \u4E0E apiserver \u901A\u4FE1\u4F7F\u7528\u7684 service \uFF0C\u4F46\u662F\u6CE8\u610F apiserver \u9700\u8981\u8BA4\u8BC1\u7684</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">Name:              kubernetes</span></span>
<span class="line"><span style="color:#DBD7CA;">Namespace:         default</span></span>
<span class="line"><span style="color:#DBD7CA;">Labels:            component=apiserver</span></span>
<span class="line"><span style="color:#DBD7CA;">                   provider=kubernetes</span></span>
<span class="line"><span style="color:#DBD7CA;">Annotations:       </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">Selector:          </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"><span style="color:#DBD7CA;">Type:              ClusterIP</span></span>
<span class="line"><span style="color:#DBD7CA;">IP:                10.96.0.1                                     </span><span style="color:#758575;"># \u96C6\u7FA4\u5185\u90E8\u8BBF\u95EE apiserver \u7684\u7F51\u5173</span></span>
<span class="line"><span style="color:#DBD7CA;">Port:              https  443/TCP</span></span>
<span class="line"><span style="color:#DBD7CA;">TargetPort:        6443/TCP</span></span>
<span class="line"><span style="color:#DBD7CA;">Endpoints:         172.16.100.101:6443                           </span><span style="color:#758575;"># apiserver \u5DE5\u4F5C\u7684\u5730\u5740</span></span>
<span class="line"><span style="color:#DBD7CA;">Session Affinity:  None</span></span>
<span class="line"><span style="color:#DBD7CA;">Events:            </span><span style="color:#CB7676;">&lt;</span><span style="color:#DBD7CA;">none</span><span style="color:#CB7676;">&gt;</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ kubectl describe service kubernetes                            </span><span style="color:#A0ADA0;"># \u96C6\u7FA4\u5185\u90E8\u7684 POD \u4E0E apiserver \u901A\u4FE1\u4F7F\u7528\u7684 service \uFF0C\u4F46\u662F\u6CE8\u610F apiserver \u9700\u8981\u8BA4\u8BC1\u7684</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">Name:              kubernetes</span></span>
<span class="line"><span style="color:#393A34;">Namespace:         default</span></span>
<span class="line"><span style="color:#393A34;">Labels:            component=apiserver</span></span>
<span class="line"><span style="color:#393A34;">                   provider=kubernetes</span></span>
<span class="line"><span style="color:#393A34;">Annotations:       </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">Selector:          </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"><span style="color:#393A34;">Type:              ClusterIP</span></span>
<span class="line"><span style="color:#393A34;">IP:                10.96.0.1                                     </span><span style="color:#A0ADA0;"># \u96C6\u7FA4\u5185\u90E8\u8BBF\u95EE apiserver \u7684\u7F51\u5173</span></span>
<span class="line"><span style="color:#393A34;">Port:              https  443/TCP</span></span>
<span class="line"><span style="color:#393A34;">TargetPort:        6443/TCP</span></span>
<span class="line"><span style="color:#393A34;">Endpoints:         172.16.100.101:6443                           </span><span style="color:#A0ADA0;"># apiserver \u5DE5\u4F5C\u7684\u5730\u5740</span></span>
<span class="line"><span style="color:#393A34;">Session Affinity:  None</span></span>
<span class="line"><span style="color:#393A34;">Events:            </span><span style="color:#AB5959;">&lt;</span><span style="color:#393A34;">none</span><span style="color:#AB5959;">&gt;</span></span>
<span class="line"></span></code></pre></div><h2 id="_13-3-serviceaccount-\u5BF9\u8C61" tabindex="-1">13.3 serviceaccount \u5BF9\u8C61 <a class="header-anchor" href="#_13-3-serviceaccount-\u5BF9\u8C61" aria-hidden="true">#</a></h2><p>k8s \u7684\u8BA4\u8BC1\u6709\u4E24\u79CD\u4E00\u79CD\u662F\uFF1Ahuman user\u3001\u4E00\u79CD\u662F serviceaccount\uFF0C\u4E0B\u9762\u5C31\u662F\u521B\u5EFA serviceaccount \u5B83\u662F POD \u8BBF\u95EE apiserver \u6240\u7528\u7684\u4E00\u79CD\u5BF9\u8C61\uFF0C\u800C human user\uFF0C\u5373\u4F7F kubectl \u547D\u4EE4\u884C\u901A\u8FC7\u8BFB\u53D6 config \u4E2D\u7684\u7528\u6237\u800C\u8BA4\u8BC1\u5230 apiserver \u7684\u3002</p><ul><li>\u521B\u5EFA\u4E00\u4E2A serviceaccount \u5BF9\u8C61\uFF0C\u5B83\u4F1A\u81EA\u52A8\u521B\u5EFA\u5E76\u5173\u8054\u4E00\u4E2A secret\uFF0C\u8FD9\u4E2A serviceaccount \u53EF\u4EE5\u5230 apiserver \u4E0A\u8FDB\u884C\u8BA4\u8BC1\uFF0C\u4F46\u662F\u8BA4\u8BC1\u4E0D\u4EE3\u8868\u6709\u6743\u9650\uFF0C\u6240\u4EE5\u9700\u8981\u6388\u6743</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ kubectl create serviceaccount admin</span></span>
<span class="line"><span style="color:#DBD7CA;">$ kubectl get secret</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ kubectl create serviceaccount admin</span></span>
<span class="line"><span style="color:#393A34;">$ kubectl get secret</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>\u521B\u5EFA POD \u4F7F\u7528\u6307\u5B9A\u7684 serviceaccount \u5BF9\u8C61</li></ul><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Pod</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">pod-serviceaccount-demo</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">default</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">labels</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">app</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">myapp</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">tier</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">frontend</span></span>
<span class="line"><span style="color:#429988;">spec</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">containers</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">nginx</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">image</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ikubernetes/myapp:v1</span></span>
<span class="line"><span style="color:#DBD7CA;">      </span><span style="color:#429988;">ports</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">        </span><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">http</span></span>
<span class="line"><span style="color:#DBD7CA;">          </span><span style="color:#429988;">containerPort</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#6394BF;">80</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">serviceAccountName</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">admin</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Pod</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">pod-serviceaccount-demo</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">default</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">labels</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">app</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">myapp</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">tier</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">frontend</span></span>
<span class="line"><span style="color:#2F8A89;">spec</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">containers</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">nginx</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">image</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ikubernetes/myapp:v1</span></span>
<span class="line"><span style="color:#393A34;">      </span><span style="color:#2F8A89;">ports</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">        </span><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">http</span></span>
<span class="line"><span style="color:#393A34;">          </span><span style="color:#2F8A89;">containerPort</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#296AA3;">80</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">serviceAccountName</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">admin</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="_13-3-1-\u5728-pod-\u4E2D\u4F7F\u7528-serviceaccount" tabindex="-1">13.3.1 \u5728 POD \u4E2D\u4F7F\u7528 serviceaccount <a class="header-anchor" href="#_13-3-1-\u5728-pod-\u4E2D\u4F7F\u7528-serviceaccount" aria-hidden="true">#</a></h3><ul><li>POD \u8FDE\u63A5 apiserver \u65F6\u5019\uFF0C\u9700\u8981\u5728\u6E05\u5355\u4E2D\u6307\u5B9A serviceAccountName \u8FD9\u4E2A\u5B57\u6BB5\uFF0C\u8BE6\u89C1\uFF1Akubectl explain pods.spec</li></ul><p>\u6BCF\u4E2A POD \u9ED8\u8BA4\u81EA\u5E26\u4E00\u4E2A volumes\uFF0C\u8FD9\u662F\u4E00\u4E2A secret\uFF0C\u8FD9\u4E2A\u5B58\u50A8\u5377\u4FDD\u5B58\u7740 default-token-bq2gn \u7528\u6765\u8BBF\u95EE apiserver \uFF0C\u800C\u8FD9\u4E2A secret \u6743\u9650\u4EC5\u4EC5\u80FD\u901A\u8FC7 api \u8BBF\u95EE\u5F53\u524D POD \u81EA\u8EAB\u7684\u4FE1\u606F\uFF0C\u5982\u679C\u60F3\u8981\u4E00\u4E2A POD \u62E5\u6709\u7BA1\u7406\u96C6\u7FA4\u7684\u6743\u9650\uFF0C\u90A3\u4E48\u53EF\u4EE5\u624B\u52A8\u521B\u5EFA\u4E00\u4E2A secret \u5E76\u901A\u8FC7 volumes \u6302\u8F7D\u5230 POD \u4E0A\u3002</p><p>serviceaccout \u4E5F\u5C5E\u4E8E\u6807\u51C6\u7684 k8s \u5BF9\u8C61\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u63D0\u4F9B\u4E86\u8D26\u53F7\u4FE1\u606F\uFF0C\u4F46\u662F\u8D26\u53F7\u7531\u6CA1\u6709\u6743\u9650\u9700\u8981 rbac \u673A\u5236\u6765\u51B3\u5B9A\u3002</p><h2 id="_13-4-kubectl-\u914D\u7F6E\u6587\u4EF6" tabindex="-1">13.4 kubectl \u914D\u7F6E\u6587\u4EF6 <a class="header-anchor" href="#_13-4-kubectl-\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a></h2><ul><li>kubectl \u914D\u7F6E\u6587\u4EF6\u89E3\u6790\uFF0C\u8BE6\u89C1\uFF1Akubectl config view</li></ul><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">Config</span></span>
<span class="line"><span style="color:#429988;">clusters</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">                                             </span><span style="color:#758575;"># \u96C6\u7FA4\u5217\u8868</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">cluster</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">                                            </span><span style="color:#758575;"># \u5217\u8868\u4E2D\u7684\u4E00\u4E2A\u96C6\u7FA4\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">certificate-authority-data</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">DATA+OMITTED</span><span style="color:#DBD7CA;">          </span><span style="color:#758575;"># \u670D\u52A1\u5668\u8BA4\u8BC1\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">server</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">https://172.16.100.101:6443</span><span style="color:#DBD7CA;">               </span><span style="color:#758575;"># \u96C6\u7FA4\u7684 apiserver \u5730\u5740</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes</span><span style="color:#DBD7CA;">                                    </span><span style="color:#758575;"># \u96C6\u7FA4\u540D\u79F0</span></span>
<span class="line"><span style="color:#429988;">users</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">                                                </span><span style="color:#758575;"># \u7528\u6237\u5217\u8868</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes-admin</span><span style="color:#DBD7CA;">                              </span><span style="color:#758575;"># \u5217\u8868\u4E2D\u7684\u4E00\u4E2A\u7528\u6237\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">user</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">                                               </span><span style="color:#758575;"># </span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">client-certificate-data</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">REDACTED</span><span style="color:#DBD7CA;">                 </span><span style="color:#758575;"># \u5BA2\u6237\u7AEF\u8BC1\u4E66</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">client-key-data</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">REDACTED</span><span style="color:#DBD7CA;">                         </span><span style="color:#758575;"># \u5BA2\u6237\u7AEF\u79C1\u94A5</span></span>
<span class="line"><span style="color:#429988;">contexts</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">                                             </span><span style="color:#758575;"># \u4E0A\u4E0B\u6587\u5217\u8868</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">context</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;">                                            </span><span style="color:#758575;"># \u5217\u8868\u4E2D\u7684\u4E00\u4E2A\u4E0A\u4E0B\u6587\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">cluster</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes</span><span style="color:#DBD7CA;">                               </span><span style="color:#758575;"># \u96C6\u7FA4\u540D\u79F0</span></span>
<span class="line"><span style="color:#DBD7CA;">    </span><span style="color:#429988;">user</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes-admin</span><span style="color:#DBD7CA;">                            </span><span style="color:#758575;"># \u7528\u6237\u540D\u79F0</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes-admin@kubernetes</span><span style="color:#DBD7CA;">                   </span><span style="color:#758575;"># \u4E0A\u4E0B\u6587\u540D\u79F0</span></span>
<span class="line"><span style="color:#429988;">current-context</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kubernetes-admin@kubernetes</span><span style="color:#DBD7CA;">          </span><span style="color:#758575;"># \u5F53\u524D\u4E0A\u4E0B\u6587</span></span>
<span class="line"><span style="color:#429988;">preferences</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">{}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">Config</span></span>
<span class="line"><span style="color:#2F8A89;">clusters</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">                                             </span><span style="color:#A0ADA0;"># \u96C6\u7FA4\u5217\u8868</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">cluster</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">                                            </span><span style="color:#A0ADA0;"># \u5217\u8868\u4E2D\u7684\u4E00\u4E2A\u96C6\u7FA4\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">certificate-authority-data</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">DATA+OMITTED</span><span style="color:#393A34;">          </span><span style="color:#A0ADA0;"># \u670D\u52A1\u5668\u8BA4\u8BC1\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">server</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">https://172.16.100.101:6443</span><span style="color:#393A34;">               </span><span style="color:#A0ADA0;"># \u96C6\u7FA4\u7684 apiserver \u5730\u5740</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes</span><span style="color:#393A34;">                                    </span><span style="color:#A0ADA0;"># \u96C6\u7FA4\u540D\u79F0</span></span>
<span class="line"><span style="color:#2F8A89;">users</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">                                                </span><span style="color:#A0ADA0;"># \u7528\u6237\u5217\u8868</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes-admin</span><span style="color:#393A34;">                              </span><span style="color:#A0ADA0;"># \u5217\u8868\u4E2D\u7684\u4E00\u4E2A\u7528\u6237\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">user</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">                                               </span><span style="color:#A0ADA0;"># </span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">client-certificate-data</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">REDACTED</span><span style="color:#393A34;">                 </span><span style="color:#A0ADA0;"># \u5BA2\u6237\u7AEF\u8BC1\u4E66</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">client-key-data</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">REDACTED</span><span style="color:#393A34;">                         </span><span style="color:#A0ADA0;"># \u5BA2\u6237\u7AEF\u79C1\u94A5</span></span>
<span class="line"><span style="color:#2F8A89;">contexts</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">                                             </span><span style="color:#A0ADA0;"># \u4E0A\u4E0B\u6587\u5217\u8868</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">context</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;">                                            </span><span style="color:#A0ADA0;"># \u5217\u8868\u4E2D\u7684\u4E00\u4E2A\u4E0A\u4E0B\u6587\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">cluster</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes</span><span style="color:#393A34;">                               </span><span style="color:#A0ADA0;"># \u96C6\u7FA4\u540D\u79F0</span></span>
<span class="line"><span style="color:#393A34;">    </span><span style="color:#2F8A89;">user</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes-admin</span><span style="color:#393A34;">                            </span><span style="color:#A0ADA0;"># \u7528\u6237\u540D\u79F0</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes-admin@kubernetes</span><span style="color:#393A34;">                   </span><span style="color:#A0ADA0;"># \u4E0A\u4E0B\u6587\u540D\u79F0</span></span>
<span class="line"><span style="color:#2F8A89;">current-context</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kubernetes-admin@kubernetes</span><span style="color:#393A34;">          </span><span style="color:#A0ADA0;"># \u5F53\u524D\u4E0A\u4E0B\u6587</span></span>
<span class="line"><span style="color:#2F8A89;">preferences</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">{}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>\u914D\u7F6E\u6587\u4EF6\u4FDD\u5B58\u4E86\uFF1A\u591A\u4E2A\u96C6\u7FA4\u3001\u591A\u7528\u6237\u7684\u914D\u7F6E\uFF0Ckubectl \u53EF\u4EE5\u4F7F\u7528\u4E0D\u540C\u7684\u7528\u6237\u8BBF\u95EE\u4E0D\u540C\u7684\u96C6\u7FA4\u3002</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">\u96C6\u7FA4\u5217\u8868\uFF1A\u96C6\u7FA4\u5BF9\u8C61\u5217\u8868</span></span>
<span class="line"><span style="color:#DBD7CA;">\u7528\u6237\u5217\u8868\uFF1A\u7528\u6237\u5BF9\u8C61\u5217\u8868</span></span>
<span class="line"><span style="color:#DBD7CA;">\u4E0A\u4E0B\u6587\uFF1A\u662F\u63CF\u8FF0\u96C6\u7FA4\u4E0E\u7528\u6237\u7684\u5173\u7CFB\u5217\u8868\u3002</span></span>
<span class="line"><span style="color:#DBD7CA;">\u5F53\u524D\u4E0A\u4E0B\u6587\uFF1A\u8868\u793A\u5F53\u524D\u4F7F\u7528\u54EA\u4E2A\u7528\u6237\u8BBF\u95EE\u54EA\u4E2A\u96C6\u7FA4</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">\u96C6\u7FA4\u5217\u8868\uFF1A\u96C6\u7FA4\u5BF9\u8C61\u5217\u8868</span></span>
<span class="line"><span style="color:#393A34;">\u7528\u6237\u5217\u8868\uFF1A\u7528\u6237\u5BF9\u8C61\u5217\u8868</span></span>
<span class="line"><span style="color:#393A34;">\u4E0A\u4E0B\u6587\uFF1A\u662F\u63CF\u8FF0\u96C6\u7FA4\u4E0E\u7528\u6237\u7684\u5173\u7CFB\u5217\u8868\u3002</span></span>
<span class="line"><span style="color:#393A34;">\u5F53\u524D\u4E0A\u4E0B\u6587\uFF1A\u8868\u793A\u5F53\u524D\u4F7F\u7528\u54EA\u4E2A\u7528\u6237\u8BBF\u95EE\u54EA\u4E2A\u96C6\u7FA4</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">\u81EA\u5B9A\u4E49\u914D\u7F6E\u4FE1\u606F\uFF1A\u8BE6\u89C1\uFF1Akubectl config  --help</span></span>
<span class="line"><span style="color:#DBD7CA;">ca \u548C\u8BC1\u4E66\u4FDD\u5B58\u8DEF\u5F84\uFF1A/etc/kubernetes \u4FDD\u5B58\u4E86\u6240\u6709\u7684 ca \u548C\u7B7E\u53D1\u7684\u8BC1\u4E66\u4FE1\u606F\u3002</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">\u81EA\u5B9A\u4E49\u914D\u7F6E\u4FE1\u606F\uFF1A\u8BE6\u89C1\uFF1Akubectl config  --help</span></span>
<span class="line"><span style="color:#393A34;">ca \u548C\u8BC1\u4E66\u4FDD\u5B58\u8DEF\u5F84\uFF1A/etc/kubernetes \u4FDD\u5B58\u4E86\u6240\u6709\u7684 ca \u548C\u7B7E\u53D1\u7684\u8BC1\u4E66\u4FE1\u606F\u3002</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="_13-5-\u6DFB\u52A0\u8BC1\u4E66\u7528\u6237\u5230-config" tabindex="-1">13.5 \u6DFB\u52A0\u8BC1\u4E66\u7528\u6237\u5230 config <a class="header-anchor" href="#_13-5-\u6DFB\u52A0\u8BC1\u4E66\u7528\u6237\u5230-config" aria-hidden="true">#</a></h2><p>k8s apiserver \u8BA4\u8BC1\u65B9\u5F0F\u6709\u4E24\u79CD\uFF1Assl\u8BC1\u4E66 \u548C token \u8BA4\u8BC1\uFF0C\u672C\u6B21\u4F7F\u7528 ssl \u8BC1\u4E66\u521B\u5EFA\u7528\u6237</p><h3 id="_13-5-1-\u521B\u5EFAssl\u8BC1\u4E66\u7528\u6237" tabindex="-1">13.5.1 \u521B\u5EFASSL\u8BC1\u4E66\u7528\u6237 <a class="header-anchor" href="#_13-5-1-\u521B\u5EFAssl\u8BC1\u4E66\u7528\u6237" aria-hidden="true">#</a></h3><ul><li>\u521B\u5EFA\u8FDE\u63A5 apiserver \u7684\u7528\u6237\u8BC1\u4E66</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># \u521B\u5EFA\u79C1\u94A5</span></span>
<span class="line"><span style="color:#858585;">(</span><span style="color:#DBD7CA;">umask 077</span><span style="color:#CB7676;">;</span><span style="color:#DBD7CA;"> openssl genrsa -out kaliarch.key 2048</span><span style="color:#858585;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u751F\u6210\u8BC1\u4E66\u7B7E\u7F72\u8BF7\u6C42\uFF0CO \u662F\u7EC4\uFF0CCN \u5C31\u662F\u8D26\u53F7\uFF0C\u8FD9\u4E2A\u8D26\u53F7\u88AB k8s \u7528\u6765\u8BC6\u522B\u8EAB\u4EFD\uFF0C\u6388\u6743\u4E5F\u9700\u8981\u6388\u6743\u8FD9\u4E2A\u8D26\u53F7</span></span>
<span class="line"><span style="color:#DBD7CA;">openssl req -new -key kaliarch.key -out kaliarch.csr -subj </span><span style="color:#C98A7D;">&quot;/CN=kaliarch&quot;</span></span>
<span class="line"><span style="color:#758575;">#penssl req -new -key kaliarch.key -out kaliarch.csr -subj &quot;O=system:masters/CN=kaliarch/&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u4F7F\u7528 CA \u7B7E\u7F72\u8BC1\u4E66\uFF0C\u5E76\u4E14\u5728 1800 \u5929\u5185\u6709\u6548</span></span>
<span class="line"><span style="color:#DBD7CA;">openssl x509 -req -in kaliarch.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out kaliarch.crt -days 1800</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u67E5\u770B\u8BC1\u4E66</span></span>
<span class="line"><span style="color:#DBD7CA;">openssl x509 -in kaliarch.crt -text -noout</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u521B\u5EFA\u79C1\u94A5</span></span>
<span class="line"><span style="color:#8E8F8B;">(</span><span style="color:#393A34;">umask 077</span><span style="color:#AB5959;">;</span><span style="color:#393A34;"> openssl genrsa -out kaliarch.key 2048</span><span style="color:#8E8F8B;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u751F\u6210\u8BC1\u4E66\u7B7E\u7F72\u8BF7\u6C42\uFF0CO \u662F\u7EC4\uFF0CCN \u5C31\u662F\u8D26\u53F7\uFF0C\u8FD9\u4E2A\u8D26\u53F7\u88AB k8s \u7528\u6765\u8BC6\u522B\u8EAB\u4EFD\uFF0C\u6388\u6743\u4E5F\u9700\u8981\u6388\u6743\u8FD9\u4E2A\u8D26\u53F7</span></span>
<span class="line"><span style="color:#393A34;">openssl req -new -key kaliarch.key -out kaliarch.csr -subj </span><span style="color:#B56959;">&quot;/CN=kaliarch&quot;</span></span>
<span class="line"><span style="color:#A0ADA0;">#penssl req -new -key kaliarch.key -out kaliarch.csr -subj &quot;O=system:masters/CN=kaliarch/&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u4F7F\u7528 CA \u7B7E\u7F72\u8BC1\u4E66\uFF0C\u5E76\u4E14\u5728 1800 \u5929\u5185\u6709\u6548</span></span>
<span class="line"><span style="color:#393A34;">openssl x509 -req -in kaliarch.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out kaliarch.crt -days 1800</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u67E5\u770B\u8BC1\u4E66</span></span>
<span class="line"><span style="color:#393A34;">openssl x509 -in kaliarch.crt -text -noout</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="_13-5-2-\u6DFB\u52A0ssl\u8BC1\u4E66\u7528\u6237\u5230config" tabindex="-1">13.5.2 \u6DFB\u52A0SSL\u8BC1\u4E66\u7528\u6237\u5230config <a class="header-anchor" href="#_13-5-2-\u6DFB\u52A0ssl\u8BC1\u4E66\u7528\u6237\u5230config" aria-hidden="true">#</a></h3><ul><li>\u5C06 kaliarch \u7528\u6237\u6DFB\u52A0\u5230 k8s \u7684 config \u4E2D\uFF0C\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BC1\u4E66\u4E3A kaliarch.crt\uFF0C\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u79C1\u94A5\u4E3A\uFF1Akaliarch.key\uFF0C\u4F7F\u7528 --embed-certs=true \u6765\u9690\u85CF\u8FD9\u4E9B\u673A\u5BC6\u4FE1\u606F</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-credentials kaliarch --client-certificate=./kaliarch.crt --client-key=./kaliarch.key --embed-certs=true</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-credentials kaliarch --client-certificate=./kaliarch.crt --client-key=./kaliarch.key --embed-certs=true</span></span>
<span class="line"></span></code></pre></div><h3 id="_13-5-3-\u521B\u5EFA\u5207\u6362\u4E0A\u4E0B\u6587" tabindex="-1">13.5.3 \u521B\u5EFA\u5207\u6362\u4E0A\u4E0B\u6587 <a class="header-anchor" href="#_13-5-3-\u521B\u5EFA\u5207\u6362\u4E0A\u4E0B\u6587" aria-hidden="true">#</a></h3><ul><li>\u521B\u5EFA\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u6388\u6743 kaliarch \u7528\u6237\u8BBF\u95EE\u540D\u79F0\u4E3A kubernetes \u7684\u96C6\u7FA4</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-context kaliarch@kubernetes --cluster=kubernetes --user=kaliarch</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-context kaliarch@kubernetes --cluster=kubernetes --user=kaliarch</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>\u5207\u6362\u5F53\u524D\u4F7F\u7528\u7684\u4E0A\u4E0B\u6587\uFF0C\u5230\u6388\u6743 kaliarch \u5230 kubernetes \u7684\u4E0A\u4E0B\u6587\u4E0A</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config use-context kaliarch@kubernetes</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config use-context kaliarch@kubernetes</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>\u7531\u4E8E\u8FD9\u4E2A\u7528\u6237\u6CA1\u6709\u6388\u6743\uFF0C\u6240\u4EE5\u8FD9\u4E2A\u7528\u6237\u662F\u65E0\u6CD5 get \u5230\u4FE1\u606F\u7684\uFF0C\u53EF\u4EE5\u518D\u5207\u6362\u56DE\u6765</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">$ kubectl get pods</span></span>
<span class="line"><span style="color:#DBD7CA;">$ kubectl config use-context kubernetes-admin@kubernetes</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">$ kubectl get pods</span></span>
<span class="line"><span style="color:#393A34;">$ kubectl config use-context kubernetes-admin@kubernetes</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="_13-6-\u521B\u5EFA\u65B0-config-\u6587\u4EF6" tabindex="-1">13.6 \u521B\u5EFA\u65B0 config \u6587\u4EF6 <a class="header-anchor" href="#_13-6-\u521B\u5EFA\u65B0-config-\u6587\u4EF6" aria-hidden="true">#</a></h2><p>\u4F7F\u7528 kubectl config set-cluster \u521B\u5EFA\u4E00\u4E2A\u65B0\u7684 config \u6587\u4EF6\uFF0C\u60F3\u8981\u8BBE\u5B9A\u8FD9\u4E2A\u65B0\u521B\u5EFA\u7684 config \u6587\u4EF6\u53EF\u4EE5\u4F7F\u7528 --kubeconfig=/tmp/test.conf \u6307\u660E\u3002</p><ul><li>\u8BBE\u7F6E\u96C6\u7FA4\u7684\u8FDE\u63A5\u7684 ca \u673A\u6784\u8BC1\u4E66\uFF0C--kubeconfig \u53EF\u4EE5\u6307\u5B9A kubectl \u4F7F\u7528\u7684\u914D\u7F6E\u6587\u4EF6\u4F4D\u7F6E\uFF0C\u9ED8\u8BA4\u4E3A\u7528\u6237\u5BB6\u76EE\u5F55 .kube \u76EE\u5F55\u4E2D\u7684 config</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-cluster k8s-cluster --server=https://172.16.100.101:6443 --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true --kubeconfig=/tmp/test.conf </span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-cluster k8s-cluster --server=https://172.16.100.101:6443 --certificate-authority=/etc/kubernetes/pki/ca.crt --embed-certs=true --kubeconfig=/tmp/test.conf </span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>\u5C06 kaliarch \u7528\u6237\u6DFB\u52A0\u5230 k8s \u7684 config \u4E2D\uFF0C\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u8BC1\u4E66\u4E3A kaliarch.crt\uFF0C\u8BBE\u7F6E\u5BA2\u6237\u7AEF\u79C1\u94A5\u4E3A\uFF1Akaliarch.key\uFF0C\u4F7F\u7528 --embed-certs=true \u6765\u9690\u85CF\u8FD9\u4E9B\u673A\u5BC6\u4FE1\u606F</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-credentials kaliarch --client-certificate=./kaliarch.crt --client-key=./kaliarch.key --embed-certs=true</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-credentials kaliarch --client-certificate=./kaliarch.crt --client-key=./kaliarch.key --embed-certs=true</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>\u521B\u5EFA\u4E0A\u4E0B\u6587\u5BF9\u8C61\uFF0C\u6388\u6743 kaliarch \u7528\u6237\u8BBF\u95EE\u540D\u79F0\u4E3A kubernetes \u7684\u96C6\u7FA4</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config set-context def-ns-admin@k8s-cluster --cluster=k8s-cluster --user=def-ns-admin --kubeconfig=/tmp/test.conf</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config set-context def-ns-admin@k8s-cluster --cluster=k8s-cluster --user=def-ns-admin --kubeconfig=/tmp/test.conf</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>\u5207\u6362\u5F53\u524D\u4F7F\u7528\u7684\u4E0A\u4E0B\u6587\uFF0C\u5230\u6388\u6743 kaliarch \u5230 kubernetes \u7684\u4E0A\u4E0B\u6587\u4E0A</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl config use-context def-ns-admin@k8s-cluster --kubeconfig=/tmp/test.con</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl config use-context def-ns-admin@k8s-cluster --kubeconfig=/tmp/test.con</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="_13-7-\u57FA\u4E8E-token-\u8BA4\u8BC1" tabindex="-1">13.7 \u57FA\u4E8E token \u8BA4\u8BC1 <a class="header-anchor" href="#_13-7-\u57FA\u4E8E-token-\u8BA4\u8BC1" aria-hidden="true">#</a></h2><h3 id="_13-7-1-\u521B\u5EFA-serviceaccount" tabindex="-1">13.7.1 \u521B\u5EFA serviceaccount <a class="header-anchor" href="#_13-7-1-\u521B\u5EFA-serviceaccount" aria-hidden="true">#</a></h3><ul><li>\u4E3A POD \u521B\u5EFA\u4E00\u4E2A serviceaccount \u5BF9\u8C61\uFF0C\u5B83\u662F POD \u8BBF\u95EE apiserver \u7684\u51ED\u8BC1</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl create serviceaccount dashborad-admin -n kube-system</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl create serviceaccount dashborad-admin -n kube-system</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="_13-7-2-\u7ED1\u5B9A\u96C6\u7FA4\u7BA1\u7406\u5458\u89D2\u8272" tabindex="-1">13.7.2 \u7ED1\u5B9A\u96C6\u7FA4\u7BA1\u7406\u5458\u89D2\u8272 <a class="header-anchor" href="#_13-7-2-\u7ED1\u5B9A\u96C6\u7FA4\u7BA1\u7406\u5458\u89D2\u8272" aria-hidden="true">#</a></h3><ul><li>\u521B\u5EFA clusterrolebinding \u5C06\u7528\u6237\u7ED1\u5B9A\u81F3 cluster-admin \u96C6\u7FA4\u7BA1\u7406\u5458\uFF08\u6700\u9AD8\u6743\u9650\uFF09</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl create clusterrolebinding dashborad-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashborad-admin</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl create clusterrolebinding dashborad-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashborad-admin</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="_13-7-3-\u901A\u8FC7-serviceaccount-\u5F97\u5230-token" tabindex="-1">13.7.3 \u901A\u8FC7 serviceaccount \u5F97\u5230 Token <a class="header-anchor" href="#_13-7-3-\u901A\u8FC7-serviceaccount-\u5F97\u5230-token" aria-hidden="true">#</a></h3><ul><li>\u627E\u5230\u521A\u624D\u521B\u5EFA\u7684 serviceaccount \u5BF9\u8C61</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl get secret -n kube-system</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl get secret -n kube-system</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>\u5F97\u5230 serviceaccount \u5BF9\u8C61\u4E2D\u7684 Token</li></ul><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl describe secret -n kube-system dashborad-admin-token-skz95</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl describe secret -n kube-system dashborad-admin-token-skz95</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div>`,67),c=[p];function o(t,r,i,y,d,A){return a(),n("div",null,c)}var k=s(e,[["render",o]]);export{D as __pageData,k as default};
