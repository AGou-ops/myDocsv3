import{_ as s,o as n,c as a,a as e}from"./app.1e6146c3.js";const m=JSON.parse('{"title":"Kubernetes CLI command -- kubectl","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u57FA\u7840\u547D\u4EE4","slug":"\u57FA\u7840\u547D\u4EE4"},{"level":2,"title":"cluster \u5FEB\u901F\u90E8\u7F72","slug":"cluster-\u5FEB\u901F\u90E8\u7F72"},{"level":2,"title":"\u9644\u5F55","slug":"\u9644\u5F55"},{"level":2,"title":"\u53C2\u8003\u94FE\u63A5","slug":"\u53C2\u8003\u94FE\u63A5"}],"relativePath":"CloudNative/k8s/k8s command.md","lastUpdated":1657272051000}'),l={name:"CloudNative/k8s/k8s command.md"},p=e(`<h1 id="kubernetes-cli-command-kubectl" tabindex="-1">Kubernetes CLI command -- kubectl <a class="header-anchor" href="#kubernetes-cli-command-kubectl" aria-hidden="true">#</a></h1><h2 id="\u57FA\u7840\u547D\u4EE4" tabindex="-1">\u57FA\u7840\u547D\u4EE4 <a class="header-anchor" href="#\u57FA\u7840\u547D\u4EE4" aria-hidden="true">#</a></h2><ul><li><code>kubectl cluster-info</code>: \u67E5\u770B\u96C6\u7FA4\u72B6\u6001;</li><li><code>kubectl get pods --selector=&quot;name=bad-frontend&quot;</code>: \u6307\u5B9A\u67E5\u770Bpod\u7684<code>name</code>\u5C5E\u6027;</li><li><code>kubectl expose deployment first-deployment --port=80 --type=NodePort</code>: \u66B4\u9732\u6307\u5B9A\u7AEF\u53E3, \u4EE5\u53CA\u6307\u5B9A\u7C7B\u578B;</li><li><code>kubectl get svc first-deployment -o go-template=&#39;\u3010\u3010range.spec.ports\u3011\u3011\u3010\u3010if .nodePort\u3011\u3011\u3010\u3010.nodePort\u3011\u3011\u3010\u3010&quot;\\n&quot;\u3011\u3011\u3010\u3010end\u3011\u3011\u3010\u3010end\u3011\u3011&#39;</code>: \u83B7\u53D6<code>service</code>\u66B4\u9732\u7684\u7AEF\u53E3; <ul><li>[\u4F7F\u7528<code>jsonpath</code>\u83B7\u53D6]: <code>kubectl get svc first-deployment -o jsonpath=&#39;{.spec..ports[0].nodePort}&#39;</code></li></ul></li><li>\u3010\u65B0\u7248\u672C\u5DF2\u5F03\u7528\u3011<code>kubectl run http --image=katacoda/docker-http-server:latest --replicas=1</code>: \u624B\u52A8\u8FD0\u884C\u4E00\u4E2A<code>deployment</code>\u5E76\u6307\u5B9A\u5176<code>pod</code>\u955C\u50CF; <ul><li><code>kubectl expose deployment http --external-ip=&quot;172.17.0.42&quot; --port=8000 --target-port=80</code>: \u66B4\u9732\u7AEF\u53E3\u53CA\u8BBF\u95EE\u5730\u5740;</li><li>\u6216\u8005\u76F4\u63A5\u4F7F\u7528: <code>kubectl run httpexposed --image=katacoda/docker-http-server:latest --replicas=1 --port=80 --hostport=8001</code></li></ul></li><li><code>kubectl exec -it POD_NAME -c CONTAINTER_NAME -- bin/sh</code>: \u8FDB\u5165\u4E00\u4E2A\u542B\u6709\u591A\u4E2A\u5BB9\u5668\u7684pod;</li><li><code>kubectl scale --replicas=3 deployment http</code>: \u6269\u5BB9;</li><li><code>kubectl set image deployment.v1.apps/nginx-deployment nginx=nginx:1.9.1 --record</code>: \u66F4\u65B0\u955C\u50CF;</li><li><code>kubectl set resources deployment nginx -c =nginx --limits =cpu=200m,memory =512Mi</code>: \u66F4\u65B0\u8D44\u6E90\u4F7F\u7528;</li><li><code>kubectl patch deployments myapp-deploy -p &#39;{ &quot;spec&quot;: {&quot;replicas&quot;:5}}&#39;</code>: \u6253\u8865\u4E01;</li><li><code>kubectl rollout history deployment.v1.apps/nginx-deployment --revision=2</code>\uFF1A\u67E5\u770B\u5386\u53F2\u4FEE\u8BA2\u7684\u8BE6\u7EC6\u4FE1\u606F\uFF1B</li><li><code>kubectl rollout undo deployment myapp-deploy --to-revision=2</code>: \u56DE\u6EDA\u81F3\u6307\u5B9A\u7248\u672C;</li><li><code>kubectl rollout status deployments myapp-deploy</code>: \u56DE\u6EDA\u64CD\u4F5C\u72B6\u6001\u4FE1\u606F;</li><li><code>kubectl rollout pause deployment/myapp-deploy</code>: \u6682\u505C\u66F4\u65B0deployment(\u7528\u4E8E\u591A\u6B21\u66F4\u65B0deployment); <ul><li><code>kubectl rollout resume deployment/myapp-deploy</code>: \u6062\u590D\u66F4\u65B0deployment;</li></ul></li><li><code>kubectl get pods -l &#39;environment in (production),tier in (frontend)&#39;</code>: \u8FC7\u6EE4\u663E\u793A\u6307\u5B9A\u6807\u7B7E\u7684pod; <ul><li><code>kubectl get pods -l environment=production,tier=frontend</code></li></ul></li><li><code>kubectl apply-validate-f pod.yaml</code>: \u68C0\u67E5yaml\u6587\u4EF6\u683C\u5F0F\u662F\u5426\u6709\u9519\u8BEF\u4E4B\u5904;</li><li><code>kubectl apply -R DIR/</code>: \u9012\u5F52\u5E94\u7528\u76EE\u5F55\u4E2D\u7684\u914D\u7F6E\u6E05\u5355\u6587\u4EF6;</li><li><code>kubectl get componentstatuses</code>: \u68C0\u67E5\u63A7\u5236\u5E73\u53F0\u7EC4\u4EF6\u7684\u72B6\u6001\uFF1B</li><li><code>kubectl logs kube-scheduler-master01 -n kube-system</code>\uFF1A\u83B7\u53D6\u8C03\u5EA6\u5668\u65E5\u5FD7\uFF0C\u5305\u62EC\u8C03\u5EA6\u8BB0\u5F55\uFF0C\u6253\u5206\u8BB0\u5F55\u7B49\uFF1B</li></ul><h2 id="cluster-\u5FEB\u901F\u90E8\u7F72" tabindex="-1">cluster \u5FEB\u901F\u90E8\u7F72 <a class="header-anchor" href="#cluster-\u5FEB\u901F\u90E8\u7F72" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#758575;"># \u4F7F\u7528\u8F7B\u91CF\u7EA7\u5BB9\u5668\u5F15\u64CEcrio, \u9700\u8981\u63D0\u524D\u5B89\u88C5</span></span>
<span class="line"><span style="color:#758575;"># systemctl restart crio</span></span>
<span class="line"><span style="color:#DBD7CA;">kubeadm init --token=102952.1a7dd4cc8d1f4cc5 --kubernetes-version </span><span style="color:#C98A7D;">$(kubeadm version -o short)</span></span>
<span class="line"><span style="color:#758575;"># \u521D\u59CB\u5316\u65F6\u8C03\u7528crio\u5F15\u64CE</span></span>
<span class="line"><span style="color:#758575;"># kubeadm init --cri-socket=/var/run/crio/crio.sock --kubernetes-version $(kubeadm version -o short)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#758575;"># \u521D\u59CB\u5316\u5B8C\u6BD5\u4E4B\u540E, crio\u67E5\u770B\u5BB9\u5668\u8FD0\u884C\u72B6\u6001</span></span>
<span class="line"><span style="color:#758575;"># crictl ps</span></span>
<span class="line"><span style="color:#DBD7CA;">sudo cp /etc/kubernetes/admin.conf </span><span style="color:#858585;">$</span><span style="color:#B8A965;">HOME</span><span style="color:#DBD7CA;">/</span></span>
<span class="line"><span style="color:#DBD7CA;">sudo chown </span><span style="color:#C98A7D;">$(id -u)</span><span style="color:#DBD7CA;">:</span><span style="color:#C98A7D;">$(id -g)</span><span style="color:#DBD7CA;"> </span><span style="color:#858585;">$</span><span style="color:#B8A965;">HOME</span><span style="color:#DBD7CA;">/admin.conf</span></span>
<span class="line"><span style="color:#CB7676;">export</span><span style="color:#DBD7CA;"> KUBECONFIG=</span><span style="color:#858585;">$</span><span style="color:#B8A965;">HOME</span><span style="color:#DBD7CA;">/admin.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">kubectl apply -f /opt/weave-kube.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">kubectl get pod -n kube-system</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">kubeadm token list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBD7CA;">kubeadm join --discovery-token-unsafe-skip-ca-verification --token=102952.1a7dd4cc8d1f4cc5 172.17.0.66:6443</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#A0ADA0;"># \u4F7F\u7528\u8F7B\u91CF\u7EA7\u5BB9\u5668\u5F15\u64CEcrio, \u9700\u8981\u63D0\u524D\u5B89\u88C5</span></span>
<span class="line"><span style="color:#A0ADA0;"># systemctl restart crio</span></span>
<span class="line"><span style="color:#393A34;">kubeadm init --token=102952.1a7dd4cc8d1f4cc5 --kubernetes-version </span><span style="color:#B56959;">$(kubeadm version -o short)</span></span>
<span class="line"><span style="color:#A0ADA0;"># \u521D\u59CB\u5316\u65F6\u8C03\u7528crio\u5F15\u64CE</span></span>
<span class="line"><span style="color:#A0ADA0;"># kubeadm init --cri-socket=/var/run/crio/crio.sock --kubernetes-version $(kubeadm version -o short)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;"># \u521D\u59CB\u5316\u5B8C\u6BD5\u4E4B\u540E, crio\u67E5\u770B\u5BB9\u5668\u8FD0\u884C\u72B6\u6001</span></span>
<span class="line"><span style="color:#A0ADA0;"># crictl ps</span></span>
<span class="line"><span style="color:#393A34;">sudo cp /etc/kubernetes/admin.conf </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">HOME</span><span style="color:#393A34;">/</span></span>
<span class="line"><span style="color:#393A34;">sudo chown </span><span style="color:#B56959;">$(id -u)</span><span style="color:#393A34;">:</span><span style="color:#B56959;">$(id -g)</span><span style="color:#393A34;"> </span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">HOME</span><span style="color:#393A34;">/admin.conf</span></span>
<span class="line"><span style="color:#AB5959;">export</span><span style="color:#393A34;"> KUBECONFIG=</span><span style="color:#8E8F8B;">$</span><span style="color:#8C862B;">HOME</span><span style="color:#393A34;">/admin.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">kubectl apply -f /opt/weave-kube.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">kubectl get pod -n kube-system</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">kubeadm token list</span></span>
<span class="line"></span>
<span class="line"><span style="color:#393A34;">kubeadm join --discovery-token-unsafe-skip-ca-verification --token=102952.1a7dd4cc8d1f4cc5 172.17.0.66:6443</span></span>
<span class="line"></span></code></pre></div><p>By default, the <code>crictl</code> CLI is configured to communicate with the runtime by the config file at <code>cat /etc/crictl.yaml</code></p><p>dashboard \u8D26\u6237\u8BA4\u8BC1(token):</p><div class="language-yaml"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#C98A7D;">cat &lt;&lt;EOF | kubectl create -f -</span><span style="color:#DBD7CA;"> </span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">v1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ServiceAccount</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">admin-user</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kube-system</span></span>
<span class="line"><span style="color:#A1B567;">---</span></span>
<span class="line"><span style="color:#429988;">apiVersion</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#429988;">metadata</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">admin-user</span></span>
<span class="line"><span style="color:#429988;">roleRef</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">apiGroup</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ClusterRole</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">cluster-admin</span></span>
<span class="line"><span style="color:#429988;">subjects</span><span style="color:#858585;">:</span></span>
<span class="line"><span style="color:#858585;">-</span><span style="color:#DBD7CA;"> </span><span style="color:#429988;">kind</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">ServiceAccount</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">name</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">admin-user</span></span>
<span class="line"><span style="color:#DBD7CA;">  </span><span style="color:#429988;">namespace</span><span style="color:#858585;">:</span><span style="color:#DBD7CA;"> </span><span style="color:#C98A7D;">kube-system</span></span>
<span class="line"><span style="color:#C98A7D;">EOF</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#B56959;">cat &lt;&lt;EOF | kubectl create -f -</span><span style="color:#393A34;"> </span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">v1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ServiceAccount</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">admin-user</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kube-system</span></span>
<span class="line"><span style="color:#6C7834;">---</span></span>
<span class="line"><span style="color:#2F8A89;">apiVersion</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io/v1beta1</span></span>
<span class="line"><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#2F8A89;">metadata</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">admin-user</span></span>
<span class="line"><span style="color:#2F8A89;">roleRef</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">apiGroup</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ClusterRole</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">cluster-admin</span></span>
<span class="line"><span style="color:#2F8A89;">subjects</span><span style="color:#8E8F8B;">:</span></span>
<span class="line"><span style="color:#8E8F8B;">-</span><span style="color:#393A34;"> </span><span style="color:#2F8A89;">kind</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">ServiceAccount</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">name</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">admin-user</span></span>
<span class="line"><span style="color:#393A34;">  </span><span style="color:#2F8A89;">namespace</span><span style="color:#8E8F8B;">:</span><span style="color:#393A34;"> </span><span style="color:#B56959;">kube-system</span></span>
<span class="line"><span style="color:#B56959;">EOF</span></span>
<span class="line"></span></code></pre></div><p>\u83B7\u53D6token:</p><div class="language-bash"><span class="copy"></span><pre class="vp-code-dark"><code><span class="line"><span style="color:#DBD7CA;">kubectl -n kube-system describe secret </span><span style="color:#C98A7D;">$(kubectl -n kube-system get secret </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;"> grep admin-user </span><span style="color:#CB7676;">|</span><span style="color:#C98A7D;"> awk &#39;{print $1}&#39;)</span></span>
<span class="line"></span></code></pre><pre class="vp-code-light"><code><span class="line"><span style="color:#393A34;">kubectl -n kube-system describe secret </span><span style="color:#B56959;">$(kubectl -n kube-system get secret </span><span style="color:#AB5959;">|</span><span style="color:#B56959;"> grep admin-user </span><span style="color:#AB5959;">|</span><span style="color:#B56959;"> awk &#39;{print $1}&#39;)</span></span>
<span class="line"></span></code></pre></div><h2 id="\u9644\u5F55" tabindex="-1">\u9644\u5F55 <a class="header-anchor" href="#\u9644\u5F55" aria-hidden="true">#</a></h2><h2 id="\u53C2\u8003\u94FE\u63A5" tabindex="-1">\u53C2\u8003\u94FE\u63A5 <a class="header-anchor" href="#\u53C2\u8003\u94FE\u63A5" aria-hidden="true">#</a></h2><ul><li>kubectl commands offical documentation: <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a></li></ul>`,13),o=[p];function c(t,r,i,y,d,u){return n(),a("div",null,o)}var k=s(l,[["render",c]]);export{m as __pageData,k as default};
